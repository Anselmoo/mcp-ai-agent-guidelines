# ðŸ”§ P4-005: Implement SpecKitStrategy - plan.md Generation [serial]

> **Parent**: #TBD
> **Labels**: `phase-4a`, `priority-high`, `serial`, `copilot-suitable`, `mcp-serena`
> **Milestone**: M5: Spec-Kit Core
> **Estimate**: 4 hours
> **Depends On**: P4-004
> **Blocks**: P4-007

## Context

The plan.md document outlines the implementation approach, phases, timeline, and risks.

## Task Description

Implement plan.md generation:

**Add to `src/strategies/speckit-strategy.ts`:**
```typescript
private renderPlan(result: any): OutputDocument {
  const plan = this.extractPlan(result);

  const content = `# Implementation Plan

## Approach

${plan.approach}

## Phases

${plan.phases.map(p => `### ${p.id}: ${p.name}

${p.description}

**Duration**: ${p.duration}

**Deliverables**:
${p.deliverables.map(d => `- ${d}`).join('\n')}
`).join('\n')}

## Dependencies

| ID | Description | Owner |
|----|-------------|-------|
${plan.dependencies.map(d => `| ${d.id} | ${d.description} | ${d.owner ?? 'TBD'} |`).join('\n')}

## Risks

| ID | Risk | Severity | Mitigation |
|----|------|----------|------------|
${plan.risks.map(r => `| ${r.id} | ${r.description} | ${r.severity} | ${r.mitigation} |`).join('\n')}

## Timeline

| Phase | Start | End |
|-------|-------|-----|
${plan.timeline.map(t => `| ${t.phase} | Week ${t.startWeek} | Week ${t.endWeek} |`).join('\n')}

---
*Generated by SpecKitStrategy*
`;

  return {
    name: 'plan.md',
    content,
    format: 'markdown',
  };
}

private extractPlan(result: any): Plan {
  // Extract plan from domain result
  // Map session phases to plan phases
  // Extract risks from session context

  return {
    approach: result.context?.approach ?? 'Iterative implementation following Spec-Kit methodology',
    phases: this.derivePhases(result),
    dependencies: this.deriveDependencies(result),
    risks: this.deriveRisks(result),
    timeline: this.deriveTimeline(result),
  };
}

private derivePhases(result: any): Phase[] {
  // Map design session phases to plan phases
}

private deriveTimeline(result: any): TimelineEntry[] {
  // Generate timeline from phases and estimates
}
```

## Acceptance Criteria

- [ ] `renderPlan()` method implemented
- [ ] Approach section
- [ ] Phases section with deliverables
- [ ] Dependencies table
- [ ] Risks table with severity and mitigation
- [ ] Timeline table
- [ ] Phase generation from domain result
- [ ] Unit tests

## Files to Modify

- `src/strategies/speckit-strategy.ts`
- `tests/vitest/strategies/speckit-strategy.spec.ts`

## Verification

```bash
npm run build && npm run test:vitest -- speckit-strategy
```

## References

- [SPEC-005: Spec-Kit Integration](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/development/plan-v0.13.x/specs/SPEC-005-speckit-integration.md)
- [TASKS Phase 4](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/development/plan-v0.13.x/tasks/TASKS-phase-4-speckit-integration.md) P4-005
