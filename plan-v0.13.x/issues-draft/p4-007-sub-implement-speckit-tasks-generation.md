# ðŸ”§ P4-007: Implement SpecKitStrategy - tasks.md Generation [serial]

> **Parent**: #TBD
> **Labels**: `phase-4a`, `priority-high`, `serial`, `copilot-suitable`, `mcp-serena`
> **Milestone**: M5: Spec-Kit Core
> **Estimate**: 3 hours
> **Depends On**: P4-006
> **Blocks**: P4-008

## Context

The tasks.md document contains detailed task breakdowns with dependencies and phase assignments.

## Task Description

Implement tasks.md generation:

**Add to `src/strategies/speckit-strategy.ts`:**
```typescript
private renderTasks(result: any): OutputDocument {
  const spec = this.extractSpec(result);
  const tasks = this.deriveTasksFromSpec(spec);
  const groupedTasks = this.groupTasksByPhase(tasks);

  const content = `# Tasks

## Overview

**Total Tasks**: ${tasks.length}
**Estimated Effort**: ${this.calculateTotalEstimate(tasks)}

## Task List

${Object.entries(groupedTasks).map(([phase, phaseTasks]) => `### ${phase}

${phaseTasks.map(t => `#### ${t.id}: ${t.title}

- **Priority**: ${t.priority}
- **Estimate**: ${t.estimate}
${t.dependencies?.length ? `- **Dependencies**: ${t.dependencies.join(', ')}` : ''}

${t.description}

**Acceptance Criteria**:
${t.acceptanceCriteria.map(ac => `- [ ] ${ac}`).join('\n')}

---
`).join('\n')}`).join('\n')}

## Dependencies Graph

\`\`\`mermaid
${this.generateDependencyGraph(tasks)}
\`\`\`

## By Priority

### High Priority
${tasks.filter(t => t.priority === 'high').map(t => `- [ ] ${t.id}: ${t.title}`).join('\n')}

### Medium Priority
${tasks.filter(t => t.priority === 'medium').map(t => `- [ ] ${t.id}: ${t.title}`).join('\n')}

### Low Priority
${tasks.filter(t => t.priority === 'low').map(t => `- [ ] ${t.id}: ${t.title}`).join('\n')}

---
*Generated by SpecKitStrategy*
`;

  return {
    name: 'tasks.md',
    content,
    format: 'markdown',
  };
}

private groupTasksByPhase(tasks: DerivedTask[]): Record<string, DerivedTask[]> {
  const grouped: Record<string, DerivedTask[]> = {
    'Phase 1': [],
    'Phase 2': [],
    'Unassigned': [],
  };

  for (const task of tasks) {
    const phase = task.phase ?? 'Unassigned';
    if (!grouped[phase]) grouped[phase] = [];
    grouped[phase].push(task);
  }

  return grouped;
}

private generateDependencyGraph(tasks: DerivedTask[]): string {
  const lines = ['graph TD'];

  for (const task of tasks) {
    if (task.dependencies?.length) {
      for (const dep of task.dependencies) {
        lines.push(`    ${dep} --> ${task.id}`);
      }
    } else {
      lines.push(`    ${task.id}[${task.id}]`);
    }
  }

  return lines.join('\n');
}

private calculateTotalEstimate(tasks: DerivedTask[]): string {
  let totalHours = 0;

  for (const task of tasks) {
    const match = task.estimate.match(/(\d+)h/);
    if (match) {
      totalHours += parseInt(match[1], 10);
    }
  }

  return `${totalHours}h (~${Math.ceil(totalHours / 8)} days)`;
}
```

## Acceptance Criteria

- [ ] `renderTasks()` method implemented
- [ ] Task list with details and checkboxes
- [ ] Tasks grouped by phase
- [ ] Priority indicators
- [ ] Dependency tracking
- [ ] Mermaid dependency graph
- [ ] Total estimate calculation
- [ ] Unit tests

## Files to Modify

- `src/strategies/speckit-strategy.ts`
- `tests/vitest/strategies/speckit-strategy.spec.ts`

## Verification

```bash
npm run build && npm run test:vitest -- speckit-strategy
```

## References

- [SPEC-005: Spec-Kit Integration](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/development/plan-v0.13.x/specs/SPEC-005-speckit-integration.md)
- [TASKS Phase 4](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/development/plan-v0.13.x/tasks/TASKS-phase-4-speckit-integration.md) P4-007
