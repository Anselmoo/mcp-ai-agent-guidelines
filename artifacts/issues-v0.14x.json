[
	{
		"title": "Phase 1: Core Infrastructure",
		"body": "# Phase 1: Core Infrastructure\n\n## Summary\n\nPhase-level parent issue for Phase 1: Core Infrastructure.\n\n## Scope\n\n- Track all Phase 1: Core Infrastructure tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-1\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 1: Core Infrastructure are created\n- [ ] Milestone 17 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "PARENT-1",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-1",
		"child_task_ids": [
			"T-001",
			"T-002",
			"T-003",
			"T-004",
			"T-005",
			"T-006",
			"T-007",
			"T-008",
			"T-009",
			"T-010"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 2: Strategy Migration",
		"body": "# Phase 2: Strategy Migration\n\n## Summary\n\nPhase-level parent issue for Phase 2: Strategy Migration.\n\n## Scope\n\n- Track all Phase 2: Strategy Migration tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-2\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 2: Strategy Migration are created\n- [ ] Milestone 18 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "PARENT-2",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-2",
		"child_task_ids": [
			"T-011",
			"T-012",
			"T-013",
			"T-014",
			"T-015",
			"T-016",
			"T-017",
			"T-018",
			"T-019",
			"T-020",
			"T-021",
			"T-022"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 2.5: Unified Prompt Ecosystem",
		"body": "# Phase 2.5: Unified Prompt Ecosystem\n\n## Summary\n\nPhase-level parent issue for Phase 2.5: Unified Prompt Ecosystem.\n\n## Scope\n\n- Track all Phase 2.5: Unified Prompt Ecosystem tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-25\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 2.5: Unified Prompt Ecosystem are created\n- [ ] Milestone 19 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "PARENT-2.5",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-25",
		"child_task_ids": [
			"T-023",
			"T-024",
			"T-025",
			"T-026",
			"T-027",
			"T-028",
			"T-029",
			"T-030",
			"T-031",
			"T-033",
			"T-034",
			"T-035",
			"T-036"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 3: Framework Consolidation",
		"body": "# Phase 3: Framework Consolidation\n\n## Summary\n\nPhase-level parent issue for Phase 3: Framework Consolidation.\n\n## Scope\n\n- Track all Phase 3: Framework Consolidation tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-3\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 3: Framework Consolidation are created\n- [ ] Milestone 20 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "PARENT-3",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-3",
		"child_task_ids": [
			"T-032",
			"T-037",
			"T-038",
			"T-039",
			"T-040",
			"T-041",
			"T-042",
			"T-043",
			"T-044",
			"T-045",
			"T-046",
			"T-047",
			"T-048",
			"T-049",
			"T-050",
			"T-051",
			"T-052"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 4: Platform Abstraction",
		"body": "# Phase 4: Platform Abstraction\n\n## Summary\n\nPhase-level parent issue for Phase 4: Platform Abstraction.\n\n## Scope\n\n- Track all Phase 4: Platform Abstraction tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-4\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 4: Platform Abstraction are created\n- [ ] Milestone 21 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P0-critical"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P0",
		"task_id": "PARENT-4",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-4",
		"child_task_ids": [
			"T-053",
			"T-054",
			"T-055",
			"T-056",
			"T-057",
			"T-058",
			"T-059",
			"T-060"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 5: CI/CD & Documentation",
		"body": "# Phase 5: CI/CD & Documentation\n\n## Summary\n\nPhase-level parent issue for Phase 5: CI/CD & Documentation.\n\n## Scope\n\n- Track all Phase 5: CI/CD & Documentation tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-5\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 5: CI/CD & Documentation are created\n- [ ] Milestone 22 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-5", "implementation", "P0-critical"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P0",
		"task_id": "PARENT-5",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-5",
		"child_task_ids": [
			"T-061",
			"T-062",
			"T-063",
			"T-064",
			"T-065",
			"T-066",
			"T-067",
			"T-068"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Phase 6: Testing & Validation",
		"body": "# Phase 6: Testing & Validation\n\n## Summary\n\nPhase-level parent issue for Phase 6: Testing & Validation.\n\n## Scope\n\n- Track all Phase 6: Testing & Validation tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-6\n\n## Acceptance Criteria\n\n- [ ] All child issues for Phase 6: Testing & Validation are created\n- [ ] Milestone 23 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "PARENT-6",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Aphase-6",
		"child_task_ids": [
			"T-069",
			"T-070",
			"T-071",
			"T-072",
			"T-073",
			"T-074",
			"T-075",
			"T-076"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "Validation: Phase-wide Verification",
		"body": "# Validation: Phase-wide Verification\n\n## Summary\n\nPhase-level parent issue for Validation: Phase-wide Verification.\n\n## Scope\n\n- Track all Validation: Phase-wide Verification tasks\n- Monitor milestones and dependencies\n- Ensure validation tasks are completed\n\n## Child Issues\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Atesting\n\n## Acceptance Criteria\n\n- [ ] All child issues for Validation: Phase-wide Verification are created\n- [ ] Milestone 24 assigned\n- [ ] Phase completion verified\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-PARENT",
		"dependencies": [],
		"estimate_hours": null,
		"source_path": "",
		"source_url": "",
		"child_issue_query": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues?q=label%3Av0.14.x%20label%3Atesting",
		"child_task_ids": [
			"V-001",
			"V-002",
			"V-003",
			"V-004",
			"V-005",
			"V-006",
			"V-007",
			"V-008",
			"V-009",
			"V-010",
			"V-011",
			"V-012",
			"V-013",
			"V-014",
			"V-015"
		],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-001: Create BaseStrategy<T> Abstract Class",
		"body": "# T-001: Create BaseStrategy<T> Abstract Class\n\n## Overview\n\n**Task ID**: T-001\n**Phase**: 1 - Core Infrastructure\n**Priority**: P0 (Critical Path)\n**Estimate**: 4 hours\n**Dependencies**: None\n**Blocks**: T-002, T-011-T-017\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nCreate an abstract base class `BaseStrategy<TInput, TOutput>` that enforces a consistent interface across all 7 strategy implementations (SpecKit, TOGAF, ADR, RFC, Enterprise, SDD, Chat).\n\n### Why\n\nThe current codebase has 7 independent strategy implementations with:\n- No common interface ‚Üí inconsistent error handling\n- No execution tracing ‚Üí poor debugging\n- No HITL integration ‚Üí missing feedback loops\n\nResearch from MCP community, Salesforce Agentforce, and Temporal confirms mandatory HITL for production AI workflows.\n\n### Target File\n\n`src/strategies/shared/base-strategy.ts`\n\n---\n\n## 2. Prerequisites\n\n### Environment Setup\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Ensure you're on the correct branch\ngit checkout -b feat/base-strategy\n\n# Install dependencies\nnpm ci\n\n# Verify build\nnpm run build\n```\n\n### Files to Review\n\n| File | Purpose |\n| ------------------------------------------------------------------ | ------------------------------ |\n| [output-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/src/strategies/output-strategy.ts) | Current interface to extend |\n| [speckit-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/src/strategies/speckit-strategy.ts) | Example of existing strategy |\n| [types.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/src/strategies/speckit/types.ts) | Type definitions to understand |\n\n---\n\n## 3. Implementation Guide\n\n### Step 3.1: Create Type Definitions\n\nCreate the types first to establish the contract:\n\n```typescript\n// src/strategies/shared/types.ts\n\n/**\n * Result of input validation.\n */\nexport interface ValidationResult {\n /** Whether validation passed */\n valid: boolean;\n /** List of validation errors (empty if valid) */\n errors: ValidationError[];\n /** List of validation warnings (non-blocking) */\n warnings: ValidationWarning[];\n}\n\n/**\n * Validation error with structured context.\n */\nexport interface ValidationError {\n /** Error code for programmatic handling */\n code: string;\n /** Human-readable error message */\n message: string;\n /** Field or path that caused the error */\n field?: string;\n /** Additional context */\n context?: Record<string, unknown>;\n}\n\n/**\n * Validation warning (non-blocking).\n */\nexport interface ValidationWarning {\n code: string;\n message: string;\n field?: string;\n suggestion?: string;\n}\n\n/**\n * Result of strategy execution.\n */\nexport interface StrategyResult<T> {\n /** Whether execution succeeded */\n success: boolean;\n /** Output data (present if success=true) */\n data?: T;\n /** Execution errors (present if success=false) */\n errors?: ValidationError[];\n /** Execution trace for debugging */\n trace: ExecutionTraceExport;\n /** Execution duration in milliseconds */\n durationMs: number;\n}\n\n/**\n * Exported execution trace for serialization.\n */\nexport interface ExecutionTraceExport {\n traceId: string;\n startTime: string;\n endTime: string;\n entries: TraceEntry[];\n summary: TraceSummary;\n}\n\n/**\n * Single trace entry.\n */\nexport interface TraceEntry {\n timestamp: string;\n type: 'start' | 'decision' | 'metric' | 'error' | 'success' | 'warning';\n message: string;\n data?: Record<string, unknown>;\n}\n\n/**\n * Trace summary for quick analysis.\n */\nexport interface TraceSummary {\n totalDecisions: number;\n totalErrors: number;\n totalWarnings: number;\n durationMs: number;\n}\n```\n\n### Step 3.2: Create ExecutionTrace Stub\n\nWe need a minimal ExecutionTrace for BaseStrategy. Full implementation is T-003.\n\n```typescript\n// src/strategies/shared/execution-trace.ts\n\nimport type { ExecutionTraceExport, TraceEntry, TraceSummary } from './types.js';\n\n/**\n * Execution trace for logging decisions and metrics.\n *\n * Provides transparency into strategy execution for debugging,\n * auditing, and human review.\n *\n * \n * ```typescript\n * const trace = new ExecutionTrace();\n * trace.recordDecision('Selected approach', 'Based on input complexity');\n * trace.recordMetric('validationTime', 45, 'ms');\n * console.log(trace.toMarkdown());\n * ```\n */\nexport class ExecutionTrace {\n private readonly traceId: string;\n private readonly startTime: Date;\n private readonly entries: TraceEntry[] = [];\n private endTime?: Date;\n\n constructor() {\n this.traceId = this.generateTraceId();\n this.startTime = new Date();\n }\n\n /**\n * Record the start of execution.\n */\n recordStart(data: Record<string, unknown>): void {\n this.entries.push({\n timestamp: new Date().toISOString(),\n type: 'start',\n message: 'Strategy execution started',\n data,\n });\n }\n\n /**\n * Record a decision point with rationale.\n *\n * decision - What was decided\n * rationale - Why it was decided\n * data - Additional context\n */\n recordDecision(decision: string, rationale: string, data?: Record<string, unknown>): void {\n this.entries.push({\n timestamp: new Date().toISOString(),\n type: 'decision',\n message: `${decision}: ${rationale}`,\n data,\n });\n }\n\n /**\n * Record a metric measurement.\n *\n * name - Metric name (e.g., 'validationTime')\n * value - Metric value\n * unit - Unit of measurement (e.g., 'ms', 'bytes')\n */\n recordMetric(name: string, value: number, unit?: string): void {\n this.entries.push({\n timestamp: new Date().toISOString(),\n type: 'metric',\n message: unit ? `${name}: ${value}${unit}` : `${name}: ${value}`,\n data: { name, value, unit },\n });\n }\n\n /**\n * Record an error that occurred during execution.\n */\n recordError(error: Error | string, context?: Record<string, unknown>): void {\n const message = error instanceof Error ? error.message : error;\n this.entries.push({\n timestamp: new Date().toISOString(),\n type: 'error',\n message,\n data: {\n ...context,\n stack: error instanceof Error ? error.stack : undefined,\n },\n });\n }\n\n /**\n * Record a warning (non-blocking issue).\n */\n recordWarning(message: string, data?: Record<string, unknown>): void {\n this.entries.push({\n timestamp: new Date().toISOString(),\n type: 'warning',\n message,\n data,\n });\n }\n\n /**\n * Record successful completion.\n */\n recordSuccess(data: Record<string, unknown>): void {\n this.endTime = new Date();\n this.entries.push({\n timestamp: this.endTime.toISOString(),\n type: 'success',\n message: 'Strategy execution completed successfully',\n data,\n });\n }\n\n /**\n * Export trace as JSON-serializable object.\n */\n toJSON(): ExecutionTraceExport {\n const end = this.endTime ?? new Date();\n return {\n traceId: this.traceId,\n startTime: this.startTime.toISOString(),\n endTime: end.toISOString(),\n entries: [...this.entries],\n summary: this.getSummary(),\n };\n }\n\n /**\n * Export trace as Markdown for human review.\n */\n toMarkdown(): string {\n const summary = this.getSummary();\n const lines = [\n `# Execution Trace: ${this.traceId}`,\n '',\n '## Summary',\n '',\n `- **Duration**: ${summary.durationMs}ms`,\n `- **Decisions**: ${summary.totalDecisions}`,\n `- **Errors**: ${summary.totalErrors}`,\n `- **Warnings**: ${summary.totalWarnings}`,\n '',\n '## Timeline',\n '',\n ];\n\n for (const entry of this.entries) {\n const icon = this.getEntryIcon(entry.type);\n lines.push(`- ${icon} \\`${entry.timestamp}\\` **${entry.type}**: ${entry.message}`);\n }\n\n return lines.join('\\n');\n }\n\n /**\n * Get duration in milliseconds.\n */\n getDuration(): number {\n const end = this.endTime ?? new Date();\n return end.getTime() - this.startTime.getTime();\n }\n\n private getSummary(): TraceSummary {\n return {\n totalDecisions: this.entries.filter(e => e.type === 'decision').length,\n totalErrors: this.entries.filter(e => e.type === 'error').length,\n totalWarnings: this.entries.filter(e => e.type === 'warning').length,\n durationMs: this.getDuration(),\n };\n }\n\n private generateTraceId(): string {\n const timestamp = Date.now().toString(36);\n const random = Math.random().toString(36).substring(2, 8);\n return `trace_${timestamp}_${random}`;\n }\n\n private getEntryIcon(type: TraceEntry['type']): string {\n const icons: Record<TraceEntry['type'], string> = {\n start: 'üöÄ',\n decision: 'üîÄ',\n metric: 'üìä',\n error: '‚ùå',\n warning: '‚ö†Ô∏è',\n success: '‚úÖ',\n };\n return icons[type] || '‚Ä¢';\n }\n}\n```\n\n### Step 3.3: Implement BaseStrategy<T>\n\nNow implement the abstract base class:\n\n```typescript\n// src/strategies/shared/base-strategy.ts\n\nimport type { SessionState } from '../../domain/design/types.js';\nimport { ExecutionTrace } from './execution-trace.js';\nimport type {\n StrategyResult,\n ValidationError,\n ValidationResult,\n} from './types.js';\n\n/**\n * Configuration for BaseStrategy behavior.\n */\nexport interface StrategyConfig {\n /** Enable execution tracing (default: true) */\n enableTrace?: boolean;\n /** Fail fast on first validation error (default: false) */\n failFast?: boolean;\n /** Maximum execution time in ms (default: 30000) */\n timeoutMs?: number;\n /** Enable verbose logging (default: false) */\n verbose?: boolean;\n}\n\n/**\n * Default strategy configuration.\n */\nconst DEFAULT_CONFIG: Required<StrategyConfig> = {\n enableTrace: true,\n failFast: false,\n timeoutMs: 30_000,\n verbose: false,\n};\n\n/**\n * Abstract base class for all output strategies.\n *\n * Enforces a consistent interface across all strategy implementations:\n * - Input validation via `validate()`\n * - Core logic via `execute()`\n * - Template method pattern via `run()`\n * - Execution tracing via `ExecutionTrace`\n *\n * All 7 strategies (SpecKit, TOGAF, ADR, RFC, Enterprise, SDD, Chat)\n * MUST extend this class.\n *\n * TInput - Strategy input type (e.g., SessionState)\n * TOutput - Strategy output type (e.g., OutputArtifacts)\n *\n * \n * ```typescript\n * class SpecKitStrategy extends BaseStrategy<SessionState, OutputArtifacts> {\n * validate(input: SessionState): ValidationResult {\n * // Validate session state\n * }\n *\n * async execute(input: SessionState): Promise<OutputArtifacts> {\n * // Generate SpecKit documents\n * }\n * }\n * ```\n */\nexport abstract class BaseStrategy<TInput, TOutput> {\n /** Execution trace for this strategy invocation */\n protected readonly trace: ExecutionTrace;\n\n /** Configuration for this strategy */\n protected readonly config: Required<StrategyConfig>;\n\n /** Strategy name for logging */\n protected abstract readonly name: string;\n\n /** Strategy version */\n protected abstract readonly version: string;\n\n constructor(config: StrategyConfig = {}) {\n this.config = { ...DEFAULT_CONFIG, ...config };\n this.trace = new ExecutionTrace();\n }\n\n /**\n * Validate the input before execution.\n *\n * MUST be implemented by subclasses to perform input validation.\n * Called automatically by `run()` before `execute()`.\n *\n * input - Strategy input to validate\n * Validation result with errors and warnings\n */\n abstract validate(input: TInput): ValidationResult;\n\n /**\n * Execute the strategy's core logic.\n *\n * MUST be implemented by subclasses to perform the main work.\n * Only called if `validate()` passes.\n *\n * input - Validated strategy input\n * Strategy output\n * Error if execution fails\n */\n abstract execute(input: TInput): Promise<TOutput>;\n\n /**\n * Run the strategy with validation and tracing.\n *\n * This is the main entry point for strategy execution.\n * Implements the Template Method pattern:\n * 1. Record start\n * 2. Validate input\n * 3. Execute if valid\n * 4. Record result\n *\n * input - Strategy input\n * Strategy result with output or errors\n */\n async run(input: TInput): Promise<StrategyResult<TOutput>> {\n const startTime = Date.now();\n\n // Record start\n if (this.config.enableTrace) {\n this.trace.recordStart({\n strategy: this.name,\n version: this.version,\n config: this.config,\n inputKeys: this.getInputKeys(input),\n });\n }\n\n // Step 1: Validate input\n const validation = this.validateWithTrace(input);\n if (!validation.valid) {\n return this.buildErrorResult(validation.errors, startTime);\n }\n\n // Step 2: Execute with timeout\n try {\n const output = await this.executeWithTimeout(input);\n\n // Record success\n if (this.config.enableTrace) {\n this.trace.recordSuccess({\n outputType: typeof output,\n durationMs: Date.now() - startTime,\n });\n }\n\n return {\n success: true,\n data: output,\n trace: this.trace.toJSON(),\n durationMs: Date.now() - startTime,\n };\n } catch (error) {\n return this.handleExecutionError(error, startTime);\n }\n }\n\n /**\n * Validate input with tracing.\n */\n private validateWithTrace(input: TInput): ValidationResult {\n const validateStart = Date.now();\n\n if (this.config.enableTrace) {\n this.trace.recordDecision(\n 'Starting validation',\n `Validating input for ${this.name}`\n );\n }\n\n const result = this.validate(input);\n\n if (this.config.enableTrace) {\n this.trace.recordMetric('validationDuration', Date.now() - validateStart, 'ms');\n\n if (!result.valid) {\n for (const error of result.errors) {\n this.trace.recordError(`Validation failed: ${error.message}`, {\n code: error.code,\n field: error.field,\n });\n }\n }\n\n for (const warning of result.warnings) {\n this.trace.recordWarning(`Validation warning: ${warning.message}`, {\n code: warning.code,\n field: warning.field,\n });\n }\n }\n\n return result;\n }\n\n /**\n * Execute with timeout protection.\n */\n private async executeWithTimeout(input: TInput): Promise<TOutput> {\n const timeoutPromise = new Promise<never>((_, reject) => {\n setTimeout(() => {\n reject(new Error(`Strategy execution timed out after ${this.config.timeoutMs}ms`));\n }, this.config.timeoutMs);\n });\n\n return Promise.race([\n this.execute(input),\n timeoutPromise,\n ]);\n }\n\n /**\n * Build error result for validation failures.\n */\n private buildErrorResult(\n errors: ValidationError[],\n startTime: number\n ): StrategyResult<TOutput> {\n return {\n success: false,\n errors,\n trace: this.trace.toJSON(),\n durationMs: Date.now() - startTime,\n };\n }\n\n /**\n * Handle execution errors.\n */\n private handleExecutionError(\n error: unknown,\n startTime: number\n ): StrategyResult<TOutput> {\n const errorMessage = error instanceof Error ? error.message : String(error);\n\n if (this.config.enableTrace) {\n this.trace.recordError(\n error instanceof Error ? error : new Error(errorMessage),\n { phase: 'execute' }\n );\n }\n\n return {\n success: false,\n errors: [{\n code: 'EXECUTION_ERROR',\n message: errorMessage,\n context: {\n stack: error instanceof Error ? error.stack : undefined,\n },\n }],\n trace: this.trace.toJSON(),\n durationMs: Date.now() - startTime,\n };\n }\n\n /**\n * Get input keys for logging (avoids logging full input).\n */\n private getInputKeys(input: TInput): string[] {\n if (input && typeof input === 'object') {\n return Object.keys(input as object);\n }\n return [];\n }\n}\n\n/**\n * Type guard for StrategyResult success.\n */\nexport function isSuccessResult<T>(\n result: StrategyResult<T>\n): result is StrategyResult<T> & { success: true; data: T } {\n return result.success && result.data !== undefined;\n}\n\n/**\n * Type guard for StrategyResult failure.\n */\nexport function isErrorResult<T>(\n result: StrategyResult<T>\n): result is StrategyResult<T> & { success: false; errors: ValidationError[] } {\n return !result.success && result.errors !== undefined;\n}\n```\n\n### Step 3.4: Create Barrel Export\n\n```typescript\n// src/strategies/shared/index.ts\n\nexport { BaseStrategy, isSuccessResult, isErrorResult } from './base-strategy.js';\nexport type { StrategyConfig } from './base-strategy.js';\n\nexport { ExecutionTrace } from './execution-trace.js';\n\nexport type {\n ExecutionTraceExport,\n StrategyResult,\n TraceEntry,\n TraceSummary,\n ValidationError,\n ValidationResult,\n ValidationWarning,\n} from './types.js';\n```\n\n---\n\n## 4. Testing Strategy\n\n### Step 4.1: Create Test File\n\n```typescript\n// tests/vitest/strategies/shared/base-strategy.spec.ts\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { BaseStrategy, isSuccessResult, isErrorResult } from '../../../../src/strategies/shared/base-strategy.js';\nimport type { ValidationResult, StrategyResult } from '../../../../src/strategies/shared/types.js';\n\n// Concrete implementation for testing\nclass TestStrategy extends BaseStrategy<{ value: number }, { result: string }> {\n protected readonly name = 'TestStrategy';\n protected readonly version = '1.0.0';\n\n public validateFn: (input: { value: number }) => ValidationResult = () => ({\n valid: true,\n errors: [],\n warnings: [],\n });\n\n public executeFn: (input: { value: number }) => Promise<{ result: string }> =\n async (input) => ({ result: `processed: ${input.value}` });\n\n validate(input: { value: number }): ValidationResult {\n return this.validateFn(input);\n }\n\n async execute(input: { value: number }): Promise<{ result: string }> {\n return this.executeFn(input);\n }\n}\n\ndescribe('BaseStrategy', () => {\n let strategy: TestStrategy;\n\n beforeEach(() => {\n strategy = new TestStrategy();\n });\n\n describe('run()', () => {\n it('should return success result when validation and execution pass', async () => {\n const result = await strategy.run({ value: 42 });\n\n expect(result.success).toBe(true);\n expect(result.data).toEqual({ result: 'processed: 42' });\n expect(result.trace).toBeDefined();\n expect(result.durationMs).toBeGreaterThanOrEqual(0);\n });\n\n it('should return error result when validation fails', async () => {\n strategy.validateFn = () => ({\n valid: false,\n errors: [{ code: 'INVALID_VALUE', message: 'Value must be positive' }],\n warnings: [],\n });\n\n const result = await strategy.run({ value: -1 });\n\n expect(result.success).toBe(false);\n expect(result.errors).toHaveLength(1);\n expect(result.errors?.[0].code).toBe('INVALID_VALUE');\n });\n\n it('should return error result when execution throws', async () => {\n strategy.executeFn = async () => {\n throw new Error('Execution failed');\n };\n\n const result = await strategy.run({ value: 42 });\n\n expect(result.success).toBe(false);\n expect(result.errors?.[0].code).toBe('EXECUTION_ERROR');\n expect(result.errors?.[0].message).toBe('Execution failed');\n });\n\n it('should timeout when execution takes too long', async () => {\n const slowStrategy = new TestStrategy({ timeoutMs: 50 });\n slowStrategy.executeFn = async () => {\n await new Promise(resolve => setTimeout(resolve, 100));\n return { result: 'too slow' };\n };\n\n const result = await slowStrategy.run({ value: 42 });\n\n expect(result.success).toBe(false);\n expect(result.errors?.[0].message).toContain('timed out');\n });\n });\n\n describe('trace', () => {\n it('should record execution trace when enabled', async () => {\n const result = await strategy.run({ value: 42 });\n\n expect(result.trace.traceId).toMatch(/^trace_/);\n expect(result.trace.entries).toHaveLength(3); // start, decision (validation), success\n expect(result.trace.entries[0].type).toBe('start');\n });\n\n it('should not record trace when disabled', async () => {\n const noTraceStrategy = new TestStrategy({ enableTrace: false });\n const result = await noTraceStrategy.run({ value: 42 });\n\n // Trace is still returned but with minimal entries\n expect(result.trace).toBeDefined();\n });\n });\n\n describe('type guards', () => {\n it('isSuccessResult should identify success', async () => {\n const result = await strategy.run({ value: 42 });\n\n if (isSuccessResult(result)) {\n // TypeScript should narrow this\n expect(result.data.result).toBe('processed: 42');\n }\n });\n\n it('isErrorResult should identify failure', async () => {\n strategy.validateFn = () => ({\n valid: false,\n errors: [{ code: 'TEST', message: 'Test error' }],\n warnings: [],\n });\n\n const result = await strategy.run({ value: 42 });\n\n if (isErrorResult(result)) {\n expect(result.errors[0].code).toBe('TEST');\n }\n });\n });\n});\n```\n\n### Step 4.2: Run Tests\n\n```bash\n# Run specific test file\nnpm run test:vitest -- tests/vitest/strategies/shared/base-strategy.spec.ts\n\n# Run with coverage\nnpm run test:coverage:vitest -- --include=\"src/strategies/shared/**\"\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------------------------- | ------ | ----------------------------------------------------- |\n| Abstract class with generic types TInput, TOutput | ‚¨ú | Type-check passes |\n| Template method pattern for `run()` | ‚¨ú | `run()` is final, calls `validate()` then `execute()` |\n| ExecutionTrace integration | ‚¨ú | Trace records start, decisions, errors, success |\n| TypeScript strict mode compliant | ‚¨ú | `npm run type-check` passes |\n| No `any` types | ‚¨ú | `grep -r \"any\" src/strategies/shared/` returns 0 |\n| JSDoc documentation on public methods | ‚¨ú | All exports documented |\n| 100% test coverage | ‚¨ú | Coverage report shows 100% |\n| Code review approved | ‚¨ú | PR approved by -reviewer |\n\n---\n\n## 6. Verification Commands\n\n```bash\n# Type check\nnpm run type-check\n\n# Lint\nnpm run lint\n\n# Run tests\nnpm run test:vitest -- tests/vitest/strategies/shared/\n\n# Check coverage\nnpm run test:coverage:vitest -- --include=\"src/strategies/shared/**\"\n\n# Verify no 'any' types\ngrep -rn \"any\" src/strategies/shared/ || echo \"‚úì No 'any' types found\"\n\n# Full quality check\nnpm run quality\n```\n\n---\n\n## 7. References\n\n| Document | Link |\n| ----------------------------- | --------------------------------------------------------------------- |\n| ADR-001: BaseStrategy Pattern | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-001) |\n| Spec REQ-001, REQ-005 | [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) |\n| Output Strategy Interface | [output-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/strategies/output-strategy.ts) |\n| Existing SpecKitStrategy | [speckit-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/strategies/speckit-strategy.ts) |\n\n---\n\n## 8. Notes for Implementer\n\n1. **Start with types** - Define `types.ts` first to establish the contract\n2. **TDD approach** - Write tests before implementing `BaseStrategy`\n3. **Don't over-engineer** - Keep initial implementation simple\n4. **ExecutionTrace stub** - T-003 will complete the full implementation\n5. **Preserve backward compatibility** - Existing strategies will migrate in T-011 to T-017\n\n### Common Pitfalls\n\n- ‚ùå Don't make `run()` overridable - it's the template method\n- ‚ùå Don't log full input objects - use `getInputKeys()` for privacy\n- ‚ùå Don't forget timeout handling - execution can hang\n- ‚úÖ Do use `readonly` for trace and config\n- ‚úÖ Do provide sensible defaults in `DEFAULT_CONFIG`\n\n---\n\n*Task: T-001 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-001",
		"dependencies": [],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-002: Test BaseStrategy<T>",
		"body": "# T-002: Test BaseStrategy<T>\n\n## Overview\n\n**Task ID**: T-002\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-001\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-002-test-basestrategy-t.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test BaseStrategy<T>' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-002\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test BaseStrategy<T> fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001\n\n### Target Files\n\n- `tests/vitest/strategies/shared/base-strategy.spec.ts`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Tests for validate() flow | ‚¨ú | `npm run test:vitest` |\n| Tests for execute() flow | ‚¨ú | `npm run test:vitest` |\n| Tests for error handling | ‚¨ú | `npm run test:vitest` |\n| 100% coverage of BaseStrategy | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `tests/vitest/strategies/shared/base-strategy.spec.ts`\n\n---\n\n*Task: T-002 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "testing", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-002",
		"dependencies": ["T-001"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-002-test-basestrategy-t.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-002-test-basestrategy-t.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-003: Implement Execution Trace",
		"body": "# T-003: Implement Execution Trace\n\n## Overview\n\n**Task ID**: T-003\n**Phase**: 1 - Foundation\n**Priority**: P0 (Critical Path)\n**Estimate**: 4 hours\n**Dependencies**: None\n**Blocks**: T-001 (BaseStrategy), T-011 (SpecKit Migration)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-003-execution-trace.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nImplement `ExecutionTrace` - a lightweight, immutable decision logging system that records:\n- Strategic decisions made during execution\n- Metrics (timing, counts, sizes)\n- Errors with context\n- Markdown export for debugging\n\n### Why\n\nCurrent strategies have no visibility into:\n- Why certain decisions were made\n- Where time is spent\n- What went wrong and why\n- How to debug production issues\n\n### Design Principles\n\n1. **Immutable**: Each record creates a new entry, no mutations\n2. **Lightweight**: Minimal overhead (~1KB per decision)\n3. **Exportable**: JSON for machines, Markdown for humans\n4. **Typed**: Full TypeScript support with discriminated unions\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Trace Types\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// src/domain/base-strategy/types.ts\n\n/**\n * A single decision recorded during execution.\n *\n * Decisions capture the \"why\" of execution - what choice was made,\n * why it was made, and what context influenced it.\n */\nexport interface Decision {\n /** Unique identifier for this decision */\n readonly id: string;\n\n /** When the decision was made */\n readonly timestamp: Date;\n\n /** Decision category for filtering */\n readonly category: string;\n\n /** Human-readable description */\n readonly description: string;\n\n /** Additional context (must be JSON-serializable) */\n readonly context: Record<string, unknown>;\n}\n\n/**\n * An error recorded during execution.\n *\n * Errors capture failures with full context for debugging.\n */\nexport interface TracedError {\n /** When the error occurred */\n readonly timestamp: Date;\n\n /** Error category */\n readonly category: string;\n\n /** Error message */\n readonly message: string;\n\n /** Original error stack trace */\n readonly stack?: string;\n\n /** Context at time of error */\n readonly context: Record<string, unknown>;\n}\n\n/**\n * Execution trace - immutable log of strategy execution.\n *\n * Contains all decisions, metrics, and errors from a single execution.\n */\nexport interface ExecutionTraceData {\n /** Unique execution ID */\n readonly executionId: string;\n\n /** Strategy name */\n readonly strategyName: string;\n\n /** Strategy version */\n readonly strategyVersion: string;\n\n /** When execution started */\n readonly startedAt: Date;\n\n /** When execution completed (if finished) */\n readonly completedAt: Date | null;\n\n /** All decisions made */\n readonly decisions: readonly Decision[];\n\n /** All metrics recorded */\n readonly metrics: Readonly<Record<string, number>>;\n\n /** All errors encountered */\n readonly errors: readonly TracedError[];\n}\n```\n\n### Step 2.2: Implement ExecutionTrace Class\n\n```typescript\n// src/domain/base-strategy/execution-trace.ts\n\nimport { v4 as uuidv4 } from 'uuid';\nimport type { Decision, TracedError, ExecutionTraceData } from './types.js';\n\n/**\n * Execution Trace - records decisions, metrics, and errors during strategy execution.\n *\n * The trace is mutable during execution but provides immutable snapshots for export.\n *\n * \n * ```typescript\n * const trace = new ExecutionTrace('my-strategy', '1.0.0');\n *\n * trace.recordDecision(\n * 'select-template',\n * 'Selected enterprise template based on input size',\n * { inputSize: 1500, threshold: 1000 }\n * );\n *\n * trace.recordMetric('generation_time_ms', 250);\n *\n * try {\n * // operation\n * } catch (error) {\n * trace.recordError(error, { operation: 'template-render' });\n * }\n *\n * // Export for debugging\n * console.log(trace.toMarkdown());\n * ```\n */\nexport class ExecutionTrace {\n private readonly executionId: string;\n private readonly startedAt: Date;\n private completedAt: Date | null = null;\n\n private readonly _decisions: Decision[] = [];\n private readonly _metrics: Record<string, number> = {};\n private readonly _errors: TracedError[] = [];\n\n constructor(\n private readonly strategyName: string,\n private readonly strategyVersion: string\n ) {\n this.executionId = uuidv4();\n this.startedAt = new Date();\n }\n\n // ============================================\n // Recording Methods\n // ============================================\n\n /**\n * Record a decision made during execution.\n *\n * category - Decision category (e.g., 'validation', 'generation', 'selection')\n * description - Human-readable description of the decision\n * context - Additional context (must be JSON-serializable)\n * The recorded decision\n */\n recordDecision(\n category: string,\n description: string,\n context: Record<string, unknown> = {}\n ): Decision {\n const decision: Decision = {\n id: uuidv4(),\n timestamp: new Date(),\n category,\n description,\n context: this.sanitizeContext(context),\n };\n\n this._decisions.push(decision);\n return decision;\n }\n\n /**\n * Record a numeric metric.\n *\n * name - Metric name (e.g., 'generation_time_ms', 'token_count')\n * value - Metric value\n */\n recordMetric(name: string, value: number): void {\n this._metrics[name] = value;\n }\n\n /**\n * Increment a counter metric.\n *\n * name - Counter name\n * increment - Amount to increment (default: 1)\n */\n incrementMetric(name: string, increment = 1): void {\n this._metrics[name] = (this._metrics[name] ?? 0) + increment;\n }\n\n /**\n * Record an error with context.\n *\n * error - The error that occurred\n * context - Additional context at time of error\n */\n recordError(\n error: Error,\n context: Record<string, unknown> = {}\n ): void {\n this._errors.push({\n timestamp: new Date(),\n category: error.name || 'Error',\n message: error.message,\n stack: error.stack,\n context: this.sanitizeContext(context),\n });\n }\n\n /**\n * Mark the trace as complete.\n */\n complete(): void {\n this.completedAt = new Date();\n this.recordMetric('total_duration_ms', this.durationMs);\n }\n\n // ============================================\n // Query Methods\n // ============================================\n\n /**\n * Get all recorded decisions.\n */\n get decisions(): readonly Decision[] {\n return [...this._decisions];\n }\n\n /**\n * Get all recorded metrics.\n */\n get metrics(): Readonly<Record<string, number>> {\n return { ...this._metrics };\n }\n\n /**\n * Get all recorded errors.\n */\n get errors(): readonly TracedError[] {\n return [...this._errors];\n }\n\n /**\n * Get current duration in milliseconds.\n */\n get durationMs(): number {\n const endTime = this.completedAt ?? new Date();\n return endTime.getTime() - this.startedAt.getTime();\n }\n\n /**\n * Check if any errors were recorded.\n */\n get hasErrors(): boolean {\n return this._errors.length > 0;\n }\n\n /**\n * Get decisions filtered by category.\n */\n getDecisionsByCategory(category: string): readonly Decision[] {\n return this._decisions.filter(d => d.category === category);\n }\n\n // ============================================\n // Export Methods\n // ============================================\n\n /**\n * Export trace as immutable data object.\n */\n toData(): ExecutionTraceData {\n return {\n executionId: this.executionId,\n strategyName: this.strategyName,\n strategyVersion: this.strategyVersion,\n startedAt: this.startedAt,\n completedAt: this.completedAt,\n decisions: [...this._decisions],\n metrics: { ...this._metrics },\n errors: [...this._errors],\n };\n }\n\n /**\n * Export trace as JSON string.\n */\n toJSON(): string {\n return JSON.stringify(this.toData(), null, 2);\n }\n\n /**\n * Export trace as Markdown for human-readable debugging.\n */\n toMarkdown(): string {\n const lines: string[] = [];\n\n // Header\n lines.push(`# Execution Trace: ${this.strategyName} v${this.strategyVersion}`);\n lines.push('');\n lines.push(`**Execution ID**: \\`${this.executionId}\\``);\n lines.push(`**Started**: ${this.startedAt.toISOString()}`);\n if (this.completedAt) {\n lines.push(`**Completed**: ${this.completedAt.toISOString()}`);\n }\n lines.push(`**Duration**: ${this.durationMs}ms`);\n lines.push('');\n\n // Metrics\n if (Object.keys(this._metrics).length > 0) {\n lines.push('## Metrics');\n lines.push('');\n lines.push('| Metric | Value |');\n lines.push('|--------|-------|');\n for (const [name, value] of Object.entries(this._metrics)) {\n lines.push(`| ${name} | ${value} |`);\n }\n lines.push('');\n }\n\n // Decisions\n if (this._decisions.length > 0) {\n lines.push('## Decisions');\n lines.push('');\n\n for (const decision of this._decisions) {\n lines.push(`### ${decision.category}`);\n lines.push('');\n lines.push(`**Time**: ${decision.timestamp.toISOString()}`);\n lines.push('');\n lines.push(decision.description);\n lines.push('');\n\n if (Object.keys(decision.context).length > 0) {\n lines.push('**Context**:');\n lines.push('```json');\n lines.push(JSON.stringify(decision.context, null, 2));\n lines.push('```');\n lines.push('');\n }\n }\n }\n\n // Errors\n if (this._errors.length > 0) {\n lines.push('## Errors');\n lines.push('');\n\n for (const error of this._errors) {\n lines.push(`### ${error.category}`);\n lines.push('');\n lines.push(`**Time**: ${error.timestamp.toISOString()}`);\n lines.push(`**Message**: ${error.message}`);\n lines.push('');\n\n if (error.stack) {\n lines.push('**Stack**:');\n lines.push('```');\n lines.push(error.stack);\n lines.push('```');\n lines.push('');\n }\n\n if (Object.keys(error.context).length > 0) {\n lines.push('**Context**:');\n lines.push('```json');\n lines.push(JSON.stringify(error.context, null, 2));\n lines.push('```');\n lines.push('');\n }\n }\n }\n\n return lines.join('\\n');\n }\n\n // ============================================\n // Private Helpers\n // ============================================\n\n /**\n * Sanitize context to ensure it's JSON-serializable.\n */\n private sanitizeContext(context: Record<string, unknown>): Record<string, unknown> {\n const result: Record<string, unknown> = {};\n\n for (const [key, value] of Object.entries(context)) {\n try {\n // Test if value is serializable\n JSON.stringify(value);\n result[key] = value;\n } catch {\n // Convert non-serializable values to strings\n result[key] = String(value);\n }\n }\n\n return result;\n }\n}\n```\n\n### Step 2.3: Create Factory and Utilities\n\n```typescript\n// src/domain/base-strategy/trace-utils.ts\n\nimport { ExecutionTrace } from './execution-trace.js';\nimport type { ExecutionTraceData } from './types.js';\n\n/**\n * Create a new execution trace for a strategy.\n *\n * strategyName - Name of the strategy\n * strategyVersion - Version of the strategy\n * New ExecutionTrace instance\n */\nexport function createTrace(\n strategyName: string,\n strategyVersion: string\n): ExecutionTrace {\n return new ExecutionTrace(strategyName, strategyVersion);\n}\n\n/**\n * Merge multiple traces into a summary.\n *\n * Useful for aggregating traces from sub-strategies or parallel execution.\n */\nexport function mergeTraces(traces: ExecutionTraceData[]): {\n totalDuration: number;\n totalDecisions: number;\n totalErrors: number;\n metrics: Record<string, number>;\n} {\n let totalDuration = 0;\n let totalDecisions = 0;\n let totalErrors = 0;\n const metrics: Record<string, number> = {};\n\n for (const trace of traces) {\n totalDecisions += trace.decisions.length;\n totalErrors += trace.errors.length;\n\n if (trace.completedAt && trace.startedAt) {\n totalDuration += trace.completedAt.getTime() - trace.startedAt.getTime();\n }\n\n for (const [key, value] of Object.entries(trace.metrics)) {\n metrics[key] = (metrics[key] ?? 0) + value;\n }\n }\n\n return { totalDuration, totalDecisions, totalErrors, metrics };\n}\n\n/**\n * Create a timing helper for measuring durations.\n *\n * trace - Trace to record timing to\n * metricName - Name of the timing metric\n * Function to call when operation completes\n *\n * \n * ```typescript\n * const endTiming = startTiming(trace, 'generation_time_ms');\n * await generateDocument();\n * endTiming(); // Records duration to trace\n * ```\n */\nexport function startTiming(\n trace: ExecutionTrace,\n metricName: string\n): () => number {\n const startTime = Date.now();\n\n return () => {\n const duration = Date.now() - startTime;\n trace.recordMetric(metricName, duration);\n return duration;\n };\n}\n\n/**\n * Wrap an async operation with automatic error tracing.\n *\n * trace - Trace to record to\n * operation - Async operation to wrap\n * context - Context to include if error occurs\n *\n * \n * ```typescript\n * const result = await withErrorTracing(\n * trace,\n * () => fetchData(url),\n * { url, operation: 'fetch-data' }\n * );\n * ```\n */\nexport async function withErrorTracing<T>(\n trace: ExecutionTrace,\n operation: () => Promise<T>,\n context: Record<string, unknown> = {}\n): Promise<T> {\n try {\n return await operation();\n } catch (error) {\n trace.recordError(\n error instanceof Error ? error : new Error(String(error)),\n context\n );\n throw error;\n }\n}\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/base-strategy/execution-trace.spec.ts\n\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { ExecutionTrace } from '../../../../src/domain/base-strategy/execution-trace.js';\nimport { startTiming, withErrorTracing, mergeTraces } from '../../../../src/domain/base-strategy/trace-utils.js';\n\ndescribe('ExecutionTrace', () => {\n let trace: ExecutionTrace;\n\n beforeEach(() => {\n trace = new ExecutionTrace('test-strategy', '1.0.0');\n });\n\n describe('recordDecision', () => {\n it('should record a decision with all fields', () => {\n const decision = trace.recordDecision(\n 'validation',\n 'Input passed schema validation',\n { inputSize: 100 }\n );\n\n expect(decision.id).toBeDefined();\n expect(decision.category).toBe('validation');\n expect(decision.description).toBe('Input passed schema validation');\n expect(decision.context).toEqual({ inputSize: 100 });\n expect(decision.timestamp).toBeInstanceOf(Date);\n });\n\n it('should accumulate multiple decisions', () => {\n trace.recordDecision('step1', 'First step');\n trace.recordDecision('step2', 'Second step');\n trace.recordDecision('step3', 'Third step');\n\n expect(trace.decisions).toHaveLength(3);\n });\n\n it('should sanitize non-serializable context', () => {\n const decision = trace.recordDecision('test', 'Test', {\n fn: () => {}, // Function - not serializable\n circular: {}, // Will add circular reference\n });\n\n // Should convert function to string representation\n expect(typeof decision.context.fn).toBe('string');\n });\n });\n\n describe('recordMetric', () => {\n it('should record a metric', () => {\n trace.recordMetric('duration_ms', 150);\n\n expect(trace.metrics.duration_ms).toBe(150);\n });\n\n it('should overwrite existing metric', () => {\n trace.recordMetric('count', 10);\n trace.recordMetric('count', 20);\n\n expect(trace.metrics.count).toBe(20);\n });\n });\n\n describe('incrementMetric', () => {\n it('should increment from zero', () => {\n trace.incrementMetric('errors');\n\n expect(trace.metrics.errors).toBe(1);\n });\n\n it('should increment existing value', () => {\n trace.recordMetric('count', 5);\n trace.incrementMetric('count', 3);\n\n expect(trace.metrics.count).toBe(8);\n });\n });\n\n describe('recordError', () => {\n it('should record an error with context', () => {\n const error = new Error('Test error');\n trace.recordError(error, { operation: 'test' });\n\n expect(trace.errors).toHaveLength(1);\n expect(trace.errors[0].message).toBe('Test error');\n expect(trace.errors[0].context).toEqual({ operation: 'test' });\n expect(trace.hasErrors).toBe(true);\n });\n\n it('should capture stack trace', () => {\n const error = new Error('Stack test');\n trace.recordError(error);\n\n expect(trace.errors[0].stack).toContain('Stack test');\n });\n });\n\n describe('complete', () => {\n it('should set completedAt', () => {\n expect(trace.toData().completedAt).toBeNull();\n\n trace.complete();\n\n expect(trace.toData().completedAt).toBeInstanceOf(Date);\n });\n\n it('should record total duration metric', () => {\n trace.complete();\n\n expect(trace.metrics.total_duration_ms).toBeDefined();\n expect(trace.metrics.total_duration_ms).toBeGreaterThanOrEqual(0);\n });\n });\n\n describe('durationMs', () => {\n it('should calculate duration', async () => {\n await new Promise(resolve => setTimeout(resolve, 50));\n\n expect(trace.durationMs).toBeGreaterThanOrEqual(50);\n });\n });\n\n describe('toJSON', () => {\n it('should serialize to valid JSON', () => {\n trace.recordDecision('test', 'Test decision');\n trace.recordMetric('count', 42);\n\n const json = trace.toJSON();\n const parsed = JSON.parse(json);\n\n expect(parsed.strategyName).toBe('test-strategy');\n expect(parsed.decisions).toHaveLength(1);\n expect(parsed.metrics.count).toBe(42);\n });\n });\n\n describe('toMarkdown', () => {\n it('should generate readable markdown', () => {\n trace.recordDecision('validation', 'Validated input');\n trace.recordMetric('duration_ms', 100);\n trace.recordError(new Error('Test error'));\n trace.complete();\n\n const md = trace.toMarkdown();\n\n expect(md).toContain('# Execution Trace: test-strategy');\n expect(md).toContain('## Metrics');\n expect(md).toContain('## Decisions');\n expect(md).toContain('## Errors');\n expect(md).toContain('validation');\n expect(md).toContain('Test error');\n });\n });\n\n describe('getDecisionsByCategory', () => {\n it('should filter decisions by category', () => {\n trace.recordDecision('validation', 'Step 1');\n trace.recordDecision('generation', 'Step 2');\n trace.recordDecision('validation', 'Step 3');\n\n const validationDecisions = trace.getDecisionsByCategory('validation');\n\n expect(validationDecisions).toHaveLength(2);\n });\n });\n});\n\ndescribe('trace-utils', () => {\n describe('startTiming', () => {\n it('should record timing metric', async () => {\n const trace = new ExecutionTrace('test', '1.0.0');\n\n const endTiming = startTiming(trace, 'operation_ms');\n await new Promise(resolve => setTimeout(resolve, 50));\n const duration = endTiming();\n\n expect(duration).toBeGreaterThanOrEqual(50);\n expect(trace.metrics.operation_ms).toBeGreaterThanOrEqual(50);\n });\n });\n\n describe('withErrorTracing', () => {\n it('should return result on success', async () => {\n const trace = new ExecutionTrace('test', '1.0.0');\n\n const result = await withErrorTracing(\n trace,\n async () => 'success',\n { operation: 'test' }\n );\n\n expect(result).toBe('success');\n expect(trace.hasErrors).toBe(false);\n });\n\n it('should record error and rethrow on failure', async () => {\n const trace = new ExecutionTrace('test', '1.0.0');\n\n await expect(\n withErrorTracing(\n trace,\n async () => { throw new Error('fail'); },\n { operation: 'test' }\n )\n ).rejects.toThrow('fail');\n\n expect(trace.hasErrors).toBe(true);\n expect(trace.errors[0].context).toEqual({ operation: 'test' });\n });\n });\n\n describe('mergeTraces', () => {\n it('should aggregate trace data', () => {\n const trace1 = new ExecutionTrace('strategy1', '1.0.0');\n trace1.recordDecision('step', 'Step 1');\n trace1.recordMetric('count', 10);\n trace1.complete();\n\n const trace2 = new ExecutionTrace('strategy2', '1.0.0');\n trace2.recordDecision('step', 'Step 2');\n trace2.recordDecision('step', 'Step 3');\n trace2.recordMetric('count', 5);\n trace2.recordError(new Error('Error'));\n trace2.complete();\n\n const summary = mergeTraces([trace1.toData(), trace2.toData()]);\n\n expect(summary.totalDecisions).toBe(3);\n expect(summary.totalErrors).toBe(1);\n expect(summary.metrics.count).toBe(15);\n });\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------------- | ------ | --------------------- |\n| Decision recording with id, timestamp, category | ‚¨ú | Unit tests pass |\n| Metric recording and incrementing | ‚¨ú | Unit tests pass |\n| Error recording with stack trace | ‚¨ú | Unit tests pass |\n| Context sanitization for JSON serialization | ‚¨ú | Circular ref test |\n| toJSON() produces valid JSON | ‚¨ú | Parse test passes |\n| toMarkdown() produces readable output | ‚¨ú | Contains all sections |\n| startTiming utility works | ‚¨ú | Timing test passes |\n| withErrorTracing captures errors | ‚¨ú | Error test passes |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. References\n\n| Document | Link |\n| ----------------------------- | ------------------------------------------------------------ |\n| T-001: BaseStrategy | [T-001-base-strategy.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md) |\n| ADR-001: BaseStrategy Pattern | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-001) |\n| uuid package | [npmjs.com/package/uuid](https://www.npmjs.com/package/uuid) |\n\n---\n\n*Task: T-003 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-003",
		"dependencies": [],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-003-execution-trace.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-003-execution-trace.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-004: Test ExecutionTrace",
		"body": "# T-004: Test ExecutionTrace\n\n## Overview\n\n**Task ID**: T-004\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-004-test-executiontrace.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test ExecutionTrace' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-004\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test ExecutionTrace fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-003\n\n### Target Files\n\n- `tests/vitest/shared/execution-trace.spec.ts`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `tests/vitest/shared/execution-trace.spec.ts`\n\n---\n\n*Task: T-004 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "testing", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-004",
		"dependencies": ["T-003"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-004-test-executiontrace.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-004-test-executiontrace.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-005: Implement SummaryFeedbackCoordinator",
		"body": "# T-005: Implement SummaryFeedbackCoordinator\n\n## Overview\n\n**Task ID**: T-005\n**Phase**: 1 - Foundation\n**Priority**: P1\n**Estimate**: 4 hours\n**Dependencies**: T-003 (ExecutionTrace)\n**Blocks**: T-037 (FrameworkRouter)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-005-summary-feedback.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nCreate `SummaryFeedbackCoordinator` - a component that:\n- Collects execution summaries from multiple strategies\n- Generates user-facing feedback (progress, warnings, suggestions)\n- Provides structured output for MCP tool responses\n- Enables \"summary mode\" for large outputs\n\n### Why\n\nCurrent MCP tools return raw output without:\n- Progress indicators during long operations\n- Aggregated warnings across sub-operations\n- Token usage estimates\n- Suggestions for next steps\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nconst coordinator = new SummaryFeedbackCoordinator();\n\n// Collect from multiple traces\ncoordinator.collect(specKitTrace);\ncoordinator.collect(diagramTrace);\ncoordinator.collect(validationTrace);\n\n// Generate summary\nconst summary = coordinator.summarize({\nmaxLength: 500,\nincludeMetrics: true,\nincludeSuggestions: true,\n});\n\n// Output\n// {\n// status: 'completed',\n// duration: '2.3s',\n// operations: 3,\n// warnings: ['Constitution validation skipped'],\n// suggestions: ['Consider adding acceptance criteria'],\n// metrics: { totalTokens: 12500, documentsGenerated: 7 }\n// }\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Types\n\n```typescript\n// src/domain/coordinators/types.ts\n\nimport type { ExecutionTraceData } from '../base-strategy/types.js';\n\n/**\n * Status of an operation or the overall summary.\n */\nexport type OperationStatus =\n| 'pending'\n| 'in-progress'\n| 'completed'\n| 'failed'\n| 'partial';\n\n/**\n * Severity level for feedback items.\n */\nexport type FeedbackSeverity = 'info' | 'warning' | 'error';\n\n/**\n * A single feedback item to show the user.\n */\nexport interface FeedbackItem {\nseverity: FeedbackSeverity;\nmessage: string;\nsource?: string;\ntimestamp: Date;\n}\n\n/**\n * A suggestion for next steps.\n */\nexport interface Suggestion {\naction: string;\nreason: string;\npriority: 'high' | 'medium' | 'low';\n}\n\n/**\n * Options for generating summaries.\n */\nexport interface SummaryOptions {\n/** Maximum character length for text summary */\nmaxLength?: number;\n\n/** Include numeric metrics */\nincludeMetrics?: boolean;\n\n/** Include suggestions for next steps */\nincludeSuggestions?: boolean;\n\n/** Include list of operations */\nincludeOperations?: boolean;\n\n/** Verbosity level */\nverbosity?: 'minimal' | 'normal' | 'verbose';\n}\n\n/**\n * Generated summary result.\n */\nexport interface SummaryResult {\n/** Overall status */\nstatus: OperationStatus;\n\n/** Human-readable duration */\nduration: string;\n\n/** Number of operations performed */\noperationCount: number;\n\n/** List of operation names (if includeOperations) */\noperations?: string[];\n\n/** Warning messages */\nwarnings: string[];\n\n/** Error messages */\nerrors: string[];\n\n/** Suggestions for next steps */\nsuggestions?: Suggestion[];\n\n/** Aggregated metrics */\nmetrics?: Record<string, number>;\n\n/** Text summary for display */\ntext: string;\n\n/** Markdown summary for rich display */\nmarkdown: string;\n}\n\n/**\n * Collected operation info from a trace.\n */\nexport interface CollectedOperation {\nname: string;\nversion: string;\nstatus: OperationStatus;\nduration: number;\ntrace: ExecutionTraceData;\n}\n```\n\n### Step 2.2: Implement SummaryFeedbackCoordinator\n\n```typescript\n// src/domain/coordinators/summary-feedback-coordinator.ts\n\nimport type { ExecutionTraceData } from '../base-strategy/types.js';\nimport type {\nCollectedOperation,\nFeedbackItem,\nOperationStatus,\nSuggestion,\nSummaryOptions,\nSummaryResult,\n} from './types.js';\n\n/**\n * SummaryFeedbackCoordinator - aggregates execution traces and generates user feedback.\n *\n * This coordinator:\n * - Collects traces from multiple strategy executions\n * - Aggregates metrics, warnings, and errors\n * - Generates human-readable summaries\n * - Provides suggestions for next steps\n *\n * \n * ```typescript\n * const coordinator = new SummaryFeedbackCoordinator();\n *\n * // Collect traces as operations complete\n * coordinator.collect(specKitResult.trace);\n * coordinator.collect(validationResult.trace);\n *\n * // Generate summary for user\n * const summary = coordinator.summarize({\n * includeMetrics: true,\n * includeSuggestions: true,\n * });\n *\n * console.log(summary.text);\n * // \"Completed 2 operations in 1.5s. Generated 7 documents (12,500 tokens).\n * // 1 warning: Constitution validation was skipped.\"\n * ```\n */\nexport class SummaryFeedbackCoordinator {\nprivate operations: CollectedOperation[] = [];\nprivate feedback: FeedbackItem[] = [];\nprivate customSuggestions: Suggestion[] = [];\nprivate startTime: Date;\n\nconstructor() {\n\tthis.startTime = new Date();\n}\n\n// ============================================\n// Collection Methods\n// ============================================\n\n/**\n * Collect a trace from a completed operation.\n *\n * trace - Execution trace from a strategy\n * name - Optional override for operation name\n */\ncollect(trace: ExecutionTraceData, name?: string): void {\n\tconst operation: CollectedOperation = {\n\t\tname: name ?? trace.strategyName,\n\t\tversion: trace.strategyVersion,\n\t\tstatus: this.determineStatus(trace),\n\t\tduration: this.calculateDuration(trace),\n\t\ttrace,\n\t};\n\n\tthis.operations.push(operation);\n\n\t// Extract warnings from trace decisions\n\tfor (const decision of trace.decisions) {\n\t\tif (decision.category === 'warning' || decision.description.toLowerCase().includes('warning')) {\n\t\t\tthis.addWarning(decision.description, trace.strategyName);\n\t\t}\n\t}\n\n\t// Extract errors\n\tfor (const error of trace.errors) {\n\t\tthis.addError(error.message, trace.strategyName);\n\t}\n}\n\n/**\n * Add a manual feedback item.\n */\naddFeedback(\n\tseverity: 'info' | 'warning' | 'error',\n\tmessage: string,\n\tsource?: string\n): void {\n\tthis.feedback.push({\n\t\tseverity,\n\t\tmessage,\n\t\tsource,\n\t\ttimestamp: new Date(),\n\t});\n}\n\n/**\n * Add a warning message.\n */\naddWarning(message: string, source?: string): void {\n\tthis.addFeedback('warning', message, source);\n}\n\n/**\n * Add an error message.\n */\naddError(message: string, source?: string): void {\n\tthis.addFeedback('error', message, source);\n}\n\n/**\n * Add a suggestion for next steps.\n */\naddSuggestion(\n\taction: string,\n\treason: string,\n\tpriority: 'high' | 'medium' | 'low' = 'medium'\n): void {\n\tthis.customSuggestions.push({ action, reason, priority });\n}\n\n// ============================================\n// Summary Generation\n// ============================================\n\n/**\n * Generate a summary of all collected operations.\n *\n * options - Summary generation options\n * Generated summary\n */\nsummarize(options: SummaryOptions = {}): SummaryResult {\n\tconst {\n\t\tmaxLength = 500,\n\t\tincludeMetrics = true,\n\t\tincludeSuggestions = true,\n\t\tincludeOperations = false,\n\t\tverbosity = 'normal',\n\t} = options;\n\n\tconst status = this.determineOverallStatus();\n\tconst totalDuration = this.calculateTotalDuration();\n\tconst metrics = this.aggregateMetrics();\n\tconst warnings = this.getWarnings();\n\tconst errors = this.getErrors();\n\tconst suggestions = includeSuggestions\n\t\t? [...this.customSuggestions, ...this.generateAutoSuggestions()]\n\t\t: undefined;\n\n\tconst text = this.generateTextSummary({\n\t\tstatus,\n\t\ttotalDuration,\n\t\tmetrics,\n\t\twarnings,\n\t\terrors,\n\t\tmaxLength,\n\t\tverbosity,\n\t});\n\n\tconst markdown = this.generateMarkdownSummary({\n\t\tstatus,\n\t\ttotalDuration,\n\t\tmetrics,\n\t\twarnings,\n\t\terrors,\n\t\tsuggestions,\n\t\tincludeMetrics,\n\t\tverbosity,\n\t});\n\n\treturn {\n\t\tstatus,\n\t\tduration: this.formatDuration(totalDuration),\n\t\toperationCount: this.operations.length,\n\t\toperations: includeOperations\n\t\t\t? this.operations.map((op) => op.name)\n\t\t\t: undefined,\n\t\twarnings,\n\t\terrors,\n\t\tsuggestions,\n\t\tmetrics: includeMetrics ? metrics : undefined,\n\t\ttext,\n\t\tmarkdown,\n\t};\n}\n\n/**\n * Reset the coordinator for reuse.\n */\nreset(): void {\n\tthis.operations = [];\n\tthis.feedback = [];\n\tthis.customSuggestions = [];\n\tthis.startTime = new Date();\n}\n\n// ============================================\n// Query Methods\n// ============================================\n\n/**\n * Check if any errors occurred.\n */\nhasErrors(): boolean {\n\treturn this.feedback.some((f) => f.severity === 'error');\n}\n\n/**\n * Check if any warnings occurred.\n */\nhasWarnings(): boolean {\n\treturn this.feedback.some((f) => f.severity === 'warning');\n}\n\n/**\n * Get number of collected operations.\n */\nget operationCount(): number {\n\treturn this.operations.length;\n}\n\n// ============================================\n// Private Helpers\n// ============================================\n\nprivate determineStatus(trace: ExecutionTraceData): OperationStatus {\n\tif (trace.errors.length > 0) return 'failed';\n\tif (!trace.completedAt) return 'in-progress';\n\treturn 'completed';\n}\n\nprivate calculateDuration(trace: ExecutionTraceData): number {\n\tif (!trace.completedAt) {\n\t\treturn Date.now() - trace.startedAt.getTime();\n\t}\n\treturn trace.completedAt.getTime() - trace.startedAt.getTime();\n}\n\nprivate determineOverallStatus(): OperationStatus {\n\tif (this.operations.length === 0) return 'pending';\n\n\tconst hasErrors = this.operations.some((op) => op.status === 'failed');\n\tconst hasInProgress = this.operations.some((op) => op.status === 'in-progress');\n\tconst allCompleted = this.operations.every((op) => op.status === 'completed');\n\n\tif (hasErrors && !allCompleted) return 'partial';\n\tif (hasErrors) return 'failed';\n\tif (hasInProgress) return 'in-progress';\n\treturn 'completed';\n}\n\nprivate calculateTotalDuration(): number {\n\treturn Date.now() - this.startTime.getTime();\n}\n\nprivate aggregateMetrics(): Record<string, number> {\n\tconst metrics: Record<string, number> = {};\n\n\tfor (const op of this.operations) {\n\t\tfor (const [key, value] of Object.entries(op.trace.metrics)) {\n\t\t\tmetrics[key] = (metrics[key] ?? 0) + value;\n\t\t}\n\t}\n\n\t// Add computed metrics\n\tmetrics.operationCount = this.operations.length;\n\tmetrics.totalDurationMs = this.calculateTotalDuration();\n\n\treturn metrics;\n}\n\nprivate getWarnings(): string[] {\n\treturn this.feedback\n\t\t.filter((f) => f.severity === 'warning')\n\t\t.map((f) => f.message);\n}\n\nprivate getErrors(): string[] {\n\treturn this.feedback\n\t\t.filter((f) => f.severity === 'error')\n\t\t.map((f) => f.message);\n}\n\nprivate generateAutoSuggestions(): Suggestion[] {\n\tconst suggestions: Suggestion[] = [];\n\tconst metrics = this.aggregateMetrics();\n\n\t// Suggest based on metrics\n\tif (metrics.totalTokens && metrics.totalTokens > 10000) {\n\t\tsuggestions.push({\n\t\t\taction: 'Consider splitting into smaller documents',\n\t\t\treason: `Output is ${metrics.totalTokens.toLocaleString()} tokens, which may exceed context limits`,\n\t\t\tpriority: 'medium',\n\t\t});\n\t}\n\n\t// Suggest based on warnings\n\tif (this.hasWarnings()) {\n\t\tsuggestions.push({\n\t\t\taction: 'Review and address warnings before proceeding',\n\t\t\treason: `${this.getWarnings().length} warning(s) were generated`,\n\t\t\tpriority: 'high',\n\t\t});\n\t}\n\n\t// Suggest based on missing validations\n\tconst hasConstitution = this.operations.some((op) =>\n\t\top.trace.decisions.some((d) => d.category === 'validation')\n\t);\n\tif (!hasConstitution) {\n\t\tsuggestions.push({\n\t\t\taction: 'Add constitution validation for compliance checking',\n\t\t\treason: 'No validation step was detected in the execution',\n\t\t\tpriority: 'low',\n\t\t});\n\t}\n\n\treturn suggestions;\n}\n\nprivate generateTextSummary(params: {\n\tstatus: OperationStatus;\n\ttotalDuration: number;\n\tmetrics: Record<string, number>;\n\twarnings: string[];\n\terrors: string[];\n\tmaxLength: number;\n\tverbosity: 'minimal' | 'normal' | 'verbose';\n}): string {\n\tconst { status, totalDuration, metrics, warnings, errors, maxLength, verbosity } = params;\n\tconst parts: string[] = [];\n\n\t// Status + duration\n\tconst statusText = status === 'completed' ? 'Completed' : `Status: ${status}`;\n\tparts.push(`${statusText} ${this.operations.length} operation(s) in ${this.formatDuration(totalDuration)}.`);\n\n\t// Metrics (if normal or verbose)\n\tif (verbosity !== 'minimal') {\n\t\tif (metrics.documentsGenerated) {\n\t\t\tparts.push(`Generated ${metrics.documentsGenerated} document(s).`);\n\t\t}\n\t\tif (metrics.totalTokens) {\n\t\t\tparts.push(`Total tokens: ${metrics.totalTokens.toLocaleString()}.`);\n\t\t}\n\t}\n\n\t// Warnings\n\tif (warnings.length > 0) {\n\t\tparts.push(`${warnings.length} warning(s): ${warnings[0]}${warnings.length > 1 ? '...' : ''}`);\n\t}\n\n\t// Errors\n\tif (errors.length > 0) {\n\t\tparts.push(`${errors.length} error(s): ${errors[0]}${errors.length > 1 ? '...' : ''}`);\n\t}\n\n\tlet result = parts.join(' ');\n\tif (result.length > maxLength) {\n\t\tresult = result.substring(0, maxLength - 3) + '...';\n\t}\n\n\treturn result;\n}\n\nprivate generateMarkdownSummary(params: {\n\tstatus: OperationStatus;\n\ttotalDuration: number;\n\tmetrics: Record<string, number>;\n\twarnings: string[];\n\terrors: string[];\n\tsuggestions?: Suggestion[];\n\tincludeMetrics: boolean;\n\tverbosity: 'minimal' | 'normal' | 'verbose';\n}): string {\n\tconst { status, totalDuration, metrics, warnings, errors, suggestions, includeMetrics, verbosity } = params;\n\tconst lines: string[] = [];\n\n\t// Header\n\tconst statusIcon = status === 'completed' ? '‚úÖ' : status === 'failed' ? '‚ùå' : '‚è≥';\n\tlines.push(`## ${statusIcon} Execution Summary`);\n\tlines.push('');\n\n\t// Stats\n\tlines.push(`- **Status**: ${status}`);\n\tlines.push(`- **Duration**: ${this.formatDuration(totalDuration)}`);\n\tlines.push(`- **Operations**: ${this.operations.length}`);\n\tlines.push('');\n\n\t// Metrics\n\tif (includeMetrics && Object.keys(metrics).length > 0) {\n\t\tlines.push('### Metrics');\n\t\tlines.push('');\n\t\tlines.push('| Metric | Value |');\n\t\tlines.push('|--------|-------|');\n\t\tfor (const [key, value] of Object.entries(metrics)) {\n\t\t\tconst formattedKey = key.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').trim();\n\t\t\tlines.push(`| ${formattedKey} | ${value.toLocaleString()} |`);\n\t\t}\n\t\tlines.push('');\n\t}\n\n\t// Warnings\n\tif (warnings.length > 0) {\n\t\tlines.push('### ‚ö†Ô∏è Warnings');\n\t\tlines.push('');\n\t\tfor (const warning of warnings) {\n\t\t\tlines.push(`- ${warning}`);\n\t\t}\n\t\tlines.push('');\n\t}\n\n\t// Errors\n\tif (errors.length > 0) {\n\t\tlines.push('### ‚ùå Errors');\n\t\tlines.push('');\n\t\tfor (const error of errors) {\n\t\t\tlines.push(`- ${error}`);\n\t\t}\n\t\tlines.push('');\n\t}\n\n\t// Suggestions\n\tif (suggestions && suggestions.length > 0) {\n\t\tlines.push('### üí° Suggestions');\n\t\tlines.push('');\n\t\tconst sorted = [...suggestions].sort((a, b) => {\n\t\t\tconst order = { high: 0, medium: 1, low: 2 };\n\t\t\treturn order[a.priority] - order[b.priority];\n\t\t});\n\t\tfor (const suggestion of sorted) {\n\t\t\tconst icon = suggestion.priority === 'high' ? 'üî¥' : suggestion.priority === 'medium' ? 'üü°' : 'üü¢';\n\t\t\tlines.push(`- ${icon} **${suggestion.action}** - ${suggestion.reason}`);\n\t\t}\n\t\tlines.push('');\n\t}\n\n\treturn lines.join('\\n');\n}\n\nprivate formatDuration(ms: number): string {\n\tif (ms < 1000) return `${ms}ms`;\n\tif (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\n\tconst minutes = Math.floor(ms / 60000);\n\tconst seconds = Math.floor((ms % 60000) / 1000);\n\treturn `${minutes}m ${seconds}s`;\n}\n}\n```\n\n### Step 2.3: Create Barrel Export\n\n```typescript\n// src/domain/coordinators/index.ts\n\nexport type {\nOperationStatus,\nFeedbackSeverity,\nFeedbackItem,\nSuggestion,\nSummaryOptions,\nSummaryResult,\nCollectedOperation,\n} from './types.js';\n\nexport { SummaryFeedbackCoordinator } from './summary-feedback-coordinator.js';\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/coordinators/summary-feedback-coordinator.spec.ts\n\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { SummaryFeedbackCoordinator } from '../../../../src/domain/coordinators/summary-feedback-coordinator.js';\nimport type { ExecutionTraceData } from '../../../../src/domain/base-strategy/types.js';\n\nfunction createMockTrace(overrides: Partial<ExecutionTraceData> = {}): ExecutionTraceData {\nreturn {\n\texecutionId: 'test-123',\n\tstrategyName: 'test-strategy',\n\tstrategyVersion: '1.0.0',\n\tstartedAt: new Date(Date.now() - 1000),\n\tcompletedAt: new Date(),\n\tdecisions: [],\n\tmetrics: {},\n\terrors: [],\n\t...overrides,\n};\n}\n\ndescribe('SummaryFeedbackCoordinator', () => {\nlet coordinator: SummaryFeedbackCoordinator;\n\nbeforeEach(() => {\n\tcoordinator = new SummaryFeedbackCoordinator();\n});\n\ndescribe('collect', () => {\n\tit('should collect a trace', () => {\n\t\tconst trace = createMockTrace();\n\t\tcoordinator.collect(trace);\n\n\t\texpect(coordinator.operationCount).toBe(1);\n\t});\n\n\tit('should extract warnings from decisions', () => {\n\t\tconst trace = createMockTrace({\n\t\t\tdecisions: [\n\t\t\t\t{\n\t\t\t\t\tid: '1',\n\t\t\t\t\ttimestamp: new Date(),\n\t\t\t\t\tcategory: 'warning',\n\t\t\t\t\tdescription: 'Constitution validation skipped',\n\t\t\t\t\tcontext: {},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tcoordinator.collect(trace);\n\t\tconst summary = coordinator.summarize();\n\n\t\texpect(summary.warnings).toContain('Constitution validation skipped');\n\t});\n\n\tit('should extract errors from trace', () => {\n\t\tconst trace = createMockTrace({\n\t\t\terrors: [\n\t\t\t\t{\n\t\t\t\t\ttimestamp: new Date(),\n\t\t\t\t\tcategory: 'Error',\n\t\t\t\t\tmessage: 'File not found',\n\t\t\t\t\tcontext: {},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tcoordinator.collect(trace);\n\n\t\texpect(coordinator.hasErrors()).toBe(true);\n\t});\n});\n\ndescribe('addFeedback', () => {\n\tit('should add warning feedback', () => {\n\t\tcoordinator.addWarning('Test warning', 'test-source');\n\n\t\texpect(coordinator.hasWarnings()).toBe(true);\n\t});\n\n\tit('should add error feedback', () => {\n\t\tcoordinator.addError('Test error');\n\n\t\texpect(coordinator.hasErrors()).toBe(true);\n\t});\n});\n\ndescribe('summarize', () => {\n\tit('should generate summary with status', () => {\n\t\tconst trace = createMockTrace();\n\t\tcoordinator.collect(trace);\n\n\t\tconst summary = coordinator.summarize();\n\n\t\texpect(summary.status).toBe('completed');\n\t\texpect(summary.operationCount).toBe(1);\n\t});\n\n\tit('should aggregate metrics from multiple traces', () => {\n\t\tcoordinator.collect(createMockTrace({\n\t\t\tstrategyName: 'strategy-1',\n\t\t\tmetrics: { documentsGenerated: 3, totalTokens: 5000 },\n\t\t}));\n\t\tcoordinator.collect(createMockTrace({\n\t\t\tstrategyName: 'strategy-2',\n\t\t\tmetrics: { documentsGenerated: 2, totalTokens: 3000 },\n\t\t}));\n\n\t\tconst summary = coordinator.summarize({ includeMetrics: true });\n\n\t\texpect(summary.metrics?.documentsGenerated).toBe(5);\n\t\texpect(summary.metrics?.totalTokens).toBe(8000);\n\t});\n\n\tit('should generate text summary', () => {\n\t\tcoordinator.collect(createMockTrace({ metrics: { documentsGenerated: 7 } }));\n\n\t\tconst summary = coordinator.summarize();\n\n\t\texpect(summary.text).toContain('Completed');\n\t\texpect(summary.text).toContain('1 operation');\n\t});\n\n\tit('should generate markdown summary', () => {\n\t\tcoordinator.collect(createMockTrace());\n\n\t\tconst summary = coordinator.summarize();\n\n\t\texpect(summary.markdown).toContain('## ‚úÖ Execution Summary');\n\t\texpect(summary.markdown).toContain('**Status**: completed');\n\t});\n\n\tit('should respect maxLength option', () => {\n\t\tcoordinator.collect(createMockTrace());\n\t\tcoordinator.addWarning('Very long warning message that goes on and on');\n\n\t\tconst summary = coordinator.summarize({ maxLength: 50 });\n\n\t\texpect(summary.text.length).toBeLessThanOrEqual(50);\n\t});\n\n\tit('should include operations list when requested', () => {\n\t\tcoordinator.collect(createMockTrace({ strategyName: 'speckit' }));\n\t\tcoordinator.collect(createMockTrace({ strategyName: 'validation' }));\n\n\t\tconst summary = coordinator.summarize({ includeOperations: true });\n\n\t\texpect(summary.operations).toContain('speckit');\n\t\texpect(summary.operations).toContain('validation');\n\t});\n});\n\ndescribe('addSuggestion', () => {\n\tit('should include custom suggestions', () => {\n\t\tcoordinator.addSuggestion(\n\t\t\t'Run validation',\n\t\t\t'No validation was performed',\n\t\t\t'high'\n\t\t);\n\n\t\tconst summary = coordinator.summarize({ includeSuggestions: true });\n\n\t\texpect(summary.suggestions).toHaveLength(1);\n\t\texpect(summary.suggestions?.[0].action).toBe('Run validation');\n\t\texpect(summary.suggestions?.[0].priority).toBe('high');\n\t});\n});\n\ndescribe('reset', () => {\n\tit('should clear all state', () => {\n\t\tcoordinator.collect(createMockTrace());\n\t\tcoordinator.addWarning('Test');\n\t\tcoordinator.addSuggestion('Test', 'Test');\n\n\t\tcoordinator.reset();\n\n\t\texpect(coordinator.operationCount).toBe(0);\n\t\texpect(coordinator.hasWarnings()).toBe(false);\n\t});\n});\n\ndescribe('overall status', () => {\n\tit('should be pending when no operations', () => {\n\t\tconst summary = coordinator.summarize();\n\t\texpect(summary.status).toBe('pending');\n\t});\n\n\tit('should be failed when any operation failed', () => {\n\t\tcoordinator.collect(createMockTrace({\n\t\t\terrors: [{ timestamp: new Date(), category: 'Error', message: 'Failed', context: {} }],\n\t\t}));\n\n\t\tconst summary = coordinator.summarize();\n\t\texpect(summary.status).toBe('failed');\n\t});\n\n\tit('should be partial when some failed and some completed', () => {\n\t\tcoordinator.collect(createMockTrace({ strategyName: 'good' }));\n\t\tcoordinator.collect(createMockTrace({\n\t\t\tstrategyName: 'bad',\n\t\t\tcompletedAt: null as any, // Still in progress or failed\n\t\t\terrors: [{ timestamp: new Date(), category: 'Error', message: 'Failed', context: {} }],\n\t\t}));\n\n\t\tconst summary = coordinator.summarize();\n\t\texpect(summary.status).toBe('partial');\n\t});\n});\n});\n```\n\n---\n\n## 4. Usage Examples\n\n### Basic Usage\n\n```typescript\nimport { SummaryFeedbackCoordinator } from '../domain/coordinators/index.js';\n\nasync function executeWithFeedback(input: SpecKitInput) {\nconst coordinator = new SummaryFeedbackCoordinator();\n\n// Execute strategy\nconst result = await specKitStrategy.execute(input);\ncoordinator.collect(result.trace);\n\n// Execute validation\nif (input.validateAgainstConstitution) {\n\tconst validationResult = await validator.execute(result.output);\n\tcoordinator.collect(validationResult.trace, 'constitution-validation');\n}\n\n// Generate summary\nconst summary = coordinator.summarize({\n\tincludeMetrics: true,\n\tincludeSuggestions: true,\n});\n\nreturn {\n\toutput: result.output,\n\tsummary,\n};\n}\n```\n\n### MCP Tool Response\n\n```typescript\n// In MCP tool handler\nconst { output, summary } = await executeWithFeedback(input);\n\nreturn {\ncontent: [\n\t{ type: 'text', text: output.artifacts.spec },\n\t{ type: 'text', text: '\\n---\\n' + summary.markdown },\n],\nisError: summary.status === 'failed',\n};\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| --------------------------------------- | ------ | ---------------- |\n| Collect traces from multiple operations | ‚¨ú | Unit test |\n| Aggregate metrics across traces | ‚¨ú | Metrics test |\n| Extract warnings from decisions | ‚¨ú | Warning test |\n| Generate text summary with length limit | ‚¨ú | maxLength test |\n| Generate markdown summary | ‚¨ú | Markdown test |\n| Auto-generate suggestions | ‚¨ú | Suggestions test |\n| Determine overall status correctly | ‚¨ú | Status tests |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 6. References\n\n| Document | Link |\n| ---------------------- | -------------------------------------------------------------------------------------------------------- |\n| T-003: ExecutionTrace | [T-003-execution-trace.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-003-execution-trace.md) |\n| T-037: FrameworkRouter | [../phase-3-consolidation/T-037-framework-router.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-037-framework-router.md) |\n| Spec REQ-009 | [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) |\n\n---\n\n*Task: T-005 | Phase: 1 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P1-high"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P1",
		"task_id": "T-005",
		"dependencies": ["T-003"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-005-summary-feedback.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-005-summary-feedback.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-006: Test SummaryFeedbackCoordinator",
		"body": "# T-006: Test SummaryFeedbackCoordinator\n\n## Overview\n\n**Task ID**: T-006\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-005\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-006-test-summaryfeedbackcoordinator.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test SummaryFeedbackCoordinator' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-006\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test SummaryFeedbackCoordinator fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-005\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-006 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "testing", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-006",
		"dependencies": ["T-005"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-006-test-summaryfeedbackcoordinator.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-006-test-summaryfeedbackcoordinator.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-007: Implement AgentHandoffCoordinator",
		"body": "# T-007: Implement AgentHandoffCoordinator\n\n## Overview\n\n**Task ID**: T-007\n**Phase**: 1 - Foundation\n**Priority**: P1 (High)\n**Estimate**: 4 hours\n**Dependencies**: T-003 (ExecutionTrace), T-005 (SummaryFeedbackCoordinator)\n**Blocks**: T-042 (Multi-agent workflow)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-007-agent-handoff.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nCreate `AgentHandoffCoordinator` - a component that:\n- Prepares context for agent-to-agent handoffs\n- Packages execution traces for receiving agents\n- Generates handoff instructions\n- Supports inter-tool delegation\n\n### Why\n\nCurrent agent handoffs are:\n- Ad-hoc with inconsistent context transfer\n- Missing execution history from prior operations\n- Not tracked for debugging\n- Hard to chain across tools\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Create handoff from current operation\nconst handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n trace: executionTrace,\n context: {\n generatedArtifacts: ['spec.md', 'plan.md'],\n sessionId: 'session-123',\n },\n instructions: 'Review the generated spec for completeness.',\n});\n\n// Serialize for MCP response\nconst serialized = handoff.toJSON();\n\n// Receiving agent can parse\nconst received = AgentHandoffCoordinator.parseHandoff(serialized);\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Handoff Types\n\n```typescript\n// src/domain/coordination/handoff-types.ts\n\nimport type { ExecutionTrace } from './execution-trace.js';\n\n/**\n * Agent identifier type.\n */\nexport type AgentId =\n | 'speckit-generator'\n | 'code-reviewer'\n | 'security-auditor'\n | 'tdd-workflow'\n | 'documentation-generator'\n | 'architecture-advisor'\n | 'debugging-assistant'\n | 'mcp-tool-builder'\n | 'prompt-architect'\n | 'custom';\n\n/**\n * Handoff priority level.\n */\nexport type HandoffPriority = 'immediate' | 'normal' | 'background';\n\n/**\n * Handoff status.\n */\nexport type HandoffStatus =\n | 'pending'\n | 'accepted'\n | 'rejected'\n | 'completed'\n | 'expired';\n\n/**\n * Context passed to receiving agent.\n */\nexport interface HandoffContext {\n /** Session identifier for correlation */\n sessionId?: string;\n\n /** Files generated or modified */\n artifacts?: string[];\n\n /** Working directory or scope */\n workingDirectory?: string;\n\n /** User's original request */\n userRequest?: string;\n\n /** Previous decisions made */\n decisions?: Array<{\n what: string;\n why: string;\n alternatives?: string[];\n }>;\n\n /** Custom context data */\n custom?: Record<string, unknown>;\n}\n\n/**\n * Instructions for receiving agent.\n */\nexport interface HandoffInstructions {\n /** Primary task description */\n task: string;\n\n /** Expected output format */\n expectedOutput?: string;\n\n /** Constraints to follow */\n constraints?: string[];\n\n /** Focus areas */\n focusAreas?: string[];\n\n /** Things to avoid */\n avoid?: string[];\n\n /** Deadline or urgency */\n deadline?: Date;\n}\n\n/**\n * Complete handoff package.\n */\nexport interface HandoffPackage {\n /** Unique handoff identifier */\n id: string;\n\n /** Version for compatibility */\n version: string;\n\n /** Source agent */\n sourceAgent: AgentId;\n\n /** Target agent */\n targetAgent: AgentId;\n\n /** Priority level */\n priority: HandoffPriority;\n\n /** Current status */\n status: HandoffStatus;\n\n /** Handoff context */\n context: HandoffContext;\n\n /** Instructions for target */\n instructions: HandoffInstructions;\n\n /** Execution trace from source */\n trace?: ExecutionTraceSnapshot;\n\n /** Creation timestamp */\n createdAt: Date;\n\n /** Expiration time */\n expiresAt?: Date;\n\n /** Metadata */\n metadata?: Record<string, unknown>;\n}\n\n/**\n * Snapshot of execution trace for serialization.\n */\nexport interface ExecutionTraceSnapshot {\n /** Operation name */\n operation: string;\n\n /** Timestamp */\n timestamp: string;\n\n /** Duration in ms */\n durationMs: number;\n\n /** Key decisions */\n decisions: Array<{\n point: string;\n choice: string;\n reason: string;\n }>;\n\n /** Key metrics */\n metrics: Array<{\n name: string;\n value: number;\n unit?: string;\n }>;\n\n /** Errors encountered */\n errors: Array<{\n code: string;\n message: string;\n }>;\n\n /** Success status */\n success: boolean;\n}\n\n/**\n * Request to create a handoff.\n */\nexport interface CreateHandoffRequest {\n /** Source agent */\n sourceAgent: AgentId;\n\n /** Target agent */\n targetAgent: AgentId;\n\n /** Execution trace */\n trace?: ExecutionTrace;\n\n /** Context data */\n context: HandoffContext;\n\n /** Task instructions */\n instructions: string | HandoffInstructions;\n\n /** Priority level */\n priority?: HandoffPriority;\n\n /** Expiration duration in minutes */\n expirationMinutes?: number;\n\n /** Additional metadata */\n metadata?: Record<string, unknown>;\n}\n```\n\n### Step 2.2: Implement AgentHandoffCoordinator\n\n```typescript\n// src/domain/coordination/agent-handoff-coordinator.ts\n\nimport { randomUUID } from 'node:crypto';\nimport type {\n AgentId,\n HandoffPackage,\n HandoffContext,\n HandoffInstructions,\n HandoffStatus,\n HandoffPriority,\n CreateHandoffRequest,\n ExecutionTraceSnapshot,\n} from './handoff-types.js';\nimport type { ExecutionTrace } from './execution-trace.js';\n\n/**\n * Current handoff protocol version.\n */\nconst HANDOFF_VERSION = '1.0.0';\n\n/**\n * Default expiration in minutes.\n */\nconst DEFAULT_EXPIRATION_MINUTES = 60;\n\n/**\n * AgentHandoffCoordinator - manages agent-to-agent handoffs.\n *\n * Features:\n * - Packages execution context for handoffs\n * - Generates structured instructions\n * - Supports serialization for MCP transport\n * - Tracks handoff lifecycle\n *\n * \n * ```typescript\n * const handoff = AgentHandoffCoordinator.prepareHandoff({\n * sourceAgent: 'speckit-generator',\n * targetAgent: 'code-reviewer',\n * trace: executionTrace,\n * context: { artifacts: ['spec.md'] },\n * instructions: 'Review the spec for completeness.',\n * });\n *\n * // Serialize for transport\n * const json = handoff.toJSON();\n *\n * // Parse on receiving side\n * const received = AgentHandoffCoordinator.parseHandoff(json);\n * ```\n */\nexport class AgentHandoffCoordinator {\n // ============================================\n // Static Factory Methods\n // ============================================\n\n /**\n * Prepare a handoff package.\n */\n static prepareHandoff(request: CreateHandoffRequest): HandoffPackage {\n const now = new Date();\n const expirationMinutes = request.expirationMinutes ?? DEFAULT_EXPIRATION_MINUTES;\n\n // Normalize instructions\n const instructions = typeof request.instructions === 'string'\n ? { task: request.instructions }\n : request.instructions;\n\n // Create trace snapshot if provided\n const traceSnapshot = request.trace\n ? AgentHandoffCoordinator.createTraceSnapshot(request.trace)\n : undefined;\n\n return {\n id: randomUUID(),\n version: HANDOFF_VERSION,\n sourceAgent: request.sourceAgent,\n targetAgent: request.targetAgent,\n priority: request.priority ?? 'normal',\n status: 'pending' as HandoffStatus,\n context: request.context,\n instructions,\n trace: traceSnapshot,\n createdAt: now,\n expiresAt: new Date(now.getTime() + expirationMinutes * 60 * 1000),\n metadata: request.metadata,\n };\n }\n\n /**\n * Parse a serialized handoff.\n */\n static parseHandoff(json: string | object): HandoffPackage {\n const data = typeof json === 'string' ? JSON.parse(json) : json;\n\n // Validate version compatibility\n if (!data.version) {\n throw new Error('Invalid handoff: missing version');\n }\n\n const [major] = data.version.split('.');\n const [currentMajor] = HANDOFF_VERSION.split('.');\n\n if (major !== currentMajor) {\n throw new Error(\n `Incompatible handoff version: ${data.version} (expected ${HANDOFF_VERSION})`\n );\n }\n\n // Restore dates\n return {\n ...data,\n createdAt: new Date(data.createdAt),\n expiresAt: data.expiresAt ? new Date(data.expiresAt) : undefined,\n };\n }\n\n // ============================================\n // Instance Methods\n // ============================================\n\n private handoffs = new Map<string, HandoffPackage>();\n\n /**\n * Register a handoff.\n */\n register(handoff: HandoffPackage): void {\n this.handoffs.set(handoff.id, handoff);\n }\n\n /**\n * Get a handoff by ID.\n */\n get(id: string): HandoffPackage | undefined {\n return this.handoffs.get(id);\n }\n\n /**\n * Update handoff status.\n */\n updateStatus(id: string, status: HandoffStatus): boolean {\n const handoff = this.handoffs.get(id);\n if (!handoff) return false;\n\n handoff.status = status;\n return true;\n }\n\n /**\n * Check if handoff is expired.\n */\n isExpired(handoff: HandoffPackage): boolean {\n if (!handoff.expiresAt) return false;\n return new Date() > handoff.expiresAt;\n }\n\n /**\n * List pending handoffs for an agent.\n */\n listPendingForAgent(agentId: AgentId): HandoffPackage[] {\n return Array.from(this.handoffs.values())\n .filter(h =>\n h.targetAgent === agentId &&\n h.status === 'pending' &&\n !this.isExpired(h)\n )\n .sort((a, b) => {\n // Sort by priority, then by creation time\n const priorityOrder: Record<HandoffPriority, number> = {\n immediate: 0,\n normal: 1,\n background: 2,\n };\n const priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];\n if (priorityDiff !== 0) return priorityDiff;\n return a.createdAt.getTime() - b.createdAt.getTime();\n });\n }\n\n /**\n * Clear expired handoffs.\n */\n clearExpired(): number {\n let cleared = 0;\n\n for (const [id, handoff] of this.handoffs) {\n if (this.isExpired(handoff)) {\n this.handoffs.delete(id);\n cleared++;\n }\n }\n\n return cleared;\n }\n\n // ============================================\n // Trace Snapshot\n // ============================================\n\n /**\n * Create a serializable snapshot from an execution trace.\n */\n static createTraceSnapshot(trace: ExecutionTrace): ExecutionTraceSnapshot {\n const data = trace.toJSON();\n\n return {\n operation: data.operation,\n timestamp: data.timestamp,\n durationMs: data.durationMs,\n decisions: data.decisions.map(d => ({\n point: d.point,\n choice: d.choice,\n reason: d.reason,\n })),\n metrics: data.metrics.map(m => ({\n name: m.name,\n value: m.value,\n unit: m.unit,\n })),\n errors: data.errors.map(e => ({\n code: e.code,\n message: e.message,\n })),\n success: data.success,\n };\n }\n\n // ============================================\n // Serialization Helpers\n // ============================================\n\n /**\n * Convert handoff to JSON string.\n */\n static toJSON(handoff: HandoffPackage): string {\n return JSON.stringify(handoff, null, 2);\n }\n\n /**\n * Generate markdown summary of handoff.\n */\n static toMarkdown(handoff: HandoffPackage): string {\n const lines: string[] = [];\n\n lines.push(`# Agent Handoff: ${handoff.sourceAgent} ‚Üí ${handoff.targetAgent}`);\n lines.push('');\n lines.push(`**ID**: \\`${handoff.id}\\``);\n lines.push(`**Status**: ${handoff.status}`);\n lines.push(`**Priority**: ${handoff.priority}`);\n lines.push(`**Created**: ${handoff.createdAt.toISOString()}`);\n if (handoff.expiresAt) {\n lines.push(`**Expires**: ${handoff.expiresAt.toISOString()}`);\n }\n lines.push('');\n\n // Instructions\n lines.push('## Instructions');\n lines.push('');\n lines.push(`**Task**: ${handoff.instructions.task}`);\n\n if (handoff.instructions.constraints?.length) {\n lines.push('');\n lines.push('**Constraints**:');\n for (const c of handoff.instructions.constraints) {\n lines.push(`- ${c}`);\n }\n }\n\n if (handoff.instructions.focusAreas?.length) {\n lines.push('');\n lines.push('**Focus Areas**:');\n for (const f of handoff.instructions.focusAreas) {\n lines.push(`- ${f}`);\n }\n }\n\n // Context\n if (handoff.context.artifacts?.length) {\n lines.push('');\n lines.push('## Artifacts');\n lines.push('');\n for (const a of handoff.context.artifacts) {\n lines.push(`- \\`${a}\\``);\n }\n }\n\n if (handoff.context.decisions?.length) {\n lines.push('');\n lines.push('## Prior Decisions');\n lines.push('');\n for (const d of handoff.context.decisions) {\n lines.push(`- **${d.what}**: ${d.why}`);\n }\n }\n\n // Trace summary\n if (handoff.trace) {\n lines.push('');\n lines.push('## Execution Trace Summary');\n lines.push('');\n lines.push(`- **Operation**: ${handoff.trace.operation}`);\n lines.push(`- **Duration**: ${handoff.trace.durationMs}ms`);\n lines.push(`- **Success**: ${handoff.trace.success ? '‚úÖ' : '‚ùå'}`);\n lines.push(`- **Decisions**: ${handoff.trace.decisions.length}`);\n lines.push(`- **Errors**: ${handoff.trace.errors.length}`);\n }\n\n return lines.join('\\n');\n }\n}\n\n/**\n * Default coordinator instance.\n */\nexport const agentHandoffCoordinator = new AgentHandoffCoordinator();\n```\n\n### Step 2.3: Create Barrel Export\n\n```typescript\n// src/domain/coordination/index.ts\n\n// Types\nexport type {\n AgentId,\n HandoffPriority,\n HandoffStatus,\n HandoffContext,\n HandoffInstructions,\n HandoffPackage,\n ExecutionTraceSnapshot,\n CreateHandoffRequest,\n} from './handoff-types.js';\n\n// Execution Trace (from T-003)\nexport { ExecutionTrace } from './execution-trace.js';\nexport type {\n TraceDecision,\n TraceMetric,\n TraceError,\n TraceExportData\n} from './execution-trace.js';\n\n// Summary Feedback (from T-005)\nexport { SummaryFeedbackCoordinator } from './summary-feedback-coordinator.js';\nexport type {\n OperationStatus,\n FeedbackItem,\n Suggestion,\n SummaryResult,\n} from './summary-feedback-coordinator.js';\n\n// Agent Handoff\nexport {\n AgentHandoffCoordinator,\n agentHandoffCoordinator,\n} from './agent-handoff-coordinator.js';\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/coordination/agent-handoff-coordinator.spec.ts\n\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport {\n AgentHandoffCoordinator,\n agentHandoffCoordinator,\n} from '../../../../src/domain/coordination/agent-handoff-coordinator.js';\nimport { ExecutionTrace } from '../../../../src/domain/coordination/execution-trace.js';\nimport type { CreateHandoffRequest } from '../../../../src/domain/coordination/handoff-types.js';\n\ndescribe('AgentHandoffCoordinator', () => {\n let coordinator: AgentHandoffCoordinator;\n\n beforeEach(() => {\n coordinator = new AgentHandoffCoordinator();\n });\n\n // ============================================\n // prepareHandoff\n // ============================================\n\n describe('prepareHandoff', () => {\n it('should create handoff package with required fields', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: { artifacts: ['spec.md'] },\n instructions: 'Review the spec.',\n });\n\n expect(handoff.id).toBeDefined();\n expect(handoff.version).toBe('1.0.0');\n expect(handoff.sourceAgent).toBe('speckit-generator');\n expect(handoff.targetAgent).toBe('code-reviewer');\n expect(handoff.status).toBe('pending');\n expect(handoff.instructions.task).toBe('Review the spec.');\n });\n\n it('should set default priority to normal', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n });\n\n expect(handoff.priority).toBe('normal');\n });\n\n it('should accept priority override', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'security-auditor',\n context: {},\n instructions: 'Urgent security review',\n priority: 'immediate',\n });\n\n expect(handoff.priority).toBe('immediate');\n });\n\n it('should set expiration time', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n expirationMinutes: 30,\n });\n\n const expectedExpiry = handoff.createdAt.getTime() + 30 * 60 * 1000;\n expect(handoff.expiresAt?.getTime()).toBe(expectedExpiry);\n });\n\n it('should include execution trace snapshot', () => {\n const trace = new ExecutionTrace('test-operation');\n trace.recordDecision('validation', 'passed', 'All inputs valid');\n trace.recordMetric('duration', 100, 'ms');\n trace.complete(true);\n\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n trace,\n });\n\n expect(handoff.trace).toBeDefined();\n expect(handoff.trace?.operation).toBe('test-operation');\n expect(handoff.trace?.decisions).toHaveLength(1);\n expect(handoff.trace?.success).toBe(true);\n });\n\n it('should accept detailed instructions object', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: {\n task: 'Review the generated spec',\n constraints: ['Focus on completeness', 'Check for ambiguity'],\n focusAreas: ['Requirements section', 'Acceptance criteria'],\n avoid: ['Implementation details'],\n },\n });\n\n expect(handoff.instructions.task).toBe('Review the generated spec');\n expect(handoff.instructions.constraints).toHaveLength(2);\n expect(handoff.instructions.focusAreas).toHaveLength(2);\n });\n });\n\n // ============================================\n // parseHandoff\n // ============================================\n\n describe('parseHandoff', () => {\n it('should parse JSON string', () => {\n const original = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: { artifacts: ['test.md'] },\n instructions: 'Test',\n });\n\n const json = JSON.stringify(original);\n const parsed = AgentHandoffCoordinator.parseHandoff(json);\n\n expect(parsed.id).toBe(original.id);\n expect(parsed.sourceAgent).toBe(original.sourceAgent);\n expect(parsed.context.artifacts).toEqual(['test.md']);\n });\n\n it('should parse object directly', () => {\n const original = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n });\n\n const parsed = AgentHandoffCoordinator.parseHandoff(original);\n\n expect(parsed.id).toBe(original.id);\n });\n\n it('should restore Date objects', () => {\n const original = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n });\n\n const json = JSON.stringify(original);\n const parsed = AgentHandoffCoordinator.parseHandoff(json);\n\n expect(parsed.createdAt).toBeInstanceOf(Date);\n expect(parsed.expiresAt).toBeInstanceOf(Date);\n });\n\n it('should throw on missing version', () => {\n expect(() => {\n AgentHandoffCoordinator.parseHandoff({ sourceAgent: 'test' });\n }).toThrow('missing version');\n });\n\n it('should throw on incompatible version', () => {\n expect(() => {\n AgentHandoffCoordinator.parseHandoff({ version: '2.0.0' });\n }).toThrow('Incompatible handoff version');\n });\n });\n\n // ============================================\n // Instance Management\n // ============================================\n\n describe('instance management', () => {\n it('should register and retrieve handoff', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n });\n\n coordinator.register(handoff);\n const retrieved = coordinator.get(handoff.id);\n\n expect(retrieved).toBe(handoff);\n });\n\n it('should update handoff status', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n });\n\n coordinator.register(handoff);\n const updated = coordinator.updateStatus(handoff.id, 'accepted');\n\n expect(updated).toBe(true);\n expect(coordinator.get(handoff.id)?.status).toBe('accepted');\n });\n\n it('should return false for unknown handoff update', () => {\n const updated = coordinator.updateStatus('unknown-id', 'accepted');\n expect(updated).toBe(false);\n });\n });\n\n // ============================================\n // Expiration\n // ============================================\n\n describe('expiration', () => {\n it('should detect expired handoff', () => {\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test',\n expirationMinutes: 0, // Immediately expired\n });\n\n // Wait a tick\n vi.useFakeTimers();\n vi.advanceTimersByTime(1);\n\n expect(coordinator.isExpired(handoff)).toBe(true);\n\n vi.useRealTimers();\n });\n\n it('should clear expired handoffs', () => {\n vi.useFakeTimers();\n\n const handoff1 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test 1',\n expirationMinutes: 1,\n });\n\n const handoff2 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test 2',\n expirationMinutes: 60,\n });\n\n coordinator.register(handoff1);\n coordinator.register(handoff2);\n\n // Advance time past first handoff expiration\n vi.advanceTimersByTime(2 * 60 * 1000);\n\n const cleared = coordinator.clearExpired();\n\n expect(cleared).toBe(1);\n expect(coordinator.get(handoff1.id)).toBeUndefined();\n expect(coordinator.get(handoff2.id)).toBeDefined();\n\n vi.useRealTimers();\n });\n });\n\n // ============================================\n // Listing\n // ============================================\n\n describe('listPendingForAgent', () => {\n it('should list pending handoffs for agent', () => {\n const handoff1 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Test 1',\n });\n\n const handoff2 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'security-auditor',\n context: {},\n instructions: 'Test 2',\n });\n\n coordinator.register(handoff1);\n coordinator.register(handoff2);\n\n const pending = coordinator.listPendingForAgent('code-reviewer');\n\n expect(pending).toHaveLength(1);\n expect(pending[0].id).toBe(handoff1.id);\n });\n\n it('should sort by priority then creation time', () => {\n vi.useFakeTimers();\n\n const handoff1 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Normal 1',\n priority: 'normal',\n });\n\n vi.advanceTimersByTime(1000);\n\n const handoff2 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Immediate',\n priority: 'immediate',\n });\n\n vi.advanceTimersByTime(1000);\n\n const handoff3 = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {},\n instructions: 'Normal 2',\n priority: 'normal',\n });\n\n coordinator.register(handoff1);\n coordinator.register(handoff2);\n coordinator.register(handoff3);\n\n const pending = coordinator.listPendingForAgent('code-reviewer');\n\n expect(pending[0].id).toBe(handoff2.id); // Immediate first\n expect(pending[1].id).toBe(handoff1.id); // Normal, earlier\n expect(pending[2].id).toBe(handoff3.id); // Normal, later\n\n vi.useRealTimers();\n });\n });\n\n // ============================================\n // Serialization\n // ============================================\n\n describe('toMarkdown', () => {\n it('should generate markdown summary', () => {\n const trace = new ExecutionTrace('test-operation');\n trace.recordDecision('validation', 'passed', 'All inputs valid');\n trace.complete(true);\n\n const handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n context: {\n artifacts: ['spec.md', 'plan.md'],\n decisions: [\n { what: 'Template', why: 'Using standard format' },\n ],\n },\n instructions: {\n task: 'Review for completeness',\n constraints: ['Focus on requirements'],\n },\n trace,\n });\n\n const markdown = AgentHandoffCoordinator.toMarkdown(handoff);\n\n expect(markdown).toContain('speckit-generator ‚Üí code-reviewer');\n expect(markdown).toContain('Review for completeness');\n expect(markdown).toContain('spec.md');\n expect(markdown).toContain('Focus on requirements');\n expect(markdown).toContain('Execution Trace Summary');\n });\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------- | ------ | --------------- |\n| Create handoff with required fields | ‚¨ú | Creation test |\n| Support priority levels | ‚¨ú | Priority test |\n| Handle expiration | ‚¨ú | Expiration test |\n| Include execution trace | ‚¨ú | Trace test |\n| Parse serialized handoff | ‚¨ú | Parse test |\n| Version compatibility check | ‚¨ú | Version test |\n| List pending handoffs by agent | ‚¨ú | Listing test |\n| Generate markdown summary | ‚¨ú | Markdown test |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. Usage Examples\n\n### Creating a Handoff After SpecKit Generation\n\n```typescript\nimport {\n AgentHandoffCoordinator\n} from './domain/coordination/index.js';\nimport { ExecutionTrace } from './domain/coordination/index.js';\n\n// After generating spec\nconst trace = new ExecutionTrace('speckit-generate');\ntrace.recordDecision('template', 'standard', 'Using standard spec template');\ntrace.recordDecision('sections', 'all', 'Including all 7 sections');\ntrace.recordMetric('artifacts', 7, 'files');\ntrace.complete(true);\n\n// Prepare handoff to code reviewer\nconst handoff = AgentHandoffCoordinator.prepareHandoff({\n sourceAgent: 'speckit-generator',\n targetAgent: 'code-reviewer',\n trace,\n context: {\n sessionId: 'session-123',\n artifacts: [\n 'spec.md',\n 'plan.md',\n 'tasks.md',\n 'progress.md',\n 'adr.md',\n 'roadmap.md',\n 'README.md',\n ],\n userRequest: 'Generate comprehensive spec for auth system',\n decisions: [\n { what: 'Scope', why: 'Focused on OAuth2 implementation' },\n { what: 'Priority', why: 'Security features marked P0' },\n ],\n },\n instructions: {\n task: 'Review the generated specification for completeness and accuracy',\n focusAreas: [\n 'Requirements coverage',\n 'Acceptance criteria clarity',\n 'Task dependencies',\n ],\n constraints: [\n 'Ensure all security requirements are addressed',\n 'Verify timeline is realistic',\n ],\n avoid: [\n 'Implementation suggestions (that comes later)',\n ],\n },\n priority: 'normal',\n});\n\n// Serialize for MCP response\nconst serialized = AgentHandoffCoordinator.toJSON(handoff);\n\n// Or generate markdown for user visibility\nconst summary = AgentHandoffCoordinator.toMarkdown(handoff);\n```\n\n---\n\n## 6. References\n\n| Document | Link |\n| -------------------------------------- | -------------------------------------------------------- |\n| T-003: ExecutionTrace | [T-003-execution-trace.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-003-execution-trace.md) |\n| T-005: SummaryFeedbackCoordinator | [T-005-summary-feedback.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-005-summary-feedback.md) |\n| ADR-001: Strategy Pattern Architecture | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-001) |\n| AGENTS.md | [AGENTS.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/AGENTS.md) |\n\n---\n\n*Task: T-007 | Phase: 1 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P1-high"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P1",
		"task_id": "T-007",
		"dependencies": ["T-003", "T-005"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-007-agent-handoff.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-007-agent-handoff.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-008: Test AgentHandoffCoordinator",
		"body": "# T-008: Test AgentHandoffCoordinator\n\n## Overview\n\n**Task ID**: T-008\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-007\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-008-test-agenthandoffcoordinator.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test AgentHandoffCoordinator' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-008\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test AgentHandoffCoordinator fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-007\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-008 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "testing", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-008",
		"dependencies": ["T-007"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-008-test-agenthandoffcoordinator.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-008-test-agenthandoffcoordinator.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-009: Update OutputStrategy Interface",
		"body": "# T-009: Update OutputStrategy Interface\n\n## Overview\n\n**Task ID**: T-009\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-001\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-009-update-outputstrategy-interface.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nUpdate to integrate with BaseStrategy pattern.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-009\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Update OutputStrategy Interface fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001\n\n### Target Files\n\n- `src/strategies/output-strategy.ts`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Review Existing State\n\n- Locate related code and determine current gaps\n- Confirm requirements from tasks.md\n\n### Step 4.2: Implement Core Changes\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nexport interface OutputStrategy {\n format(data: unknown): string;\n}\n\nexport class MarkdownStrategy implements OutputStrategy {\n format(data: unknown): string {\n return String(data);\n }\n}\n```\n\n### Step 4.3: Wire Integrations\n\n- Update barrel exports and registries\n- Register new handler or service if required\n- Add configuration entries where needed\n\n### Step 4.4: Validate Behavior\n\n- Run unit tests for new logic\n- Ensure TypeScript strict mode passes\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `src/strategies/output-strategy.ts`\n\n---\n\n*Task: T-009 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "implementation", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-009",
		"dependencies": ["T-001"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-009-update-outputstrategy-interface.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-009-update-outputstrategy-interface.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-010: Phase 1 Integration Test",
		"body": "# T-010: Phase 1 Integration Test\n\n## Overview\n\n**Task ID**: T-010\n**Phase**: 1\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-001 through T-009\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-010-phase-1-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968\n\n\n## 1. Overview\n\n### What\n\nVerify all Phase 1 components work together.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-010\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 1 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001 through T-009\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-010 | Phase: 1 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-1", "integration-test", "P0-critical"],
		"milestone": 17,
		"parent_issue": 968,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/968",
		"phase": "1",
		"priority": "P0",
		"task_id": "T-010",
		"dependencies": ["T-001", "T-009"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-010-phase-1-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-010-phase-1-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-011: Migrate SpecKit Strategy to BaseStrategy",
		"body": "# T-011: Migrate SpecKit Strategy to BaseStrategy\n\n## Overview\n\n**Task ID**: T-011\n**Phase**: 2 - Migration\n**Priority**: P0 (Critical Path)\n**Estimate**: 6 hours\n**Dependencies**: T-001 (BaseStrategy), T-003 (ExecutionTrace)\n**Blocks**: T-012 (TOGAF), T-013 (ADR), T-014 (RFC)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-011-migrate-speckit.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nMigrate the existing 2181-line `speckit-strategy.ts` to extend `BaseStrategy<T>`, extracting pure business logic into the domain layer while keeping MCP-specific orchestration in the strategy.\n\n### Why\n\nCurrent SpecKit implementation:\n- 2181 lines in a single file\n- Mixed concerns (business logic + MCP orchestration)\n- No execution tracing\n- Difficult to test in isolation\n- No reusable patterns for other strategies\n\n### Target State\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```\nsrc/strategies/speckit/\n‚îú‚îÄ‚îÄ speckit-strategy.ts (~400 lines - orchestration only)\n‚îú‚îÄ‚îÄ index.ts (barrel export)\n‚îî‚îÄ‚îÄ ...existing files...\n\nsrc/domain/speckit/\n‚îú‚îÄ‚îÄ types.ts (SessionState, OutputArtifacts, etc.)\n‚îú‚îÄ‚îÄ generators/\n‚îÇ ‚îú‚îÄ‚îÄ spec-generator.ts (generateSpec pure function)\n‚îÇ ‚îú‚îÄ‚îÄ plan-generator.ts (generatePlan pure function)\n‚îÇ ‚îú‚îÄ‚îÄ tasks-generator.ts (generateTasks pure function)\n‚îÇ ‚îî‚îÄ‚îÄ index.ts\n‚îú‚îÄ‚îÄ validators/\n‚îÇ ‚îú‚îÄ‚îÄ constitution-validator.ts\n‚îÇ ‚îî‚îÄ‚îÄ index.ts\n‚îî‚îÄ‚îÄ index.ts (barrel)\n```\n\n---\n\n## 2. Current State Analysis\n\n### Current File Structure\n\n```typescript\n// src/strategies/speckit-strategy.ts (2181 lines)\n\nexport interface SessionState {\n title: string;\n overview: string;\n objectives: Objective[];\n requirements: Requirement[];\n // ... many more fields\n}\n\nexport interface OutputArtifacts {\n readme?: string;\n spec?: string;\n plan?: string;\n tasks?: string;\n progress?: string;\n adr?: string;\n roadmap?: string;\n}\n\nexport class SpecKitStrategy implements OutputStrategy {\n // 1700+ lines of mixed concerns:\n // - Input validation\n // - Session state management\n // - Document generation (spec, plan, tasks, etc.)\n // - Constitution validation\n // - Error handling\n}\n```\n\n### Issues to Address\n\n| Issue | Lines | Solution |\n| ----------------- | ----- | ------------------------------------------ |\n| Giant class | 2181 | Split into BaseStrategy + domain functions |\n| No tracing | - | Add ExecutionTrace via BaseStrategy |\n| Mixed concerns | ~1200 | Extract generators to domain layer |\n| Inline validation | ~300 | Extract to validators/ |\n| No typing | - | Add proper generics |\n\n---\n\n## 3. Implementation Guide\n\n### Step 3.1: Extract Types to Domain Layer\n\n```typescript\n// src/domain/speckit/types.ts\n\nimport { z } from 'zod';\n\n// ============================================\n// Input Types (from MCP tool)\n// ============================================\n\nexport const ObjectiveSchema = z.object({\n description: z.string().min(1),\n priority: z.enum(['high', 'medium', 'low']).optional().default('medium'),\n});\n\nexport const RequirementSchema = z.object({\n description: z.string().min(1),\n type: z.enum(['functional', 'non-functional']).optional().default('functional'),\n priority: z.enum(['high', 'medium', 'low']).optional().default('medium'),\n});\n\nexport const SpecKitInputSchema = z.object({\n title: z.string().min(1, 'Title is required'),\n overview: z.string().min(1, 'Overview is required'),\n objectives: z.array(ObjectiveSchema).min(1, 'At least one objective required'),\n requirements: z.array(RequirementSchema).min(1, 'At least one requirement required'),\n acceptanceCriteria: z.array(z.string()).optional().default([]),\n outOfScope: z.array(z.string()).optional().default([]),\n constitutionPath: z.string().optional(),\n validateAgainstConstitution: z.boolean().optional().default(false),\n});\n\nexport type SpecKitInput = z.infer<typeof SpecKitInputSchema>;\nexport type Objective = z.infer<typeof ObjectiveSchema>;\nexport type Requirement = z.infer<typeof RequirementSchema>;\n\n// ============================================\n// Session State (internal processing)\n// ============================================\n\nexport interface SessionState {\n /** Parsed and validated input */\n input: SpecKitInput;\n\n /** Constitution constraints (if loaded) */\n constitution: ConstitutionConstraints | null;\n\n /** Generated document sections */\n sections: {\n readme: MarkdownSection | null;\n spec: MarkdownSection | null;\n plan: MarkdownSection | null;\n tasks: MarkdownSection | null;\n progress: MarkdownSection | null;\n adr: MarkdownSection | null;\n roadmap: MarkdownSection | null;\n };\n\n /** Processing metadata */\n metadata: {\n startedAt: Date;\n totalTokensEstimate: number;\n warnings: string[];\n };\n}\n\nexport interface MarkdownSection {\n title: string;\n content: string;\n generatedAt: Date;\n tokenEstimate: number;\n}\n\nexport interface ConstitutionConstraints {\n path: string;\n loadedAt: Date;\n rules: ConstitutionRule[];\n}\n\nexport interface ConstitutionRule {\n id: string;\n description: string;\n severity: 'error' | 'warning';\n check: (state: SessionState) => boolean;\n}\n\n// ============================================\n// Output Types\n// ============================================\n\nexport interface SpecKitOutput {\n /** All generated documents as markdown strings */\n artifacts: OutputArtifacts;\n\n /** Validation results against constitution */\n validation: ValidationResult | null;\n\n /** Processing statistics */\n stats: ProcessingStats;\n}\n\nexport interface OutputArtifacts {\n readme: string;\n spec: string;\n plan: string;\n tasks: string;\n progress: string;\n adr: string;\n roadmap: string;\n}\n\nexport interface ProcessingStats {\n totalDuration: number;\n documentsGenerated: number;\n totalTokens: number;\n warnings: string[];\n}\n\nexport interface ValidationResult {\n isValid: boolean;\n score: number;\n errors: ValidationIssue[];\n warnings: ValidationIssue[];\n recommendations: string[];\n}\n\nexport interface ValidationIssue {\n ruleId: string;\n message: string;\n severity: 'error' | 'warning';\n location?: string;\n}\n\n// ============================================\n// Factory Functions\n// ============================================\n\nexport function createInitialSessionState(input: SpecKitInput): SessionState {\n return {\n input,\n constitution: null,\n sections: {\n readme: null,\n spec: null,\n plan: null,\n tasks: null,\n progress: null,\n adr: null,\n roadmap: null,\n },\n metadata: {\n startedAt: new Date(),\n totalTokensEstimate: 0,\n warnings: [],\n },\n };\n}\n\nexport function createDefaultOutput(): SpecKitOutput {\n return {\n artifacts: {\n readme: '',\n spec: '',\n plan: '',\n tasks: '',\n progress: '',\n adr: '',\n roadmap: '',\n },\n validation: null,\n stats: {\n totalDuration: 0,\n documentsGenerated: 0,\n totalTokens: 0,\n warnings: [],\n },\n };\n}\n```\n\n### Step 3.2: Extract Pure Generators\n\n```typescript\n// src/domain/speckit/generators/spec-generator.ts\n\nimport type { SessionState, MarkdownSection, Requirement, Objective } from '../types.js';\n\n/**\n * Generate the spec.md document from session state.\n *\n * Pure function - no side effects, no external dependencies.\n *\n * state - Current session state\n * Generated spec section\n */\nexport function generateSpec(state: SessionState): MarkdownSection {\n const { input } = state;\n const startTime = Date.now();\n\n const sections: string[] = [];\n\n // Title section\n sections.push(`# ${input.title} - Specification`);\n sections.push('');\n\n // Overview\n sections.push('## Overview');\n sections.push('');\n sections.push(input.overview);\n sections.push('');\n\n // Objectives\n sections.push('## Objectives');\n sections.push('');\n sections.push(formatObjectives(input.objectives));\n sections.push('');\n\n // Requirements\n sections.push('## Requirements');\n sections.push('');\n sections.push('### Functional Requirements');\n sections.push('');\n sections.push(formatRequirements(input.requirements.filter(r => r.type === 'functional')));\n sections.push('');\n sections.push('### Non-Functional Requirements');\n sections.push('');\n sections.push(formatRequirements(input.requirements.filter(r => r.type === 'non-functional')));\n sections.push('');\n\n // Acceptance Criteria\n if (input.acceptanceCriteria.length > 0) {\n sections.push('## Acceptance Criteria');\n sections.push('');\n sections.push(formatAcceptanceCriteria(input.acceptanceCriteria));\n sections.push('');\n }\n\n // Out of Scope\n if (input.outOfScope.length > 0) {\n sections.push('## Out of Scope');\n sections.push('');\n sections.push(formatOutOfScope(input.outOfScope));\n sections.push('');\n }\n\n const content = sections.join('\\n');\n\n return {\n title: 'spec.md',\n content,\n generatedAt: new Date(),\n tokenEstimate: estimateTokens(content),\n };\n}\n\n// ============================================\n// Formatting Helpers (Pure Functions)\n// ============================================\n\nfunction formatObjectives(objectives: Objective[]): string {\n const byPriority = groupByPriority(objectives);\n const lines: string[] = [];\n\n for (const priority of ['high', 'medium', 'low'] as const) {\n const items = byPriority[priority];\n if (items.length === 0) continue;\n\n lines.push(`### Priority: ${capitalize(priority)}`);\n lines.push('');\n\n for (const obj of items) {\n lines.push(`- ${obj.description}`);\n }\n lines.push('');\n }\n\n return lines.join('\\n');\n}\n\nfunction formatRequirements(requirements: Requirement[]): string {\n if (requirements.length === 0) {\n return '_No requirements specified._';\n }\n\n const lines: string[] = [];\n lines.push('| ID | Description | Priority |');\n lines.push('|----|-------------|----------|');\n\n requirements.forEach((req, index) => {\n const id = `REQ-${String(index + 1).padStart(3, '0')}`;\n lines.push(`| ${id} | ${req.description} | ${capitalize(req.priority ?? 'medium')} |`);\n });\n\n return lines.join('\\n');\n}\n\nfunction formatAcceptanceCriteria(criteria: string[]): string {\n return criteria.map((c, i) => `- [ ] **AC-${i + 1}**: ${c}`).join('\\n');\n}\n\nfunction formatOutOfScope(items: string[]): string {\n return items.map(item => `- ‚ùå ${item}`).join('\\n');\n}\n\nfunction groupByPriority<T extends { priority?: string }>(\n items: T[]\n): Record<string, T[]> {\n const result: Record<string, T[]> = { high: [], medium: [], low: [] };\n\n for (const item of items) {\n const priority = item.priority ?? 'medium';\n result[priority].push(item);\n }\n\n return result;\n}\n\nfunction capitalize(str: string): string {\n return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction estimateTokens(text: string): number {\n // Rough estimate: ~4 characters per token\n return Math.ceil(text.length / 4);\n}\n```\n\n```typescript\n// src/domain/speckit/generators/plan-generator.ts\n\nimport type { SessionState, MarkdownSection } from '../types.js';\n\n/**\n * Generate the plan.md document from session state.\n *\n * Pure function - no side effects.\n */\nexport function generatePlan(state: SessionState): MarkdownSection {\n const { input } = state;\n const startTime = Date.now();\n\n const sections: string[] = [];\n\n sections.push(`# ${input.title} - Implementation Plan`);\n sections.push('');\n\n // Executive Summary\n sections.push('## Executive Summary');\n sections.push('');\n sections.push(input.overview);\n sections.push('');\n\n // Phases (derived from objectives)\n sections.push('## Phases');\n sections.push('');\n sections.push(generatePhases(input.objectives));\n sections.push('');\n\n // Timeline (Mermaid Gantt)\n sections.push('## Timeline');\n sections.push('');\n sections.push(generateGanttChart(input.objectives));\n sections.push('');\n\n // Risk Assessment\n sections.push('## Risks & Mitigations');\n sections.push('');\n sections.push(generateRiskAssessment(input.requirements));\n sections.push('');\n\n const content = sections.join('\\n');\n\n return {\n title: 'plan.md',\n content,\n generatedAt: new Date(),\n tokenEstimate: estimateTokens(content),\n };\n}\n\nfunction generatePhases(objectives: Array<{ description: string; priority?: string }>): string {\n const highPriority = objectives.filter(o => o.priority === 'high');\n const mediumPriority = objectives.filter(o => o.priority === 'medium');\n const lowPriority = objectives.filter(o => o.priority === 'low');\n\n const lines: string[] = [];\n\n if (highPriority.length > 0) {\n lines.push('### Phase 1: Foundation (Weeks 1-2)');\n lines.push('');\n lines.push('**Focus**: High-priority objectives');\n lines.push('');\n highPriority.forEach((obj, i) => {\n lines.push(`${i + 1}. ${obj.description}`);\n });\n lines.push('');\n }\n\n if (mediumPriority.length > 0) {\n lines.push('### Phase 2: Core Implementation (Weeks 3-4)');\n lines.push('');\n lines.push('**Focus**: Medium-priority objectives');\n lines.push('');\n mediumPriority.forEach((obj, i) => {\n lines.push(`${i + 1}. ${obj.description}`);\n });\n lines.push('');\n }\n\n if (lowPriority.length > 0) {\n lines.push('### Phase 3: Enhancement (Weeks 5-6)');\n lines.push('');\n lines.push('**Focus**: Low-priority objectives');\n lines.push('');\n lowPriority.forEach((obj, i) => {\n lines.push(`${i + 1}. ${obj.description}`);\n });\n lines.push('');\n }\n\n return lines.join('\\n');\n}\n\nfunction generateGanttChart(objectives: Array<{ description: string; priority?: string }>): string {\n const lines: string[] = [];\n\n lines.push('```mermaid');\n lines.push('gantt');\n lines.push(' title Implementation Timeline');\n lines.push(' dateFormat YYYY-MM-DD');\n lines.push('');\n\n const highPriority = objectives.filter(o => o.priority === 'high');\n const mediumPriority = objectives.filter(o => o.priority === 'medium');\n const lowPriority = objectives.filter(o => o.priority === 'low');\n\n if (highPriority.length > 0) {\n lines.push(' section Phase 1');\n highPriority.forEach((obj, i) => {\n const taskName = truncate(obj.description, 30);\n lines.push(` ${taskName} :p1t${i + 1}, 2025-01-06, 1w`);\n });\n }\n\n if (mediumPriority.length > 0) {\n lines.push(' section Phase 2');\n mediumPriority.forEach((obj, i) => {\n const taskName = truncate(obj.description, 30);\n lines.push(` ${taskName} :p2t${i + 1}, after p1t1, 1w`);\n });\n }\n\n if (lowPriority.length > 0) {\n lines.push(' section Phase 3');\n lowPriority.forEach((obj, i) => {\n const taskName = truncate(obj.description, 30);\n lines.push(` ${taskName} :p3t${i + 1}, after p2t1, 1w`);\n });\n }\n\n lines.push('```');\n\n return lines.join('\\n');\n}\n\nfunction generateRiskAssessment(requirements: Array<{ description: string; priority?: string }>): string {\n const lines: string[] = [];\n\n lines.push('| Risk | Probability | Impact | Mitigation |');\n lines.push('|------|-------------|--------|------------|');\n\n // Generate risks based on requirement count and types\n if (requirements.length > 20) {\n lines.push('| Scope creep | High | High | Strict change control process |');\n }\n\n const nfr = requirements.filter(r => r.type === 'non-functional');\n if (nfr.length > 5) {\n lines.push('| Performance constraints | Medium | High | Early performance testing |');\n }\n\n lines.push('| Technical complexity | Medium | Medium | Incremental implementation |');\n lines.push('| Resource availability | Low | Medium | Cross-training team members |');\n\n return lines.join('\\n');\n}\n\nfunction truncate(str: string, maxLength: number): string {\n if (str.length <= maxLength) return str;\n return str.substring(0, maxLength - 3) + '...';\n}\n\nfunction estimateTokens(text: string): number {\n return Math.ceil(text.length / 4);\n}\n```\n\n### Step 3.3: Create Generators Barrel\n\n```typescript\n// src/domain/speckit/generators/index.ts\n\nexport { generateSpec } from './spec-generator.js';\nexport { generatePlan } from './plan-generator.js';\nexport { generateTasks } from './tasks-generator.js';\nexport { generateProgress } from './progress-generator.js';\nexport { generateReadme } from './readme-generator.js';\nexport { generateAdr } from './adr-generator.js';\nexport { generateRoadmap } from './roadmap-generator.js';\n```\n\n### Step 3.4: Create Domain Barrel\n\n```typescript\n// src/domain/speckit/index.ts\n\n// Types\nexport type {\n SpecKitInput,\n SpecKitOutput,\n SessionState,\n OutputArtifacts,\n ValidationResult,\n Objective,\n Requirement,\n} from './types.js';\n\nexport {\n SpecKitInputSchema,\n createInitialSessionState,\n createDefaultOutput,\n} from './types.js';\n\n// Generators\nexport * from './generators/index.js';\n\n// Validators\nexport * from './validators/index.js';\n```\n\n### Step 3.5: Migrate Strategy to BaseStrategy\n\n```typescript\n// src/strategies/speckit/speckit-strategy.ts\n\nimport { BaseStrategy, type StrategyResult } from '../../domain/base-strategy/index.js';\nimport {\n type SpecKitInput,\n type SpecKitOutput,\n type SessionState,\n SpecKitInputSchema,\n createInitialSessionState,\n createDefaultOutput,\n generateSpec,\n generatePlan,\n generateTasks,\n generateProgress,\n generateReadme,\n generateAdr,\n generateRoadmap,\n validateAgainstConstitution,\n} from '../../domain/speckit/index.js';\n\n/**\n * SpecKit Strategy - Generates full project specification artifacts.\n *\n * Extends BaseStrategy to provide:\n * - Zod validation of inputs\n * - Execution tracing for debugging\n * - Consistent error handling\n * - Structured output format\n *\n * \n * ```typescript\n * const strategy = new SpecKitStrategy();\n * const result = await strategy.execute({\n * title: 'My Project',\n * overview: 'Project description...',\n * objectives: [{ description: 'Build X', priority: 'high' }],\n * requirements: [{ description: 'Must do Y', type: 'functional' }],\n * });\n *\n * if (result.success) {\n * console.log(result.output.artifacts.spec);\n * }\n * ```\n */\nexport class SpecKitStrategy extends BaseStrategy<SpecKitInput, SpecKitOutput> {\n readonly name = 'speckit';\n readonly version = '2.0.0';\n\n constructor() {\n super(SpecKitInputSchema);\n }\n\n /**\n * Execute the SpecKit generation pipeline.\n *\n * Pipeline stages:\n * 1. Initialize session state\n * 2. Load constitution (if specified)\n * 3. Generate all documents in parallel\n * 4. Validate against constitution (if enabled)\n * 5. Compile final output\n */\n protected async executeStrategy(input: SpecKitInput): Promise<SpecKitOutput> {\n const startTime = Date.now();\n\n // Stage 1: Initialize\n this.trace.recordDecision(\n 'initialize',\n 'Creating session state from validated input',\n { title: input.title, objectiveCount: input.objectives.length }\n );\n const state = createInitialSessionState(input);\n\n // Stage 2: Load constitution (optional)\n if (input.constitutionPath) {\n this.trace.recordDecision(\n 'load-constitution',\n `Loading constitution from ${input.constitutionPath}`,\n { path: input.constitutionPath }\n );\n state.constitution = await this.loadConstitution(input.constitutionPath);\n }\n\n // Stage 3: Generate documents\n this.trace.recordDecision(\n 'generate-documents',\n 'Generating all specification documents',\n { documentsToGenerate: 7 }\n );\n\n const generationStart = Date.now();\n\n // Generate in parallel for performance\n const [readme, spec, plan, tasks, progress, adr, roadmap] = await Promise.all([\n this.safeGenerate(() => generateReadme(state), 'readme'),\n this.safeGenerate(() => generateSpec(state), 'spec'),\n this.safeGenerate(() => generatePlan(state), 'plan'),\n this.safeGenerate(() => generateTasks(state), 'tasks'),\n this.safeGenerate(() => generateProgress(state), 'progress'),\n this.safeGenerate(() => generateAdr(state), 'adr'),\n this.safeGenerate(() => generateRoadmap(state), 'roadmap'),\n ]);\n\n const generationDuration = Date.now() - generationStart;\n this.trace.recordMetric('generation_duration_ms', generationDuration);\n\n // Stage 4: Validate (optional)\n let validation = null;\n if (input.validateAgainstConstitution && state.constitution) {\n this.trace.recordDecision(\n 'validate-constitution',\n 'Validating generated documents against constitution',\n { ruleCount: state.constitution.rules.length }\n );\n\n validation = await validateAgainstConstitution(\n { readme, spec, plan, tasks, progress, adr, roadmap },\n state.constitution\n );\n\n this.trace.recordMetric('validation_score', validation.score);\n\n if (!validation.isValid) {\n this.trace.recordError(\n new Error(`Constitution validation failed: ${validation.errors.length} errors`),\n { errors: validation.errors }\n );\n }\n }\n\n // Stage 5: Compile output\n const totalDuration = Date.now() - startTime;\n this.trace.recordMetric('total_duration_ms', totalDuration);\n\n const output: SpecKitOutput = {\n artifacts: {\n readme: readme?.content ?? '',\n spec: spec?.content ?? '',\n plan: plan?.content ?? '',\n tasks: tasks?.content ?? '',\n progress: progress?.content ?? '',\n adr: adr?.content ?? '',\n roadmap: roadmap?.content ?? '',\n },\n validation,\n stats: {\n totalDuration,\n documentsGenerated: [readme, spec, plan, tasks, progress, adr, roadmap].filter(Boolean).length,\n totalTokens: [readme, spec, plan, tasks, progress, adr, roadmap]\n .reduce((sum, doc) => sum + (doc?.tokenEstimate ?? 0), 0),\n warnings: state.metadata.warnings,\n },\n };\n\n return output;\n }\n\n /**\n * Wrap generator in error handling with trace logging.\n */\n private async safeGenerate<T>(\n generator: () => T,\n name: string\n ): Promise<T | null> {\n try {\n const result = generator();\n this.trace.recordDecision(\n `generate-${name}`,\n `Successfully generated ${name}`,\n {}\n );\n return result;\n } catch (error) {\n this.trace.recordError(\n error instanceof Error ? error : new Error(String(error)),\n { generator: name }\n );\n return null;\n }\n }\n\n /**\n * Load constitution from file path.\n */\n private async loadConstitution(path: string): Promise<SessionState['constitution']> {\n // Will use PAL in Phase 4, for now use fs directly\n const { promises: fs } = await import('node:fs');\n\n try {\n const content = await fs.readFile(path, 'utf-8');\n // Parse constitution (implementation in validators/)\n return {\n path,\n loadedAt: new Date(),\n rules: [], // TODO: Parse rules from content\n };\n } catch (error) {\n this.trace.recordError(\n error instanceof Error ? error : new Error(String(error)),\n { path }\n );\n return null;\n }\n }\n}\n```\n\n---\n\n## 4. Test Coverage\n\n```typescript\n// tests/vitest/domain/speckit/generators/spec-generator.spec.ts\n\nimport { describe, it, expect } from 'vitest';\nimport { generateSpec } from '../../../../../src/domain/speckit/generators/spec-generator.js';\nimport { createInitialSessionState } from '../../../../../src/domain/speckit/types.js';\n\ndescribe('generateSpec', () => {\n const baseInput = {\n title: 'Test Project',\n overview: 'A test project for unit testing',\n objectives: [\n { description: 'Build feature A', priority: 'high' as const },\n { description: 'Build feature B', priority: 'medium' as const },\n ],\n requirements: [\n { description: 'Must do X', type: 'functional' as const, priority: 'high' as const },\n { description: 'Performance < 100ms', type: 'non-functional' as const, priority: 'medium' as const },\n ],\n acceptanceCriteria: ['System boots in < 5s', 'All tests pass'],\n outOfScope: ['Mobile support', 'i18n'],\n };\n\n it('should generate spec with all sections', () => {\n const state = createInitialSessionState(baseInput);\n const result = generateSpec(state);\n\n expect(result.title).toBe('spec.md');\n expect(result.content).toContain('# Test Project - Specification');\n expect(result.content).toContain('## Overview');\n expect(result.content).toContain('## Objectives');\n expect(result.content).toContain('## Requirements');\n expect(result.content).toContain('### Functional Requirements');\n expect(result.content).toContain('### Non-Functional Requirements');\n expect(result.content).toContain('## Acceptance Criteria');\n expect(result.content).toContain('## Out of Scope');\n });\n\n it('should format objectives by priority', () => {\n const state = createInitialSessionState(baseInput);\n const result = generateSpec(state);\n\n expect(result.content).toContain('### Priority: High');\n expect(result.content).toContain('### Priority: Medium');\n expect(result.content).toContain('Build feature A');\n expect(result.content).toContain('Build feature B');\n });\n\n it('should format requirements as table', () => {\n const state = createInitialSessionState(baseInput);\n const result = generateSpec(state);\n\n expect(result.content).toContain('| ID | Description | Priority |');\n expect(result.content).toContain('| REQ-001 |');\n expect(result.content).toContain('Must do X');\n });\n\n it('should estimate tokens', () => {\n const state = createInitialSessionState(baseInput);\n const result = generateSpec(state);\n\n expect(result.tokenEstimate).toBeGreaterThan(0);\n expect(result.tokenEstimate).toBe(Math.ceil(result.content.length / 4));\n });\n\n it('should skip optional sections if empty', () => {\n const input = {\n ...baseInput,\n acceptanceCriteria: [],\n outOfScope: [],\n };\n const state = createInitialSessionState(input);\n const result = generateSpec(state);\n\n expect(result.content).not.toContain('## Acceptance Criteria');\n expect(result.content).not.toContain('## Out of Scope');\n });\n});\n```\n\n```typescript\n// tests/vitest/strategies/speckit/speckit-strategy.spec.ts\n\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { SpecKitStrategy } from '../../../../src/strategies/speckit/speckit-strategy.js';\n\ndescribe('SpecKitStrategy', () => {\n let strategy: SpecKitStrategy;\n\n beforeEach(() => {\n strategy = new SpecKitStrategy();\n });\n\n const validInput = {\n title: 'Test Project',\n overview: 'A test project',\n objectives: [{ description: 'Build feature', priority: 'high' as const }],\n requirements: [{ description: 'Must work', type: 'functional' as const }],\n };\n\n describe('execute', () => {\n it('should generate all artifacts', async () => {\n const result = await strategy.execute(validInput);\n\n expect(result.success).toBe(true);\n expect(result.output).toBeDefined();\n expect(result.output!.artifacts.readme).toBeTruthy();\n expect(result.output!.artifacts.spec).toBeTruthy();\n expect(result.output!.artifacts.plan).toBeTruthy();\n expect(result.output!.artifacts.tasks).toBeTruthy();\n });\n\n it('should include execution trace', async () => {\n const result = await strategy.execute(validInput);\n\n expect(result.trace).toBeDefined();\n expect(result.trace.decisions.length).toBeGreaterThan(0);\n expect(result.trace.metrics['total_duration_ms']).toBeDefined();\n });\n\n it('should record generation metrics', async () => {\n const result = await strategy.execute(validInput);\n\n expect(result.trace.metrics['generation_duration_ms']).toBeDefined();\n expect(result.output!.stats.documentsGenerated).toBe(7);\n });\n });\n\n describe('validation', () => {\n it('should reject missing title', async () => {\n const input = { ...validInput, title: '' };\n const result = await strategy.execute(input);\n\n expect(result.success).toBe(false);\n expect(result.error?.code).toBe('VALIDATION_ERROR');\n });\n\n it('should reject empty objectives', async () => {\n const input = { ...validInput, objectives: [] };\n const result = await strategy.execute(input);\n\n expect(result.success).toBe(false);\n expect(result.error?.message).toContain('objective');\n });\n });\n});\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------------------------------- | ------ | -------------------------- |\n| Types extracted to `src/domain/speckit/types.ts` | ‚¨ú | File exists with all types |\n| Generators extracted to `src/domain/speckit/generators/` | ‚¨ú | 7 generator files exist |\n| SpecKitStrategy extends BaseStrategy | ‚¨ú | Class compiles |\n| All generators are pure functions | ‚¨ú | No side effects in tests |\n| ExecutionTrace records all decisions | ‚¨ú | Trace has 5+ decisions |\n| Validation errors use ErrorCode | ‚¨ú | Error codes correct |\n| 90% test coverage | ‚¨ú | Coverage report |\n| Existing behavior preserved | ‚¨ú | Integration tests pass |\n\n---\n\n## 6. References\n\n| Document | Link |\n| ----------------------------- | ------------------------------------------------------------------------------------ |\n| T-001: BaseStrategy | [T-001-base-strategy.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md) |\n| ADR-001: BaseStrategy Pattern | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-001) |\n| Current speckit-strategy.ts | [src/strategies/speckit-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/strategies/speckit-strategy.ts) |\n\n---\n\n*Task: T-011 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-011",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-011-migrate-speckit.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-011-migrate-speckit.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-012: Migrate TOGAFStrategy",
		"body": "# T-012: Migrate TOGAFStrategy\n\n## Overview\n\n**Task ID**: T-012\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-012-migrate-togafstrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate TOGAFStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-012\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate TOGAFStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-012 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-012",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-012-migrate-togafstrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-012-migrate-togafstrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-013: Migrate ADRStrategy",
		"body": "# T-013: Migrate ADRStrategy\n\n## Overview\n\n**Task ID**: T-013\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-013-migrate-adrstrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate ADRStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-013\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate ADRStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-013 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "documentation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-013",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-013-migrate-adrstrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-013-migrate-adrstrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-014: Migrate RFCStrategy",
		"body": "# T-014: Migrate RFCStrategy\n\n## Overview\n\n**Task ID**: T-014\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-014-migrate-rfcstrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate RFCStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-014\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate RFCStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-014 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-014",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-014-migrate-rfcstrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-014-migrate-rfcstrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-015: Migrate EnterpriseStrategy",
		"body": "# T-015: Migrate EnterpriseStrategy\n\n## Overview\n\n**Task ID**: T-015\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 6h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-015-migrate-enterprisestrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate EnterpriseStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-015\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate EnterpriseStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-015 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-015",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-015-migrate-enterprisestrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-015-migrate-enterprisestrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-016: Migrate SDDStrategy",
		"body": "# T-016: Migrate SDDStrategy\n\n## Overview\n\n**Task ID**: T-016\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-016-migrate-sddstrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate SDDStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-016\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate SDDStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-016 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-016",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-016-migrate-sddstrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-016-migrate-sddstrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-017: Migrate ChatStrategy",
		"body": "# T-017: Migrate ChatStrategy\n\n## Overview\n\n**Task ID**: T-017\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-001, T-003\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-017-migrate-chatstrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Migrate ChatStrategy' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-017\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Migrate ChatStrategy fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-001, T-003\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Audit Current Implementation\n\n- Identify existing classes, helpers, and entry points\n- Capture behavior that must remain stable\n\n### Step 4.2: Extract Domain Logic\n\n- Move pure logic into `src/domain/`\n- Keep MCP-specific orchestration in strategy/tool layer\n\n### Step 4.3: Update Strategy/Tool\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Example: delegate to extracted domain logic\nconst result = domainGenerator(input);\n```\n\n### Step 4.4: Validate Behavior\n\n- Run existing tests to ensure parity\n- Add new tests for extracted logic\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [migration-checklist](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/migration-checklist.md)\n\n---\n\n*Task: T-017 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-017",
		"dependencies": ["T-001", "T-003"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-017-migrate-chatstrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-017-migrate-chatstrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-018: Score-Mapping Threshold Arrays",
		"body": "# T-018: Score-Mapping Threshold Arrays\n\n## Overview\n\n**Task ID**: T-018\n**Phase**: 2 - Migration\n**Priority**: P2 (Medium)\n**Estimate**: 3 hours\n**Dependencies**: T-001 (BaseStrategy)\n**Blocks**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-018-threshold-arrays.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nRefactor hardcoded threshold checks into configurable threshold arrays:\n- Replace if/else chains with declarative threshold definitions\n- Support custom thresholds per use case\n- Enable threshold overrides via configuration\n- Improve testability of scoring logic\n\n### Why\n\nCurrent threshold logic is:\n- Scattered across multiple files\n- Hardcoded with magic numbers\n- Difficult to customize per deployment\n- Hard to test edge cases\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Define threshold configuration\nconst scoreThresholds: ThresholdConfig = {\n levels: [\n { min: 90, max: 100, level: 'excellent', color: '#00ff00' },\n { min: 70, max: 89, level: 'good', color: '#88ff00' },\n { min: 50, max: 69, level: 'fair', color: '#ffff00' },\n { min: 0, max: 49, level: 'poor', color: '#ff0000' },\n ],\n defaultLevel: 'unknown',\n};\n\n// Use for score mapping\nconst evaluator = new ThresholdEvaluator(scoreThresholds);\nconst result = evaluator.evaluate(85);\n// { level: 'good', color: '#88ff00', min: 70, max: 89 }\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Threshold Types\n\n```typescript\n// src/domain/scoring/threshold-types.ts\n\n/**\n * A single threshold range definition.\n */\nexport interface ThresholdRange<TLevel extends string = string> {\n /** Minimum value (inclusive) */\n min: number;\n\n /** Maximum value (inclusive) */\n max: number;\n\n /** Level identifier */\n level: TLevel;\n\n /** Optional color for visualization */\n color?: string;\n\n /** Optional label for display */\n label?: string;\n\n /** Optional description */\n description?: string;\n\n /** Custom metadata */\n metadata?: Record<string, unknown>;\n}\n\n/**\n * Configuration for a threshold evaluator.\n */\nexport interface ThresholdConfig<TLevel extends string = string> {\n /** Ordered array of threshold ranges (highest to lowest) */\n levels: ThresholdRange<TLevel>[];\n\n /** Default level when no range matches */\n defaultLevel: TLevel;\n\n /** Default color when no range matches */\n defaultColor?: string;\n\n /** Whether to allow gaps in ranges */\n allowGaps?: boolean;\n\n /** Whether to allow overlapping ranges */\n allowOverlaps?: boolean;\n}\n\n/**\n * Result from threshold evaluation.\n */\nexport interface ThresholdResult<TLevel extends string = string> {\n /** The matched level */\n level: TLevel;\n\n /** The matched color */\n color?: string;\n\n /** The matched label */\n label?: string;\n\n /** The matched range */\n range?: ThresholdRange<TLevel>;\n\n /** Whether a specific range matched */\n matched: boolean;\n\n /** The evaluated score */\n score: number;\n\n /** Normalized score (0-100) */\n normalizedScore: number;\n}\n\n/**\n * Predefined score levels for common use cases.\n */\nexport type CodeQualityLevel =\n | 'excellent'\n | 'good'\n | 'fair'\n | 'poor'\n | 'critical'\n | 'unknown';\n\nexport type CoverageLevel =\n | 'full'\n | 'high'\n | 'medium'\n | 'low'\n | 'none';\n\nexport type RiskLevel =\n | 'critical'\n | 'high'\n | 'medium'\n | 'low'\n | 'minimal';\n```\n\n### Step 2.2: Implement ThresholdEvaluator\n\n```typescript\n// src/domain/scoring/threshold-evaluator.ts\n\nimport type {\n ThresholdConfig,\n ThresholdRange,\n ThresholdResult,\n} from './threshold-types.js';\n\n/**\n * Error thrown when threshold configuration is invalid.\n */\nexport class ThresholdConfigError extends Error {\n constructor(\n message: string,\n public readonly details: {\n type: 'gap' | 'overlap' | 'order' | 'bounds';\n ranges?: Array<{ min: number; max: number }>;\n }\n ) {\n super(message);\n this.name = 'ThresholdConfigError';\n }\n}\n\n/**\n * ThresholdEvaluator - maps scores to levels using configurable thresholds.\n *\n * Features:\n * - Declarative threshold definition\n * - Configuration validation\n * - Type-safe level mapping\n * - Support for custom metadata\n *\n * \n * ```typescript\n * const evaluator = new ThresholdEvaluator({\n * levels: [\n * { min: 90, max: 100, level: 'excellent', color: 'green' },\n * { min: 70, max: 89, level: 'good', color: 'lightgreen' },\n * { min: 50, max: 69, level: 'fair', color: 'yellow' },\n * { min: 0, max: 49, level: 'poor', color: 'red' },\n * ],\n * defaultLevel: 'unknown',\n * });\n *\n * const result = evaluator.evaluate(75);\n * // { level: 'good', color: 'lightgreen', matched: true, ... }\n * ```\n */\nexport class ThresholdEvaluator<TLevel extends string = string> {\n private readonly config: ThresholdConfig<TLevel>;\n private readonly sortedLevels: ThresholdRange<TLevel>[];\n\n constructor(config: ThresholdConfig<TLevel>) {\n this.config = config;\n this.sortedLevels = this.validateAndSort(config.levels);\n }\n\n // ============================================\n // Evaluation\n // ============================================\n\n /**\n * Evaluate a score and return the matching level.\n *\n * score - The score to evaluate\n * options - Optional evaluation options\n */\n evaluate(\n score: number,\n options?: {\n /** Clamp score to valid range */\n clamp?: boolean;\n /** Custom normalization range */\n range?: { min: number; max: number };\n }\n ): ThresholdResult<TLevel> {\n const clamp = options?.clamp ?? true;\n const range = options?.range ?? { min: 0, max: 100 };\n\n // Optionally clamp score to valid range\n let normalizedScore = score;\n if (clamp) {\n normalizedScore = Math.max(range.min, Math.min(range.max, score));\n }\n\n // Find matching range\n const matchedRange = this.findMatchingRange(normalizedScore);\n\n if (matchedRange) {\n return {\n level: matchedRange.level,\n color: matchedRange.color,\n label: matchedRange.label ?? matchedRange.level,\n range: matchedRange,\n matched: true,\n score,\n normalizedScore,\n };\n }\n\n // Return default\n return {\n level: this.config.defaultLevel,\n color: this.config.defaultColor,\n label: this.config.defaultLevel,\n range: undefined,\n matched: false,\n score,\n normalizedScore,\n };\n }\n\n /**\n * Evaluate multiple scores.\n */\n evaluateAll(scores: number[]): ThresholdResult<TLevel>[] {\n return scores.map(score => this.evaluate(score));\n }\n\n /**\n * Get the level for a score (simple accessor).\n */\n getLevel(score: number): TLevel {\n return this.evaluate(score).level;\n }\n\n /**\n * Get the color for a score.\n */\n getColor(score: number): string | undefined {\n return this.evaluate(score).color;\n }\n\n // ============================================\n // Range Operations\n // ============================================\n\n /**\n * Find the range that contains a score.\n */\n private findMatchingRange(score: number): ThresholdRange<TLevel> | undefined {\n return this.sortedLevels.find(\n range => score >= range.min && score <= range.max\n );\n }\n\n /**\n * Get all defined ranges.\n */\n getRanges(): ReadonlyArray<ThresholdRange<TLevel>> {\n return this.sortedLevels;\n }\n\n /**\n * Get range for a specific level.\n */\n getRangeForLevel(level: TLevel): ThresholdRange<TLevel> | undefined {\n return this.sortedLevels.find(range => range.level === level);\n }\n\n /**\n * Check if a score is within a specific level's range.\n */\n isInLevel(score: number, level: TLevel): boolean {\n return this.getLevel(score) === level;\n }\n\n // ============================================\n // Configuration\n // ============================================\n\n /**\n * Get the current configuration.\n */\n getConfig(): ThresholdConfig<TLevel> {\n return { ...this.config };\n }\n\n /**\n * Create a new evaluator with merged configuration.\n */\n withOverrides(\n overrides: Partial<ThresholdConfig<TLevel>>\n ): ThresholdEvaluator<TLevel> {\n return new ThresholdEvaluator({\n ...this.config,\n ...overrides,\n levels: overrides.levels ?? this.config.levels,\n });\n }\n\n // ============================================\n // Validation\n // ============================================\n\n /**\n * Validate and sort threshold ranges.\n */\n private validateAndSort(\n levels: ThresholdRange<TLevel>[]\n ): ThresholdRange<TLevel>[] {\n if (levels.length === 0) {\n return [];\n }\n\n // Sort by min value descending (highest first)\n const sorted = [...levels].sort((a, b) => b.min - a.min);\n\n // Validate bounds\n for (const range of sorted) {\n if (range.min > range.max) {\n throw new ThresholdConfigError(\n `Invalid range: min (${range.min}) > max (${range.max}) for level \"${range.level}\"`,\n { type: 'bounds', ranges: [{ min: range.min, max: range.max }] }\n );\n }\n }\n\n // Check for gaps and overlaps\n if (!this.config.allowGaps || !this.config.allowOverlaps) {\n for (let i = 0; i < sorted.length - 1; i++) {\n const current = sorted[i];\n const next = sorted[i + 1];\n\n // Check for overlap\n if (!this.config.allowOverlaps && current.min <= next.max) {\n throw new ThresholdConfigError(\n `Overlapping ranges detected: \"${current.level}\" (${current.min}-${current.max}) ` +\n `overlaps with \"${next.level}\" (${next.min}-${next.max})`,\n {\n type: 'overlap',\n ranges: [\n { min: current.min, max: current.max },\n { min: next.min, max: next.max },\n ],\n }\n );\n }\n\n // Check for gap\n if (!this.config.allowGaps && current.min > next.max + 1) {\n throw new ThresholdConfigError(\n `Gap detected between \"${next.level}\" (max: ${next.max}) ` +\n `and \"${current.level}\" (min: ${current.min})`,\n {\n type: 'gap',\n ranges: [\n { min: next.min, max: next.max },\n { min: current.min, max: current.max },\n ],\n }\n );\n }\n }\n }\n\n return sorted;\n }\n}\n```\n\n### Step 2.3: Create Predefined Configurations\n\n```typescript\n// src/domain/scoring/preset-thresholds.ts\n\nimport type { ThresholdConfig, CodeQualityLevel, CoverageLevel, RiskLevel } from './threshold-types.js';\n\n/**\n * Code quality score thresholds (0-100).\n */\nexport const CODE_QUALITY_THRESHOLDS: ThresholdConfig<CodeQualityLevel> = {\n levels: [\n {\n min: 90, max: 100,\n level: 'excellent',\n color: '#00C853',\n label: 'Excellent',\n description: 'Code meets all quality standards',\n },\n {\n min: 70, max: 89,\n level: 'good',\n color: '#64DD17',\n label: 'Good',\n description: 'Code is well-written with minor issues',\n },\n {\n min: 50, max: 69,\n level: 'fair',\n color: '#FFD600',\n label: 'Fair',\n description: 'Code has noticeable issues that should be addressed',\n },\n {\n min: 25, max: 49,\n level: 'poor',\n color: '#FF6D00',\n label: 'Poor',\n description: 'Code has significant quality issues',\n },\n {\n min: 0, max: 24,\n level: 'critical',\n color: '#DD2C00',\n label: 'Critical',\n description: 'Code requires immediate attention',\n },\n ],\n defaultLevel: 'unknown',\n defaultColor: '#9E9E9E',\n};\n\n/**\n * Test coverage thresholds (0-100).\n */\nexport const COVERAGE_THRESHOLDS: ThresholdConfig<CoverageLevel> = {\n levels: [\n {\n min: 95, max: 100,\n level: 'full',\n color: '#00C853',\n label: 'Full Coverage',\n },\n {\n min: 80, max: 94,\n level: 'high',\n color: '#64DD17',\n label: 'High Coverage',\n },\n {\n min: 60, max: 79,\n level: 'medium',\n color: '#FFD600',\n label: 'Medium Coverage',\n },\n {\n min: 30, max: 59,\n level: 'low',\n color: '#FF6D00',\n label: 'Low Coverage',\n },\n {\n min: 0, max: 29,\n level: 'none',\n color: '#DD2C00',\n label: 'Insufficient Coverage',\n },\n ],\n defaultLevel: 'none',\n defaultColor: '#DD2C00',\n};\n\n/**\n * Risk level thresholds (inverted - lower is better).\n */\nexport const RISK_THRESHOLDS: ThresholdConfig<RiskLevel> = {\n levels: [\n {\n min: 80, max: 100,\n level: 'critical',\n color: '#DD2C00',\n label: 'Critical Risk',\n },\n {\n min: 60, max: 79,\n level: 'high',\n color: '#FF6D00',\n label: 'High Risk',\n },\n {\n min: 40, max: 59,\n level: 'medium',\n color: '#FFD600',\n label: 'Medium Risk',\n },\n {\n min: 20, max: 39,\n level: 'low',\n color: '#64DD17',\n label: 'Low Risk',\n },\n {\n min: 0, max: 19,\n level: 'minimal',\n color: '#00C853',\n label: 'Minimal Risk',\n },\n ],\n defaultLevel: 'medium',\n defaultColor: '#FFD600',\n};\n```\n\n### Step 2.4: Create Factory Functions\n\n```typescript\n// src/domain/scoring/threshold-factory.ts\n\nimport { ThresholdEvaluator } from './threshold-evaluator.js';\nimport type { ThresholdConfig, CodeQualityLevel, CoverageLevel, RiskLevel } from './threshold-types.js';\nimport {\n CODE_QUALITY_THRESHOLDS,\n COVERAGE_THRESHOLDS,\n RISK_THRESHOLDS,\n} from './preset-thresholds.js';\n\n/**\n * Create a code quality score evaluator.\n */\nexport function createCodeQualityEvaluator(\n overrides?: Partial<ThresholdConfig<CodeQualityLevel>>\n): ThresholdEvaluator<CodeQualityLevel> {\n return new ThresholdEvaluator({\n ...CODE_QUALITY_THRESHOLDS,\n ...overrides,\n levels: overrides?.levels ?? CODE_QUALITY_THRESHOLDS.levels,\n });\n}\n\n/**\n * Create a coverage evaluator.\n */\nexport function createCoverageEvaluator(\n overrides?: Partial<ThresholdConfig<CoverageLevel>>\n): ThresholdEvaluator<CoverageLevel> {\n return new ThresholdEvaluator({\n ...COVERAGE_THRESHOLDS,\n ...overrides,\n levels: overrides?.levels ?? COVERAGE_THRESHOLDS.levels,\n });\n}\n\n/**\n * Create a risk evaluator.\n */\nexport function createRiskEvaluator(\n overrides?: Partial<ThresholdConfig<RiskLevel>>\n): ThresholdEvaluator<RiskLevel> {\n return new ThresholdEvaluator({\n ...RISK_THRESHOLDS,\n ...overrides,\n levels: overrides?.levels ?? RISK_THRESHOLDS.levels,\n });\n}\n\n/**\n * Create a custom evaluator with inline definition.\n */\nexport function createCustomEvaluator<TLevel extends string>(\n config: ThresholdConfig<TLevel>\n): ThresholdEvaluator<TLevel> {\n return new ThresholdEvaluator(config);\n}\n```\n\n### Step 2.5: Create Barrel Export\n\n```typescript\n// src/domain/scoring/index.ts\n\n// Types\nexport type {\n ThresholdRange,\n ThresholdConfig,\n ThresholdResult,\n CodeQualityLevel,\n CoverageLevel,\n RiskLevel,\n} from './threshold-types.js';\n\n// Evaluator\nexport {\n ThresholdEvaluator,\n ThresholdConfigError,\n} from './threshold-evaluator.js';\n\n// Presets\nexport {\n CODE_QUALITY_THRESHOLDS,\n COVERAGE_THRESHOLDS,\n RISK_THRESHOLDS,\n} from './preset-thresholds.js';\n\n// Factories\nexport {\n createCodeQualityEvaluator,\n createCoverageEvaluator,\n createRiskEvaluator,\n createCustomEvaluator,\n} from './threshold-factory.js';\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/scoring/threshold-evaluator.spec.ts\n\nimport { describe, it, expect } from 'vitest';\nimport {\n ThresholdEvaluator,\n ThresholdConfigError,\n} from '../../../../src/domain/scoring/threshold-evaluator.js';\nimport type { ThresholdConfig } from '../../../../src/domain/scoring/threshold-types.js';\n\ndescribe('ThresholdEvaluator', () => {\n const standardConfig: ThresholdConfig<'excellent' | 'good' | 'fair' | 'poor' | 'unknown'> = {\n levels: [\n { min: 90, max: 100, level: 'excellent', color: 'green' },\n { min: 70, max: 89, level: 'good', color: 'lightgreen' },\n { min: 50, max: 69, level: 'fair', color: 'yellow' },\n { min: 0, max: 49, level: 'poor', color: 'red' },\n ],\n defaultLevel: 'unknown',\n defaultColor: 'gray',\n };\n\n // ============================================\n // Basic Evaluation\n // ============================================\n\n describe('evaluate', () => {\n it('should return correct level for score in range', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.evaluate(95).level).toBe('excellent');\n expect(evaluator.evaluate(75).level).toBe('good');\n expect(evaluator.evaluate(55).level).toBe('fair');\n expect(evaluator.evaluate(25).level).toBe('poor');\n });\n\n it('should return boundary values correctly', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.evaluate(100).level).toBe('excellent');\n expect(evaluator.evaluate(90).level).toBe('excellent');\n expect(evaluator.evaluate(89).level).toBe('good');\n expect(evaluator.evaluate(70).level).toBe('good');\n expect(evaluator.evaluate(0).level).toBe('poor');\n });\n\n it('should include color in result', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.evaluate(95).color).toBe('green');\n expect(evaluator.evaluate(75).color).toBe('lightgreen');\n });\n\n it('should set matched flag correctly', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.evaluate(75).matched).toBe(true);\n });\n\n it('should clamp scores by default', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.evaluate(150).normalizedScore).toBe(100);\n expect(evaluator.evaluate(-50).normalizedScore).toBe(0);\n });\n\n it('should not clamp when disabled', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n const result = evaluator.evaluate(150, { clamp: false });\n expect(result.normalizedScore).toBe(150);\n });\n });\n\n // ============================================\n // Default Level\n // ============================================\n\n describe('default level', () => {\n it('should return default for unmatched score with gaps', () => {\n const gappyConfig: ThresholdConfig = {\n levels: [\n { min: 90, max: 100, level: 'excellent' },\n { min: 0, max: 10, level: 'poor' },\n ],\n defaultLevel: 'unknown',\n allowGaps: true,\n };\n\n const evaluator = new ThresholdEvaluator(gappyConfig);\n\n const result = evaluator.evaluate(50);\n expect(result.level).toBe('unknown');\n expect(result.matched).toBe(false);\n });\n });\n\n // ============================================\n // Convenience Methods\n // ============================================\n\n describe('convenience methods', () => {\n it('getLevel should return level string', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.getLevel(85)).toBe('good');\n });\n\n it('getColor should return color string', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.getColor(85)).toBe('lightgreen');\n });\n\n it('isInLevel should check level correctly', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.isInLevel(85, 'good')).toBe(true);\n expect(evaluator.isInLevel(85, 'excellent')).toBe(false);\n });\n\n it('evaluateAll should evaluate multiple scores', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n const results = evaluator.evaluateAll([95, 75, 55, 25]);\n\n expect(results.map(r => r.level)).toEqual([\n 'excellent', 'good', 'fair', 'poor'\n ]);\n });\n });\n\n // ============================================\n // Configuration\n // ============================================\n\n describe('configuration', () => {\n it('getRanges should return all ranges', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n expect(evaluator.getRanges()).toHaveLength(4);\n });\n\n it('getRangeForLevel should return specific range', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n\n const range = evaluator.getRangeForLevel('good');\n expect(range?.min).toBe(70);\n expect(range?.max).toBe(89);\n });\n\n it('withOverrides should create new evaluator', () => {\n const evaluator = new ThresholdEvaluator(standardConfig);\n const overridden = evaluator.withOverrides({\n defaultLevel: 'fair' as 'unknown',\n });\n\n // Original unchanged\n expect(evaluator.getConfig().defaultLevel).toBe('unknown');\n // New has override\n expect(overridden.getConfig().defaultLevel).toBe('fair');\n });\n });\n\n // ============================================\n // Validation\n // ============================================\n\n describe('validation', () => {\n it('should throw on invalid range bounds', () => {\n expect(() => {\n new ThresholdEvaluator({\n levels: [{ min: 100, max: 50, level: 'bad' }],\n defaultLevel: 'unknown',\n });\n }).toThrow(ThresholdConfigError);\n });\n\n it('should throw on overlapping ranges by default', () => {\n expect(() => {\n new ThresholdEvaluator({\n levels: [\n { min: 80, max: 100, level: 'high' },\n { min: 70, max: 90, level: 'medium' }, // Overlaps\n ],\n defaultLevel: 'unknown',\n });\n }).toThrow('Overlapping ranges');\n });\n\n it('should allow overlaps when configured', () => {\n const evaluator = new ThresholdEvaluator({\n levels: [\n { min: 80, max: 100, level: 'high' },\n { min: 70, max: 90, level: 'medium' },\n ],\n defaultLevel: 'unknown',\n allowOverlaps: true,\n });\n\n expect(evaluator.getRanges()).toHaveLength(2);\n });\n\n it('should throw on gaps by default', () => {\n expect(() => {\n new ThresholdEvaluator({\n levels: [\n { min: 80, max: 100, level: 'high' },\n { min: 0, max: 50, level: 'low' }, // Gap 51-79\n ],\n defaultLevel: 'unknown',\n });\n }).toThrow('Gap detected');\n });\n\n it('should allow gaps when configured', () => {\n const evaluator = new ThresholdEvaluator({\n levels: [\n { min: 80, max: 100, level: 'high' },\n { min: 0, max: 50, level: 'low' },\n ],\n defaultLevel: 'unknown',\n allowGaps: true,\n });\n\n expect(evaluator.getRanges()).toHaveLength(2);\n });\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------ | ------ | --------------- |\n| Evaluate score to level | ‚¨ú | Evaluation test |\n| Boundary values handled | ‚¨ú | Boundary test |\n| Score clamping works | ‚¨ú | Clamp test |\n| Default level fallback | ‚¨ú | Default test |\n| Preset configurations | ‚¨ú | Preset test |\n| Configuration validation | ‚¨ú | Validation test |\n| Gap detection | ‚¨ú | Gap test |\n| Overlap detection | ‚¨ú | Overlap test |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. Migration Example\n\n### Before (hardcoded thresholds)\n\n```typescript\nfunction getQualityLevel(score: number): string {\n if (score >= 90) return 'excellent';\n if (score >= 70) return 'good';\n if (score >= 50) return 'fair';\n if (score >= 25) return 'poor';\n return 'critical';\n}\n\nfunction getQualityColor(score: number): string {\n if (score >= 90) return '#00C853';\n if (score >= 70) return '#64DD17';\n if (score >= 50) return '#FFD600';\n if (score >= 25) return '#FF6D00';\n return '#DD2C00';\n}\n```\n\n### After (configurable thresholds)\n\n```typescript\nimport { createCodeQualityEvaluator } from './domain/scoring/index.js';\n\nconst evaluator = createCodeQualityEvaluator();\n\n// Simple usage\nconst result = evaluator.evaluate(85);\nconsole.log(result.level); // 'good'\nconsole.log(result.color); // '#64DD17'\n\n// Custom thresholds for stricter project\nconst strictEvaluator = createCodeQualityEvaluator({\n levels: [\n { min: 95, max: 100, level: 'excellent', color: '#00C853' },\n { min: 85, max: 94, level: 'good', color: '#64DD17' },\n { min: 70, max: 84, level: 'fair', color: '#FFD600' },\n { min: 50, max: 69, level: 'poor', color: '#FF6D00' },\n { min: 0, max: 49, level: 'critical', color: '#DD2C00' },\n ],\n});\n```\n\n---\n\n## 6. References\n\n| Document | Link |\n| ------------------------- | ---------------------------------------------------------------------------------------------- |\n| T-001: BaseStrategy | [T-001-base-strategy.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-1-foundation/T-001-base-strategy.md) |\n| clean-code-scorer.ts | [src/tools/analysis/clean-code-scorer.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/analysis/clean-code-scorer.ts) |\n| ADR-001: Strategy Pattern | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-001) |\n\n---\n\n*Task: T-018 | Phase: 2 | Priority: P2*\n",
		"labels": ["v0.14.x", "phase-2", "implementation", "P2-medium"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P2",
		"task_id": "T-018",
		"dependencies": ["T-001"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-018-threshold-arrays.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-018-threshold-arrays.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-019: Test Score-Mapping Thresholds",
		"body": "# T-019: Test Score-Mapping Thresholds\n\n## Overview\n\n**Task ID**: T-019\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-018\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-019-test-score-mapping-thresholds.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\n100% coverage of all threshold boundaries.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-019\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test Score-Mapping Thresholds fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-018\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-019 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "testing", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-019",
		"dependencies": ["T-018"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-019-test-score-mapping-thresholds.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-019-test-score-mapping-thresholds.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-020: Test All Migrated Strategies",
		"body": "# T-020: Test All Migrated Strategies\n\n## Overview\n\n**Task ID**: T-020\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-011 through T-017\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-020-test-all-migrated-strategies.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test All Migrated Strategies' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-020\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test All Migrated Strategies fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-011 through T-017\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-020 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "testing", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-020",
		"dependencies": ["T-011", "T-017"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-020-test-all-migrated-strategies.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-020-test-all-migrated-strategies.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-021: Verify BaseStrategy Compliance",
		"body": "# T-021: Verify BaseStrategy Compliance\n\n## Overview\n\n**Task ID**: T-021\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-011 through T-017\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-021-verify-basestrategy-compliance.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nVerify all 7 strategies extend BaseStrategy<T> correctly.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-021\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify BaseStrategy Compliance fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-011 through T-017\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Prepare Inputs\n\n- Confirm all dependent tasks are complete\n- Ensure required artifacts/logs are available\n\n### Step 4.2: Execute Validation\n\n- Method: Run the relevant validation command or audit.\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Example (replace with the actual command)\nnpm run validate:verify_basestrategy_compliance\n```\n\n### Step 4.3: Capture Evidence\n\n- Save reports under `artifacts/` or attach to CI logs\n- Note any failures with remediation steps\n\n### Step 4.4: Remediate and Re-run\n\n- Fix issues discovered by validation\n- Re-run until validation passes\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Validation executed successfully | ‚¨ú | `npm run quality` |\n| Results recorded with evidence | ‚¨ú | PR description |\n| Follow-up items documented | ‚¨ú | Issue tracker |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-021 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "testing", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-021",
		"dependencies": ["T-011", "T-017"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-021-verify-basestrategy-compliance.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-021-verify-basestrategy-compliance.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-022: Phase 2 Integration Test",
		"body": "# T-022: Phase 2 Integration Test\n\n## Overview\n\n**Task ID**: T-022\n**Phase**: 2\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-011 through T-021\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-022-phase-2-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Phase 2 Integration Test' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-022\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 2 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-011 through T-021\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-022 | Phase: 2 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-2", "integration-test", "P0-critical"],
		"milestone": 18,
		"parent_issue": 969,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/969",
		"phase": "2",
		"priority": "P0",
		"task_id": "T-022",
		"dependencies": ["T-011", "T-021"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-022-phase-2-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-022-phase-2-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-023: Design UnifiedPromptBuilder Architecture",
		"body": "# T-023: Design UnifiedPromptBuilder Architecture\n\n## Overview\n\n**Task ID**: T-023\n**Phase**: 2.5 - Unified Prompt Ecosystem\n**Priority**: P0 (Critical Path)\n**Estimate**: 4h\n**Dependencies**: T-022 (Phase 2 Integration)\n**Blocks**: T-024, T-025, T-026, T-027-T-031\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-023-design-unifiedpromptbuilder-architecture.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nDesign the architecture for `UnifiedPromptBuilder` - a single entry point replacing 12+ prompt builders with registry pattern and template engine (REQ-007).\n\n### Why\n\n- **Tool Fragmentation**: 12+ prompt builders with overlapping functionality\n- **Inconsistent Patterns**: Different output formats, techniques, metadata handling\n- **Maintenance Burden**: Changes require updates across multiple files\n- **REQ-007 Compliance**: Spec mandates single entry point\n\n### Deliverables\n\n- `docs/adr/ADR-XXX-unified-prompt-builder.md` - Architecture Decision Record\n- Component diagram (Mermaid) showing data flow\n- Interface contracts for PromptRegistry, TemplateEngine, DomainGenerator\n- Migration strategy document\n\n## 2. Context and Scope\n\n### Current State (12+ Prompt Builders)\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```\nsrc/tools/prompt/\n‚îú‚îÄ‚îÄ hierarchical-prompt-builder.ts (650 lines)\n‚îú‚îÄ‚îÄ domain-neutral-prompt-builder.ts (445 lines)\n‚îú‚îÄ‚îÄ security-hardening-prompt-builder.ts (520 lines)\n‚îú‚îÄ‚îÄ architecture-design-prompt-builder.ts (380 lines)\n‚îú‚îÄ‚îÄ code-analysis-prompt-builder.ts (290 lines)\n‚îú‚îÄ‚îÄ debugging-assistant-prompt-builder.ts (310 lines)\n‚îú‚îÄ‚îÄ spark-prompt-builder.ts (280 lines)\n‚îú‚îÄ‚îÄ prompt-flow-builder.ts (420 lines)\n‚îú‚îÄ‚îÄ prompt-chaining-builder.ts (350 lines)\n‚îî‚îÄ‚îÄ ... (3 more)\n```\n\n### Target State\n\n```\nsrc/tools/prompt/\n‚îú‚îÄ‚îÄ unified/\n‚îÇ ‚îú‚îÄ‚îÄ unified-prompt-builder.ts (Entry point)\n‚îÇ ‚îú‚îÄ‚îÄ prompt-registry.ts (Domain registration)\n‚îÇ ‚îú‚îÄ‚îÄ template-engine.ts (Handlebars rendering)\n‚îÇ ‚îî‚îÄ‚îÄ generators/\n‚îÇ ‚îú‚îÄ‚îÄ hierarchical-generator.ts (Domain logic)\n‚îÇ ‚îú‚îÄ‚îÄ security-generator.ts\n‚îÇ ‚îú‚îÄ‚îÄ architecture-generator.ts\n‚îÇ ‚îî‚îÄ‚îÄ ... (per-domain generators)\n‚îú‚îÄ‚îÄ facades/ (Backward compat)\n‚îÇ ‚îú‚îÄ‚îÄ hierarchical-facade.ts\n‚îÇ ‚îî‚îÄ‚îÄ domain-neutral-facade.ts\n‚îî‚îÄ‚îÄ shared/ (Existing utils)\n```\n\n### Out of Scope\n\n- Implementing generators (T-027-T-031)\n- Creating facades (T-032, T-033)\n- Performance optimization\n\n## 3. Prerequisites\n\n### Dependencies\n\n| Task | Requirement |\n| ----- | ---------------------------- |\n| T-022 | Phase 2 Integration complete |\n\n### Target Files\n\n| File | Action |\n| --------------------------------------------- | ------ |\n| `docs/adr/ADR-XXX-unified-prompt-builder.md` | Create |\n| `docs/architecture/unified-prompt-builder.md` | Create |\n\n### Research Required\n\n- Review existing prompt builder patterns in `src/tools/prompt/`\n- Analyze shared utilities in `src/tools/shared/prompt-*.ts`\n- Study registry patterns (e.g., `src/tools/design/constraint-manager.ts`)\n\n## 4. Architecture Design\n\n### 4.1: Component Diagram\n\n```mermaid\nflowchart TB\n subgraph Entry[\"Entry Point\"]\n UPB[UnifiedPromptBuilder]\n end\n\n subgraph Registry[\"Registration\"]\n PR[PromptRegistry]\n DG1[HierarchicalGenerator]\n DG2[SecurityGenerator]\n DG3[ArchitectureGenerator]\n DGN[...DomainGenerators]\n end\n\n subgraph Engine[\"Rendering\"]\n TE[TemplateEngine]\n HB[Handlebars Templates]\n end\n\n subgraph Shared[\"Shared Utilities\"]\n PS[prompt-sections.ts]\n PU[prompt-utils.ts]\n end\n\n UPB --> PR\n PR --> DG1 & DG2 & DG3 & DGN\n DG1 & DG2 & DG3 & DGN --> TE\n TE --> HB\n DG1 & DG2 & DG3 & DGN --> PS & PU\n```\n\n### 4.2: Interface Contracts\n\n```typescript\n// Core interfaces for UnifiedPromptBuilder\n\nexport interface PromptDomain {\n name: string; // 'hierarchical' | 'security' | 'architecture' | ...\n version: string;\n generator: DomainGenerator;\n schema: z.ZodSchema;\n}\n\nexport interface DomainGenerator {\n generate(input: unknown, context: GeneratorContext): Promise<PromptOutput>;\n validate(input: unknown): ValidationResult;\n}\n\nexport interface GeneratorContext {\n templateEngine: TemplateEngine;\n config: PromptConfig;\n metadata: PromptMetadata;\n}\n\nexport interface PromptOutput {\n content: string;\n format: 'markdown' | 'xml' | 'json';\n metadata: Record<string, unknown>;\n}\n\nexport interface UnifiedPromptInput {\n domain: string; // Required: which generator to use\n title: string; // Required: prompt title\n description?: string; // Optional: brief description\n sections: Record<string, unknown>; // Domain-specific data\n config?: PromptConfig; // Optional: rendering config\n}\n```\n\n### 4.3: Registry Pattern\n\n```typescript\n// PromptRegistry - singleton managing domain generators\n\nexport class PromptRegistry {\n private static instance: PromptRegistry;\n private domains = new Map<string, PromptDomain>();\n\n static getInstance(): PromptRegistry {\n if (!PromptRegistry.instance) {\n PromptRegistry.instance = new PromptRegistry();\n }\n return PromptRegistry.instance;\n }\n\n register(domain: PromptDomain): void {\n if (this.domains.has(domain.name)) {\n throw new Error(`Domain '${domain.name}' already registered`);\n }\n this.domains.set(domain.name, domain);\n }\n\n get(name: string): PromptDomain | undefined {\n return this.domains.get(name);\n }\n\n list(): string[] {\n return Array.from(this.domains.keys());\n }\n}\n```\n\n### 4.4: Template Engine\n\n```typescript\n// TemplateEngine - Handlebars-based rendering\n\nimport Handlebars from 'handlebars';\n\nexport class TemplateEngine {\n private templates = new Map<string, HandlebarsTemplateDelegate>();\n\n registerTemplate(name: string, source: string): void {\n this.templates.set(name, Handlebars.compile(source));\n }\n\n render(templateName: string, data: Record<string, unknown>): string {\n const template = this.templates.get(templateName);\n if (!template) {\n throw new Error(`Template '${templateName}' not found`);\n }\n return template(data);\n }\n\n registerHelpers(): void {\n // Register common helpers\n Handlebars.registerHelper('slug', slugify);\n Handlebars.registerHelper('join', (arr, sep) => arr?.join(sep) ?? '');\n }\n}\n```\n\n## 5. ADR Template\n\n```markdown\n# ADR-XXX: UnifiedPromptBuilder Architecture\n\n## Status\nProposed\n\n## Context\nThe codebase has 12+ prompt builders with overlapping functionality...\n\n## Decision\nImplement UnifiedPromptBuilder with:\n1. PromptRegistry for domain registration\n2. TemplateEngine for Handlebars rendering\n3. DomainGenerators for per-domain logic\n4. Legacy facades for backward compatibility\n\n## Consequences\n- Single entry point for all prompt generation\n- Reduced code duplication\n- Easier testing via generator isolation\n- Migration period with deprecation warnings\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| ---------------------- | ---------- | ------ | ------------------------------------------ |\n| Over-abstraction | Medium | High | Start with 3 domains, expand iteratively |\n| Breaking changes | High | High | Legacy facades (T-032, T-033) |\n| Performance regression | Low | Medium | Benchmark critical paths |\n| Template complexity | Medium | Medium | Keep templates simple, logic in generators |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------- | ------ | ------------------------------ |\n| ADR document created | ‚¨ú | `docs/adr/ADR-XXX-*.md` exists |\n| Interface contracts defined | ‚¨ú | TypeScript interfaces in ADR |\n| Component diagram included | ‚¨ú | Mermaid diagram renders |\n| Migration strategy documented | ‚¨ú | Facade approach documented |\n| Stakeholder review completed | ‚¨ú | PR approved by -reviewer |\n\n---\n\n## 8. References\n\n- [spec.md - REQ-007](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [Existing prompt builders](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/)\n- [Shared utilities](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/prompt-utils.ts)\n- [Handlebars documentation](https://handlebarsjs.com/)\n\n---\n\n*Task: T-023 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-023",
		"dependencies": ["T-022"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-023-design-unifiedpromptbuilder-architecture.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-023-design-unifiedpromptbuilder-architecture.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-024: Implement PromptRegistry",
		"body": "# T-024: Implement PromptRegistry\n\n## Overview\n\n**Task ID**: T-024\n**Phase**: 2.5 - Unified Prompts\n**Priority**: P0 (Critical Path)\n**Estimate**: 4 hours\n**Dependencies**: None\n**Blocks**: T-026 (UnifiedPromptBuilder)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-024-prompt-registry.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nCreate `PromptRegistry` - a singleton that:\n- Registers domain-specific prompt generators\n- Provides type-safe access to generators\n- Lazy-loads generators for performance\n- Supports runtime registration for extensions\n\n### Why\n\nCurrent prompt builders are:\n- Instantiated independently with no shared registry\n- Hard to discover available generators\n- Difficult to extend with new domains\n- No central configuration\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Registration (at startup)\npromptRegistry.register('hierarchical', HierarchicalGenerator);\npromptRegistry.register('security', SecurityGenerator);\npromptRegistry.register('architecture', ArchitectureGenerator);\n\n// Usage (in UnifiedPromptBuilder)\nconst generator = promptRegistry.get('hierarchical');\nconst sections = generator.generate(request);\n\n// Discovery\nconst domains = promptRegistry.listDomains();\n// ['hierarchical', 'security', 'architecture', ...]\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Generator Interface\n\n```typescript\n// src/domain/prompts/types.ts\n\nimport type { z } from 'zod';\n\n/**\n * Domain identifier for prompt generators.\n */\nexport type PromptDomain =\n | 'hierarchical'\n | 'security'\n | 'architecture'\n | 'code-analysis'\n | 'documentation'\n | 'debugging'\n | 'domain-neutral'\n | 'spark'\n | 'enterprise'\n | 'l9-engineer'\n | 'quick-prompts'\n | 'coverage-dashboard';\n\n/**\n * Prompting technique that can be applied.\n */\nexport type PromptTechnique =\n | 'zero-shot'\n | 'few-shot'\n | 'chain-of-thought'\n | 'self-consistency'\n | 'tree-of-thoughts'\n | 'react'\n | 'rag'\n | 'meta-prompting';\n\n/**\n * Output style for generated prompts.\n */\nexport type PromptStyle = 'markdown' | 'xml';\n\n/**\n * Base request interface for all generators.\n */\nexport interface BasePromptRequest {\n /** Output style preference */\n style?: PromptStyle;\n\n /** Prompting techniques to apply */\n techniques?: PromptTechnique[];\n\n /** Include metadata section */\n includeMetadata?: boolean;\n\n /** Include references section */\n includeReferences?: boolean;\n\n /** Target LLM provider for optimization */\n provider?: string;\n}\n\n/**\n * Generated section of a prompt.\n */\nexport interface PromptSection {\n /** Section identifier */\n id: string;\n\n /** Section title (for display) */\n title: string;\n\n /** Section content */\n content: string;\n\n /** Whether section is required */\n required: boolean;\n\n /** Order for rendering */\n order: number;\n}\n\n/**\n * Result from a generator.\n */\nexport interface GeneratorResult {\n /** Generated sections */\n sections: PromptSection[];\n\n /** Metadata about generation */\n metadata: {\n domain: PromptDomain;\n generatedAt: Date;\n techniques: PromptTechnique[];\n tokenEstimate: number;\n };\n}\n\n/**\n * Interface that all prompt generators must implement.\n */\nexport interface PromptGenerator<TRequest extends BasePromptRequest = BasePromptRequest> {\n /** Domain this generator handles */\n readonly domain: PromptDomain;\n\n /** Generator version */\n readonly version: string;\n\n /** Human-readable description */\n readonly description: string;\n\n /** Zod schema for validating requests */\n readonly requestSchema: z.ZodSchema<TRequest>;\n\n /**\n * Generate prompt sections from a request.\n *\n * request - Validated request data\n * Generated sections and metadata\n */\n generate(request: TRequest): GeneratorResult;\n}\n\n/**\n * Factory function type for lazy generator instantiation.\n */\nexport type GeneratorFactory<T extends BasePromptRequest = BasePromptRequest> =\n () => PromptGenerator<T>;\n```\n\n### Step 2.2: Implement PromptRegistry\n\n```typescript\n// src/domain/prompts/registry.ts\n\nimport type {\n PromptDomain,\n PromptGenerator,\n GeneratorFactory,\n BasePromptRequest,\n} from './types.js';\n\n/**\n * Registry entry with metadata.\n */\ninterface RegistryEntry<T extends BasePromptRequest = BasePromptRequest> {\n factory: GeneratorFactory<T>;\n version: string;\n description: string;\n instance?: PromptGenerator<T>;\n}\n\n/**\n * PromptRegistry - singleton registry for prompt generators.\n *\n * Features:\n * - Lazy instantiation of generators\n * - Type-safe access with generics\n * - Runtime registration for extensions\n * - Domain discovery\n *\n * \n * ```typescript\n * // At startup\n * import { promptRegistry } from './registry.js';\n * import { HierarchicalGenerator } from './domains/hierarchical.js';\n *\n * promptRegistry.register(\n * 'hierarchical',\n * () => new HierarchicalGenerator(),\n * { version: '2.0.0', description: 'Hierarchical prompt generation' }\n * );\n *\n * // Usage\n * const generator = promptRegistry.get('hierarchical');\n * const result = generator.generate(request);\n * ```\n */\nexport class PromptRegistry {\n private readonly generators = new Map<PromptDomain, RegistryEntry>();\n private static instance: PromptRegistry | null = null;\n\n private constructor() {\n // Private constructor for singleton\n }\n\n /**\n * Get the singleton instance.\n */\n static getInstance(): PromptRegistry {\n if (!PromptRegistry.instance) {\n PromptRegistry.instance = new PromptRegistry();\n }\n return PromptRegistry.instance;\n }\n\n /**\n * Reset the singleton (for testing).\n */\n static resetInstance(): void {\n PromptRegistry.instance = null;\n }\n\n // ============================================\n // Registration\n // ============================================\n\n /**\n * Register a generator factory for a domain.\n *\n * domain - Domain identifier\n * factory - Factory function to create generator\n * options - Registration options\n */\n register<T extends BasePromptRequest>(\n domain: PromptDomain,\n factory: GeneratorFactory<T>,\n options: {\n version: string;\n description: string;\n }\n ): void {\n if (this.generators.has(domain)) {\n throw new Error(`Generator already registered for domain: ${domain}`);\n }\n\n this.generators.set(domain, {\n factory: factory as GeneratorFactory,\n version: options.version,\n description: options.description,\n });\n }\n\n /**\n * Register a generator instance directly.\n *\n * generator - Generator instance\n */\n registerInstance<T extends BasePromptRequest>(\n generator: PromptGenerator<T>\n ): void {\n this.register(\n generator.domain,\n () => generator,\n {\n version: generator.version,\n description: generator.description,\n }\n );\n }\n\n /**\n * Override an existing registration.\n *\n * Use with caution - primarily for testing.\n */\n override<T extends BasePromptRequest>(\n domain: PromptDomain,\n factory: GeneratorFactory<T>,\n options: { version: string; description: string }\n ): void {\n this.generators.set(domain, {\n factory: factory as GeneratorFactory,\n version: options.version,\n description: options.description,\n });\n }\n\n // ============================================\n // Access\n // ============================================\n\n /**\n * Get a generator for a domain.\n *\n * Generator is lazily instantiated on first access.\n *\n * domain - Domain identifier\n * Generator instance\n * If no generator registered for domain\n */\n get<T extends BasePromptRequest>(domain: PromptDomain): PromptGenerator<T> {\n const entry = this.generators.get(domain);\n\n if (!entry) {\n throw new Error(\n `No generator registered for domain: ${domain}. ` +\n `Available domains: ${this.listDomains().join(', ')}`\n );\n }\n\n // Lazy instantiation\n if (!entry.instance) {\n entry.instance = entry.factory();\n }\n\n return entry.instance as PromptGenerator<T>;\n }\n\n /**\n * Check if a domain has a registered generator.\n */\n has(domain: PromptDomain): boolean {\n return this.generators.has(domain);\n }\n\n /**\n * Get metadata for a domain without instantiating.\n */\n getMetadata(domain: PromptDomain): { version: string; description: string } | undefined {\n const entry = this.generators.get(domain);\n if (!entry) return undefined;\n\n return {\n version: entry.version,\n description: entry.description,\n };\n }\n\n // ============================================\n // Discovery\n // ============================================\n\n /**\n * List all registered domains.\n */\n listDomains(): PromptDomain[] {\n return Array.from(this.generators.keys());\n }\n\n /**\n * List all registered generators with metadata.\n */\n listGenerators(): Array<{\n domain: PromptDomain;\n version: string;\n description: string;\n instantiated: boolean;\n }> {\n return Array.from(this.generators.entries()).map(([domain, entry]) => ({\n domain,\n version: entry.version,\n description: entry.description,\n instantiated: !!entry.instance,\n }));\n }\n\n /**\n * Get count of registered generators.\n */\n get size(): number {\n return this.generators.size;\n }\n\n // ============================================\n // Cleanup\n // ============================================\n\n /**\n * Clear all registrations.\n *\n * Use with caution - primarily for testing.\n */\n clear(): void {\n this.generators.clear();\n }\n\n /**\n * Unregister a specific domain.\n */\n unregister(domain: PromptDomain): boolean {\n return this.generators.delete(domain);\n }\n}\n\n/**\n * Default singleton instance.\n */\nexport const promptRegistry = PromptRegistry.getInstance();\n```\n\n### Step 2.3: Create Default Registrations\n\n```typescript\n// src/domain/prompts/register-defaults.ts\n\nimport { promptRegistry } from './registry.js';\n\n// Import generators (these will be created in subsequent tasks)\nimport { HierarchicalGenerator } from './domains/hierarchical.js';\nimport { SecurityGenerator } from './domains/security.js';\nimport { ArchitectureGenerator } from './domains/architecture.js';\nimport { CodeAnalysisGenerator } from './domains/code-analysis.js';\nimport { DocumentationGenerator } from './domains/documentation.js';\nimport { DebuggingGenerator } from './domains/debugging.js';\nimport { DomainNeutralGenerator } from './domains/domain-neutral.js';\nimport { SparkGenerator } from './domains/spark.js';\nimport { EnterpriseGenerator } from './domains/enterprise.js';\nimport { L9EngineerGenerator } from './domains/l9-engineer.js';\nimport { QuickPromptsGenerator } from './domains/quick-prompts.js';\nimport { CoverageDashboardGenerator } from './domains/coverage-dashboard.js';\n\n/**\n * Register all default prompt generators.\n *\n * Called once at application startup.\n */\nexport function registerDefaultGenerators(): void {\n promptRegistry.register('hierarchical', () => new HierarchicalGenerator(), {\n version: '2.0.0',\n description: 'Hierarchical prompt generation with context ‚Üí goal ‚Üí requirements',\n });\n\n promptRegistry.register('security', () => new SecurityGenerator(), {\n version: '2.0.0',\n description: 'Security-focused prompts with OWASP compliance',\n });\n\n promptRegistry.register('architecture', () => new ArchitectureGenerator(), {\n version: '2.0.0',\n description: 'Architecture design prompts for system design',\n });\n\n promptRegistry.register('code-analysis', () => new CodeAnalysisGenerator(), {\n version: '2.0.0',\n description: 'Code review and analysis prompts',\n });\n\n promptRegistry.register('documentation', () => new DocumentationGenerator(), {\n version: '2.0.0',\n description: 'Technical documentation generation prompts',\n });\n\n promptRegistry.register('debugging', () => new DebuggingGenerator(), {\n version: '2.0.0',\n description: 'Debugging assistant prompts with root cause analysis',\n });\n\n promptRegistry.register('domain-neutral', () => new DomainNeutralGenerator(), {\n version: '2.0.0',\n description: 'Domain-neutral prompts for cross-cutting concerns',\n });\n\n promptRegistry.register('spark', () => new SparkGenerator(), {\n version: '2.0.0',\n description: 'Spark UI/UX card generation prompts',\n });\n\n promptRegistry.register('enterprise', () => new EnterpriseGenerator(), {\n version: '2.0.0',\n description: 'Enterprise architecture strategy prompts',\n });\n\n promptRegistry.register('l9-engineer', () => new L9EngineerGenerator(), {\n version: '2.0.0',\n description: 'Distinguished engineer (L9) technical design prompts',\n });\n\n promptRegistry.register('quick-prompts', () => new QuickPromptsGenerator(), {\n version: '2.0.0',\n description: 'Quick developer prompts with checklists',\n });\n\n promptRegistry.register('coverage-dashboard', () => new CoverageDashboardGenerator(), {\n version: '2.0.0',\n description: 'Coverage dashboard UI design prompts',\n });\n}\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/prompts/registry.spec.ts\n\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { PromptRegistry } from '../../../../src/domain/prompts/registry.js';\nimport type { PromptGenerator, BasePromptRequest, GeneratorResult } from '../../../../src/domain/prompts/types.js';\nimport { z } from 'zod';\n\n// Mock generator for testing\nclass MockGenerator implements PromptGenerator {\n static instanceCount = 0;\n\n readonly domain = 'hierarchical' as const;\n readonly version = '1.0.0';\n readonly description = 'Mock generator';\n readonly requestSchema = z.object({});\n\n constructor() {\n MockGenerator.instanceCount++;\n }\n\n generate(): GeneratorResult {\n return {\n sections: [],\n metadata: {\n domain: this.domain,\n generatedAt: new Date(),\n techniques: [],\n tokenEstimate: 0,\n },\n };\n }\n}\n\ndescribe('PromptRegistry', () => {\n let registry: PromptRegistry;\n\n beforeEach(() => {\n PromptRegistry.resetInstance();\n registry = PromptRegistry.getInstance();\n MockGenerator.instanceCount = 0;\n });\n\n afterEach(() => {\n PromptRegistry.resetInstance();\n });\n\n describe('singleton', () => {\n it('should return same instance', () => {\n const instance1 = PromptRegistry.getInstance();\n const instance2 = PromptRegistry.getInstance();\n\n expect(instance1).toBe(instance2);\n });\n\n it('should reset instance', () => {\n const instance1 = PromptRegistry.getInstance();\n PromptRegistry.resetInstance();\n const instance2 = PromptRegistry.getInstance();\n\n expect(instance1).not.toBe(instance2);\n });\n });\n\n describe('register', () => {\n it('should register a generator factory', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n expect(registry.has('hierarchical')).toBe(true);\n });\n\n it('should throw on duplicate registration', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n expect(() => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n }).toThrow('already registered');\n });\n });\n\n describe('registerInstance', () => {\n it('should register a generator instance', () => {\n const generator = new MockGenerator();\n registry.registerInstance(generator);\n\n expect(registry.has('hierarchical')).toBe(true);\n });\n });\n\n describe('get', () => {\n it('should return registered generator', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n const generator = registry.get('hierarchical');\n\n expect(generator.domain).toBe('hierarchical');\n });\n\n it('should lazily instantiate generator', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n expect(MockGenerator.instanceCount).toBe(0);\n\n registry.get('hierarchical');\n\n expect(MockGenerator.instanceCount).toBe(1);\n });\n\n it('should cache generator instance', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n registry.get('hierarchical');\n registry.get('hierarchical');\n registry.get('hierarchical');\n\n expect(MockGenerator.instanceCount).toBe(1);\n });\n\n it('should throw for unknown domain', () => {\n expect(() => {\n registry.get('unknown' as any);\n }).toThrow('No generator registered');\n });\n });\n\n describe('override', () => {\n it('should replace existing registration', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Original',\n });\n\n registry.override('hierarchical', () => new MockGenerator(), {\n version: '2.0.0',\n description: 'Overridden',\n });\n\n const metadata = registry.getMetadata('hierarchical');\n expect(metadata?.version).toBe('2.0.0');\n });\n });\n\n describe('listDomains', () => {\n it('should list all registered domains', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n const domains = registry.listDomains();\n\n expect(domains).toContain('hierarchical');\n });\n });\n\n describe('listGenerators', () => {\n it('should list generators with metadata', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test description',\n });\n\n const generators = registry.listGenerators();\n\n expect(generators).toHaveLength(1);\n expect(generators[0].domain).toBe('hierarchical');\n expect(generators[0].version).toBe('1.0.0');\n expect(generators[0].description).toBe('Test description');\n expect(generators[0].instantiated).toBe(false);\n });\n\n it('should track instantiation status', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n registry.get('hierarchical');\n\n const generators = registry.listGenerators();\n expect(generators[0].instantiated).toBe(true);\n });\n });\n\n describe('clear', () => {\n it('should remove all registrations', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n registry.clear();\n\n expect(registry.size).toBe(0);\n });\n });\n\n describe('unregister', () => {\n it('should remove specific domain', () => {\n registry.register('hierarchical', () => new MockGenerator(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n const removed = registry.unregister('hierarchical');\n\n expect(removed).toBe(true);\n expect(registry.has('hierarchical')).toBe(false);\n });\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------ | ------ | ------------------- |\n| Singleton pattern implemented | ‚¨ú | Singleton test |\n| Register generator factory | ‚¨ú | Registration test |\n| Lazy instantiation | ‚¨ú | Instance count test |\n| Instance caching | ‚¨ú | Cache test |\n| Type-safe generic access | ‚¨ú | TypeScript compile |\n| Domain discovery (listDomains) | ‚¨ú | Discovery test |\n| Override for testing | ‚¨ú | Override test |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. References\n\n| Document | Link |\n| --------------------------------- | ------------------------------------------------------ |\n| T-026: UnifiedPromptBuilder | [T-026-unified-builder.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md) |\n| T-025: TemplateEngine | [T-025-template-engine.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-025-template-engine.md) |\n| ADR-003: Unified Prompt Ecosystem | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-003) |\n\n---\n\n*Task: T-024 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-024",
		"dependencies": [],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-024-prompt-registry.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-024-prompt-registry.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-025: Implement TemplateEngine",
		"body": "# T-025: Implement TemplateEngine\n\n## Overview\n\n**Task ID**: T-025\n**Phase**: 2.5 - Unified Prompts\n**Priority**: P0 (Critical Path)\n**Estimate**: 5 hours\n**Dependencies**: T-024 (PromptRegistry)\n**Blocks**: T-026 (UnifiedPromptBuilder)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-025-template-engine.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nCreate `TemplateEngine` - a composable prompt assembly system that:\n- Composes sections from multiple generators\n- Applies rendering templates (markdown, XML)\n- Handles section ordering and deduplication\n- Supports conditional sections based on config\n\n### Why\n\nCurrent prompt builders have:\n- Duplicate section rendering logic\n- Inconsistent frontmatter/metadata handling\n- No shared template system\n- Hard-coded output formats\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nconst engine = new TemplateEngine();\n\n// Compose sections from multiple sources\nconst prompt = engine.compose({\n sections: [\n ...hierarchicalResult.sections,\n ...securityResult.sections,\n ],\n style: 'markdown',\n options: {\n includeFrontmatter: true,\n includeMetadata: true,\n includeReferences: true,\n includeDisclaimer: false,\n },\n});\n\n// Output is fully rendered markdown/XML\nconsole.log(prompt);\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Template Types\n\n```typescript\n// src/domain/prompts/template-types.ts\n\nimport type { PromptSection, PromptStyle } from './types.js';\n\n/**\n * Options for prompt composition.\n */\nexport interface CompositionOptions {\n /** Include YAML frontmatter */\n includeFrontmatter?: boolean;\n\n /** Include metadata section */\n includeMetadata?: boolean;\n\n /** Include references section */\n includeReferences?: boolean;\n\n /** Include disclaimer section */\n includeDisclaimer?: boolean;\n\n /** Custom frontmatter fields */\n frontmatter?: Record<string, unknown>;\n\n /** Custom metadata fields */\n metadata?: Record<string, unknown>;\n\n /** Reference links to include */\n references?: ReferenceLink[];\n\n /** Disclaimer text */\n disclaimerText?: string;\n}\n\n/**\n * Reference link for references section.\n */\nexport interface ReferenceLink {\n title: string;\n url: string;\n description?: string;\n}\n\n/**\n * Request to compose a prompt.\n */\nexport interface ComposeRequest {\n /** Sections to compose */\n sections: PromptSection[];\n\n /** Output style */\n style: PromptStyle;\n\n /** Composition options */\n options?: CompositionOptions;\n\n /** Title for the prompt */\n title?: string;\n\n /** Description for frontmatter */\n description?: string;\n}\n\n/**\n * Result from composition.\n */\nexport interface ComposeResult {\n /** Rendered prompt content */\n content: string;\n\n /** Sections that were rendered */\n renderedSections: string[];\n\n /** Token estimate for the prompt */\n tokenEstimate: number;\n\n /** Warnings during composition */\n warnings: string[];\n}\n\n/**\n * Renderer interface for different output styles.\n */\nexport interface SectionRenderer {\n /** Render a single section */\n renderSection(section: PromptSection): string;\n\n /** Render frontmatter */\n renderFrontmatter(data: Record<string, unknown>): string;\n\n /** Render metadata section */\n renderMetadata(metadata: Record<string, unknown>): string;\n\n /** Render references section */\n renderReferences(references: ReferenceLink[]): string;\n\n /** Render disclaimer */\n renderDisclaimer(text: string): string;\n\n /** Join rendered parts */\n join(parts: string[]): string;\n}\n```\n\n### Step 2.2: Implement Markdown Renderer\n\n```typescript\n// src/domain/prompts/renderers/markdown-renderer.ts\n\nimport type {\n SectionRenderer,\n ReferenceLink\n} from '../template-types.js';\nimport type { PromptSection } from '../types.js';\n\n/**\n * Markdown renderer for prompt sections.\n */\nexport class MarkdownRenderer implements SectionRenderer {\n /**\n * Render a section as markdown.\n */\n renderSection(section: PromptSection): string {\n const lines: string[] = [];\n\n // Section header\n lines.push(`## ${section.title}`);\n lines.push('');\n\n // Section content\n lines.push(section.content);\n lines.push('');\n\n return lines.join('\\n');\n }\n\n /**\n * Render YAML frontmatter.\n */\n renderFrontmatter(data: Record<string, unknown>): string {\n const lines: string[] = ['---'];\n\n for (const [key, value] of Object.entries(data)) {\n lines.push(this.formatYamlLine(key, value));\n }\n\n lines.push('---');\n lines.push('');\n\n return lines.join('\\n');\n }\n\n /**\n * Render metadata section.\n */\n renderMetadata(metadata: Record<string, unknown>): string {\n const lines: string[] = [];\n\n lines.push('## Metadata');\n lines.push('');\n\n for (const [key, value] of Object.entries(metadata)) {\n lines.push(`- **${key}**: ${this.formatValue(value)}`);\n }\n\n lines.push('');\n\n return lines.join('\\n');\n }\n\n /**\n * Render references section.\n */\n renderReferences(references: ReferenceLink[]): string {\n if (references.length === 0) {\n return '';\n }\n\n const lines: string[] = [];\n\n lines.push('## References');\n lines.push('');\n\n for (const ref of references) {\n if (ref.description) {\n lines.push(`- [${ref.title}](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/${ref.url}) - ${ref.description}`);\n } else {\n lines.push(`- [${ref.title}](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/${ref.url})`);\n }\n }\n\n lines.push('');\n\n return lines.join('\\n');\n }\n\n /**\n * Render disclaimer section.\n */\n renderDisclaimer(text: string): string {\n const lines: string[] = [];\n\n lines.push('---');\n lines.push('');\n lines.push(`*${text}*`);\n lines.push('');\n\n return lines.join('\\n');\n }\n\n /**\n * Join rendered parts.\n */\n join(parts: string[]): string {\n return parts.filter(Boolean).join('\\n');\n }\n\n // ============================================\n // Helpers\n // ============================================\n\n private formatYamlLine(key: string, value: unknown): string {\n if (Array.isArray(value)) {\n return `${key}:\\n${value.map(v => ` - ${v}`).join('\\n')}`;\n }\n if (typeof value === 'object' && value !== null) {\n return `${key}: ${JSON.stringify(value)}`;\n }\n if (typeof value === 'string' && value.includes('\\n')) {\n return `${key}: |\\n ${value.split('\\n').join('\\n ')}`;\n }\n return `${key}: ${value}`;\n }\n\n private formatValue(value: unknown): string {\n if (Array.isArray(value)) {\n return value.join(', ');\n }\n if (value instanceof Date) {\n return value.toISOString();\n }\n if (typeof value === 'object' && value !== null) {\n return JSON.stringify(value);\n }\n return String(value);\n }\n}\n```\n\n### Step 2.3: Implement XML Renderer\n\n```typescript\n// src/domain/prompts/renderers/xml-renderer.ts\n\nimport type {\n SectionRenderer,\n ReferenceLink\n} from '../template-types.js';\nimport type { PromptSection } from '../types.js';\n\n/**\n * XML renderer for prompt sections.\n *\n * Useful for Claude-style XML prompts.\n */\nexport class XmlRenderer implements SectionRenderer {\n /**\n * Render a section as XML.\n */\n renderSection(section: PromptSection): string {\n const tagName = this.toTagName(section.id);\n\n return `<${tagName}>\n${this.escapeXml(section.content)}\n</${tagName}>`;\n }\n\n /**\n * Render metadata as XML attributes.\n */\n renderFrontmatter(data: Record<string, unknown>): string {\n const attrs = Object.entries(data)\n .map(([k, v]) => `${k}=\"${this.escapeXml(String(v))}\"`)\n .join(' ');\n\n return `<prompt ${attrs}>`;\n }\n\n /**\n * Render metadata section.\n */\n renderMetadata(metadata: Record<string, unknown>): string {\n const lines: string[] = ['<metadata>'];\n\n for (const [key, value] of Object.entries(metadata)) {\n lines.push(` <${key}>${this.escapeXml(String(value))}</${key}>`);\n }\n\n lines.push('</metadata>');\n\n return lines.join('\\n');\n }\n\n /**\n * Render references section.\n */\n renderReferences(references: ReferenceLink[]): string {\n if (references.length === 0) {\n return '';\n }\n\n const lines: string[] = ['<references>'];\n\n for (const ref of references) {\n lines.push(` <reference url=\"${this.escapeXml(ref.url)}\">`);\n lines.push(` <title>${this.escapeXml(ref.title)}</title>`);\n if (ref.description) {\n lines.push(` <description>${this.escapeXml(ref.description)}</description>`);\n }\n lines.push(' </reference>');\n }\n\n lines.push('</references>');\n\n return lines.join('\\n');\n }\n\n /**\n * Render disclaimer section.\n */\n renderDisclaimer(text: string): string {\n return `<disclaimer>${this.escapeXml(text)}</disclaimer>`;\n }\n\n /**\n * Join rendered parts.\n */\n join(parts: string[]): string {\n return parts.filter(Boolean).join('\\n\\n');\n }\n\n // ============================================\n // Helpers\n // ============================================\n\n private toTagName(id: string): string {\n return id.toLowerCase().replace(/[^a-z0-9]/g, '-');\n }\n\n private escapeXml(text: string): string {\n return text\n .replace(/&/g, '&amp;')\n .replace(/</g, '&lt;')\n .replace(/>/g, '&gt;')\n .replace(/\"/g, '&quot;')\n .replace(/'/g, '&apos;');\n }\n}\n```\n\n### Step 2.4: Implement TemplateEngine\n\n```typescript\n// src/domain/prompts/template-engine.ts\n\nimport type {\n ComposeRequest,\n ComposeResult,\n CompositionOptions,\n SectionRenderer,\n} from './template-types.js';\nimport type { PromptSection, PromptStyle } from './types.js';\nimport { MarkdownRenderer } from './renderers/markdown-renderer.js';\nimport { XmlRenderer } from './renderers/xml-renderer.js';\n\n/**\n * Default disclaimer text.\n */\nconst DEFAULT_DISCLAIMER =\n 'This prompt was generated automatically. Review and adapt as needed.';\n\n/**\n * TemplateEngine - composes prompt sections into final output.\n *\n * Features:\n * - Multiple output formats (markdown, XML)\n * - Section ordering and deduplication\n * - Optional frontmatter, metadata, references, disclaimer\n * - Token estimation\n *\n * \n * ```typescript\n * const engine = new TemplateEngine();\n *\n * const result = engine.compose({\n * sections: [...],\n * style: 'markdown',\n * title: 'Code Review Prompt',\n * options: {\n * includeFrontmatter: true,\n * includeReferences: true,\n * },\n * });\n *\n * console.log(result.content);\n * ```\n */\nexport class TemplateEngine {\n private readonly renderers: Map<PromptStyle, SectionRenderer>;\n\n constructor() {\n this.renderers = new Map<PromptStyle, SectionRenderer>([\n ['markdown', new MarkdownRenderer()],\n ['xml', new XmlRenderer()],\n ]);\n }\n\n /**\n * Register a custom renderer.\n */\n registerRenderer(style: PromptStyle, renderer: SectionRenderer): void {\n this.renderers.set(style, renderer);\n }\n\n /**\n * Compose sections into a final prompt.\n */\n compose(request: ComposeRequest): ComposeResult {\n const {\n sections,\n style,\n options = {},\n title,\n description,\n } = request;\n\n const renderer = this.getRenderer(style);\n const warnings: string[] = [];\n\n // Deduplicate and sort sections\n const processedSections = this.processSections(sections, warnings);\n\n // Build parts\n const parts: string[] = [];\n\n // Frontmatter\n if (options.includeFrontmatter) {\n const frontmatterData = {\n title: title ?? 'Generated Prompt',\n description: description ?? '',\n generated: new Date().toISOString(),\n style,\n ...options.frontmatter,\n };\n parts.push(renderer.renderFrontmatter(frontmatterData));\n }\n\n // Title (for markdown without frontmatter)\n if (!options.includeFrontmatter && title && style === 'markdown') {\n parts.push(`# ${title}\\n`);\n }\n\n // Main sections\n for (const section of processedSections) {\n parts.push(renderer.renderSection(section));\n }\n\n // Metadata\n if (options.includeMetadata) {\n const metadata = {\n sectionCount: processedSections.length,\n ...options.metadata,\n };\n parts.push(renderer.renderMetadata(metadata));\n }\n\n // References\n if (options.includeReferences && options.references?.length) {\n parts.push(renderer.renderReferences(options.references));\n }\n\n // Disclaimer\n if (options.includeDisclaimer) {\n const text = options.disclaimerText ?? DEFAULT_DISCLAIMER;\n parts.push(renderer.renderDisclaimer(text));\n }\n\n // Close XML wrapper if needed\n if (style === 'xml' && options.includeFrontmatter) {\n parts.push('</prompt>');\n }\n\n // Join and finalize\n const content = renderer.join(parts);\n\n return {\n content,\n renderedSections: processedSections.map(s => s.id),\n tokenEstimate: this.estimateTokens(content),\n warnings,\n };\n }\n\n // ============================================\n // Section Processing\n // ============================================\n\n /**\n * Deduplicate and sort sections by order.\n */\n private processSections(\n sections: PromptSection[],\n warnings: string[]\n ): PromptSection[] {\n const seen = new Map<string, PromptSection>();\n\n for (const section of sections) {\n if (seen.has(section.id)) {\n warnings.push(`Duplicate section \"${section.id}\" - keeping first occurrence`);\n continue;\n }\n seen.set(section.id, section);\n }\n\n // Sort by order\n return Array.from(seen.values()).sort((a, b) => a.order - b.order);\n }\n\n // ============================================\n // Helpers\n // ============================================\n\n private getRenderer(style: PromptStyle): SectionRenderer {\n const renderer = this.renderers.get(style);\n\n if (!renderer) {\n throw new Error(\n `No renderer for style: ${style}. ` +\n `Available: ${Array.from(this.renderers.keys()).join(', ')}`\n );\n }\n\n return renderer;\n }\n\n /**\n * Estimate token count.\n *\n * Uses simple heuristic: ~4 characters per token.\n */\n private estimateTokens(content: string): number {\n return Math.ceil(content.length / 4);\n }\n}\n\n/**\n * Default engine instance.\n */\nexport const templateEngine = new TemplateEngine();\n```\n\n### Step 2.5: Create Barrel Export\n\n```typescript\n// src/domain/prompts/index.ts\n\n// Types\nexport type {\n PromptDomain,\n PromptTechnique,\n PromptStyle,\n BasePromptRequest,\n PromptSection,\n GeneratorResult,\n PromptGenerator,\n GeneratorFactory,\n} from './types.js';\n\nexport type {\n CompositionOptions,\n ReferenceLink,\n ComposeRequest,\n ComposeResult,\n SectionRenderer,\n} from './template-types.js';\n\n// Registry\nexport { PromptRegistry, promptRegistry } from './registry.js';\n\n// Template Engine\nexport { TemplateEngine, templateEngine } from './template-engine.js';\n\n// Renderers\nexport { MarkdownRenderer } from './renderers/markdown-renderer.js';\nexport { XmlRenderer } from './renderers/xml-renderer.js';\n\n// Registration\nexport { registerDefaultGenerators } from './register-defaults.js';\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/domain/prompts/template-engine.spec.ts\n\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { TemplateEngine } from '../../../../src/domain/prompts/template-engine.js';\nimport type { PromptSection, PromptStyle } from '../../../../src/domain/prompts/types.js';\n\ndescribe('TemplateEngine', () => {\n let engine: TemplateEngine;\n\n beforeEach(() => {\n engine = new TemplateEngine();\n });\n\n // ============================================\n // Basic Composition\n // ============================================\n\n describe('compose', () => {\n it('should compose sections into markdown', () => {\n const sections: PromptSection[] = [\n {\n id: 'context',\n title: 'Context',\n content: 'This is the context.',\n required: true,\n order: 1,\n },\n {\n id: 'goal',\n title: 'Goal',\n content: 'This is the goal.',\n required: true,\n order: 2,\n },\n ];\n\n const result = engine.compose({\n sections,\n style: 'markdown',\n });\n\n expect(result.content).toContain('## Context');\n expect(result.content).toContain('This is the context.');\n expect(result.content).toContain('## Goal');\n expect(result.content).toContain('This is the goal.');\n });\n\n it('should compose sections into XML', () => {\n const sections: PromptSection[] = [\n {\n id: 'context',\n title: 'Context',\n content: 'This is the context.',\n required: true,\n order: 1,\n },\n ];\n\n const result = engine.compose({\n sections,\n style: 'xml',\n });\n\n expect(result.content).toContain('<context>');\n expect(result.content).toContain('This is the context.');\n expect(result.content).toContain('</context>');\n });\n\n it('should sort sections by order', () => {\n const sections: PromptSection[] = [\n { id: 'c', title: 'C', content: 'C', required: true, order: 3 },\n { id: 'a', title: 'A', content: 'A', required: true, order: 1 },\n { id: 'b', title: 'B', content: 'B', required: true, order: 2 },\n ];\n\n const result = engine.compose({\n sections,\n style: 'markdown',\n });\n\n const aIndex = result.content.indexOf('## A');\n const bIndex = result.content.indexOf('## B');\n const cIndex = result.content.indexOf('## C');\n\n expect(aIndex).toBeLessThan(bIndex);\n expect(bIndex).toBeLessThan(cIndex);\n });\n });\n\n // ============================================\n // Deduplication\n // ============================================\n\n describe('deduplication', () => {\n it('should deduplicate sections with same id', () => {\n const sections: PromptSection[] = [\n { id: 'ctx', title: 'Context', content: 'First', required: true, order: 1 },\n { id: 'ctx', title: 'Context', content: 'Second', required: true, order: 1 },\n ];\n\n const result = engine.compose({\n sections,\n style: 'markdown',\n });\n\n expect(result.renderedSections).toHaveLength(1);\n expect(result.content).toContain('First');\n expect(result.content).not.toContain('Second');\n });\n\n it('should add warning for duplicates', () => {\n const sections: PromptSection[] = [\n { id: 'ctx', title: 'Context', content: 'First', required: true, order: 1 },\n { id: 'ctx', title: 'Context', content: 'Second', required: true, order: 1 },\n ];\n\n const result = engine.compose({\n sections,\n style: 'markdown',\n });\n\n expect(result.warnings).toHaveLength(1);\n expect(result.warnings[0]).toContain('Duplicate section');\n });\n });\n\n // ============================================\n // Options\n // ============================================\n\n describe('options', () => {\n const minimalSections: PromptSection[] = [\n { id: 'test', title: 'Test', content: 'Content', required: true, order: 1 },\n ];\n\n it('should include frontmatter when requested', () => {\n const result = engine.compose({\n sections: minimalSections,\n style: 'markdown',\n title: 'Test Prompt',\n options: {\n includeFrontmatter: true,\n },\n });\n\n expect(result.content).toContain('---');\n expect(result.content).toContain('title: Test Prompt');\n });\n\n it('should include references when provided', () => {\n const result = engine.compose({\n sections: minimalSections,\n style: 'markdown',\n options: {\n includeReferences: true,\n references: [\n { title: 'Doc', url: 'https://example.com' },\n ],\n },\n });\n\n expect(result.content).toContain('## References');\n expect(result.content).toContain('[Doc](https://example.com)');\n });\n\n it('should include disclaimer when requested', () => {\n const result = engine.compose({\n sections: minimalSections,\n style: 'markdown',\n options: {\n includeDisclaimer: true,\n disclaimerText: 'Custom disclaimer',\n },\n });\n\n expect(result.content).toContain('Custom disclaimer');\n });\n\n it('should include metadata when requested', () => {\n const result = engine.compose({\n sections: minimalSections,\n style: 'markdown',\n options: {\n includeMetadata: true,\n metadata: {\n version: '1.0.0',\n domain: 'test',\n },\n },\n });\n\n expect(result.content).toContain('## Metadata');\n expect(result.content).toContain('version');\n });\n });\n\n // ============================================\n // Token Estimation\n // ============================================\n\n describe('token estimation', () => {\n it('should estimate tokens', () => {\n const sections: PromptSection[] = [\n { id: 'test', title: 'Test', content: 'A'.repeat(1000), required: true, order: 1 },\n ];\n\n const result = engine.compose({\n sections,\n style: 'markdown',\n });\n\n // ~4 chars per token\n expect(result.tokenEstimate).toBeGreaterThan(250);\n });\n });\n\n // ============================================\n // Custom Renderer\n // ============================================\n\n describe('custom renderer', () => {\n it('should allow registering custom renderer', () => {\n const customRenderer = {\n renderSection: (s: PromptSection) => `CUSTOM: ${s.content}`,\n renderFrontmatter: () => '',\n renderMetadata: () => '',\n renderReferences: () => '',\n renderDisclaimer: () => '',\n join: (parts: string[]) => parts.join('|'),\n };\n\n engine.registerRenderer('markdown' as PromptStyle, customRenderer);\n\n const result = engine.compose({\n sections: [\n { id: 'test', title: 'Test', content: 'Hello', required: true, order: 1 },\n ],\n style: 'markdown',\n });\n\n expect(result.content).toContain('CUSTOM: Hello');\n });\n });\n});\n```\n\n### Step 3.2: Renderer Tests\n\n```typescript\n// tests/vitest/domain/prompts/renderers/markdown-renderer.spec.ts\n\nimport { describe, it, expect } from 'vitest';\nimport { MarkdownRenderer } from '../../../../../src/domain/prompts/renderers/markdown-renderer.js';\n\ndescribe('MarkdownRenderer', () => {\n const renderer = new MarkdownRenderer();\n\n describe('renderSection', () => {\n it('should render section with title', () => {\n const output = renderer.renderSection({\n id: 'context',\n title: 'Context',\n content: 'Test content',\n required: true,\n order: 1,\n });\n\n expect(output).toContain('## Context');\n expect(output).toContain('Test content');\n });\n });\n\n describe('renderFrontmatter', () => {\n it('should render YAML frontmatter', () => {\n const output = renderer.renderFrontmatter({\n title: 'Test',\n version: '1.0.0',\n });\n\n expect(output).toMatch(/^---/);\n expect(output).toContain('title: Test');\n expect(output).toContain('version: 1.0.0');\n expect(output).toMatch(/---$/m);\n });\n\n it('should handle array values', () => {\n const output = renderer.renderFrontmatter({\n tags: ['a', 'b', 'c'],\n });\n\n expect(output).toContain('tags:');\n expect(output).toContain(' - a');\n });\n });\n\n describe('renderReferences', () => {\n it('should render reference links', () => {\n const output = renderer.renderReferences([\n { title: 'Docs', url: 'https://example.com', description: 'Main docs' },\n ]);\n\n expect(output).toContain('## References');\n expect(output).toContain('[Docs](https://example.com) - Main docs');\n });\n\n it('should return empty for no references', () => {\n const output = renderer.renderReferences([]);\n expect(output).toBe('');\n });\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------- | ------ | -------------------- |\n| Markdown rendering | ‚¨ú | Markdown test |\n| XML rendering | ‚¨ú | XML test |\n| Section ordering | ‚¨ú | Order test |\n| Section deduplication | ‚¨ú | Dedup test |\n| Frontmatter support | ‚¨ú | Frontmatter test |\n| Metadata support | ‚¨ú | Metadata test |\n| References support | ‚¨ú | References test |\n| Disclaimer support | ‚¨ú | Disclaimer test |\n| Token estimation | ‚¨ú | Token test |\n| Custom renderer support | ‚¨ú | Custom renderer test |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. Usage Examples\n\n### Basic Markdown Prompt\n\n```typescript\nimport { templateEngine } from './domain/prompts/index.js';\n\nconst result = templateEngine.compose({\n sections: [\n {\n id: 'context',\n title: 'Context',\n content: 'Building a microservices authentication system.',\n required: true,\n order: 1,\n },\n {\n id: 'goal',\n title: 'Goal',\n content: 'Implement OAuth2 authorization flow with JWT tokens.',\n required: true,\n order: 2,\n },\n {\n id: 'requirements',\n title: 'Requirements',\n content: '- Support multiple providers\\n- Token refresh\\n- Secure storage',\n required: true,\n order: 3,\n },\n ],\n style: 'markdown',\n title: 'Authentication System Design',\n options: {\n includeFrontmatter: true,\n includeReferences: true,\n references: [\n { title: 'OAuth 2.0 Spec', url: 'https://oauth.net/2/' },\n { title: 'JWT RFC', url: 'https://tools.ietf.org/html/rfc7519' },\n ],\n },\n});\n\nconsole.log(result.content);\n```\n\n**Output:**\n\n```markdown\n---\ntitle: Authentication System Design\ndescription: \"\"\ngenerated: 2025-01-15T10:30:00.000Z\nstyle: markdown\n---\n\n## Context\n\nBuilding a microservices authentication system.\n\n## Goal\n\nImplement OAuth2 authorization flow with JWT tokens.\n\n## Requirements\n\n- Support multiple providers\n- Token refresh\n- Secure storage\n\n## References\n\n- [OAuth 2.0 Spec](https://oauth.net/2/)\n- [JWT RFC](https://tools.ietf.org/html/rfc7519)\n```\n\n---\n\n## 6. References\n\n| Document | Link |\n| --------------------------------- | ------------------------------------------------------ |\n| T-024: PromptRegistry | [T-024-prompt-registry.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-024-prompt-registry.md) |\n| T-026: UnifiedPromptBuilder | [T-026-unified-builder.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md) |\n| ADR-003: Unified Prompt Ecosystem | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-003) |\n\n---\n\n*Task: T-025 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-025",
		"dependencies": ["T-024"],
		"estimate_hours": 5,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-025-template-engine.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-025-template-engine.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-026: Implement UnifiedPromptBuilder Core",
		"body": "# T-026: Implement UnifiedPromptBuilder Core\n\n## Overview\n\n**Task ID**: T-026\n**Phase**: 2.5 - Unified Prompt Ecosystem\n**Priority**: P0 (Critical Path)\n**Estimate**: 8 hours\n**Dependencies**: T-024 (PromptRegistry), T-025 (TemplateEngine)\n**Blocks**: T-027-T-031 (Domain Generators), T-032-T-033 (Legacy Facades)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nImplement `UnifiedPromptBuilder` as the single entry point for all prompt generation, replacing the 12+ disparate prompt builders (hierarchical, domain-neutral, spark, security, architecture, etc.) with a unified, extensible system.\n\n### Why\n\nCurrent codebase has 12+ prompt builders with:\n- ~25% code duplication (shared sections, frontmatter, techniques)\n- Inconsistent prompt structure across builders\n- Hard to maintain and extend\n- No unified interface for consumers\n\n### Target Files\n\n| File | Purpose |\n| ---------------------------------------------- | ---------------- |\n| `src/domain/prompts/unified-prompt-builder.ts` | Main class |\n| `src/domain/prompts/types.ts` | Type definitions |\n| `src/domain/prompts/index.ts` | Barrel export |\n\n---\n\n## 2. Prerequisites\n\n### Dependencies\n\n- **T-024**: PromptRegistry must be implemented\n- **T-025**: TemplateEngine must be implemented\n\n### Files to Review\n\n| File | Purpose |\n| ------------------------------------------------------------------------------------------------- | --------------------------------- |\n| [hierarchical-prompt-builder.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/hierarchical-prompt-builder.ts) | Current implementation to replace |\n| [domain-neutral-prompt-builder.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/domain-neutral-prompt-builder.ts) | Another builder to consolidate |\n| [prompt-sections.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/prompt-sections.ts) | Shared sections to reuse |\n| [prompt-utils.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/prompt-utils.ts) | Utilities to incorporate |\n\n### Environment Setup\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Ensure dependencies are built\nnpm run build\n\n# Verify T-024 and T-025 are complete\nls src/domain/prompts/registry.ts\nls src/domain/prompts/template-engine.ts\n```\n\n---\n\n## 3. Implementation Guide\n\n### Step 3.1: Define Type System\n\n```typescript\n// src/domain/prompts/types.ts\n\nimport type { z } from 'zod';\n\n/**\n * Supported prompt domains.\n * Each domain has specific input requirements and output templates.\n */\nexport type PromptDomain =\n | 'hierarchical'\n | 'domain-neutral'\n | 'spark'\n | 'security'\n | 'architecture'\n | 'code-analysis'\n | 'debugging'\n | 'documentation'\n | 'enterprise'\n | 'l9-engineer';\n\n/**\n * Prompting technique from 2025 research.\n */\nexport type PromptTechnique =\n | 'zero-shot'\n | 'few-shot'\n | 'chain-of-thought'\n | 'self-consistency'\n | 'tree-of-thoughts'\n | 'react'\n | 'art'\n | 'prompt-chaining'\n | 'meta-prompting'\n | 'rag';\n\n/**\n * Provider-specific optimizations.\n */\nexport type PromptProvider =\n | 'gpt-4.1'\n | 'gpt-5'\n | 'claude-opus-4.1'\n | 'claude-sonnet-4'\n | 'gemini-2.5-pro'\n | 'other';\n\n/**\n * Output format for generated prompts.\n */\nexport type PromptOutputFormat =\n | 'markdown'\n | 'json'\n | 'yaml'\n | 'prompt-md';\n\n/**\n * Request to build a prompt.\n */\nexport interface PromptRequest<TContext = Record<string, unknown>> {\n /** Target domain for prompt generation */\n domain: PromptDomain;\n\n /** Domain-specific context */\n context: TContext;\n\n /** Prompting techniques to apply */\n techniques?: PromptTechnique[];\n\n /** Target LLM provider */\n provider?: PromptProvider;\n\n /** Output format */\n outputFormat?: PromptOutputFormat;\n\n /** Include YAML frontmatter */\n includeFrontmatter?: boolean;\n\n /** Include metadata section */\n includeMetadata?: boolean;\n\n /** Include technique hints */\n includeTechniqueHints?: boolean;\n\n /** Custom title override */\n title?: string;\n}\n\n/**\n * Generated prompt result.\n */\nexport interface PromptResult {\n /** Generated prompt content */\n content: string;\n\n /** Prompt metadata */\n metadata: PromptMetadata;\n\n /** Applied techniques */\n techniques: PromptTechnique[];\n\n /** Generation statistics */\n stats: PromptStats;\n}\n\n/**\n * Prompt metadata for reference.\n */\nexport interface PromptMetadata {\n /** Domain that generated the prompt */\n domain: PromptDomain;\n\n /** Target provider */\n provider: PromptProvider;\n\n /** Generation timestamp */\n generatedAt: string;\n\n /** Builder version */\n version: string;\n\n /** Custom title */\n title?: string;\n}\n\n/**\n * Generation statistics.\n */\nexport interface PromptStats {\n /** Estimated token count */\n estimatedTokens: number;\n\n /** Number of sections */\n sectionCount: number;\n\n /** Generation time in ms */\n generationTimeMs: number;\n}\n\n/**\n * Interface for domain-specific prompt generators.\n */\nexport interface PromptGenerator<TContext = Record<string, unknown>> {\n /** Domain this generator handles */\n readonly domain: PromptDomain;\n\n /** Generator version */\n readonly version: string;\n\n /** Zod schema for validating context */\n readonly contextSchema: z.ZodSchema<TContext>;\n\n /**\n * Generate prompt sections from context.\n * context - Validated domain context\n * options - Generation options\n * Array of prompt sections\n */\n generate(\n context: TContext,\n options: GeneratorOptions\n ): Promise<PromptSection[]>;\n\n /**\n * Get technique recommendations for this domain.\n */\n recommendTechniques(context: TContext): PromptTechnique[];\n}\n\n/**\n * Options passed to generators.\n */\nexport interface GeneratorOptions {\n techniques: PromptTechnique[];\n provider: PromptProvider;\n includeTechniqueHints: boolean;\n}\n\n/**\n * A section of a prompt.\n */\nexport interface PromptSection {\n /** Section title (e.g., \"Context\", \"Goal\", \"Constraints\") */\n title: string;\n\n /** Section content */\n content: string;\n\n /** Section priority (higher = earlier in output) */\n priority: number;\n\n /** Whether this section is required */\n required: boolean;\n}\n```\n\n### Step 3.2: Implement PromptRegistry (T-024 Reference)\n\n```typescript\n// src/domain/prompts/registry.ts\n\nimport type { PromptDomain, PromptGenerator } from './types.js';\n\n/**\n * Registry for domain-specific prompt generators.\n *\n * Singleton pattern ensures consistent registration across the application.\n *\n * \n * ```typescript\n * const registry = PromptRegistry.getInstance();\n * registry.register(new HierarchicalGenerator());\n * const generator = registry.get('hierarchical');\n * ```\n */\nexport class PromptRegistry {\n private static instance: PromptRegistry | null = null;\n private generators: Map<PromptDomain, PromptGenerator> = new Map();\n\n private constructor() {}\n\n /**\n * Get the singleton registry instance.\n */\n static getInstance(): PromptRegistry {\n if (!PromptRegistry.instance) {\n PromptRegistry.instance = new PromptRegistry();\n }\n return PromptRegistry.instance;\n }\n\n /**\n * Reset the registry (for testing).\n */\n static resetInstance(): void {\n PromptRegistry.instance = null;\n }\n\n /**\n * Register a prompt generator for a domain.\n *\n * generator - Generator to register\n * Error if domain already registered\n */\n register(generator: PromptGenerator): void {\n if (this.generators.has(generator.domain)) {\n throw new Error(\n `Generator for domain '${generator.domain}' is already registered. ` +\n `Use forceRegister() to override.`\n );\n }\n this.generators.set(generator.domain, generator);\n }\n\n /**\n * Force register a generator, overwriting existing.\n */\n forceRegister(generator: PromptGenerator): void {\n this.generators.set(generator.domain, generator);\n }\n\n /**\n * Get a generator by domain.\n *\n * domain - Domain to look up\n * Error if domain not registered\n */\n get(domain: PromptDomain): PromptGenerator {\n const generator = this.generators.get(domain);\n if (!generator) {\n const available = this.list().join(', ');\n throw new Error(\n `No generator registered for domain '${domain}'. ` +\n `Available domains: ${available || 'none'}`\n );\n }\n return generator;\n }\n\n /**\n * Check if a domain is registered.\n */\n has(domain: PromptDomain): boolean {\n return this.generators.has(domain);\n }\n\n /**\n * List all registered domains.\n */\n list(): PromptDomain[] {\n return Array.from(this.generators.keys());\n }\n\n /**\n * Get count of registered generators.\n */\n get size(): number {\n return this.generators.size;\n }\n}\n```\n\n### Step 3.3: Implement TemplateEngine (T-025 Reference)\n\n```typescript\n// src/domain/prompts/template-engine.ts\n\nimport type { PromptOutputFormat, PromptSection, PromptMetadata } from './types.js';\n\n/**\n * Template rendering options.\n */\nexport interface RenderOptions {\n format: PromptOutputFormat;\n includeFrontmatter: boolean;\n includeMetadata: boolean;\n}\n\n/**\n * Engine for rendering prompt sections into final output.\n *\n * Handles:\n * - Section ordering by priority\n * - Frontmatter generation\n * - Format-specific rendering\n *\n * \n * ```typescript\n * const engine = new TemplateEngine();\n * const content = engine.render(sections, metadata, {\n * format: 'prompt-md',\n * includeFrontmatter: true,\n * includeMetadata: true,\n * });\n * ```\n */\nexport class TemplateEngine {\n /**\n * Render sections into final prompt output.\n *\n * sections - Prompt sections to render\n * metadata - Prompt metadata\n * options - Rendering options\n * Rendered prompt string\n */\n render(\n sections: PromptSection[],\n metadata: PromptMetadata,\n options: RenderOptions\n ): string {\n // Sort sections by priority (higher first)\n const sorted = [...sections].sort((a, b) => b.priority - a.priority);\n\n switch (options.format) {\n case 'json':\n return this.renderJson(sorted, metadata);\n case 'yaml':\n return this.renderYaml(sorted, metadata);\n case 'prompt-md':\n return this.renderPromptMd(sorted, metadata, options);\n case 'markdown':\n default:\n return this.renderMarkdown(sorted, metadata, options);\n }\n }\n\n /**\n * Estimate token count for content.\n * Uses rough approximation of 4 characters per token.\n */\n estimateTokens(content: string): number {\n return Math.ceil(content.length / 4);\n }\n\n private renderMarkdown(\n sections: PromptSection[],\n metadata: PromptMetadata,\n options: RenderOptions\n ): string {\n const parts: string[] = [];\n\n // Title\n if (metadata.title) {\n parts.push(`# ${metadata.title}\\n`);\n }\n\n // Sections\n for (const section of sections) {\n parts.push(`## ${section.title}\\n`);\n parts.push(section.content);\n parts.push('');\n }\n\n // Metadata footer\n if (options.includeMetadata) {\n parts.push('---');\n parts.push(`*Generated by UnifiedPromptBuilder v${metadata.version}*`);\n parts.push(`*Domain: ${metadata.domain} | Provider: ${metadata.provider}*`);\n parts.push(`*Generated: ${metadata.generatedAt}*`);\n }\n\n return parts.join('\\n');\n }\n\n private renderPromptMd(\n sections: PromptSection[],\n metadata: PromptMetadata,\n options: RenderOptions\n ): string {\n const parts: string[] = [];\n\n // YAML frontmatter\n if (options.includeFrontmatter) {\n parts.push('---');\n parts.push(`mode: agent`);\n parts.push(`model: ${this.getModelFromProvider(metadata.provider)}`);\n parts.push(`tools: [githubRepo, codebase, editFiles]`);\n parts.push(`description: \"${metadata.title || 'Generated prompt'}\"`);\n parts.push('---');\n parts.push('');\n }\n\n // Add markdown content\n parts.push(this.renderMarkdown(sections, metadata, { ...options, includeMetadata: false }));\n\n return parts.join('\\n');\n }\n\n private renderJson(sections: PromptSection[], metadata: PromptMetadata): string {\n return JSON.stringify(\n {\n metadata,\n sections: sections.map(s => ({\n title: s.title,\n content: s.content,\n })),\n },\n null,\n 2\n );\n }\n\n private renderYaml(sections: PromptSection[], metadata: PromptMetadata): string {\n const lines = [\n 'metadata:',\n ` domain: ${metadata.domain}`,\n ` provider: ${metadata.provider}`,\n ` version: ${metadata.version}`,\n ` generatedAt: ${metadata.generatedAt}`,\n '',\n 'sections:',\n ];\n\n for (const section of sections) {\n lines.push(` - title: \"${section.title}\"`);\n lines.push(` content: |`);\n for (const line of section.content.split('\\n')) {\n lines.push(` ${line}`);\n }\n }\n\n return lines.join('\\n');\n }\n\n private getModelFromProvider(provider: string): string {\n const modelMap: Record<string, string> = {\n 'gpt-4.1': 'gpt-4.1',\n 'gpt-5': 'gpt-5',\n 'claude-opus-4.1': 'claude-opus-4.1',\n 'claude-sonnet-4': 'claude-sonnet-4',\n 'gemini-2.5-pro': 'gemini-2.5-pro',\n 'other': 'gpt-4.1',\n };\n return modelMap[provider] || 'gpt-4.1';\n }\n}\n```\n\n### Step 3.4: Implement UnifiedPromptBuilder\n\n```typescript\n// src/domain/prompts/unified-prompt-builder.ts\n\nimport { z } from 'zod';\nimport { PromptRegistry } from './registry.js';\nimport { TemplateEngine, type RenderOptions } from './template-engine.js';\nimport type {\n PromptDomain,\n PromptGenerator,\n GeneratorOptions,\n PromptOutputFormat,\n PromptProvider,\n PromptRequest,\n PromptResult,\n PromptSection,\n PromptTechnique,\n} from './types.js';\n\n/**\n * Default values for prompt building.\n */\nconst DEFAULTS = {\n provider: 'claude-sonnet-4' as PromptProvider,\n outputFormat: 'prompt-md' as PromptOutputFormat,\n includeFrontmatter: true,\n includeMetadata: true,\n includeTechniqueHints: true,\n} as const;\n\n/**\n * Builder version for tracking.\n */\nconst VERSION = '0.14.0';\n\n/**\n * Unified entry point for all prompt generation.\n *\n * Replaces 12+ individual prompt builders with a single, extensible system.\n * Uses a registry pattern for domain-specific generators and a template\n * engine for consistent output rendering.\n *\n * \n * ```typescript\n * const builder = new UnifiedPromptBuilder();\n *\n * // Build a hierarchical prompt\n * const result = await builder.build({\n * domain: 'hierarchical',\n * context: {\n * goal: 'Implement authentication',\n * requirements: ['OAuth2 support', 'JWT tokens'],\n * },\n * techniques: ['chain-of-thought'],\n * provider: 'claude-sonnet-4',\n * });\n *\n * console.log(result.content);\n * ```\n */\nexport class UnifiedPromptBuilder {\n private readonly registry: PromptRegistry;\n private readonly templateEngine: TemplateEngine;\n\n constructor(\n registry?: PromptRegistry,\n templateEngine?: TemplateEngine\n ) {\n this.registry = registry ?? PromptRegistry.getInstance();\n this.templateEngine = templateEngine ?? new TemplateEngine();\n }\n\n /**\n * Build a prompt for the specified domain.\n *\n * request - Prompt build request\n * Generated prompt with metadata and stats\n * Error if domain not registered or validation fails\n */\n async build<TContext extends Record<string, unknown>>(\n request: PromptRequest<TContext>\n ): Promise<PromptResult> {\n const startTime = Date.now();\n\n // Get generator for domain\n const generator = this.registry.get(request.domain);\n\n // Validate context against generator schema\n const validatedContext = this.validateContext(generator, request.context);\n\n // Determine techniques to apply\n const techniques = this.selectTechniques(generator, validatedContext, request);\n\n // Build generator options\n const options: GeneratorOptions = {\n techniques,\n provider: request.provider ?? DEFAULTS.provider,\n includeTechniqueHints: request.includeTechniqueHints ?? DEFAULTS.includeTechniqueHints,\n };\n\n // Generate sections\n const sections = await generator.generate(validatedContext, options);\n\n // Build metadata\n const metadata = {\n domain: request.domain,\n provider: options.provider,\n generatedAt: new Date().toISOString(),\n version: VERSION,\n title: request.title,\n };\n\n // Render to final output\n const renderOptions: RenderOptions = {\n format: request.outputFormat ?? DEFAULTS.outputFormat,\n includeFrontmatter: request.includeFrontmatter ?? DEFAULTS.includeFrontmatter,\n includeMetadata: request.includeMetadata ?? DEFAULTS.includeMetadata,\n };\n\n const content = this.templateEngine.render(sections, metadata, renderOptions);\n\n return {\n content,\n metadata,\n techniques,\n stats: {\n estimatedTokens: this.templateEngine.estimateTokens(content),\n sectionCount: sections.length,\n generationTimeMs: Date.now() - startTime,\n },\n };\n }\n\n /**\n * Build multiple prompts in batch.\n *\n * requests - Array of prompt requests\n * Array of results (in same order as requests)\n */\n async buildBatch<TContext extends Record<string, unknown>>(\n requests: PromptRequest<TContext>[]\n ): Promise<PromptResult[]> {\n return Promise.all(requests.map(req => this.build(req)));\n }\n\n /**\n * Get list of available domains.\n */\n getAvailableDomains(): PromptDomain[] {\n return this.registry.list();\n }\n\n /**\n * Check if a domain is supported.\n */\n supportsDomain(domain: PromptDomain): boolean {\n return this.registry.has(domain);\n }\n\n /**\n * Get recommended techniques for a domain and context.\n */\n getRecommendedTechniques<TContext extends Record<string, unknown>>(\n domain: PromptDomain,\n context: TContext\n ): PromptTechnique[] {\n const generator = this.registry.get(domain);\n const validated = this.validateContext(generator, context);\n return generator.recommendTechniques(validated);\n }\n\n /**\n * Validate context against generator schema.\n */\n private validateContext<TContext>(\n generator: PromptGenerator,\n context: TContext\n ): TContext {\n try {\n return generator.contextSchema.parse(context) as TContext;\n } catch (error) {\n if (error instanceof z.ZodError) {\n const issues = error.issues\n .map(i => ` - ${i.path.join('.')}: ${i.message}`)\n .join('\\n');\n throw new Error(\n `Invalid context for domain '${generator.domain}':\\n${issues}`\n );\n }\n throw error;\n }\n }\n\n /**\n * Select techniques based on request and generator recommendations.\n */\n private selectTechniques<TContext>(\n generator: PromptGenerator,\n context: TContext,\n request: PromptRequest\n ): PromptTechnique[] {\n // Use explicit techniques if provided\n if (request.techniques && request.techniques.length > 0) {\n return request.techniques;\n }\n\n // Otherwise, get recommendations from generator\n return generator.recommendTechniques(context);\n }\n}\n\n/**\n * Create a pre-configured UnifiedPromptBuilder.\n *\n * Convenience function that ensures the registry is populated\n * with all built-in generators.\n */\nexport function createPromptBuilder(): UnifiedPromptBuilder {\n // In production, this would register all built-in generators\n // For now, return a builder with the default registry\n return new UnifiedPromptBuilder();\n}\n```\n\n### Step 3.5: Create Example Domain Generator\n\n```typescript\n// src/domain/prompts/generators/hierarchical.ts\n\nimport { z } from 'zod';\nimport type {\n GeneratorOptions,\n PromptGenerator,\n PromptSection,\n PromptTechnique,\n} from '../types.js';\n\n/**\n * Context schema for hierarchical prompts.\n */\nconst HierarchicalContextSchema = z.object({\n goal: z.string().min(1).describe('The primary goal or objective'),\n context: z.string().optional().describe('Background context'),\n requirements: z.array(z.string()).optional().describe('Specific requirements'),\n constraints: z.array(z.string()).optional().describe('Constraints to follow'),\n outputFormat: z.string().optional().describe('Expected output format'),\n audience: z.string().optional().describe('Target audience'),\n});\n\ntype HierarchicalContext = z.infer<typeof HierarchicalContextSchema>;\n\n/**\n * Generator for hierarchical prompts.\n *\n * Creates structured prompts with clear goal, context, requirements,\n * and constraints sections.\n */\nexport class HierarchicalGenerator implements PromptGenerator<HierarchicalContext> {\n readonly domain = 'hierarchical' as const;\n readonly version = '1.0.0';\n readonly contextSchema = HierarchicalContextSchema;\n\n async generate(\n context: HierarchicalContext,\n options: GeneratorOptions\n ): Promise<PromptSection[]> {\n const sections: PromptSection[] = [];\n\n // Goal section (highest priority)\n sections.push({\n title: 'Goal',\n content: context.goal,\n priority: 100,\n required: true,\n });\n\n // Context section\n if (context.context) {\n sections.push({\n title: 'Context',\n content: context.context,\n priority: 90,\n required: false,\n });\n }\n\n // Requirements section\n if (context.requirements && context.requirements.length > 0) {\n const reqList = context.requirements\n .map((r, i) => `${i + 1}. ${r}`)\n .join('\\n');\n sections.push({\n title: 'Requirements',\n content: reqList,\n priority: 80,\n required: false,\n });\n }\n\n // Constraints section\n if (context.constraints && context.constraints.length > 0) {\n const conList = context.constraints.map(c => `- ${c}`).join('\\n');\n sections.push({\n title: 'Constraints',\n content: conList,\n priority: 70,\n required: false,\n });\n }\n\n // Output format section\n if (context.outputFormat) {\n sections.push({\n title: 'Output Format',\n content: context.outputFormat,\n priority: 60,\n required: false,\n });\n }\n\n // Technique hints\n if (options.includeTechniqueHints && options.techniques.length > 0) {\n const hints = this.getTechniqueHints(options.techniques);\n if (hints) {\n sections.push({\n title: 'Approach Guidance',\n content: hints,\n priority: 50,\n required: false,\n });\n }\n }\n\n return sections;\n }\n\n recommendTechniques(context: HierarchicalContext): PromptTechnique[] {\n const techniques: PromptTechnique[] = [];\n\n // Complex goals benefit from chain-of-thought\n if (context.goal.length > 100 || context.requirements?.length! > 3) {\n techniques.push('chain-of-thought');\n }\n\n // Multiple constraints benefit from self-consistency\n if (context.constraints?.length! > 2) {\n techniques.push('self-consistency');\n }\n\n // Default to zero-shot if no specific recommendations\n if (techniques.length === 0) {\n techniques.push('zero-shot');\n }\n\n return techniques;\n }\n\n private getTechniqueHints(techniques: PromptTechnique[]): string | null {\n const hints: string[] = [];\n\n for (const technique of techniques) {\n switch (technique) {\n case 'chain-of-thought':\n hints.push('Think through this step by step, showing your reasoning.');\n break;\n case 'self-consistency':\n hints.push('Consider multiple approaches and verify consistency.');\n break;\n case 'tree-of-thoughts':\n hints.push('Explore different solution paths before committing.');\n break;\n case 'react':\n hints.push('Interleave reasoning and actions systematically.');\n break;\n }\n }\n\n return hints.length > 0 ? hints.join('\\n') : null;\n }\n}\n```\n\n### Step 3.6: Create Barrel Export\n\n```typescript\n// src/domain/prompts/index.ts\n\n// Core classes\nexport { UnifiedPromptBuilder, createPromptBuilder } from './unified-prompt-builder.js';\nexport { PromptRegistry } from './registry.js';\nexport { TemplateEngine } from './template-engine.js';\n\n// Types\nexport type {\n GeneratorOptions,\n PromptDomain,\n PromptGenerator,\n PromptMetadata,\n PromptOutputFormat,\n PromptProvider,\n PromptRequest,\n PromptResult,\n PromptSection,\n PromptStats,\n PromptTechnique,\n} from './types.js';\n\n// Generators\nexport { HierarchicalGenerator } from './generators/hierarchical.js';\n```\n\n---\n\n## 4. Testing Strategy\n\n### Step 4.1: Unit Tests\n\n```typescript\n// tests/vitest/domain/prompts/unified-prompt-builder.spec.ts\n\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport {\n UnifiedPromptBuilder,\n PromptRegistry,\n TemplateEngine,\n HierarchicalGenerator,\n} from '../../../../src/domain/prompts/index.js';\n\ndescribe('UnifiedPromptBuilder', () => {\n let builder: UnifiedPromptBuilder;\n let registry: PromptRegistry;\n\n beforeEach(() => {\n // Reset registry to clean state\n PromptRegistry.resetInstance();\n registry = PromptRegistry.getInstance();\n\n // Register test generator\n registry.register(new HierarchicalGenerator());\n\n builder = new UnifiedPromptBuilder(registry);\n });\n\n afterEach(() => {\n PromptRegistry.resetInstance();\n });\n\n describe('build()', () => {\n it('should generate a hierarchical prompt', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: {\n goal: 'Implement user authentication',\n requirements: ['OAuth2 support', 'JWT tokens'],\n },\n });\n\n expect(result.content).toContain('# Goal');\n expect(result.content).toContain('Implement user authentication');\n expect(result.content).toContain('Requirements');\n expect(result.metadata.domain).toBe('hierarchical');\n expect(result.stats.estimatedTokens).toBeGreaterThan(0);\n });\n\n it('should apply requested techniques', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: {\n goal: 'Complex multi-step task',\n },\n techniques: ['chain-of-thought'],\n includeTechniqueHints: true,\n });\n\n expect(result.techniques).toContain('chain-of-thought');\n expect(result.content).toContain('step by step');\n });\n\n it('should auto-recommend techniques when not specified', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: {\n goal: 'A very long and complex goal that requires deep analysis and multiple considerations to solve effectively',\n requirements: ['req1', 'req2', 'req3', 'req4'],\n },\n });\n\n // Should auto-recommend chain-of-thought for complex goals\n expect(result.techniques).toContain('chain-of-thought');\n });\n\n it('should throw for unregistered domain', async () => {\n await expect(\n builder.build({\n domain: 'nonexistent' as any,\n context: {},\n })\n ).rejects.toThrow(\"No generator registered for domain 'nonexistent'\");\n });\n\n it('should throw for invalid context', async () => {\n await expect(\n builder.build({\n domain: 'hierarchical',\n context: {\n // Missing required 'goal' field\n } as any,\n })\n ).rejects.toThrow(\"Invalid context for domain 'hierarchical'\");\n });\n });\n\n describe('output formats', () => {\n const baseContext = { goal: 'Test goal' };\n\n it('should render markdown format', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: baseContext,\n outputFormat: 'markdown',\n });\n\n expect(result.content).toContain('## Goal');\n expect(result.content).not.toContain('---\\nmode:');\n });\n\n it('should render prompt-md format with frontmatter', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: baseContext,\n outputFormat: 'prompt-md',\n includeFrontmatter: true,\n });\n\n expect(result.content).toContain('---');\n expect(result.content).toContain('mode: agent');\n });\n\n it('should render JSON format', async () => {\n const result = await builder.build({\n domain: 'hierarchical',\n context: baseContext,\n outputFormat: 'json',\n });\n\n const parsed = JSON.parse(result.content);\n expect(parsed.metadata.domain).toBe('hierarchical');\n expect(parsed.sections).toBeInstanceOf(Array);\n });\n });\n\n describe('getAvailableDomains()', () => {\n it('should list registered domains', () => {\n const domains = builder.getAvailableDomains();\n expect(domains).toContain('hierarchical');\n });\n });\n\n describe('supportsDomain()', () => {\n it('should return true for registered domain', () => {\n expect(builder.supportsDomain('hierarchical')).toBe(true);\n });\n\n it('should return false for unregistered domain', () => {\n expect(builder.supportsDomain('nonexistent' as any)).toBe(false);\n });\n });\n\n describe('buildBatch()', () => {\n it('should build multiple prompts', async () => {\n const results = await builder.buildBatch([\n { domain: 'hierarchical', context: { goal: 'Goal 1' } },\n { domain: 'hierarchical', context: { goal: 'Goal 2' } },\n ]);\n\n expect(results).toHaveLength(2);\n expect(results[0].content).toContain('Goal 1');\n expect(results[1].content).toContain('Goal 2');\n });\n });\n});\n```\n\n### Step 4.2: Run Tests\n\n```bash\n# Run tests\nnpm run test:vitest -- tests/vitest/domain/prompts/\n\n# Run with coverage\nnpm run test:coverage:vitest -- --include=\"src/domain/prompts/**\"\n\n# Expected output: >90% coverage\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------------------------------- | ------ | ------------------------------ |\n| Single entry point `UnifiedPromptBuilder` | ‚¨ú | Class exported from barrel |\n| `PromptRegistry` for domain registration | ‚¨ú | Singleton pattern works |\n| `TemplateEngine` for rendering | ‚¨ú | All formats render correctly |\n| Supports all output formats (md, json, yaml, prompt-md) | ‚¨ú | Unit tests pass |\n| Technique application | ‚¨ú | Techniques appear in output |\n| Auto-recommendation of techniques | ‚¨ú | Generator recommendations work |\n| Context validation with Zod | ‚¨ú | Invalid context throws |\n| 90% test coverage | ‚¨ú | Coverage report confirms |\n| TypeScript strict mode | ‚¨ú | `npm run type-check` passes |\n\n---\n\n## 6. Migration Path\n\n### Deprecating Old Builders\n\nAfter UnifiedPromptBuilder is complete, old builders will be wrapped as facades:\n\n```typescript\n// src/tools/prompt/legacy-facades/hierarchical-facade.ts\n\nimport { emitDeprecationWarning } from '../../shared/deprecation.js';\nimport { UnifiedPromptBuilder } from '../../../domain/prompts/index.js';\n\n/**\n * Use UnifiedPromptBuilder instead\n */\nexport async function hierarchicalPromptBuilder(args: unknown) {\n emitDeprecationWarning({\n tool: 'hierarchical-prompt-builder',\n replacement: 'UnifiedPromptBuilder with domain: \"hierarchical\"',\n deprecatedIn: 'v0.14.0',\n removedIn: 'v0.15.0',\n });\n\n const builder = new UnifiedPromptBuilder();\n const result = await builder.build({\n domain: 'hierarchical',\n context: args as Record<string, unknown>,\n });\n\n return { content: [{ type: 'text', text: result.content }] };\n}\n```\n\n---\n\n## 7. References\n\n| Document | Link |\n| ----------------------------------- | --------------------------------------------------------------------------------------------- |\n| ADR-003: Unified Prompt Ecosystem | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-003) |\n| Spec REQ-007, REQ-008, REQ-009 | [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) |\n| Current hierarchical-prompt-builder | [hierarchical-prompt-builder.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/hierarchical-prompt-builder.ts) |\n| Prompt utilities | [prompt-utils.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/prompt-utils.ts) |\n\n---\n\n*Task: T-026 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-026",
		"dependencies": ["T-024", "T-025"],
		"estimate_hours": 8,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-027: Implement Domain Generator: Hierarchical",
		"body": "# T-027: Implement Domain Generator: Hierarchical\n\n## Overview\n\n**Task ID**: T-027\n**Phase**: 2.5 - Unified Prompt Ecosystem\n**Priority**: P0 (Critical Path)\n**Estimate**: 4h\n**Dependencies**: T-026 (UnifiedPromptBuilder Core)\n**Blocks**: T-032 (Legacy Facade: Hierarchical)\n\n---\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nImplement `HierarchicalGenerator` - the domain generator for hierarchical prompts (independent ‚Üí modeling ‚Üí scaffolding levels) that plugs into UnifiedPromptBuilder.\n\n### Why\n\n- **REQ-007 Compliance**: Part of UnifiedPromptBuilder domain generators\n- **Pattern Reuse**: Extract reusable logic from existing 650-line builder\n- **Registry Integration**: Enable `domain: 'hierarchical'` routing\n\n### Source Analysis\n\n`src/tools/prompt/hierarchical-prompt-builder.ts` (650 lines):\n- 3 hierarchy levels: independent, modeling, scaffolding\n- Technique integration (chain-of-thought, few-shot, etc.)\n- Provider-specific tips (GPT, Claude, Gemini)\n- Metadata and frontmatter generation\n\n### Deliverables\n\n- `src/tools/prompt/unified/generators/hierarchical-generator.ts`\n- `src/tools/prompt/unified/generators/index.ts` (barrel)\n- Unit tests in `tests/vitest/tools/prompt/unified/generators/`\n\n## 2. Context and Scope\n\n### Current State\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// src/tools/prompt/hierarchical-prompt-builder.ts (650 lines)\nexport async function hierarchicalPromptBuilder(input: HierarchicalInput): Promise<CallToolResult>\n```\n\n### Target State\n\n```typescript\n// src/tools/prompt/unified/generators/hierarchical-generator.ts\nexport class HierarchicalGenerator implements DomainGenerator {\n generate(input: HierarchicalInput, context: GeneratorContext): Promise<PromptOutput>\n validate(input: unknown): ValidationResult\n}\n```\n\n### Out of Scope\n\n- Modifying existing `hierarchical-prompt-builder.ts`\n- Creating legacy facade (T-032)\n- Template engine implementation (T-025)\n\n## 3. Prerequisites\n\n### Dependencies\n\n| Task | Status | Purpose |\n| ----- | -------- | ------------------------------- |\n| T-026 | Complete | DomainGenerator interface |\n| T-024 | Complete | PromptRegistry for registration |\n| T-025 | Complete | TemplateEngine for rendering |\n\n### Target Files\n\n| File | Action | Purpose |\n| ----------------------------------------------------------------------------- | ------ | -------------- |\n| `src/tools/prompt/unified/generators/hierarchical-generator.ts` | Create | Generator impl |\n| `src/tools/prompt/unified/generators/index.ts` | Create | Barrel export |\n| `tests/vitest/tools/prompt/unified/generators/hierarchical-generator.spec.ts` | Create | Unit tests |\n\n### Reference Files\n\n| File | Purpose |\n| ------------------------------------------------- | ------------------------- |\n| `src/tools/prompt/hierarchical-prompt-builder.ts` | Existing logic to extract |\n| `src/tools/shared/prompt-sections.ts` | Shared section builders |\n| `src/tools/shared/prompt-utils.ts` | Utility functions |\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Generator Types\n\n```typescript\n// src/tools/prompt/unified/generators/hierarchical-generator.ts\n\nimport { z } from \"zod\";\nimport type { DomainGenerator, GeneratorContext, PromptOutput, ValidationResult } from \"../types.js\";\nimport {\n buildTechniqueHintsSection,\n buildProviderTipsSection,\n buildPitfallsSection,\n TechniqueEnum,\n ProviderEnum,\n} from \"../../../shared/prompt-sections.js\";\nimport { buildMetadataSection, buildFrontmatterWithPolicy } from \"../../../shared/prompt-utils.js\";\n\n/**\n * Hierarchy levels for structured prompting.\n */\nexport const HierarchyLevelEnum = z.enum([\n \"independent\", // Minimal guidance, agent-driven\n \"modeling\", // Examples and patterns provided\n \"scaffolding\", // Step-by-step structure\n]);\n\nexport type HierarchyLevel = z.infer<typeof HierarchyLevelEnum>;\n\n/**\n * Schema for hierarchical prompt input.\n */\nexport const HierarchicalInputSchema = z.object({\n level: HierarchyLevelEnum.describe(\"Hierarchy level: independent, modeling, or scaffolding\"),\n task: z.string().min(1).describe(\"Task description\"),\n context: z.string().optional().describe(\"Additional context\"),\n constraints: z.array(z.string()).optional().describe(\"Constraints or requirements\"),\n examples: z.array(z.object({\n input: z.string(),\n output: z.string(),\n explanation: z.string().optional(),\n })).optional().describe(\"Few-shot examples (for modeling level)\"),\n steps: z.array(z.string()).optional().describe(\"Explicit steps (for scaffolding level)\"),\n techniques: z.array(TechniqueEnum).optional().describe(\"Prompting techniques to include\"),\n provider: ProviderEnum.optional().describe(\"Target LLM provider\"),\n style: z.enum([\"markdown\", \"xml\"]).optional().default(\"markdown\"),\n includeReferences: z.boolean().optional().default(true),\n includeFrontmatter: z.boolean().optional().default(true),\n includeMetadata: z.boolean().optional().default(true),\n});\n\nexport type HierarchicalInput = z.infer<typeof HierarchicalInputSchema>;\n```\n\n### Step 4.2: Implement Generator Class\n\n```typescript\n// (continued in hierarchical-generator.ts)\n\n/**\n * Domain generator for hierarchical prompts.\n * Supports independent, modeling, and scaffolding levels.\n */\nexport class HierarchicalGenerator implements DomainGenerator {\n readonly name = \"hierarchical\";\n readonly version = \"1.0.0\";\n readonly schema = HierarchicalInputSchema;\n\n validate(input: unknown): ValidationResult {\n const result = HierarchicalInputSchema.safeParse(input);\n if (result.success) {\n return { valid: true, errors: [], warnings: [] };\n }\n return {\n valid: false,\n errors: result.error.errors.map(e => ({\n code: \"VALIDATION_ERROR\",\n message: e.message,\n field: e.path.join(\".\"),\n })),\n warnings: [],\n };\n }\n\n async generate(\n input: HierarchicalInput,\n context: GeneratorContext\n ): Promise<PromptOutput> {\n const validated = HierarchicalInputSchema.parse(input);\n\n // Build sections based on hierarchy level\n const sections = this.buildSections(validated);\n\n // Add technique hints if requested\n const techniqueHints = validated.techniques\n ? buildTechniqueHintsSection(validated.techniques)\n : \"\";\n\n // Add provider tips if specified\n const providerTips = validated.provider\n ? buildProviderTipsSection(validated.provider)\n : \"\";\n\n // Build metadata\n const metadata = validated.includeMetadata\n ? buildMetadataSection({\n level: validated.level,\n provider: validated.provider,\n techniques: validated.techniques,\n sourceTool: \"unified-prompt-builder\",\n })\n : \"\";\n\n // Build frontmatter\n const frontmatter = validated.includeFrontmatter\n ? buildFrontmatterWithPolicy({\n title: `Hierarchical Prompt (${validated.level})`,\n level: validated.level,\n })\n : \"\";\n\n // Assemble content\n const content = this.assembleContent({\n frontmatter,\n metadata,\n sections,\n techniqueHints,\n providerTips,\n style: validated.style,\n });\n\n return {\n content,\n format: validated.style,\n metadata: {\n level: validated.level,\n provider: validated.provider,\n generatedAt: new Date().toISOString(),\n },\n };\n }\n\n private buildSections(input: HierarchicalInput): string {\n const parts: string[] = [];\n\n // Task section (always present)\n parts.push(`## Task\\n\\n${input.task}`);\n\n // Context (if provided)\n if (input.context) {\n parts.push(`## Context\\n\\n${input.context}`);\n }\n\n // Constraints (if provided)\n if (input.constraints?.length) {\n parts.push(`## Constraints\\n\\n${input.constraints.map(c => `- ${c}`).join(\"\\n\")}`);\n }\n\n // Level-specific sections\n switch (input.level) {\n case \"independent\":\n parts.push(this.buildIndependentSection());\n break;\n case \"modeling\":\n parts.push(this.buildModelingSection(input.examples));\n break;\n case \"scaffolding\":\n parts.push(this.buildScaffoldingSection(input.steps));\n break;\n }\n\n return parts.join(\"\\n\\n\");\n }\n\n private buildIndependentSection(): string {\n return `## Approach\\n\\nUse your best judgment to complete this task. You have full autonomy over the approach and implementation details.`;\n }\n\n private buildModelingSection(examples?: HierarchicalInput[\"examples\"]): string {\n if (!examples?.length) {\n return `## Examples\\n\\n*No examples provided. Consider adding examples for better results.*`;\n }\n\n const exampleBlocks = examples.map((ex, i) => {\n let block = `### Example ${i + 1}\\n\\n**Input:** ${ex.input}\\n\\n**Output:** ${ex.output}`;\n if (ex.explanation) {\n block += `\\n\\n**Explanation:** ${ex.explanation}`;\n }\n return block;\n });\n\n return `## Examples\\n\\n${exampleBlocks.join(\"\\n\\n\")}`;\n }\n\n private buildScaffoldingSection(steps?: string[]): string {\n if (!steps?.length) {\n return `## Steps\\n\\n*No steps provided. Consider adding explicit steps for scaffolding level.*`;\n }\n\n const stepList = steps.map((step, i) => `${i + 1}. ${step}`).join(\"\\n\");\n return `## Steps\\n\\nFollow these steps in order:\\n\\n${stepList}`;\n }\n\n private assembleContent(parts: {\n frontmatter: string;\n metadata: string;\n sections: string;\n techniqueHints: string;\n providerTips: string;\n style: \"markdown\" | \"xml\";\n }): string {\n const { frontmatter, metadata, sections, techniqueHints, providerTips } = parts;\n\n return [\n frontmatter,\n metadata,\n sections,\n techniqueHints,\n providerTips,\n ].filter(Boolean).join(\"\\n\\n\");\n }\n}\n\n// Export singleton instance for registration\nexport const hierarchicalGenerator = new HierarchicalGenerator();\n```\n\n### Step 4.3: Create Barrel Export\n\n```typescript\n// src/tools/prompt/unified/generators/index.ts\n\nexport {\n HierarchicalGenerator,\n hierarchicalGenerator,\n HierarchicalInputSchema,\n HierarchyLevelEnum,\n type HierarchicalInput,\n type HierarchyLevel,\n} from \"./hierarchical-generator.js\";\n\n// Future generators:\n// export { SecurityGenerator } from \"./security-generator.js\";\n// export { ArchitectureGenerator } from \"./architecture-generator.js\";\n```\n\n### Step 4.4: Register with PromptRegistry\n\n```typescript\n// In unified-prompt-builder.ts or initialization\nimport { hierarchicalGenerator } from \"./generators/index.js\";\n\nPromptRegistry.getInstance().register({\n name: \"hierarchical\",\n version: \"1.0.0\",\n generator: hierarchicalGenerator,\n schema: HierarchicalInputSchema,\n});\n```\n\n## 5. Testing Strategy\n\n```typescript\n// tests/vitest/tools/prompt/unified/generators/hierarchical-generator.spec.ts\n\nimport { describe, it, expect } from \"vitest\";\nimport {\n HierarchicalGenerator,\n HierarchicalInputSchema,\n} from \"../../../../../../src/tools/prompt/unified/generators/hierarchical-generator.js\";\n\ndescribe(\"HierarchicalGenerator\", () => {\n const generator = new HierarchicalGenerator();\n\n describe(\"validate()\", () => {\n it(\"accepts valid independent input\", () => {\n const result = generator.validate({\n level: \"independent\",\n task: \"Write a function\",\n });\n expect(result.valid).toBe(true);\n });\n\n it(\"rejects missing required fields\", () => {\n const result = generator.validate({ level: \"independent\" });\n expect(result.valid).toBe(false);\n expect(result.errors[0].field).toBe(\"task\");\n });\n });\n\n describe(\"generate()\", () => {\n const mockContext = { templateEngine: {}, config: {}, metadata: {} } as any;\n\n it(\"generates independent level prompt\", async () => {\n const result = await generator.generate(\n { level: \"independent\", task: \"Test task\" },\n mockContext\n );\n expect(result.content).toContain(\"Test task\");\n expect(result.content).toContain(\"full autonomy\");\n });\n\n it(\"generates modeling level with examples\", async () => {\n const result = await generator.generate(\n {\n level: \"modeling\",\n task: \"Classify sentiment\",\n examples: [{ input: \"Great!\", output: \"positive\" }],\n },\n mockContext\n );\n expect(result.content).toContain(\"Example 1\");\n expect(result.content).toContain(\"Great!\");\n });\n\n it(\"generates scaffolding level with steps\", async () => {\n const result = await generator.generate(\n {\n level: \"scaffolding\",\n task: \"Build API\",\n steps: [\"Design schema\", \"Implement endpoints\"],\n },\n mockContext\n );\n expect(result.content).toContain(\"1. Design schema\");\n expect(result.content).toContain(\"2. Implement endpoints\");\n });\n });\n});\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| ------------------------------ | ---------- | ------ | -------------------------------- |\n| Logic divergence from original | Medium | Medium | Comprehensive comparison tests |\n| Missing edge cases | Medium | Low | Port existing tests |\n| Interface mismatch | Low | High | Pin to DomainGenerator interface |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------- | ------ | -------------------- |\n| Generates all 3 hierarchy levels | ‚¨ú | Unit tests pass |\n| Validates input correctly | ‚¨ú | Schema tests pass |\n| Integrates with PromptRegistry | ‚¨ú | Registration test |\n| Output matches original builder | ‚¨ú | Comparison test |\n| TypeScript strict passes | ‚¨ú | `npm run type-check` |\n| Test coverage ‚â•90% | ‚¨ú | Coverage report |\n\n---\n\n## 8. References\n\n- [T-026 UnifiedPromptBuilder](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md)\n- [T-023 Architecture](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-023-design-unifiedpromptbuilder-architecture.md)\n- [hierarchical-prompt-builder.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/hierarchical-prompt-builder.ts)\n- [prompt-sections.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/prompt-sections.ts)\n\n---\n\n*Task: T-027 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-027",
		"dependencies": ["T-026"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-027-implement-domain-generator-hierarchical.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-027-implement-domain-generator-hierarchical.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-028: Implement Domain Generator: Security",
		"body": "# T-028: Implement Domain Generator: Security\n\n## Overview\n\n**Task ID**: T-028\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-028-implement-domain-generator-security.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement Domain Generator: Security' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-028\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement Domain Generator: Security fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Security Domain Generator Template\n\nCreate `src/tools/templates/generators/security-domain.hbs`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```handlebars\n{{! Security Domain Generator Template }}\n{{#with domain}}\n// Security Domain: {{name}}\n// Generated: {{../metadata.timestamp}}\n\nimport { z } from 'zod';\nimport type { SecurityConfig, ThreatModel, ComplianceFramework } from './types.js';\n\n/**\n * {{description}}\n * Compliance: {{#each compliance}}{{this}}{{#unless }}, {{/unless}}{{/each}}\n */\n\n// Security Schemas\nexport const threatModelSchema = z.object({\n threatId: z.string().describe('Unique threat identifier'),\n category: z.enum(['STRIDE', 'OWASP', 'CWE', 'CUSTOM']).describe('Threat category'),\n severity: z.enum(['critical', 'high', 'medium', 'low']).describe('Threat severity'),\n likelihood: z.enum(['certain', 'likely', 'possible', 'unlikely']).describe('Occurrence likelihood'),\n impact: z.string().describe('Impact description'),\n mitigation: z.string().describe('Mitigation strategy'),\n});\n\nexport const securityConfigSchema = z.object({\n enableThreatModeling: z.boolean().default(true).describe('Enable threat modeling'),\n complianceFrameworks: z.array(z.string()).describe('Compliance frameworks'),\n securityLevel: z.enum(['basic', 'standard', 'strict']).default('standard'),\n auditLogging: z.boolean().default(true).describe('Enable audit logging'),\n});\n\n{{#each entities}}\n// Security Entity: {{name}}\nexport interface {{pascalCase name}}Security {\n {{#each properties}}\n /** {{description}} */\n {{name}}: {{type}};\n {{/each}}\n}\n{{/each}}\n\n// Security Functions\n{{#each functions}}\n/**\n * {{description}}\n * {{securityLevel}}\n */\nexport function {{name}}({{#each params}}{{name}}: {{type}}{{#unless }}, {{/unless}}{{/each}}): {{returnType}} {\n // Security validation\n {{#if requiresAudit}}\n auditLog('{{name}}', { params: arguments });\n {{/if}}\n // Implementation\n}\n{{/each}}\n{{/with}}\n```\n\n### Step 4.2: Create Security Generator Logic\n\nCreate `src/tools/templates/generators/security-generator.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\nimport { z } from 'zod';\nimport type { GeneratorResult, SecurityDomainConfig } from '../types.js';\n\nexport const securityDomainConfigSchema = z.object({\n name: z.string().min(1).describe('Security domain name'),\n description: z.string().describe('Domain description'),\n compliance: z.array(z.enum(['OWASP', 'SOC2', 'GDPR', 'HIPAA', 'PCI-DSS'])).describe('Compliance frameworks'),\n threatCategories: z.array(z.enum(['STRIDE', 'OWASP-Top10', 'CWE-Top25'])).optional(),\n securityLevel: z.enum(['basic', 'standard', 'strict']).default('standard'),\n entities: z.array(z.object({\n name: z.string(),\n properties: z.array(z.object({\n name: z.string(),\n type: z.string(),\n description: z.string(),\n sensitive: z.boolean().optional(),\n })),\n })).optional(),\n functions: z.array(z.object({\n name: z.string(),\n description: z.string(),\n params: z.array(z.object({ name: z.string(), type: z.string() })),\n returnType: z.string(),\n securityLevel: z.string(),\n requiresAudit: z.boolean().optional(),\n })).optional(),\n});\n\nexport async function generateSecurityDomain(\n config: SecurityDomainConfig,\n templatePath: string\n): Promise<GeneratorResult> {\n const validated = securityDomainConfigSchema.parse(config);\n\n const context = {\n domain: validated,\n metadata: {\n timestamp: new Date().toISOString(),\n generator: 'security-domain-generator',\n version: '0.14.0',\n },\n };\n\n const template = await loadTemplate(templatePath);\n const compiled = Handlebars.compile(template);\n const output = compiled(context);\n\n return {\n success: true,\n output,\n metadata: context.metadata,\n compliance: validated.compliance,\n };\n}\n```\n\n### Step 4.3: Register Security Generator\n\nUpdate `src/tools/templates/generators/index.ts`:\n\n```typescript\nexport { generateSecurityDomain, securityDomainConfigSchema } from './security-generator.js';\n```\n\n### Step 4.4: Add Security-Specific Helpers\n\nUpdate `src/tools/templates/helpers/security-helpers.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\n\nexport function registerSecurityHelpers(): void {\n Handlebars.registerHelper('threatSeverityColor', (severity: string) => {\n const colors: Record<string, string> = {\n critical: 'red', high: 'orange', medium: 'yellow', low: 'green'\n };\n return colors[severity] || 'gray';\n });\n\n Handlebars.registerHelper('complianceBadge', (framework: string) => {\n return `[${framework}]`;\n });\n\n Handlebars.registerHelper('sensitiveField', (isSensitive: boolean) => {\n return isSensitive ? '' : '';\n });\n}\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-028 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-028",
		"dependencies": ["T-026"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-028-implement-domain-generator-security.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-028-implement-domain-generator-security.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-029: Implement Domain Generator: Architecture",
		"body": "# T-029: Implement Domain Generator: Architecture\n\n**Task ID**: T-029\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-029-implement-domain-generator-architecture.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement Domain Generator: Architecture' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-029\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement Domain Generator: Architecture fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Review Requirements\n\n- Re-read `spec.md` and relevant ADRs\n- Identify constraints, assumptions, and open questions\n\n### Step 4.2: Draft Architecture\n\n- Produce an ADR with alternatives considered\n- Capture interface contracts and data flow\n\n### Step 4.3: Socialize\n\n- Share the draft with reviewers\n- Incorporate feedback before implementation\n\n## 5. Testing Strategy\n\n- Confirm architecture review approval\n- Align with spec requirements\n- Ensure follow-on implementation tasks reference the design\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Architecture decision documented | ‚¨ú | ADR file exists |\n| Design aligns with spec and ADRs | ‚¨ú | Code review |\n| Stakeholder review completed | ‚¨ú | PR approval |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-029 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-029",
		"dependencies": ["T-026"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-029-implement-domain-generator-architecture.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-029-implement-domain-generator-architecture.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-030: Implement Domain Generator: Code Analysis",
		"body": "# T-030: Implement Domain Generator: Code Analysis\n\n## Overview\n\n**Task ID**: T-030\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-030-implement-domain-generator-code-analysis.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement Domain Generator: Code Analysis' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-030\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement Domain Generator: Code Analysis fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Code Analysis Domain Generator Template\n\nCreate `src/tools/templates/generators/code-analysis-domain.hbs`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```handlebars\n{{! Code Analysis Domain Generator Template }}\n{{#with domain}}\n// Code Analysis Domain: {{name}}\n// Generated: {{../metadata.timestamp}}\n\nimport { z } from 'zod';\nimport type { AnalysisConfig, CodeMetric, QualityRule } from './types.js';\n\n/**\n * {{description}}\n * Analysis Types: {{#each analysisTypes}}{{this}}{{#unless }}, {{/unless}}{{/each}}\n */\n\n// Analysis Configuration Schema\nexport const analysisConfigSchema = z.object({\n target: z.string().describe('Target file or directory'),\n analysisTypes: z.array(z.enum(['complexity', 'coverage', 'dependencies', 'security', 'style'])),\n thresholds: z.object({\n complexity: z.number().optional().describe('Max cyclomatic complexity'),\n coverage: z.number().optional().describe('Min coverage percentage'),\n duplicateThreshold: z.number().optional().describe('Max duplicate lines'),\n }).optional(),\n ignorePatterns: z.array(z.string()).optional().describe('Glob patterns to ignore'),\n});\n\n// Code Metric Schema\nexport const codeMetricSchema = z.object({\n name: z.string().describe('Metric name'),\n value: z.number().describe('Metric value'),\n unit: z.string().optional().describe('Unit of measurement'),\n threshold: z.number().optional().describe('Threshold for warnings'),\n status: z.enum(['pass', 'warn', 'fail']).describe('Metric status'),\n});\n\n{{#each analyzers}}\n// Analyzer: {{name}}\nexport interface {{pascalCase name}}Analyzer {\n {{#each properties}}\n /** {{description}} */\n {{name}}: {{type}};\n {{/each}}\n analyze(source: string): AnalysisResult;\n}\n{{/each}}\n\n// Analysis Functions\n{{#each functions}}\n/**\n * {{description}}\n * {{complexity}}\n */\nexport function {{name}}({{#each params}}{{name}}: {{type}}{{#unless }}, {{/unless}}{{/each}}): {{returnType}} {\n // Analysis implementation\n}\n{{/each}}\n{{/with}}\n```\n\n### Step 4.2: Create Code Analysis Generator Logic\n\nCreate `src/tools/templates/generators/code-analysis-generator.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\nimport { z } from 'zod';\nimport type { GeneratorResult, CodeAnalysisDomainConfig } from '../types.js';\n\nexport const codeAnalysisDomainConfigSchema = z.object({\n name: z.string().min(1).describe('Analysis domain name'),\n description: z.string().describe('Domain description'),\n analysisTypes: z.array(z.enum([\n 'complexity', 'coverage', 'dependencies', 'security',\n 'style', 'duplication', 'documentation'\n ])).describe('Types of analysis to include'),\n analyzers: z.array(z.object({\n name: z.string(),\n properties: z.array(z.object({\n name: z.string(),\n type: z.string(),\n description: z.string(),\n })),\n })).optional(),\n functions: z.array(z.object({\n name: z.string(),\n description: z.string(),\n params: z.array(z.object({ name: z.string(), type: z.string() })),\n returnType: z.string(),\n complexity: z.string().optional(),\n })).optional(),\n thresholds: z.object({\n complexity: z.number().optional(),\n coverage: z.number().optional(),\n duplication: z.number().optional(),\n }).optional(),\n});\n\nexport async function generateCodeAnalysisDomain(\n config: CodeAnalysisDomainConfig,\n templatePath: string\n): Promise<GeneratorResult> {\n const validated = codeAnalysisDomainConfigSchema.parse(config);\n\n const context = {\n domain: validated,\n metadata: {\n timestamp: new Date().toISOString(),\n generator: 'code-analysis-domain-generator',\n version: '0.14.0',\n },\n };\n\n const template = await loadTemplate(templatePath);\n const compiled = Handlebars.compile(template);\n const output = compiled(context);\n\n return {\n success: true,\n output,\n metadata: context.metadata,\n analysisTypes: validated.analysisTypes,\n };\n}\n```\n\n### Step 4.3: Register Code Analysis Generator\n\nUpdate `src/tools/templates/generators/index.ts`:\n\n```typescript\nexport { generateCodeAnalysisDomain, codeAnalysisDomainConfigSchema } from './code-analysis-generator.js';\n```\n\n### Step 4.4: Add Analysis-Specific Helpers\n\nUpdate `src/tools/templates/helpers/analysis-helpers.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\n\nexport function registerAnalysisHelpers(): void {\n Handlebars.registerHelper('metricStatus', (value: number, threshold: number) => {\n if (value <= threshold * 0.8) return 'pass';\n if (value <= threshold) return 'warn';\n return 'fail';\n });\n\n Handlebars.registerHelper('complexityGrade', (complexity: number) => {\n if (complexity <= 5) return 'A';\n if (complexity <= 10) return 'B';\n if (complexity <= 20) return 'C';\n return 'D';\n });\n}\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-030 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-030",
		"dependencies": ["T-026"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-030-implement-domain-generator-code-analysis.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-030-implement-domain-generator-code-analysis.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-031: Implement Domain Generator: Domain Neutral",
		"body": "# T-031: Implement Domain Generator: Domain Neutral\n\n## Overview\n\n**Task ID**: T-031\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 3h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-031-implement-domain-generator-domain-neutral.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement Domain Generator: Domain Neutral' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-031\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement Domain Generator: Domain Neutral fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Domain-Neutral Generator Template\n\nCreate `src/tools/templates/generators/domain-neutral.hbs`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```handlebars\n{{! Domain-Neutral Generator Template }}\n{{#with domain}}\n// Domain: {{name}}\n// Generated: {{../metadata.timestamp}}\n// Purpose: {{purpose}}\n\nimport { z } from 'zod';\n\n/**\n * {{description}}\n * Domain Type: {{domainType}}\n * Cross-Domain: {{crossDomain}}\n */\n\n// Configuration Schema\nexport const {{camelCase name}}ConfigSchema = z.object({\n {{#each configFields}}\n {{name}}: {{zodType}}.describe('{{description}}'),\n {{/each}}\n});\n\n// Domain Types\n{{#each types}}\nexport type {{name}} = {\n {{#each properties}}\n /** {{description}} */\n {{name}}: {{type}};\n {{/each}}\n};\n{{/each}}\n\n// Domain Interfaces\n{{#each interfaces}}\n/**\n * {{description}}\n */\nexport interface {{name}} {\n {{#each methods}}\n /** {{description}} */\n {{name}}({{#each params}}{{name}}: {{type}}{{#unless }}, {{/unless}}{{/each}}): {{returnType}};\n {{/each}}\n}\n{{/each}}\n\n// Domain Functions\n{{#each functions}}\n/**\n * {{description}}\n{{#if domain}}\n * {{domain}}\n{{/if}}\n */\nexport function {{name}}({{#each params}}{{name}}: {{type}}{{#unless }}, {{/unless}}{{/each}}): {{returnType}} {\n // Domain-neutral implementation\n}\n{{/each}}\n{{/with}}\n```\n\n### Step 4.2: Create Domain-Neutral Generator Logic\n\nCreate `src/tools/templates/generators/domain-neutral-generator.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\nimport { z } from 'zod';\nimport type { GeneratorResult, DomainNeutralConfig } from '../types.js';\n\nexport const domainNeutralConfigSchema = z.object({\n name: z.string().min(1).describe('Domain name'),\n description: z.string().describe('Domain description'),\n purpose: z.string().describe('Primary purpose'),\n domainType: z.enum(['utility', 'workflow', 'integration', 'analysis', 'generation']),\n crossDomain: z.boolean().default(false).describe('Is cross-domain applicable'),\n configFields: z.array(z.object({\n name: z.string(),\n zodType: z.string(),\n description: z.string(),\n })).optional(),\n types: z.array(z.object({\n name: z.string(),\n properties: z.array(z.object({\n name: z.string(),\n type: z.string(),\n description: z.string(),\n })),\n })).optional(),\n interfaces: z.array(z.object({\n name: z.string(),\n description: z.string(),\n methods: z.array(z.object({\n name: z.string(),\n description: z.string(),\n params: z.array(z.object({ name: z.string(), type: z.string() })),\n returnType: z.string(),\n })),\n })).optional(),\n functions: z.array(z.object({\n name: z.string(),\n description: z.string(),\n params: z.array(z.object({ name: z.string(), type: z.string() })),\n returnType: z.string(),\n domain: z.string().optional(),\n })).optional(),\n});\n\nexport async function generateDomainNeutral(\n config: DomainNeutralConfig,\n templatePath: string\n): Promise<GeneratorResult> {\n const validated = domainNeutralConfigSchema.parse(config);\n\n const context = {\n domain: validated,\n metadata: {\n timestamp: new Date().toISOString(),\n generator: 'domain-neutral-generator',\n version: '0.14.0',\n },\n };\n\n const template = await loadTemplate(templatePath);\n const compiled = Handlebars.compile(template);\n const output = compiled(context);\n\n return {\n success: true,\n output,\n metadata: context.metadata,\n domainType: validated.domainType,\n };\n}\n```\n\n### Step 4.3: Register Domain-Neutral Generator\n\nUpdate `src/tools/templates/generators/index.ts`:\n\n```typescript\nexport { generateDomainNeutral, domainNeutralConfigSchema } from './domain-neutral-generator.js';\n```\n\n### Step 4.4: Add Domain-Neutral Helpers\n\nUpdate `src/tools/templates/helpers/domain-helpers.ts`:\n\n```typescript\nimport Handlebars from 'handlebars';\n\nexport function registerDomainNeutralHelpers(): void {\n Handlebars.registerHelper('zodType', (type: string) => {\n const zodMap: Record<string, string> = {\n string: 'z.string()', number: 'z.number()', boolean: 'z.boolean()',\n array: 'z.array(z.unknown())', object: 'z.object({})',\n };\n return zodMap[type] || 'z.unknown()';\n });\n\n Handlebars.registerHelper('domainTag', (domainType: string) => {\n return `-${domainType}`;\n });\n}\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-031 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-031",
		"dependencies": ["T-026"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-031-implement-domain-generator-domain-neutral.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-031-implement-domain-generator-domain-neutral.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-033: Create Legacy Facade: DomainNeutralPromptBuilder",
		"body": "# T-033: Create Legacy Facade: DomainNeutralPromptBuilder\n\n## Overview\n\n**Task ID**: T-033\n**Phase**: 2.5 - Unified Prompt Ecosystem\n**Priority**: P0 (Critical Path)\n**Estimate**: 4h\n**Dependencies**: T-026 (UnifiedPromptBuilder Core)\n**Blocks**: T-035 (Test UnifiedPromptBuilder)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-033-create-legacy-facade-domainneutralpromptbuilder.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nCreate a backward-compatible facade `domain-neutral-facade.ts` that wraps the new `UnifiedPromptBuilder` while preserving the existing `domainNeutralPromptBuilder` API. This enables gradual migration without breaking existing tool consumers.\n\n### Why\n\n- **Backward Compatibility**: Existing MCP clients using `domain-neutral-prompt-builder` continue working\n- **Deprecation Path**: Facade emits deprecation warnings guiding users to UnifiedPromptBuilder\n- **Risk Reduction**: Parallel operation allows rollback if issues arise\n- **REQ-008 Compliance**: Spec requires legacy facades with deprecation warnings\n\n### Deliverables\n\n- `src/tools/prompt/facades/domain-neutral-facade.ts` - Facade implementation\n- `src/tools/prompt/facades/index.ts` - Barrel export\n- Updated `src/tools/prompt/index.ts` to export facade\n- Unit tests in `tests/vitest/tools/prompt/facades/domain-neutral-facade.spec.ts`\n\n## 2. Context and Scope\n\n### Current State\n\nThe existing `domain-neutral-prompt-builder.ts` (445 lines) exports:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// src/tools/prompt/domain-neutral-prompt-builder.ts\nexport async function domainNeutralPromptBuilder(\n input: DomainNeutralInput\n): Promise<CallToolResult>\n```\n\nKey schema fields: `title`, `summary`, `objectives`, `workflow`, `capabilities`, `risks`, `successMetrics`\n\n### Target State\n\n```\nsrc/tools/prompt/\n‚îú‚îÄ‚îÄ domain-neutral-prompt-builder.ts (existing - unchanged)\n‚îú‚îÄ‚îÄ facades/\n‚îÇ ‚îú‚îÄ‚îÄ domain-neutral-facade.ts (NEW - wraps UnifiedPromptBuilder)\n‚îÇ ‚îî‚îÄ‚îÄ index.ts (NEW - barrel)\n‚îî‚îÄ‚îÄ index.ts (updated exports)\n```\n\n### Out of Scope\n\n- Modifying `domain-neutral-prompt-builder.ts` internals\n- Breaking API changes to existing schema\n- Full UnifiedPromptBuilder implementation (T-026)\n\n## 3. Prerequisites\n\n### Dependencies\n\n| Task | Status | Required For |\n| ----- | ---------------- | ------------------------ |\n| T-026 | Must be complete | UnifiedPromptBuilder API |\n| T-024 | Must be complete | PromptRegistry |\n| T-025 | Must be complete | TemplateEngine |\n\n### Target Files\n\n| File | Action | Purpose |\n| ----------------------------------------------------------------- | ------ | --------------------- |\n| `src/tools/prompt/facades/domain-neutral-facade.ts` | Create | Facade implementation |\n| `src/tools/prompt/facades/index.ts` | Create | Barrel exports |\n| `src/tools/prompt/index.ts` | Modify | Add facade export |\n| `tests/vitest/tools/prompt/facades/domain-neutral-facade.spec.ts` | Create | Unit tests |\n\n### Tooling\n\n- Node.js 22.x\n- TypeScript strict mode\n- Vitest for testing\n- `npm run quality` for validation\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Facade Directory Structure\n\n```bash\nmkdir -p src/tools/prompt/facades\nmkdir -p tests/vitest/tools/prompt/facades\n```\n\n### Step 4.2: Implement Domain-Neutral Facade\n\n```typescript\n// src/tools/prompt/facades/domain-neutral-facade.ts\n\nimport type { CallToolResult } from \"/sdk/types.js\";\nimport { z } from \"zod\";\nimport { warnDeprecated } from \"../../shared/deprecation-helpers.js\";\nimport type { UnifiedPromptBuilder } from \"../unified/unified-prompt-builder.js\";\n\n/**\n * Legacy facade for DomainNeutralPromptBuilder.\n * Wraps UnifiedPromptBuilder while preserving backward compatibility.\n *\n * Use UnifiedPromptBuilder directly with domain='domain-neutral'\n * v0.16.0\n */\n\n// Re-export original schema for backward compatibility\nexport const DomainNeutralFacadeSchema = z.object({\n title: z.string().describe(\"Prompt title\"),\n summary: z.string().describe(\"Brief summary of the prompt purpose\"),\n objectives: z.array(z.string()).optional().describe(\"List of objectives\"),\n nonGoals: z.array(z.string()).optional().describe(\"Explicit non-goals\"),\n background: z.string().optional().describe(\"Background context\"),\n workflow: z.array(z.string()).optional().describe(\"Workflow steps\"),\n capabilities: z.array(z.object({\n name: z.string(),\n purpose: z.string(),\n preconditions: z.string().optional(),\n inputs: z.string().optional(),\n processing: z.string().optional(),\n outputs: z.string().optional(),\n })).optional().describe(\"Capability definitions\"),\n risks: z.array(z.object({\n description: z.string(),\n mitigation: z.string().optional(),\n })).optional().describe(\"Risk factors\"),\n successMetrics: z.array(z.string()).optional().describe(\"Success criteria\"),\n // Prompt configuration\n style: z.enum([\"markdown\", \"xml\"]).optional().default(\"markdown\"),\n provider: z.string().optional(),\n techniques: z.array(z.string()).optional(),\n includeReferences: z.boolean().optional().default(true),\n includeFrontmatter: z.boolean().optional().default(true),\n includeMetadata: z.boolean().optional().default(true),\n});\n\nexport type DomainNeutralFacadeInput = z.infer<typeof DomainNeutralFacadeSchema>;\n\nexport class DomainNeutralFacade {\n private readonly unifiedBuilder: UnifiedPromptBuilder;\n private deprecationWarned = false;\n\n constructor(unifiedBuilder: UnifiedPromptBuilder) {\n this.unifiedBuilder = unifiedBuilder;\n }\n\n /**\n * Generate domain-neutral prompt using legacy API.\n * Internally delegates to UnifiedPromptBuilder.\n */\n async generate(input: DomainNeutralFacadeInput): Promise<CallToolResult> {\n // Emit deprecation warning once per instance\n if (!this.deprecationWarned) {\n warnDeprecated({\n oldName: \"domainNeutralPromptBuilder\",\n newName: \"UnifiedPromptBuilder.generate({ domain: 'domain-neutral', ... })\",\n removalVersion: \"v0.16.0\",\n migrationGuide: \"See docs/migration/prompt-builders.md\",\n });\n this.deprecationWarned = true;\n }\n\n // Transform legacy input to unified format\n const unifiedInput = this.transformInput(input);\n\n // Delegate to UnifiedPromptBuilder\n return this.unifiedBuilder.generate(unifiedInput);\n }\n\n private transformInput(legacy: DomainNeutralFacadeInput) {\n return {\n domain: \"domain-neutral\" as const,\n title: legacy.title,\n description: legacy.summary,\n sections: {\n objectives: legacy.objectives,\n nonGoals: legacy.nonGoals,\n background: legacy.background,\n workflow: legacy.workflow,\n capabilities: legacy.capabilities,\n risks: legacy.risks,\n successMetrics: legacy.successMetrics,\n },\n config: {\n style: legacy.style,\n provider: legacy.provider,\n techniques: legacy.techniques,\n includeReferences: legacy.includeReferences,\n includeFrontmatter: legacy.includeFrontmatter,\n includeMetadata: legacy.includeMetadata,\n },\n };\n }\n}\n\n/**\n * Factory function for backward compatibility.\n * Use UnifiedPromptBuilder directly\n */\nexport function createDomainNeutralFacade(\n unifiedBuilder: UnifiedPromptBuilder\n): DomainNeutralFacade {\n return new DomainNeutralFacade(unifiedBuilder);\n}\n```\n\n### Step 4.3: Create Barrel Export\n\n```typescript\n// src/tools/prompt/facades/index.ts\n\nexport {\n DomainNeutralFacade,\n DomainNeutralFacadeSchema,\n createDomainNeutralFacade,\n type DomainNeutralFacadeInput,\n} from \"./domain-neutral-facade.js\";\n\n// Future facades will be added here:\n// export { HierarchicalFacade } from \"./hierarchical-facade.js\";\n```\n\n### Step 4.4: Update Main Barrel Export\n\n```typescript\n// src/tools/prompt/index.ts (add to existing exports)\n\n// Legacy facades (deprecated)\nexport {\n DomainNeutralFacade,\n createDomainNeutralFacade,\n} from \"./facades/index.js\";\n```\n\n### Step 4.5: Implement Unit Tests\n\n```typescript\n// tests/vitest/tools/prompt/facades/domain-neutral-facade.spec.ts\n\nimport { describe, it, expect, vi, beforeEach } from \"vitest\";\nimport {\n DomainNeutralFacade,\n DomainNeutralFacadeSchema,\n createDomainNeutralFacade,\n} from \"../../../../../src/tools/prompt/facades/domain-neutral-facade.js\";\n\ndescribe(\"DomainNeutralFacade\", () => {\n const mockUnifiedBuilder = {\n generate: vi.fn().mockResolvedValue({\n content: [{ type: \"text\", text: \"Generated prompt\" }],\n }),\n };\n\n beforeEach(() => {\n vi.clearAllMocks();\n });\n\n describe(\"schema validation\", () => {\n it(\"accepts valid minimal input\", () => {\n const input = { title: \"Test\", summary: \"Test summary\" };\n const result = DomainNeutralFacadeSchema.safeParse(input);\n expect(result.success).toBe(true);\n });\n\n it(\"accepts full input with all optional fields\", () => {\n const input = {\n title: \"Full Test\",\n summary: \"Complete test\",\n objectives: [\"Obj 1\", \"Obj 2\"],\n workflow: [\"Step 1\", \"Step 2\"],\n risks: [{ description: \"Risk 1\", mitigation: \"Mitigate\" }],\n style: \"markdown\",\n includeReferences: true,\n };\n const result = DomainNeutralFacadeSchema.safeParse(input);\n expect(result.success).toBe(true);\n });\n\n it(\"rejects input missing required fields\", () => {\n const result = DomainNeutralFacadeSchema.safeParse({});\n expect(result.success).toBe(false);\n });\n });\n\n describe(\"generate()\", () => {\n it(\"delegates to UnifiedPromptBuilder with transformed input\", async () => {\n const facade = createDomainNeutralFacade(mockUnifiedBuilder as any);\n\n await facade.generate({\n title: \"Test Prompt\",\n summary: \"Test description\",\n objectives: [\"Goal 1\"],\n });\n\n expect(mockUnifiedBuilder.generate).toHaveBeenCalledWith(\n expect.objectContaining({\n domain: \"domain-neutral\",\n title: \"Test Prompt\",\n description: \"Test description\",\n })\n );\n });\n\n it(\"returns result from UnifiedPromptBuilder\", async () => {\n const facade = createDomainNeutralFacade(mockUnifiedBuilder as any);\n\n const result = await facade.generate({\n title: \"Test\",\n summary: \"Test\",\n });\n\n expect(result.content).toBeDefined();\n });\n\n it(\"emits deprecation warning on first call only\", async () => {\n const warnSpy = vi.spyOn(console, \"warn\").mockImplementation(() => {});\n const facade = createDomainNeutralFacade(mockUnifiedBuilder as any);\n\n await facade.generate({ title: \"Test\", summary: \"Test\" });\n await facade.generate({ title: \"Test2\", summary: \"Test2\" });\n\n // Warning should be emitted only once\n expect(warnSpy).toHaveBeenCalledTimes(1);\n warnSpy.mockRestore();\n });\n });\n\n describe(\"input transformation\", () => {\n it(\"maps legacy fields to unified format\", async () => {\n const facade = createDomainNeutralFacade(mockUnifiedBuilder as any);\n\n await facade.generate({\n title: \"Legacy Title\",\n summary: \"Legacy Summary\",\n objectives: [\"Obj\"],\n workflow: [\"Step\"],\n style: \"xml\",\n includeReferences: false,\n });\n\n expect(mockUnifiedBuilder.generate).toHaveBeenCalledWith({\n domain: \"domain-neutral\",\n title: \"Legacy Title\",\n description: \"Legacy Summary\",\n sections: {\n objectives: [\"Obj\"],\n workflow: [\"Step\"],\n nonGoals: undefined,\n background: undefined,\n capabilities: undefined,\n risks: undefined,\n successMetrics: undefined,\n },\n config: {\n style: \"xml\",\n provider: undefined,\n techniques: undefined,\n includeReferences: false,\n includeFrontmatter: undefined,\n includeMetadata: undefined,\n },\n });\n });\n });\n});\n```\n\n## 5. Testing Strategy\n\n### Unit Tests\n- Schema validation (valid/invalid inputs)\n- Input transformation (legacy ‚Üí unified format)\n- Delegation to UnifiedPromptBuilder\n- Deprecation warning emission (once per instance)\n\n### Integration Tests\n- End-to-end facade ‚Üí UnifiedPromptBuilder ‚Üí output\n- Verify output matches original `domainNeutralPromptBuilder`\n\n### Commands\n```bash\n# Run facade tests\nnpm run test:vitest -- --filter=\"domain-neutral-facade\"\n\n# Run with coverage\nnpm run test:coverage:vitest -- --filter=\"facades\"\n\n# Quality check\nnpm run quality\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| -------------------------------- | ---------- | ------ | -------------------------------- |\n| Input transformation loses data | Medium | High | Comprehensive mapping tests |\n| Deprecation warning spam | Low | Low | Warn once per instance |\n| UnifiedPromptBuilder API changes | Medium | Medium | Pin to stable interface contract |\n| Performance regression | Low | Medium | Benchmark facade vs direct call |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ---------------------------------------- | ------ | ------------------------------------- |\n| Facade delegates to UnifiedPromptBuilder | ‚¨ú | Unit test: `generate()` calls builder |\n| Schema accepts all legacy input shapes | ‚¨ú | Schema validation tests pass |\n| Deprecation warning emitted once | ‚¨ú | Console spy test |\n| Barrel exports work correctly | ‚¨ú | Import test from `prompt/index.ts` |\n| TypeScript strict mode passes | ‚¨ú | `npm run type-check` |\n| Test coverage ‚â•90% | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md - REQ-008](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - Legacy facade requirement\n- [T-026 UnifiedPromptBuilder](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md) - Core builder dependency\n- [domain-neutral-prompt-builder.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/prompt/domain-neutral-prompt-builder.ts) - Existing implementation\n- [ADR-002 ToolAnnotations](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/docs/adr/ADR-002-tool-annotations.md) - Annotation standard\n\n---\n\n*Task: T-033 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-033",
		"dependencies": ["T-026"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-033-create-legacy-facade-domainneutralpromptbuilder.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-033-create-legacy-facade-domainneutralpromptbuilder.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-034: Add ToolAnnotations to All Prompt Tools (GAP-001)",
		"body": "# T-034: Add ToolAnnotations to All Prompt Tools (GAP-001)\n\n## Overview\n\n**Task ID**: T-034\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 6h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-034-add-toolannotations-to-all-prompt-tools-gap-001.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Add ToolAnnotations to All Prompt Tools (GAP-001)' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-034\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Add ToolAnnotations to All Prompt Tools (GAP-001) fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `src/tools/shared/annotation-presets.ts`\n- `src/index.ts`\n- `src/schemas/flow-tool-schemas.ts`\n- `scripts/validate-tool-annotations.ts`\n- `package.json`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Define ToolAnnotations Type\n\nCreate or update `src/tools/shared/tool-annotations.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\n\n/**\n * MCP 2025-03-26 ToolAnnotations for LLM hint behavior\n * https://spec.modelcontextprotocol.io/specification/2025-03-26/server/tools/\n */\nexport const toolAnnotationsSchema = z.object({\n /** Free-form hints for LLM behavior */\n title: z.string().optional().describe('Human-readable tool title'),\n readOnlyHint: z.boolean().optional().describe('Tool does not modify state'),\n destructiveHint: z.boolean().optional().describe('Tool may perform destructive operations'),\n idempotentHint: z.boolean().optional().describe('Repeated calls with same args have same effect'),\n openWorldHint: z.boolean().optional().describe('Tool interacts with external entities'),\n}).describe('Hints for LLM behavior with this tool');\n\nexport type ToolAnnotations = z.infer<typeof toolAnnotationsSchema>;\n\n// Predefined annotation sets for common tool types\nexport const READ_ONLY_ANNOTATIONS: ToolAnnotations = {\n readOnlyHint: true,\n destructiveHint: false,\n idempotentHint: true,\n};\n\nexport const GENERATOR_ANNOTATIONS: ToolAnnotations = {\n readOnlyHint: false,\n destructiveHint: false,\n idempotentHint: true,\n openWorldHint: false,\n};\n\nexport const ANALYZER_ANNOTATIONS: ToolAnnotations = {\n readOnlyHint: true,\n destructiveHint: false,\n idempotentHint: true,\n openWorldHint: false,\n};\n```\n\n### Step 4.2: Update Prompt Tool Registration Pattern\n\nUpdate each prompt tool in `src/index.ts` to include annotations:\n\n```typescript\nimport { READ_ONLY_ANNOTATIONS, GENERATOR_ANNOTATIONS, ANALYZER_ANNOTATIONS } from './tools/shared/tool-annotations.js';\n\n// Example: hierarchical-prompt-builder\nserver.tool(\n 'hierarchical_prompt_builder',\n 'Generate hierarchical prompts with multiple specificity levels',\n hierarchicalPromptBuilderSchema,\n {\n annotations: {\n ...GENERATOR_ANNOTATIONS,\n title: 'Hierarchical Prompt Builder',\n },\n },\n handleHierarchicalPromptBuilder\n);\n\n// Example: clean-code-scorer\nserver.tool(\n 'clean_code_scorer',\n 'Score code quality on a 0-100 scale',\n cleanCodeScorerSchema,\n {\n annotations: {\n ...ANALYZER_ANNOTATIONS,\n title: 'Clean Code Scorer',\n },\n },\n handleCleanCodeScorer\n);\n\n// Example: design-assistant\nserver.tool(\n 'design_assistant',\n 'Orchestrate multi-phase design workflows',\n designAssistantSchema,\n {\n annotations: {\n readOnlyHint: false,\n destructiveHint: false,\n idempotentHint: false, // Sessions have state\n openWorldHint: false,\n title: 'Design Assistant',\n },\n },\n handleDesignAssistant\n);\n```\n\n### Step 4.3: Validate All Tools Have Annotations\n\nCreate `scripts/validate-tool-annotations.ts`:\n\n```typescript\nimport { Server } from '/sdk/server/index.js';\nimport { toolAnnotationsSchema, ToolAnnotations } from '../src/tools/shared/tool-annotations.js';\n\ninterface ToolValidationResult {\n toolName: string;\n hasAnnotations: boolean;\n annotations?: ToolAnnotations;\n errors?: string[];\n}\n\nexport function validateToolAnnotations(server: Server): ToolValidationResult[] {\n const results: ToolValidationResult[] = [];\n\n for (const [name, tool] of server.getTools()) {\n const result: ToolValidationResult = {\n toolName: name,\n hasAnnotations: !!tool.annotations,\n };\n\n if (tool.annotations) {\n const parsed = toolAnnotationsSchema.safeParse(tool.annotations);\n if (parsed.success) {\n result.annotations = parsed.data;\n } else {\n result.errors = parsed.error.issues.map(i => i.message);\n }\n }\n\n results.push(result);\n }\n\n return results;\n}\n```\n\n- Update barrel exports and registries\n- Register new handler or service if required\n- Add configuration entries where needed\n\n### Step 4.4: Create Coverage Report\n\nAdd npm script to `package.json`:\n\n```json\n{\n \"scripts\": {\n \"validate:annotations\": \"tsx scripts/validate-tool-annotations.ts\"\n }\n}\n```\n\n- Run unit tests for new logic\n- Ensure TypeScript strict mode passes\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-034 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "implementation", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-034",
		"dependencies": ["T-026"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-034-add-toolannotations-to-all-prompt-tools-gap-001.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-034-add-toolannotations-to-all-prompt-tools-gap-001.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-035: Test UnifiedPromptBuilder",
		"body": "# T-035: Test UnifiedPromptBuilder\n\n## Overview\n\n**Task ID**: T-035\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 6h\n**Dependencies**: T-026\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-035-test-unifiedpromptbuilder.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test UnifiedPromptBuilder' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-035\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test UnifiedPromptBuilder fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-035 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "testing", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-035",
		"dependencies": ["T-026"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-035-test-unifiedpromptbuilder.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-035-test-unifiedpromptbuilder.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-036: Phase 2.5 Integration Test",
		"body": "# T-036: Phase 2.5 Integration Test\n\n## Overview\n\n**Task ID**: T-036\n**Phase**: 2.5\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-027 through T-034\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-036-phase-2-5-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Phase 2.5 Integration Test' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-036\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 2.5 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-027 through T-034\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-036 | Phase: 2.5 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-25", "integration-test", "P0-critical"],
		"milestone": 19,
		"parent_issue": 970,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/970",
		"phase": "2.5",
		"priority": "P0",
		"task_id": "T-036",
		"dependencies": ["T-027", "T-034"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-036-phase-2-5-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-036-phase-2-5-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-032: Implement Legacy Facades",
		"body": "# T-032: Implement Legacy Facades\n\n## Overview\n\n**Task ID**: T-032\n**Phase**: 3 - Consolidation\n**Priority**: P1 (High)\n**Estimate**: 4 hours\n**Dependencies**: T-026 (UnifiedPromptBuilder), T-037 (FrameworkRouter)\n**Blocks**: T-034 (API deprecation)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-032-legacy-facades.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nCreate `LegacyFacade` pattern to:\n- Wrap new unified builders with old API signatures\n- Emit deprecation warnings\n- Provide migration guidance\n- Enable incremental migration\n\n### Why\n\nExisting tools have established APIs that:\n- Cannot change without breaking consumers\n- Need gradual migration path\n- Should guide users to new APIs\n- Must maintain backward compatibility during transition\n\n### Target API\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Old API (preserved for compatibility)\nimport { buildHierarchicalPrompt } from './legacy/hierarchical-prompt-builder.js';\n\nconst result = buildHierarchicalPrompt({\n context: 'Building auth system',\n goal: 'Implement OAuth2',\n // ... old options\n});\n\n// Console shows:\n// ‚ö†Ô∏è DEPRECATION: buildHierarchicalPrompt() is deprecated.\n// Use UnifiedPromptBuilder.build({ domain: 'hierarchical', ... }) instead.\n// Migration guide: https://docs.example.com/migrate-prompts\n\n// New API (recommended)\nimport { unifiedPromptBuilder } from './domain/prompts/index.js';\n\nconst result = unifiedPromptBuilder.build({\n domain: 'hierarchical',\n request: {\n context: 'Building auth system',\n goal: 'Implement OAuth2',\n },\n});\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Facade Types\n\n```typescript\n// src/legacy/facade-types.ts\n\n/**\n * Deprecation warning configuration.\n */\nexport interface DeprecationConfig {\n /** Old function/method name */\n oldName: string;\n\n /** New replacement recommendation */\n newName: string;\n\n /** Migration guide URL */\n migrationUrl?: string;\n\n /** Version when deprecated */\n deprecatedIn: string;\n\n /** Version when will be removed */\n removeIn?: string;\n\n /** Additional migration instructions */\n instructions?: string[];\n\n /** Only warn once per session */\n warnOnce?: boolean;\n}\n\n/**\n * Facade options for wrapping new implementations.\n */\nexport interface FacadeOptions<TNewRequest, TOldRequest> {\n /** Deprecation configuration */\n deprecation: DeprecationConfig;\n\n /** Transform old request to new format */\n transformRequest: (oldRequest: TOldRequest) => TNewRequest;\n\n /** Transform new response to old format (if needed) */\n transformResponse?: (newResponse: unknown) => unknown;\n\n /** Custom validation for old request format */\n validateOldRequest?: (request: TOldRequest) => string | null;\n}\n\n/**\n * Registry for tracking deprecation warnings.\n */\nexport interface DeprecationRegistry {\n /** Check if warning was already shown */\n hasWarned(key: string): boolean;\n\n /** Mark warning as shown */\n markWarned(key: string): void;\n\n /** Clear all warnings (for testing) */\n clear(): void;\n}\n```\n\n### Step 2.2: Implement Deprecation Logger\n\n```typescript\n// src/legacy/deprecation-logger.ts\n\nimport type { DeprecationConfig, DeprecationRegistry } from './facade-types.js';\n\n/**\n * Default deprecation registry (tracks warnings per session).\n */\nclass DefaultDeprecationRegistry implements DeprecationRegistry {\n private readonly warned = new Set<string>();\n\n hasWarned(key: string): boolean {\n return this.warned.has(key);\n }\n\n markWarned(key: string): void {\n this.warned.add(key);\n }\n\n clear(): void {\n this.warned.clear();\n }\n}\n\n/**\n * Global deprecation registry singleton.\n */\nconst deprecationRegistry = new DefaultDeprecationRegistry();\n\n/**\n * Format deprecation warning message.\n */\nfunction formatDeprecationWarning(config: DeprecationConfig): string {\n const lines: string[] = [];\n\n lines.push(`‚ö†Ô∏è DEPRECATION: ${config.oldName} is deprecated.`);\n lines.push(` Use ${config.newName} instead.`);\n\n if (config.migrationUrl) {\n lines.push(` Migration guide: ${config.migrationUrl}`);\n }\n\n lines.push(` Deprecated in: v${config.deprecatedIn}`);\n\n if (config.removeIn) {\n lines.push(` Will be removed in: v${config.removeIn}`);\n }\n\n if (config.instructions?.length) {\n lines.push('');\n lines.push(' Migration steps:');\n for (const instruction of config.instructions) {\n lines.push(` ‚Ä¢ ${instruction}`);\n }\n }\n\n return lines.join('\\n');\n}\n\n/**\n * Emit a deprecation warning.\n */\nexport function emitDeprecationWarning(config: DeprecationConfig): void {\n const key = `${config.oldName}:${config.newName}`;\n\n // Check if we should warn\n if (config.warnOnce && deprecationRegistry.hasWarned(key)) {\n return;\n }\n\n // Emit warning\n console.warn(formatDeprecationWarning(config));\n\n // Mark as warned\n if (config.warnOnce) {\n deprecationRegistry.markWarned(key);\n }\n}\n\n/**\n * Reset deprecation warnings (for testing).\n */\nexport function resetDeprecationWarnings(): void {\n deprecationRegistry.clear();\n}\n\n/**\n * Create a deprecation decorator for methods.\n */\nexport function deprecated(config: DeprecationConfig) {\n return function <T extends (...args: unknown[]) => unknown>(\n target: T\n ): T {\n const wrapper = function (this: unknown, ...args: unknown[]): unknown {\n emitDeprecationWarning(config);\n return target.apply(this, args);\n };\n\n // Preserve function name\n Object.defineProperty(wrapper, 'name', {\n value: target.name,\n configurable: true,\n });\n\n return wrapper as T;\n };\n}\n```\n\n### Step 2.3: Implement Legacy Facade Factory\n\n```typescript\n// src/legacy/facade-factory.ts\n\nimport type { FacadeOptions } from './facade-types.js';\nimport { emitDeprecationWarning } from './deprecation-logger.js';\n\n/**\n * Create a legacy facade that wraps a new implementation.\n *\n * \n * ```typescript\n * const buildHierarchicalPrompt = createLegacyFacade(\n * (req) => unifiedPromptBuilder.build({ domain: 'hierarchical', request: req }),\n * {\n * deprecation: {\n * oldName: 'buildHierarchicalPrompt()',\n * newName: 'UnifiedPromptBuilder.build({ domain: \"hierarchical\", ... })',\n * deprecatedIn: '0.14.0',\n * removeIn: '0.15.0',\n * warnOnce: true,\n * },\n * transformRequest: (old) => ({\n * context: old.context,\n * goal: old.goal,\n * // ... map old fields to new\n * }),\n * }\n * );\n * ```\n */\nexport function createLegacyFacade<\n TNewRequest,\n TOldRequest,\n TResult\n>(\n implementation: (request: TNewRequest) => TResult,\n options: FacadeOptions<TNewRequest, TOldRequest>\n): (request: TOldRequest) => TResult {\n return function legacyFacade(oldRequest: TOldRequest): TResult {\n // Emit deprecation warning\n emitDeprecationWarning(options.deprecation);\n\n // Validate old request if validator provided\n if (options.validateOldRequest) {\n const error = options.validateOldRequest(oldRequest);\n if (error) {\n throw new Error(`Invalid request: ${error}`);\n }\n }\n\n // Transform to new format\n const newRequest = options.transformRequest(oldRequest);\n\n // Call new implementation\n const result = implementation(newRequest);\n\n // Transform response if needed\n if (options.transformResponse) {\n return options.transformResponse(result) as TResult;\n }\n\n return result;\n };\n}\n\n/**\n * Create an async legacy facade.\n */\nexport function createAsyncLegacyFacade<\n TNewRequest,\n TOldRequest,\n TResult\n>(\n implementation: (request: TNewRequest) => Promise<TResult>,\n options: FacadeOptions<TNewRequest, TOldRequest>\n): (request: TOldRequest) => Promise<TResult> {\n return async function asyncLegacyFacade(oldRequest: TOldRequest): Promise<TResult> {\n // Emit deprecation warning\n emitDeprecationWarning(options.deprecation);\n\n // Validate old request if validator provided\n if (options.validateOldRequest) {\n const error = options.validateOldRequest(oldRequest);\n if (error) {\n throw new Error(`Invalid request: ${error}`);\n }\n }\n\n // Transform to new format\n const newRequest = options.transformRequest(oldRequest);\n\n // Call new implementation\n const result = await implementation(newRequest);\n\n // Transform response if needed\n if (options.transformResponse) {\n return options.transformResponse(result) as TResult;\n }\n\n return result;\n };\n}\n```\n\n### Step 2.4: Implement Specific Facades\n\n```typescript\n// src/legacy/prompt-facades.ts\n\nimport { createLegacyFacade } from './facade-factory.js';\nimport { unifiedPromptBuilder } from '../domain/prompts/index.js';\nimport type {\n HierarchicalPromptRequest,\n SecurityPromptRequest,\n ArchitecturePromptRequest,\n} from '../tools/prompt/types.js';\n\n// ============================================\n// Hierarchical Prompt Builder Facade\n// ============================================\n\n/**\n * Old hierarchical prompt request format.\n */\ninterface LegacyHierarchicalRequest {\n context: string;\n goal: string;\n requirements?: string[];\n audience?: string;\n outputFormat?: string;\n style?: 'markdown' | 'xml';\n includeFrontmatter?: boolean;\n includeMetadata?: boolean;\n includeReferences?: boolean;\n}\n\n/**\n * Use UnifiedPromptBuilder.build() instead.\n */\nexport const buildHierarchicalPrompt = createLegacyFacade<\n { domain: 'hierarchical'; request: HierarchicalPromptRequest },\n LegacyHierarchicalRequest,\n string\n>(\n (req) => unifiedPromptBuilder.build(req),\n {\n deprecation: {\n oldName: 'buildHierarchicalPrompt()',\n newName: 'UnifiedPromptBuilder.build({ domain: \"hierarchical\", ... })',\n deprecatedIn: '0.14.0',\n removeIn: '0.16.0',\n migrationUrl: 'https://github.com/mcp-ai-agent-guidelines/docs/migrate-prompts',\n warnOnce: true,\n instructions: [\n 'Import UnifiedPromptBuilder from domain/prompts',\n 'Replace buildHierarchicalPrompt(opts) with build({ domain: \"hierarchical\", request: opts })',\n 'Update response handling if needed',\n ],\n },\n transformRequest: (old) => ({\n domain: 'hierarchical' as const,\n request: {\n context: old.context,\n goal: old.goal,\n requirements: old.requirements,\n audience: old.audience,\n outputFormat: old.outputFormat,\n style: old.style,\n includeFrontmatter: old.includeFrontmatter,\n includeMetadata: old.includeMetadata,\n includeReferences: old.includeReferences,\n },\n }),\n }\n);\n\n// ============================================\n// Security Prompt Builder Facade\n// ============================================\n\n/**\n * Old security prompt request format.\n */\ninterface LegacySecurityRequest {\n projectName: string;\n securityDomain: string;\n threatModel?: string[];\n complianceFrameworks?: string[];\n // ... other old fields\n}\n\n/**\n * Use UnifiedPromptBuilder.build() instead.\n */\nexport const buildSecurityPrompt = createLegacyFacade<\n { domain: 'security'; request: SecurityPromptRequest },\n LegacySecurityRequest,\n string\n>(\n (req) => unifiedPromptBuilder.build(req),\n {\n deprecation: {\n oldName: 'buildSecurityPrompt()',\n newName: 'UnifiedPromptBuilder.build({ domain: \"security\", ... })',\n deprecatedIn: '0.14.0',\n removeIn: '0.16.0',\n warnOnce: true,\n },\n transformRequest: (old) => ({\n domain: 'security' as const,\n request: {\n projectName: old.projectName,\n securityDomain: old.securityDomain,\n threatModel: old.threatModel,\n complianceFrameworks: old.complianceFrameworks,\n },\n }),\n }\n);\n\n// ============================================\n// Architecture Prompt Builder Facade\n// ============================================\n\n/**\n * Old architecture prompt request format.\n */\ninterface LegacyArchitectureRequest {\n projectName: string;\n systemDescription: string;\n architectureStyle?: string;\n qualityAttributes?: string[];\n // ... other old fields\n}\n\n/**\n * Use UnifiedPromptBuilder.build() instead.\n */\nexport const buildArchitecturePrompt = createLegacyFacade<\n { domain: 'architecture'; request: ArchitecturePromptRequest },\n LegacyArchitectureRequest,\n string\n>(\n (req) => unifiedPromptBuilder.build(req),\n {\n deprecation: {\n oldName: 'buildArchitecturePrompt()',\n newName: 'UnifiedPromptBuilder.build({ domain: \"architecture\", ... })',\n deprecatedIn: '0.14.0',\n removeIn: '0.16.0',\n warnOnce: true,\n },\n transformRequest: (old) => ({\n domain: 'architecture' as const,\n request: {\n projectName: old.projectName,\n systemDescription: old.systemDescription,\n architectureStyle: old.architectureStyle,\n qualityAttributes: old.qualityAttributes,\n },\n }),\n }\n);\n```\n\n### Step 2.5: Create Barrel Export\n\n```typescript\n// src/legacy/index.ts\n\n// Types\nexport type {\n DeprecationConfig,\n FacadeOptions,\n DeprecationRegistry,\n} from './facade-types.js';\n\n// Deprecation utilities\nexport {\n emitDeprecationWarning,\n resetDeprecationWarnings,\n deprecated,\n} from './deprecation-logger.js';\n\n// Facade factory\nexport {\n createLegacyFacade,\n createAsyncLegacyFacade,\n} from './facade-factory.js';\n\n// Specific facades (re-export for backward compatibility)\nexport {\n buildHierarchicalPrompt,\n buildSecurityPrompt,\n buildArchitecturePrompt,\n} from './prompt-facades.js';\n```\n\n---\n\n## 3. Test Coverage\n\n```typescript\n// tests/vitest/legacy/facade-factory.spec.ts\n\nimport { describe, it, expect, beforeEach, vi, afterEach } from 'vitest';\nimport {\n createLegacyFacade,\n createAsyncLegacyFacade,\n} from '../../../src/legacy/facade-factory.js';\nimport { resetDeprecationWarnings } from '../../../src/legacy/deprecation-logger.js';\n\ndescribe('createLegacyFacade', () => {\n beforeEach(() => {\n resetDeprecationWarnings();\n vi.spyOn(console, 'warn').mockImplementation(() => {});\n });\n\n afterEach(() => {\n vi.restoreAllMocks();\n });\n\n it('should call implementation with transformed request', () => {\n const implementation = vi.fn().mockReturnValue('result');\n\n const facade = createLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn',\n newName: 'newFn',\n deprecatedIn: '0.14.0',\n },\n transformRequest: (old: { x: number }) => ({ y: old.x * 2 }),\n });\n\n const result = facade({ x: 5 });\n\n expect(implementation).toHaveBeenCalledWith({ y: 10 });\n expect(result).toBe('result');\n });\n\n it('should emit deprecation warning', () => {\n const implementation = vi.fn().mockReturnValue('result');\n\n const facade = createLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn()',\n newName: 'newFn()',\n deprecatedIn: '0.14.0',\n },\n transformRequest: (old: unknown) => old,\n });\n\n facade({});\n\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('DEPRECATION')\n );\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('oldFn()')\n );\n });\n\n it('should only warn once when warnOnce is true', () => {\n const implementation = vi.fn().mockReturnValue('result');\n\n const facade = createLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn',\n newName: 'newFn',\n deprecatedIn: '0.14.0',\n warnOnce: true,\n },\n transformRequest: (old: unknown) => old,\n });\n\n facade({});\n facade({});\n facade({});\n\n expect(console.warn).toHaveBeenCalledTimes(1);\n });\n\n it('should transform response when transformer provided', () => {\n const implementation = vi.fn().mockReturnValue({ value: 42 });\n\n const facade = createLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn',\n newName: 'newFn',\n deprecatedIn: '0.14.0',\n },\n transformRequest: (old: unknown) => old,\n transformResponse: (res: { value: number }) => res.value.toString(),\n });\n\n const result = facade({});\n\n expect(result).toBe('42');\n });\n\n it('should validate old request when validator provided', () => {\n const implementation = vi.fn().mockReturnValue('result');\n\n const facade = createLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn',\n newName: 'newFn',\n deprecatedIn: '0.14.0',\n },\n transformRequest: (old: unknown) => old,\n validateOldRequest: (req: { required?: string }) =>\n req.required ? null : 'required field is missing',\n });\n\n expect(() => facade({})).toThrow('required field is missing');\n expect(implementation).not.toHaveBeenCalled();\n });\n});\n\ndescribe('createAsyncLegacyFacade', () => {\n beforeEach(() => {\n resetDeprecationWarnings();\n vi.spyOn(console, 'warn').mockImplementation(() => {});\n });\n\n afterEach(() => {\n vi.restoreAllMocks();\n });\n\n it('should handle async implementation', async () => {\n const implementation = vi.fn().mockResolvedValue('async result');\n\n const facade = createAsyncLegacyFacade(implementation, {\n deprecation: {\n oldName: 'oldFn',\n newName: 'newFn',\n deprecatedIn: '0.14.0',\n },\n transformRequest: (old: unknown) => old,\n });\n\n const result = await facade({});\n\n expect(result).toBe('async result');\n });\n});\n```\n\n### Step 3.2: Deprecation Logger Tests\n\n```typescript\n// tests/vitest/legacy/deprecation-logger.spec.ts\n\nimport { describe, it, expect, beforeEach, vi, afterEach } from 'vitest';\nimport {\n emitDeprecationWarning,\n resetDeprecationWarnings,\n deprecated,\n} from '../../../src/legacy/deprecation-logger.js';\n\ndescribe('emitDeprecationWarning', () => {\n beforeEach(() => {\n resetDeprecationWarnings();\n vi.spyOn(console, 'warn').mockImplementation(() => {});\n });\n\n afterEach(() => {\n vi.restoreAllMocks();\n });\n\n it('should emit formatted warning', () => {\n emitDeprecationWarning({\n oldName: 'oldFunction()',\n newName: 'newFunction()',\n deprecatedIn: '0.14.0',\n });\n\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('‚ö†Ô∏è DEPRECATION')\n );\n });\n\n it('should include migration URL when provided', () => {\n emitDeprecationWarning({\n oldName: 'oldFunction()',\n newName: 'newFunction()',\n deprecatedIn: '0.14.0',\n migrationUrl: 'https://example.com/migrate',\n });\n\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('https://example.com/migrate')\n );\n });\n\n it('should include removal version when provided', () => {\n emitDeprecationWarning({\n oldName: 'oldFunction()',\n newName: 'newFunction()',\n deprecatedIn: '0.14.0',\n removeIn: '0.16.0',\n });\n\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('0.16.0')\n );\n });\n\n it('should include migration instructions when provided', () => {\n emitDeprecationWarning({\n oldName: 'oldFunction()',\n newName: 'newFunction()',\n deprecatedIn: '0.14.0',\n instructions: ['Step 1', 'Step 2'],\n });\n\n expect(console.warn).toHaveBeenCalledWith(\n expect.stringContaining('Step 1')\n );\n });\n});\n\ndescribe('deprecated decorator', () => {\n beforeEach(() => {\n resetDeprecationWarnings();\n vi.spyOn(console, 'warn').mockImplementation(() => {});\n });\n\n afterEach(() => {\n vi.restoreAllMocks();\n });\n\n it('should wrap function and emit warning', () => {\n const original = (x: number) => x * 2;\n const wrapped = deprecated({\n oldName: 'original()',\n newName: 'newVersion()',\n deprecatedIn: '0.14.0',\n })(original);\n\n const result = wrapped(5);\n\n expect(result).toBe(10);\n expect(console.warn).toHaveBeenCalled();\n });\n\n it('should preserve function context', () => {\n const obj = {\n value: 10,\n getValue() {\n return this.value;\n },\n };\n\n const wrappedGetValue = deprecated({\n oldName: 'getValue()',\n newName: 'getNewValue()',\n deprecatedIn: '0.14.0',\n })(obj.getValue.bind(obj));\n\n expect(wrappedGetValue()).toBe(10);\n });\n});\n```\n\n---\n\n## 4. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| --------------------------- | ------ | --------------- |\n| Legacy facade factory works | ‚¨ú | Facade test |\n| Request transformation | ‚¨ú | Transform test |\n| Response transformation | ‚¨ú | Response test |\n| Deprecation warning emitted | ‚¨ú | Warning test |\n| warnOnce works correctly | ‚¨ú | warnOnce test |\n| Migration URL displayed | ‚¨ú | URL test |\n| Async facade works | ‚¨ú | Async test |\n| deprecated decorator works | ‚¨ú | Decorator test |\n| 100% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 5. Migration Guide\n\n### Before (v0.13.x)\n\n```typescript\nimport { buildHierarchicalPrompt } from './tools/prompt/hierarchical-prompt-builder.js';\n\nconst prompt = buildHierarchicalPrompt({\n context: 'Building auth system',\n goal: 'Implement OAuth2',\n requirements: ['JWT tokens', 'Refresh tokens'],\n style: 'markdown',\n includeFrontmatter: true,\n});\n```\n\n### After (v0.14.x+)\n\n```typescript\nimport { unifiedPromptBuilder } from './domain/prompts/index.js';\n\nconst prompt = unifiedPromptBuilder.build({\n domain: 'hierarchical',\n request: {\n context: 'Building auth system',\n goal: 'Implement OAuth2',\n requirements: ['JWT tokens', 'Refresh tokens'],\n },\n options: {\n style: 'markdown',\n includeFrontmatter: true,\n },\n});\n```\n\n---\n\n## 6. References\n\n| Document | Link |\n| ------------------------------- | -------------------------------------------------------------------------------- |\n| T-026: UnifiedPromptBuilder | [T-026-unified-builder.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-026-unified-builder.md) |\n| T-037: FrameworkRouter | [T-037-framework-router.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-037-framework-router.md) |\n| ADR-004: Backward Compatibility | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-004) |\n\n---\n\n*Task: T-032 | Phase: 3 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P1-high"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P1",
		"task_id": "T-032",
		"dependencies": ["T-026", "T-037"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-032-legacy-facades.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-032-legacy-facades.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-037: Implement Framework Router",
		"body": "# T-037: Implement Framework Router\n\n## Overview\n\n**Task ID**: T-037\n**Phase**: 3 - Consolidation\n**Priority**: P0 (Critical Path)\n**Estimate**: 8 hours\n**Dependencies**: T-011 through T-016 (all strategies migrated)\n**Blocks**: T-038 (cross-cutting), T-039 (output formats)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-037-framework-router.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nCreate a unified **Framework Router** that:\n- Routes requests to the appropriate strategy based on `OutputApproach`\n- Manages strategy lifecycle (instantiation, caching, cleanup)\n- Provides a single entry point for all output generation\n- Enables cross-cutting capabilities (diagrams, shell scripts, configs)\n\n### Why\n\nCurrent state:\n- Each strategy instantiated separately in tool handlers\n- No unified routing logic\n- Cross-cutting capabilities duplicated\n- Hard to add new output approaches\n\nTarget state:\n- Single `FrameworkRouter.execute(approach, input)` API\n- Strategy caching for performance\n- Plugin architecture for cross-cutting capabilities\n- Easy to add new output approaches\n\n### Architecture\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ MCP Tool Handler ‚îÇ\n‚îÇ (speckit-generator, togaf-generator, adr-generator, etc.) ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n ‚îÇ\n ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ FrameworkRouter ‚îÇ\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ ‚îÇ Strategy ‚îÇ ‚îÇ Plugin ‚îÇ ‚îÇ Output ‚îÇ ‚îÇ\n‚îÇ ‚îÇ Registry ‚îÇ ‚îÇ Manager ‚îÇ ‚îÇ Formatter ‚îÇ ‚îÇ\n‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n ‚îÇ ‚îÇ ‚îÇ\n ‚ñº ‚ñº ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ SpecKitStrategy ‚îÇ ‚îÇ DiagramPlugin ‚îÇ ‚îÇ MarkdownFormat ‚îÇ\n‚îÇ TOGAFStrategy ‚îÇ ‚îÇ ShellPlugin ‚îÇ ‚îÇ JSONFormat ‚îÇ\n‚îÇ ADRStrategy ‚îÇ ‚îÇ ConfigPlugin ‚îÇ ‚îÇ HTMLFormat ‚îÇ\n‚îÇ RFCStrategy ‚îÇ ‚îÇ IssuesPlugin ‚îÇ ‚îÇ ‚îÇ\n‚îÇ ... ‚îÇ ‚îÇ ... ‚îÇ ‚îÇ ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n---\n\n## 2. Implementation Guide\n\n### Step 2.1: Define Router Types\n\n```typescript\n// src/domain/router/types.ts\n\nimport type { StrategyResult } from '../base-strategy/types.js';\n\n/**\n * Output approaches supported by the router.\n * Maps to strategy implementations.\n */\nexport type OutputApproach =\n | 'speckit'\n | 'togaf'\n | 'adr'\n | 'rfc'\n | 'enterprise'\n | 'sdd'\n | 'chat';\n\n/**\n * Cross-cutting capabilities that can be added to any output.\n */\nexport type CrossCuttingCapability =\n | 'workflow' // GitHub Actions, CI/CD\n | 'shell-script' // Bash/PowerShell scripts\n | 'diagram' // Mermaid diagrams\n | 'config' // Config file generation\n | 'issues' // GitHub issue templates\n | 'pr-template'; // Pull request templates\n\n/**\n * Router request - what MCP tools send to the router.\n */\nexport interface RouterRequest<TInput = unknown> {\n /** Which output approach to use */\n approach: OutputApproach;\n\n /** Input data for the strategy */\n input: TInput;\n\n /** Optional cross-cutting capabilities to enable */\n capabilities?: CrossCuttingCapability[];\n\n /** Output format preference */\n format?: OutputFormat;\n\n /** Request metadata */\n metadata?: {\n requestId?: string;\n correlationId?: string;\n timeout?: number;\n };\n}\n\n/**\n * Router response - what the router returns to MCP tools.\n */\nexport interface RouterResponse<TOutput = unknown> {\n /** Whether execution succeeded */\n success: boolean;\n\n /** Strategy output (if success) */\n output?: TOutput;\n\n /** Cross-cutting outputs (diagrams, scripts, etc.) */\n artifacts?: CrossCuttingArtifacts;\n\n /** Error information (if failure) */\n error?: RouterError;\n\n /** Execution trace for debugging */\n trace: ExecutionSummary;\n}\n\n/**\n * Artifacts generated by cross-cutting plugins.\n */\nexport interface CrossCuttingArtifacts {\n diagrams?: DiagramArtifact[];\n scripts?: ScriptArtifact[];\n configs?: ConfigArtifact[];\n workflows?: WorkflowArtifact[];\n issues?: IssueArtifact[];\n}\n\nexport interface DiagramArtifact {\n name: string;\n type: 'mermaid' | 'plantuml' | 'graphviz';\n content: string;\n}\n\nexport interface ScriptArtifact {\n name: string;\n platform: 'bash' | 'powershell' | 'cross-platform';\n content: string;\n}\n\nexport interface ConfigArtifact {\n name: string;\n format: 'json' | 'yaml' | 'toml';\n content: string;\n}\n\nexport interface WorkflowArtifact {\n name: string;\n platform: 'github' | 'gitlab' | 'azure';\n content: string;\n}\n\nexport interface IssueArtifact {\n title: string;\n body: string;\n labels: string[];\n}\n\n/**\n * Supported output formats.\n */\nexport type OutputFormat = 'markdown' | 'json' | 'html' | 'yaml';\n\n/**\n * Router error with categorization.\n */\nexport interface RouterError {\n code: RouterErrorCode;\n message: string;\n approach?: OutputApproach;\n cause?: Error;\n}\n\nexport type RouterErrorCode =\n | 'UNKNOWN_APPROACH'\n | 'STRATEGY_NOT_FOUND'\n | 'VALIDATION_FAILED'\n | 'EXECUTION_FAILED'\n | 'PLUGIN_FAILED'\n | 'FORMAT_FAILED'\n | 'TIMEOUT';\n\n/**\n * Summary of execution for tracing.\n */\nexport interface ExecutionSummary {\n requestId: string;\n approach: OutputApproach;\n startedAt: Date;\n completedAt: Date;\n durationMs: number;\n strategyVersion: string;\n pluginsExecuted: string[];\n metrics: Record<string, number>;\n}\n```\n\n### Step 2.2: Implement Strategy Registry\n\n```typescript\n// src/domain/router/strategy-registry.ts\n\nimport type { BaseStrategy } from '../base-strategy/index.js';\nimport type { OutputApproach } from './types.js';\n\n/**\n * Factory function that creates a strategy instance.\n */\ntype StrategyFactory<TInput, TOutput> = () => BaseStrategy<TInput, TOutput>;\n\n/**\n * Registry entry with metadata.\n */\ninterface RegistryEntry {\n factory: StrategyFactory<unknown, unknown>;\n version: string;\n description: string;\n singleton: boolean;\n instance?: BaseStrategy<unknown, unknown>;\n}\n\n/**\n * Strategy Registry - manages strategy registration and instantiation.\n *\n * Features:\n * - Lazy instantiation for performance\n * - Singleton support for stateless strategies\n * - Version tracking for debugging\n *\n * \n * ```typescript\n * const registry = new StrategyRegistry();\n *\n * // Register strategies\n * registry.register('speckit', () => new SpecKitStrategy(), {\n * version: '2.0.0',\n * description: 'Generate project specification artifacts',\n * singleton: true,\n * });\n *\n * // Get strategy instance\n * const strategy = registry.get('speckit');\n * ```\n */\nexport class StrategyRegistry {\n private readonly strategies = new Map<OutputApproach, RegistryEntry>();\n\n /**\n * Register a strategy factory.\n *\n * approach - The output approach this strategy handles\n * factory - Factory function to create strategy instances\n * options - Registration options\n */\n register<TInput, TOutput>(\n approach: OutputApproach,\n factory: StrategyFactory<TInput, TOutput>,\n options: {\n version: string;\n description: string;\n singleton?: boolean;\n }\n ): void {\n if (this.strategies.has(approach)) {\n throw new Error(`Strategy already registered for approach: ${approach}`);\n }\n\n this.strategies.set(approach, {\n factory: factory as StrategyFactory<unknown, unknown>,\n version: options.version,\n description: options.description,\n singleton: options.singleton ?? true,\n });\n }\n\n /**\n * Get a strategy instance for an approach.\n *\n * approach - The output approach\n * Strategy instance\n * If no strategy registered for approach\n */\n get<TInput, TOutput>(approach: OutputApproach): BaseStrategy<TInput, TOutput> {\n const entry = this.strategies.get(approach);\n\n if (!entry) {\n throw new Error(`No strategy registered for approach: ${approach}`);\n }\n\n // Return cached instance for singletons\n if (entry.singleton) {\n if (!entry.instance) {\n entry.instance = entry.factory();\n }\n return entry.instance as BaseStrategy<TInput, TOutput>;\n }\n\n // Create new instance for non-singletons\n return entry.factory() as BaseStrategy<TInput, TOutput>;\n }\n\n /**\n * Check if an approach is registered.\n */\n has(approach: OutputApproach): boolean {\n return this.strategies.has(approach);\n }\n\n /**\n * Get metadata for all registered strategies.\n */\n list(): Array<{\n approach: OutputApproach;\n version: string;\n description: string;\n }> {\n return Array.from(this.strategies.entries()).map(([approach, entry]) => ({\n approach,\n version: entry.version,\n description: entry.description,\n }));\n }\n\n /**\n * Clear all registered strategies (for testing).\n */\n clear(): void {\n this.strategies.clear();\n }\n}\n\n/**\n * Default singleton instance.\n */\nexport const strategyRegistry = new StrategyRegistry();\n```\n\n### Step 2.3: Implement Plugin Manager\n\n```typescript\n// src/domain/router/plugin-manager.ts\n\nimport type { CrossCuttingCapability, CrossCuttingArtifacts } from './types.js';\n\n/**\n * Plugin interface - all cross-cutting plugins must implement this.\n */\nexport interface CrossCuttingPlugin {\n /** Plugin identifier */\n readonly name: CrossCuttingCapability;\n\n /** Plugin version */\n readonly version: string;\n\n /**\n * Execute the plugin on strategy output.\n *\n * strategyOutput - Output from the main strategy\n * context - Execution context with metadata\n * Generated artifacts\n */\n execute<T>(\n strategyOutput: T,\n context: PluginContext\n ): Promise<PluginResult>;\n}\n\n/**\n * Context provided to plugins during execution.\n */\nexport interface PluginContext {\n approach: string;\n requestId: string;\n metadata: Record<string, unknown>;\n}\n\n/**\n * Result from plugin execution.\n */\nexport interface PluginResult {\n success: boolean;\n artifacts?: Partial<CrossCuttingArtifacts>;\n error?: Error;\n}\n\n/**\n * Plugin Manager - manages cross-cutting capability plugins.\n *\n * Plugins can:\n * - Generate Mermaid diagrams from strategy output\n * - Create shell scripts for automation\n * - Generate config files\n * - Create GitHub workflow files\n * - Generate issue templates\n *\n * \n * ```typescript\n * const manager = new PluginManager();\n *\n * // Register plugins\n * manager.register(new DiagramPlugin());\n * manager.register(new ShellScriptPlugin());\n *\n * // Execute selected plugins\n * const artifacts = await manager.execute(\n * ['diagram', 'shell-script'],\n * strategyOutput,\n * context\n * );\n * ```\n */\nexport class PluginManager {\n private readonly plugins = new Map<CrossCuttingCapability, CrossCuttingPlugin>();\n\n /**\n * Register a plugin.\n */\n register(plugin: CrossCuttingPlugin): void {\n if (this.plugins.has(plugin.name)) {\n throw new Error(`Plugin already registered: ${plugin.name}`);\n }\n this.plugins.set(plugin.name, plugin);\n }\n\n /**\n * Execute selected plugins on strategy output.\n *\n * capabilities - Which plugins to execute\n * strategyOutput - Output from main strategy\n * context - Execution context\n * Combined artifacts from all plugins\n */\n async execute<T>(\n capabilities: CrossCuttingCapability[],\n strategyOutput: T,\n context: PluginContext\n ): Promise<{\n artifacts: CrossCuttingArtifacts;\n executed: string[];\n errors: Array<{ plugin: string; error: Error }>;\n }> {\n const artifacts: CrossCuttingArtifacts = {};\n const executed: string[] = [];\n const errors: Array<{ plugin: string; error: Error }> = [];\n\n // Execute plugins in parallel\n const results = await Promise.allSettled(\n capabilities.map(async (cap) => {\n const plugin = this.plugins.get(cap);\n if (!plugin) {\n return { capability: cap, result: null };\n }\n\n const result = await plugin.execute(strategyOutput, context);\n return { capability: cap, result };\n })\n );\n\n // Collect results\n for (const result of results) {\n if (result.status === 'fulfilled') {\n const { capability, result: pluginResult } = result.value;\n\n if (pluginResult?.success && pluginResult.artifacts) {\n executed.push(capability);\n this.mergeArtifacts(artifacts, pluginResult.artifacts);\n } else if (pluginResult?.error) {\n errors.push({ plugin: capability, error: pluginResult.error });\n }\n } else {\n // Promise rejected\n errors.push({\n plugin: 'unknown',\n error: result.reason as Error,\n });\n }\n }\n\n return { artifacts, executed, errors };\n }\n\n /**\n * Check if a capability is available.\n */\n has(capability: CrossCuttingCapability): boolean {\n return this.plugins.has(capability);\n }\n\n /**\n * List all registered plugins.\n */\n list(): Array<{ name: CrossCuttingCapability; version: string }> {\n return Array.from(this.plugins.values()).map((p) => ({\n name: p.name,\n version: p.version,\n }));\n }\n\n /**\n * Merge plugin artifacts into combined artifacts.\n */\n private mergeArtifacts(\n target: CrossCuttingArtifacts,\n source: Partial<CrossCuttingArtifacts>\n ): void {\n if (source.diagrams) {\n target.diagrams = [...(target.diagrams ?? []), ...source.diagrams];\n }\n if (source.scripts) {\n target.scripts = [...(target.scripts ?? []), ...source.scripts];\n }\n if (source.configs) {\n target.configs = [...(target.configs ?? []), ...source.configs];\n }\n if (source.workflows) {\n target.workflows = [...(target.workflows ?? []), ...source.workflows];\n }\n if (source.issues) {\n target.issues = [...(target.issues ?? []), ...source.issues];\n }\n }\n}\n\n/**\n * Default singleton instance.\n */\nexport const pluginManager = new PluginManager();\n```\n\n### Step 2.4: Implement Framework Router\n\n```typescript\n// src/domain/router/framework-router.ts\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { StrategyRegistry, strategyRegistry } from './strategy-registry.js';\nimport { PluginManager, pluginManager } from './plugin-manager.js';\nimport type {\n RouterRequest,\n RouterResponse,\n RouterError,\n RouterErrorCode,\n ExecutionSummary,\n OutputApproach,\n CrossCuttingCapability,\n} from './types.js';\n\n/**\n * Framework Router - unified entry point for all output generation.\n *\n * The router:\n * 1. Validates the request\n * 2. Routes to the appropriate strategy\n * 3. Executes cross-cutting plugins\n * 4. Formats the output\n * 5. Returns a consistent response\n *\n * \n * ```typescript\n * const router = new FrameworkRouter();\n *\n * // Simple execution\n * const result = await router.execute({\n * approach: 'speckit',\n * input: {\n * title: 'My Project',\n * overview: 'Project description',\n * objectives: [{ description: 'Build X', priority: 'high' }],\n * requirements: [{ description: 'Must do Y' }],\n * },\n * });\n *\n * // With cross-cutting capabilities\n * const result = await router.execute({\n * approach: 'speckit',\n * input: { ... },\n * capabilities: ['diagram', 'workflow', 'issues'],\n * });\n * ```\n */\nexport class FrameworkRouter {\n constructor(\n private readonly registry: StrategyRegistry = strategyRegistry,\n private readonly plugins: PluginManager = pluginManager\n ) {}\n\n /**\n * Execute a request through the router.\n *\n * request - Router request with approach and input\n * Router response with output and artifacts\n */\n async execute<TInput, TOutput>(\n request: RouterRequest<TInput>\n ): Promise<RouterResponse<TOutput>> {\n const requestId = request.metadata?.requestId ?? uuidv4();\n const startedAt = new Date();\n\n try {\n // Step 1: Validate approach\n if (!this.registry.has(request.approach)) {\n return this.errorResponse(\n 'UNKNOWN_APPROACH',\n `Unknown output approach: ${request.approach}`,\n request.approach,\n requestId,\n startedAt\n );\n }\n\n // Step 2: Get strategy\n const strategy = this.registry.get<TInput, TOutput>(request.approach);\n\n // Step 3: Execute strategy\n const strategyResult = await strategy.execute(request.input);\n\n if (!strategyResult.success) {\n return this.errorResponse(\n 'EXECUTION_FAILED',\n strategyResult.error?.message ?? 'Strategy execution failed',\n request.approach,\n requestId,\n startedAt\n );\n }\n\n // Step 4: Execute plugins (if requested)\n let artifacts = undefined;\n let pluginsExecuted: string[] = [];\n\n if (request.capabilities && request.capabilities.length > 0) {\n const pluginResult = await this.plugins.execute(\n request.capabilities,\n strategyResult.output,\n {\n approach: request.approach,\n requestId,\n metadata: request.metadata ?? {},\n }\n );\n\n artifacts = pluginResult.artifacts;\n pluginsExecuted = pluginResult.executed;\n\n // Log plugin errors but don't fail the request\n if (pluginResult.errors.length > 0) {\n console.warn('Plugin errors:', pluginResult.errors);\n }\n }\n\n // Step 5: Build response\n const completedAt = new Date();\n\n return {\n success: true,\n output: strategyResult.output,\n artifacts,\n trace: {\n requestId,\n approach: request.approach,\n startedAt,\n completedAt,\n durationMs: completedAt.getTime() - startedAt.getTime(),\n strategyVersion: strategy.version,\n pluginsExecuted,\n metrics: strategyResult.trace?.metrics ?? {},\n },\n };\n } catch (error) {\n return this.errorResponse(\n 'EXECUTION_FAILED',\n error instanceof Error ? error.message : 'Unknown error',\n request.approach,\n requestId,\n startedAt,\n error instanceof Error ? error : undefined\n );\n }\n }\n\n /**\n * Get available approaches.\n */\n getApproaches(): OutputApproach[] {\n return this.registry.list().map((s) => s.approach);\n }\n\n /**\n * Get available capabilities.\n */\n getCapabilities(): CrossCuttingCapability[] {\n return this.plugins.list().map((p) => p.name);\n }\n\n /**\n * Check if an approach is supported.\n */\n supportsApproach(approach: OutputApproach): boolean {\n return this.registry.has(approach);\n }\n\n /**\n * Create error response.\n */\n private errorResponse<TOutput>(\n code: RouterErrorCode,\n message: string,\n approach: OutputApproach,\n requestId: string,\n startedAt: Date,\n cause?: Error\n ): RouterResponse<TOutput> {\n const completedAt = new Date();\n\n return {\n success: false,\n error: { code, message, approach, cause },\n trace: {\n requestId,\n approach,\n startedAt,\n completedAt,\n durationMs: completedAt.getTime() - startedAt.getTime(),\n strategyVersion: 'N/A',\n pluginsExecuted: [],\n metrics: {},\n },\n };\n }\n}\n\n/**\n * Default singleton instance.\n */\nexport const frameworkRouter = new FrameworkRouter();\n```\n\n### Step 2.5: Create Router Barrel\n\n```typescript\n// src/domain/router/index.ts\n\n// Types\nexport type {\n OutputApproach,\n CrossCuttingCapability,\n RouterRequest,\n RouterResponse,\n RouterError,\n RouterErrorCode,\n CrossCuttingArtifacts,\n DiagramArtifact,\n ScriptArtifact,\n ConfigArtifact,\n WorkflowArtifact,\n IssueArtifact,\n OutputFormat,\n ExecutionSummary,\n} from './types.js';\n\n// Registry\nexport { StrategyRegistry, strategyRegistry } from './strategy-registry.js';\n\n// Plugin Manager\nexport type { CrossCuttingPlugin, PluginContext, PluginResult } from './plugin-manager.js';\nexport { PluginManager, pluginManager } from './plugin-manager.js';\n\n// Router\nexport { FrameworkRouter, frameworkRouter } from './framework-router.js';\n```\n\n### Step 2.6: Register Default Strategies\n\n```typescript\n// src/domain/router/register-defaults.ts\n\nimport { strategyRegistry } from './strategy-registry.js';\nimport { pluginManager } from './plugin-manager.js';\n\n// Import strategies\nimport { SpecKitStrategy } from '../../strategies/speckit/speckit-strategy.js';\nimport { TOGAFStrategy } from '../../strategies/togaf/togaf-strategy.js';\nimport { ADRStrategy } from '../../strategies/adr/adr-strategy.js';\nimport { RFCStrategy } from '../../strategies/rfc/rfc-strategy.js';\nimport { EnterpriseStrategy } from '../../strategies/enterprise/enterprise-strategy.js';\nimport { SDDStrategy } from '../../strategies/sdd/sdd-strategy.js';\nimport { ChatStrategy } from '../../strategies/chat/chat-strategy.js';\n\n// Import plugins\nimport { DiagramPlugin } from '../../plugins/diagram-plugin.js';\nimport { ShellScriptPlugin } from '../../plugins/shell-script-plugin.js';\nimport { WorkflowPlugin } from '../../plugins/workflow-plugin.js';\nimport { IssuesPlugin } from '../../plugins/issues-plugin.js';\nimport { ConfigPlugin } from '../../plugins/config-plugin.js';\nimport { PRTemplatePlugin } from '../../plugins/pr-template-plugin.js';\n\n/**\n * Register all default strategies and plugins.\n *\n * Called once at application startup.\n */\nexport function registerDefaults(): void {\n // Register strategies\n strategyRegistry.register('speckit', () => new SpecKitStrategy(), {\n version: '2.0.0',\n description: 'Generate project specification artifacts (spec.md, plan.md, tasks.md, etc.)',\n singleton: true,\n });\n\n strategyRegistry.register('togaf', () => new TOGAFStrategy(), {\n version: '2.0.0',\n description: 'Generate TOGAF architecture documentation',\n singleton: true,\n });\n\n strategyRegistry.register('adr', () => new ADRStrategy(), {\n version: '2.0.0',\n description: 'Generate Architecture Decision Records',\n singleton: true,\n });\n\n strategyRegistry.register('rfc', () => new RFCStrategy(), {\n version: '2.0.0',\n description: 'Generate Request for Comments documents',\n singleton: true,\n });\n\n strategyRegistry.register('enterprise', () => new EnterpriseStrategy(), {\n version: '2.0.0',\n description: 'Generate enterprise architecture documentation',\n singleton: true,\n });\n\n strategyRegistry.register('sdd', () => new SDDStrategy(), {\n version: '2.0.0',\n description: 'Generate Software Design Documents',\n singleton: true,\n });\n\n strategyRegistry.register('chat', () => new ChatStrategy(), {\n version: '2.0.0',\n description: 'Generate conversational responses',\n singleton: true,\n });\n\n // Register plugins\n pluginManager.register(new DiagramPlugin());\n pluginManager.register(new ShellScriptPlugin());\n pluginManager.register(new WorkflowPlugin());\n pluginManager.register(new IssuesPlugin());\n pluginManager.register(new ConfigPlugin());\n pluginManager.register(new PRTemplatePlugin());\n}\n```\n\n---\n\n## 3. Usage in MCP Tools\n\n### Before (Direct Strategy)\n\n```typescript\n// ‚ùå Old pattern - direct strategy instantiation\nimport { SpecKitStrategy } from '../strategies/speckit-strategy.js';\n\nasync function handleSpecKitTool(input: SpecKitInput) {\n const strategy = new SpecKitStrategy();\n const result = await strategy.execute(input);\n\n return {\n content: [{ type: 'text', text: result.output?.artifacts.spec ?? '' }],\n };\n}\n```\n\n### After (Using Router)\n\n```typescript\n// ‚úÖ New pattern - using Framework Router\nimport { frameworkRouter } from '../domain/router/index.js';\nimport type { SpecKitInput, SpecKitOutput } from '../domain/speckit/types.js';\n\nasync function handleSpecKitTool(input: SpecKitInput) {\n const result = await frameworkRouter.execute<SpecKitInput, SpecKitOutput>({\n approach: 'speckit',\n input,\n capabilities: ['diagram', 'issues'], // Optional cross-cutting\n });\n\n if (!result.success) {\n throw new Error(result.error?.message ?? 'Failed to generate spec');\n }\n\n // Access artifacts\n const spec = result.output?.artifacts.spec ?? '';\n const diagrams = result.artifacts?.diagrams ?? [];\n\n return {\n content: [\n { type: 'text', text: spec },\n ...diagrams.map(d => ({ type: 'text', text: `\\n\\n${d.content}` })),\n ],\n };\n}\n```\n\n---\n\n## 4. Test Coverage\n\n```typescript\n// tests/vitest/domain/router/framework-router.spec.ts\n\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { FrameworkRouter } from '../../../../src/domain/router/framework-router.js';\nimport { StrategyRegistry } from '../../../../src/domain/router/strategy-registry.js';\nimport { PluginManager } from '../../../../src/domain/router/plugin-manager.js';\nimport { BaseStrategy } from '../../../../src/domain/base-strategy/index.js';\nimport { z } from 'zod';\n\n// Mock strategy for testing\nclass MockStrategy extends BaseStrategy<{ value: string }, { result: string }> {\n readonly name = 'mock';\n readonly version = '1.0.0';\n\n constructor() {\n super(z.object({ value: z.string() }));\n }\n\n protected async executeStrategy(input: { value: string }) {\n return { result: `processed: ${input.value}` };\n }\n}\n\ndescribe('FrameworkRouter', () => {\n let registry: StrategyRegistry;\n let plugins: PluginManager;\n let router: FrameworkRouter;\n\n beforeEach(() => {\n registry = new StrategyRegistry();\n plugins = new PluginManager();\n router = new FrameworkRouter(registry, plugins);\n\n // Register mock strategy\n registry.register('speckit' as any, () => new MockStrategy(), {\n version: '1.0.0',\n description: 'Mock strategy for testing',\n singleton: true,\n });\n });\n\n describe('execute', () => {\n it('should route to correct strategy', async () => {\n const result = await router.execute({\n approach: 'speckit',\n input: { value: 'test' },\n });\n\n expect(result.success).toBe(true);\n expect(result.output).toEqual({ result: 'processed: test' });\n });\n\n it('should return error for unknown approach', async () => {\n const result = await router.execute({\n approach: 'unknown' as any,\n input: {},\n });\n\n expect(result.success).toBe(false);\n expect(result.error?.code).toBe('UNKNOWN_APPROACH');\n });\n\n it('should include execution trace', async () => {\n const result = await router.execute({\n approach: 'speckit',\n input: { value: 'test' },\n });\n\n expect(result.trace).toBeDefined();\n expect(result.trace.approach).toBe('speckit');\n expect(result.trace.durationMs).toBeGreaterThanOrEqual(0);\n expect(result.trace.strategyVersion).toBe('1.0.0');\n });\n\n it('should use provided request ID', async () => {\n const result = await router.execute({\n approach: 'speckit',\n input: { value: 'test' },\n metadata: { requestId: 'custom-id' },\n });\n\n expect(result.trace.requestId).toBe('custom-id');\n });\n });\n\n describe('getApproaches', () => {\n it('should list registered approaches', () => {\n const approaches = router.getApproaches();\n expect(approaches).toContain('speckit');\n });\n });\n\n describe('supportsApproach', () => {\n it('should return true for registered approach', () => {\n expect(router.supportsApproach('speckit')).toBe(true);\n });\n\n it('should return false for unknown approach', () => {\n expect(router.supportsApproach('unknown' as any)).toBe(false);\n });\n });\n});\n```\n\n```typescript\n// tests/vitest/domain/router/strategy-registry.spec.ts\n\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { StrategyRegistry } from '../../../../src/domain/router/strategy-registry.js';\nimport { BaseStrategy } from '../../../../src/domain/base-strategy/index.js';\nimport { z } from 'zod';\n\nclass TestStrategy extends BaseStrategy<{}, {}> {\n static instanceCount = 0;\n readonly name = 'test';\n readonly version = '1.0.0';\n\n constructor() {\n super(z.object({}));\n TestStrategy.instanceCount++;\n }\n\n protected async executeStrategy() {\n return {};\n }\n}\n\ndescribe('StrategyRegistry', () => {\n let registry: StrategyRegistry;\n\n beforeEach(() => {\n registry = new StrategyRegistry();\n TestStrategy.instanceCount = 0;\n });\n\n it('should register and retrieve strategy', () => {\n registry.register('speckit' as any, () => new TestStrategy(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n const strategy = registry.get('speckit' as any);\n expect(strategy).toBeInstanceOf(TestStrategy);\n });\n\n it('should cache singleton strategies', () => {\n registry.register('speckit' as any, () => new TestStrategy(), {\n version: '1.0.0',\n description: 'Test',\n singleton: true,\n });\n\n registry.get('speckit' as any);\n registry.get('speckit' as any);\n registry.get('speckit' as any);\n\n expect(TestStrategy.instanceCount).toBe(1);\n });\n\n it('should create new instances for non-singletons', () => {\n registry.register('speckit' as any, () => new TestStrategy(), {\n version: '1.0.0',\n description: 'Test',\n singleton: false,\n });\n\n registry.get('speckit' as any);\n registry.get('speckit' as any);\n registry.get('speckit' as any);\n\n expect(TestStrategy.instanceCount).toBe(3);\n });\n\n it('should throw on duplicate registration', () => {\n registry.register('speckit' as any, () => new TestStrategy(), {\n version: '1.0.0',\n description: 'Test',\n });\n\n expect(() => {\n registry.register('speckit' as any, () => new TestStrategy(), {\n version: '1.0.0',\n description: 'Test',\n });\n }).toThrow('already registered');\n });\n\n it('should throw for unregistered approach', () => {\n expect(() => {\n registry.get('unknown' as any);\n }).toThrow('No strategy registered');\n });\n});\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------------------- | ------ | --------------------- |\n| StrategyRegistry manages all strategies | ‚¨ú | Unit tests pass |\n| PluginManager executes cross-cutting plugins | ‚¨ú | Plugin tests pass |\n| FrameworkRouter routes to correct strategy | ‚¨ú | Routing tests pass |\n| Singleton caching works | ‚¨ú | Instance count test |\n| Error handling returns proper codes | ‚¨ú | Error tests pass |\n| Execution trace included in response | ‚¨ú | Trace assertions pass |\n| Default strategies registered at startup | ‚¨ú | Integration test |\n| 90% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 6. References\n\n| Document | Link |\n| -------------------------- | ---------------------------------------------------------------------------------- |\n| T-011: Migrate SpecKit | [T-011-migrate-speckit.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-2-migration/T-011-migrate-speckit.md) |\n| ADR-002: Framework Router | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-002) |\n| Current output-strategy.ts | [src/strategies/output-strategy.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/strategies/output-strategy.ts) |\n\n---\n\n*Task: T-037 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-037",
		"dependencies": ["T-011", "T-016"],
		"estimate_hours": 8,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-037-framework-router.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-037-framework-router.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-038: Implement Framework Router",
		"body": "# T-038: Implement Framework Router\n\n## Overview\n\n**Task ID**: T-038\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-037\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement Framework Router' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-038\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement Framework Router fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-037\n\n### Target Files\n\n- `src/frameworks/registry.ts`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Review Existing State\n\n- Locate related code and determine current gaps\n- Confirm requirements from tasks.md\n\n### Step 4.2: Implement Core Changes\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nexport class FrameworkRouter {\n private registry = new Map<string, Framework>();\n\n register(name: string, framework: Framework): void {\n this.registry.set(name, framework);\n }\n\n get(name: string): Framework {\n const framework = this.registry.get(name);\n if (!framework) throw new Error(`Unknown framework: ${name}`);\n return framework;\n }\n}\n```\n\n### Step 4.3: Wire Integrations\n\n- Update barrel exports and registries\n- Register new handler or service if required\n- Add configuration entries where needed\n\n### Step 4.4: Validate Behavior\n\n- Run unit tests for new logic\n- Ensure TypeScript strict mode passes\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Implementation completed per requirements | ‚¨ú | `npm run quality` |\n| Integration points wired and documented | ‚¨ú | Code review |\n| Quality checks pass | ‚¨ú | `npm run quality` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `src/frameworks/registry.ts`\n\n---\n\n*Task: T-038 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-038",
		"dependencies": ["T-037"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-039: Consolidate Prompt Engineering Framework",
		"body": "# T-039: Consolidate Prompt Engineering Framework\n\n## Overview\n\n**Task ID**: T-039\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-039-consolidate-prompt-engineering-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Prompt Engineering Framework' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-039\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Consolidate Prompt Engineering Framework fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Unified Prompt Engineering Interface\n\nCreate `src/tools/prompt/framework/prompt-framework.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\nimport type { PromptConfig, PromptOutput, PromptTechnique } from './types.js';\n\n/**\n * Unified Prompt Engineering Framework\n * Consolidates all prompt building patterns into a single coherent interface\n */\n\n// Technique Registry Schema\nexport const techniqueSchema = z.enum([\n 'zero-shot', 'few-shot', 'chain-of-thought', 'self-consistency',\n 'in-context-learning', 'generate-knowledge', 'prompt-chaining',\n 'tree-of-thoughts', 'meta-prompting', 'rag', 'react', 'art'\n]).describe('Prompting technique');\n\n// Unified Framework Config\nexport const promptFrameworkConfigSchema = z.object({\n // Core settings\n style: z.enum(['markdown', 'xml', 'json']).default('markdown'),\n provider: z.string().optional().describe('Target LLM provider'),\n model: z.string().optional().describe('Target model'),\n\n // Technique selection\n techniques: z.array(techniqueSchema).default(['zero-shot']),\n autoSelectTechniques: z.boolean().default(false),\n\n // Output settings\n includeFrontmatter: z.boolean().default(true),\n includeMetadata: z.boolean().default(true),\n includeReferences: z.boolean().default(false),\n includeTechniqueHints: z.boolean().default(true),\n\n // Content settings\n maxTokens: z.number().optional(),\n temperature: z.number().min(0).max(2).optional(),\n});\n\nexport type PromptFrameworkConfig = z.infer<typeof promptFrameworkConfigSchema>;\n\n// Framework Implementation\nexport class PromptFramework {\n constructor(private config: PromptFrameworkConfig) {}\n\n /**\n * Build a prompt using the configured techniques\n */\n async build(context: PromptBuildContext): Promise<PromptOutput> {\n const techniques = this.config.autoSelectTechniques\n ? this.selectTechniques(context)\n : this.config.techniques;\n\n const sections = await this.buildSections(context, techniques);\n return this.assemblePrompt(sections);\n }\n\n private selectTechniques(context: PromptBuildContext): PromptTechnique[] {\n const selected: PromptTechnique[] = [];\n\n if (context.examples && context.examples.length > 0) {\n selected.push('few-shot');\n }\n if (context.requiresReasoning) {\n selected.push('chain-of-thought');\n }\n if (context.hasKnowledgeBase) {\n selected.push('rag');\n }\n\n return selected.length > 0 ? selected : ['zero-shot'];\n }\n\n private async buildSections(\n context: PromptBuildContext,\n techniques: PromptTechnique[]\n ): Promise<PromptSection[]> {\n const sections: PromptSection[] = [];\n\n if (this.config.includeFrontmatter) {\n sections.push(this.buildFrontmatter(context));\n }\n\n sections.push(this.buildSystemSection(context));\n sections.push(this.buildTaskSection(context));\n\n for (const technique of techniques) {\n sections.push(await this.buildTechniqueSection(technique, context));\n }\n\n if (this.config.includeMetadata) {\n sections.push(this.buildMetadataSection());\n }\n\n return sections;\n }\n\n private assemblePrompt(sections: PromptSection[]): PromptOutput {\n const content = sections.map(s => s.content).join('\\n\\n');\n return {\n content,\n format: this.config.style,\n sections: sections.map(s => s.name),\n metadata: { timestamp: new Date().toISOString() },\n };\n }\n}\n```\n\n### Step 4.2: Create Technique Implementations\n\nCreate `src/tools/prompt/framework/techniques/index.ts`:\n\n```typescript\nimport type { TechniqueBuilder, PromptBuildContext, PromptSection } from '../types.js';\n\nexport const techniqueBuilders: Record<string, TechniqueBuilder> = {\n 'zero-shot': buildZeroShot,\n 'few-shot': buildFewShot,\n 'chain-of-thought': buildChainOfThought,\n 'self-consistency': buildSelfConsistency,\n 'rag': buildRAG,\n 'react': buildReAct,\n};\n\nfunction buildZeroShot(context: PromptBuildContext): PromptSection {\n return {\n name: 'task',\n content: `## Task\\n\\n${context.task}`,\n };\n}\n\nfunction buildFewShot(context: PromptBuildContext): PromptSection {\n const examples = context.examples?.map((ex, i) =>\n `### Example ${i + 1}\\n\\n**Input:** ${ex.input}\\n**Output:** ${ex.output}`\n ).join('\\n\\n');\n\n return {\n name: 'examples',\n content: `## Examples\\n\\n${examples}`,\n };\n}\n\nfunction buildChainOfThought(context: PromptBuildContext): PromptSection {\n return {\n name: 'reasoning',\n content: `## Reasoning Process\\n\\nThink through this step by step:\\n1. First, analyze the input\\n2. Consider relevant constraints\\n3. Generate potential solutions\\n4. Evaluate and select the best approach\\n5. Provide your final answer`,\n };\n}\n```\n\n### Step 4.3: Create Framework Factory\n\nCreate `src/tools/prompt/framework/factory.ts`:\n\n```typescript\nimport { PromptFramework, promptFrameworkConfigSchema } from './prompt-framework.js';\nimport type { PromptFrameworkConfig } from './prompt-framework.js';\n\nlet instance: PromptFramework | null = null;\n\nexport function createPromptFramework(config: Partial<PromptFrameworkConfig> = {}): PromptFramework {\n const validated = promptFrameworkConfigSchema.parse(config);\n return new PromptFramework(validated);\n}\n\nexport function getPromptFramework(): PromptFramework {\n if (!instance) {\n instance = createPromptFramework();\n }\n return instance;\n}\n```\n\n### Step 4.4: Export from Barrel\n\nUpdate `src/tools/prompt/index.ts`:\n\n```typescript\nexport { PromptFramework, promptFrameworkConfigSchema } from './framework/prompt-framework.js';\nexport { createPromptFramework, getPromptFramework } from './framework/factory.js';\nexport { techniqueBuilders } from './framework/techniques/index.js';\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-039 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-039",
		"dependencies": ["T-038"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-039-consolidate-prompt-engineering-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-039-consolidate-prompt-engineering-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-040: Consolidate Code Quality Framework",
		"body": "# T-040: Consolidate Code Quality Framework\n\n## Overview\n\n**Task ID**: T-040\n**Phase**: 3 - Framework Consolidation\n**Priority**: P0 (Critical Path)\n**Estimate**: 4h\n**Dependencies**: T-038 (Framework Router)\n**Blocks**: T-049 (Test Framework Consolidation)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-040-consolidate-code-quality-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nConsolidate 4 code quality tools into a unified \"Code Quality & Analysis\" framework routed via FrameworkRouter (REQ-010).\n\n### Why\n\n- **REQ-010 Compliance**: Consolidate 30+ tools into 11 frameworks\n- **Reduce Duplication**: 4 tools share scoring logic, hygiene patterns\n- **Single Entry Point**: Route via `framework: 'code-quality'`\n\n### Tools to Consolidate\n\n| Current Tool | Lines | Purpose |\n| ----------------------------- | ----- | ------------------------- |\n| `clean-code-scorer` | 580 | Quality score 0-100 |\n| `code-hygiene-analyzer` | 420 | Patterns/dependencies |\n| `iterative-coverage-enhancer` | 510 | Coverage gap detection |\n| `semantic-code-analyzer` | 390 | Symbol/structure analysis |\n\n### Deliverables\n\n- `src/frameworks/code-quality/index.ts` - Framework entry\n- `src/frameworks/code-quality/router.ts` - Action routing\n- Updated `src/frameworks/index.ts` - Barrel export\n- Unit tests in `tests/vitest/frameworks/code-quality/`\n\n## 2. Context and Scope\n\n### Current State\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```\nsrc/tools/analysis/\n‚îú‚îÄ‚îÄ clean-code-scorer.ts (standalone tool)\n‚îú‚îÄ‚îÄ code-hygiene-analyzer.ts (standalone tool)\n‚îú‚îÄ‚îÄ iterative-coverage-enhancer.ts\n‚îî‚îÄ‚îÄ ...\nsrc/tools/\n‚îî‚îÄ‚îÄ semantic-code-analyzer.ts (standalone tool)\n```\n\n### Target State\n\n```\nsrc/frameworks/code-quality/\n‚îú‚îÄ‚îÄ index.ts (Framework definition)\n‚îú‚îÄ‚îÄ router.ts (Action routing)\n‚îú‚îÄ‚îÄ types.ts (Shared types)\n‚îî‚îÄ‚îÄ actions/\n ‚îú‚îÄ‚îÄ score.ts (‚Üí clean-code-scorer)\n ‚îú‚îÄ‚îÄ hygiene.ts (‚Üí code-hygiene-analyzer)\n ‚îú‚îÄ‚îÄ coverage.ts (‚Üí iterative-coverage-enhancer)\n ‚îî‚îÄ‚îÄ semantic.ts (‚Üí semantic-code-analyzer)\n```\n\n### Out of Scope\n\n- Rewriting tool internals\n- Breaking existing tool APIs\n- Performance optimization\n\n## 3. Prerequisites\n\n### Dependencies\n\n| Task | Status | Purpose |\n| ----- | -------- | ------------------------------ |\n| T-038 | Complete | FrameworkRouter infrastructure |\n\n### Target Files\n\n| File | Action | Purpose |\n| ------------------------------------------------ | ------ | -------------------- |\n| `src/frameworks/code-quality/index.ts` | Create | Framework definition |\n| `src/frameworks/code-quality/router.ts` | Create | Action routing |\n| `src/frameworks/code-quality/types.ts` | Create | Shared types |\n| `src/frameworks/index.ts` | Modify | Add export |\n| `tests/vitest/frameworks/code-quality/*.spec.ts` | Create | Unit tests |\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Framework Types\n\n```typescript\n// src/frameworks/code-quality/types.ts\n\nimport { z } from \"zod\";\n\nexport const CodeQualityActionEnum = z.enum([\n \"score\", // Calculate quality score\n \"hygiene\", // Analyze code hygiene\n \"coverage\", // Analyze test coverage\n \"semantic\", // Semantic code analysis\n]);\n\nexport type CodeQualityAction = z.infer<typeof CodeQualityActionEnum>;\n\nexport const CodeQualityInputSchema = z.object({\n action: CodeQualityActionEnum.describe(\"Quality analysis action\"),\n codeContent: z.string().optional().describe(\"Code to analyze\"),\n projectPath: z.string().optional().describe(\"Path to project\"),\n language: z.string().optional().describe(\"Programming language\"),\n framework: z.string().optional().describe(\"Framework/stack\"),\n coverageMetrics: z.object({\n lines: z.number().min(0).max(100).optional(),\n branches: z.number().min(0).max(100).optional(),\n functions: z.number().min(0).max(100).optional(),\n statements: z.number().min(0).max(100).optional(),\n }).optional().describe(\"Current coverage metrics\"),\n includeReferences: z.boolean().optional().default(true),\n includeMetadata: z.boolean().optional().default(true),\n});\n\nexport type CodeQualityInput = z.infer<typeof CodeQualityInputSchema>;\n```\n\n### Step 4.2: Create Action Router\n\n```typescript\n// src/frameworks/code-quality/router.ts\n\nimport type { CallToolResult } from \"/sdk/types.js\";\nimport { cleanCodeScorer } from \"../../tools/analysis/clean-code-scorer.js\";\nimport { codeHygieneAnalyzer } from \"../../tools/analysis/code-hygiene-analyzer.js\";\nimport { iterativeCoverageEnhancer } from \"../../tools/analysis/iterative-coverage-enhancer.js\";\nimport { semanticCodeAnalyzer } from \"../../tools/semantic-code-analyzer.js\";\nimport type { CodeQualityInput, CodeQualityAction } from \"./types.js\";\n\nconst actionHandlers: Record<CodeQualityAction, (input: CodeQualityInput) => Promise<CallToolResult>> = {\n score: async (input) => cleanCodeScorer({\n codeContent: input.codeContent,\n projectPath: input.projectPath,\n language: input.language,\n framework: input.framework,\n coverageMetrics: input.coverageMetrics,\n includeReferences: input.includeReferences,\n includeMetadata: input.includeMetadata,\n }),\n\n hygiene: async (input) => codeHygieneAnalyzer({\n codeContent: input.codeContent ?? \"\",\n language: input.language ?? \"typescript\",\n framework: input.framework,\n includeReferences: input.includeReferences,\n }),\n\n coverage: async (input) => iterativeCoverageEnhancer({\n projectPath: input.projectPath,\n language: input.language,\n framework: input.framework,\n currentCoverage: input.coverageMetrics,\n analyzeCoverageGaps: true,\n generateTestSuggestions: true,\n includeReferences: input.includeReferences,\n }),\n\n semantic: async (input) => semanticCodeAnalyzer({\n codeContent: input.codeContent ?? \"\",\n language: input.language,\n analysisType: \"all\",\n includeReferences: input.includeReferences,\n includeMetadata: input.includeMetadata,\n }),\n};\n\nexport async function routeCodeQualityAction(\n input: CodeQualityInput\n): Promise<CallToolResult> {\n const handler = actionHandlers[input.action];\n if (!handler) {\n throw new Error(`Unknown code-quality action: ${input.action}`);\n }\n return handler(input);\n}\n```\n\n### Step 4.3: Create Framework Entry Point\n\n```typescript\n// src/frameworks/code-quality/index.ts\n\nimport type { CallToolResult } from \"/sdk/types.js\";\nimport type { FrameworkDefinition } from \"../types.js\";\nimport { CodeQualityInputSchema, type CodeQualityInput } from \"./types.js\";\nimport { routeCodeQualityAction } from \"./router.js\";\n\nexport const codeQualityFramework: FrameworkDefinition = {\n name: \"code-quality\",\n description: \"Code quality analysis: scoring, hygiene, coverage, and semantic analysis\",\n version: \"1.0.0\",\n schema: CodeQualityInputSchema,\n actions: [\"score\", \"hygiene\", \"coverage\", \"semantic\"],\n\n async execute(input: unknown): Promise<CallToolResult> {\n const validated = CodeQualityInputSchema.parse(input);\n return routeCodeQualityAction(validated);\n },\n};\n\nexport { CodeQualityInputSchema, type CodeQualityInput } from \"./types.js\";\n```\n\n### Step 4.4: Update Barrel Export\n\n```typescript\n// src/frameworks/index.ts (add to existing)\n\nexport { codeQualityFramework } from \"./code-quality/index.js\";\n```\n\n### Step 4.5: Register with FrameworkRouter\n\n```typescript\n// In FrameworkRouter initialization\nrouter.register(codeQualityFramework);\n```\n\n## 5. Testing Strategy\n\n```typescript\n// tests/vitest/frameworks/code-quality/router.spec.ts\n\nimport { describe, it, expect, vi } from \"vitest\";\nimport { routeCodeQualityAction } from \"../../../../src/frameworks/code-quality/router.js\";\n\nvi.mock(\"../../../../src/tools/analysis/clean-code-scorer.js\", () => ({\n cleanCodeScorer: vi.fn().mockResolvedValue({ content: [{ type: \"text\", text: \"Score: 85\" }] }),\n}));\n\ndescribe(\"Code Quality Router\", () => {\n it(\"routes 'score' to cleanCodeScorer\", async () => {\n const result = await routeCodeQualityAction({\n action: \"score\",\n codeContent: \"const x = 1;\",\n language: \"typescript\",\n });\n expect(result.content).toBeDefined();\n });\n\n it(\"throws on unknown action\", async () => {\n await expect(\n routeCodeQualityAction({ action: \"invalid\" as any })\n ).rejects.toThrow(\"Unknown code-quality action\");\n });\n});\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| ---------------------------- | ---------- | ------ | ------------------------------ |\n| Breaking existing tool calls | Medium | High | Tools remain callable directly |\n| Input mapping errors | Medium | Medium | Comprehensive test coverage |\n| Performance overhead | Low | Low | Thin routing layer |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------- | ------ | -------------------- |\n| Framework routes all 4 actions | ‚¨ú | Router test passes |\n| Schema validates inputs | ‚¨ú | Schema test passes |\n| Registered with FrameworkRouter | ‚¨ú | Import test passes |\n| TypeScript strict passes | ‚¨ú | `npm run type-check` |\n| Test coverage ‚â•90% | ‚¨ú | Coverage report |\n\n---\n\n## 8. References\n\n- [spec.md - REQ-010](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [T-038 Framework Router](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md)\n- [clean-code-scorer.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/analysis/clean-code-scorer.ts)\n- [code-hygiene-analyzer.ts](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/analysis/code-hygiene-analyzer.ts)\n\n---\n\n*Task: T-040 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-040",
		"dependencies": ["T-038"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-040-consolidate-code-quality-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-040-consolidate-code-quality-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-041: Consolidate Design & Architecture Framework",
		"body": "# T-041: Consolidate Design & Architecture Framework\n\n## Overview\n\n**Task ID**: T-041\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-041-consolidate-design-architecture-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Design & Architecture Framework' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-041\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\nFrom spec.md baseline:\n- `architecture-design-prompt-builder.ts` - Architecture prompts\n- `l9-distinguished-engineer-prompt-builder.ts` - L9 engineering prompts\n- `digital-enterprise-architect-prompt-builder.ts` - Enterprise prompts\n- ~35% code duplication between these tools\n\n### Target State\n\nPer ADR-005 Framework Consolidation:\n- Single `DesignArchitectureFramework` in `src/frameworks/design-architecture/`\n- Unified interface with action-based routing\n- Actions: `architecture`, `l9-engineering`, `enterprise-architect`\n- Shared validation, output formatting, and template rendering\n\n### Out of Scope\n\n- Prompt content changes (only structural consolidation)\n- Breaking external API (facades maintain compatibility)\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038: Framework Router implemented\n\n### Target Files\n\n- `src/frameworks/design-architecture/index.ts` (new)\n- `src/frameworks/design-architecture/handler.ts`\n- `src/frameworks/design-architecture/actions/` (3 actions)\n- `src/frameworks/design-architecture/schema.ts`\n- `src/frameworks/design-architecture/types.ts`\n\n### Tooling\n\n- Node.js 22.x\n- Zod for schema validation\n- Handlebars for template rendering\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Framework Structure\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nmkdir -p src/frameworks/design-architecture/actions\n```\n\n### Step 4.2: Define Schema\n\n**File**: `src/frameworks/design-architecture/schema.ts`\n```typescript\nimport { z } from 'zod';\n\nexport const designArchitectureSchema = z.object({\n action: z.enum(['architecture', 'l9-engineering', 'enterprise-architect']),\n projectContext: z.string().optional(),\n requirements: z.array(z.string()).optional(),\n constraints: z.array(z.string()).optional(),\n technicalStack: z.array(z.string()).optional(),\n outputFormat: z.enum(['markdown', 'json']).default('markdown'),\n});\n\nexport type DesignArchitectureInput = z.infer<typeof designArchitectureSchema>;\n```\n\n### Step 4.3: Implement Handler\n\n**File**: `src/frameworks/design-architecture/handler.ts`\n```typescript\nimport { designArchitectureSchema, DesignArchitectureInput } from './schema.js';\nimport { architectureAction } from './actions/architecture.js';\nimport { l9EngineeringAction } from './actions/l9-engineering.js';\nimport { enterpriseArchitectAction } from './actions/enterprise-architect.js';\n\nconst actionHandlers = {\n 'architecture': architectureAction,\n 'l9-engineering': l9EngineeringAction,\n 'enterprise-architect': enterpriseArchitectAction,\n};\n\nexport async function handleDesignArchitecture(input: unknown) {\n const validated = designArchitectureSchema.parse(input);\n const handler = actionHandlers[validated.action];\n return handler(validated);\n}\n```\n\n### Step 4.4: Implement Actions\n\n**File**: `src/frameworks/design-architecture/actions/architecture.ts`\n```typescript\nimport { DesignArchitectureInput } from '../schema.js';\nimport { formatOutput } from '../../shared/output-formatter.js';\n\nexport async function architectureAction(input: DesignArchitectureInput) {\n // Consolidate logic from architecture-design-prompt-builder.ts\n const prompt = buildArchitecturePrompt(input);\n return formatOutput(prompt, input.outputFormat);\n}\n```\n\n### Step 4.5: Register in Framework Router\n\n```typescript\n// In src/frameworks/registry.ts\nimport { handleDesignArchitecture } from './design-architecture/handler.js';\n\nframeworkRouter.register('design-architecture', handleDesignArchitecture);\n```\n\n## 5. Testing Strategy\n\n- Confirm architecture review approval\n- Align with spec requirements\n- Ensure follow-on implementation tasks reference the design\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------------ | ------ | -------------------------------------------------------------- |\n| Framework handler created | ‚¨ú | File exists at `src/frameworks/design-architecture/handler.ts` |\n| All 3 actions implemented | ‚¨ú | `architecture`, `l9-engineering`, `enterprise-architect` |\n| Schema validates inputs | ‚¨ú | Zod schema with TypeScript inference |\n| Registered in router | ‚¨ú | `frameworkRouter.get('design-architecture')` returns handler |\n| Unit tests pass | ‚¨ú | `npm run test:vitest -- design-architecture` |\n| Legacy tools route through framework | ‚¨ú | Old tool calls redirect to new handler |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - Framework Consolidation requirements\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-005 (Framework Consolidation)\n- [T-038](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md) - Framework Router\n\n---\n\n*Task: T-041 | Phase: 3-Consolidation | Priority: P0*\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-041 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-041",
		"dependencies": ["T-038"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-041-consolidate-design-architecture-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-041-consolidate-design-architecture-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-042: Consolidate Security Framework",
		"body": "# T-042: Consolidate Security Framework\n\n## Overview\n\n**Task ID**: T-042\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-042-consolidate-security-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Security Framework' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-042\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\nFrom spec.md baseline:\n- `security-hardening-prompt-builder.ts` - OWASP/security prompts\n- `dependency-auditor.ts` - Dependency vulnerability scanning\n- Separate tools with overlapping security concerns\n\n### Target State\n\nPer ADR-005 Framework Consolidation:\n- Single `SecurityFramework` in `src/frameworks/security/`\n- Actions: `hardening`, `audit`, `compliance`, `threat-model`\n- Unified OWASP integration and vulnerability database\n- Shared severity classification and remediation suggestions\n\n### Out of Scope\n\n- New security features (only consolidation)\n- External security scanner integrations\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038: Framework Router implemented\n\n### Target Files\n\n- `src/frameworks/security/index.ts` (new)\n- `src/frameworks/security/handler.ts`\n- `src/frameworks/security/actions/` (4 actions)\n- `src/frameworks/security/schema.ts`\n- `src/frameworks/security/owasp-rules.ts`\n\n### Tooling\n\n- Node.js 22.x\n- Zod for schema validation\n\n## 4. Implementation Guide\n\n### Step 4.1: Define Schema\n\n**File**: `src/frameworks/security/schema.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\n\nexport const securityFrameworkSchema = z.object({\n action: z.enum(['hardening', 'audit', 'compliance', 'threat-model']),\n targetCode: z.string().optional(),\n dependencyFile: z.string().optional(),\n complianceStandards: z.array(z.enum(['OWASP', 'SOC2', 'HIPAA', 'PCI-DSS'])).optional(),\n severity: z.enum(['critical', 'high', 'medium', 'low', 'all']).default('all'),\n outputFormat: z.enum(['markdown', 'json', 'sarif']).default('markdown'),\n});\n\nexport type SecurityFrameworkInput = z.infer<typeof securityFrameworkSchema>;\n```\n\n### Step 4.2: Implement Handler\n\n**File**: `src/frameworks/security/handler.ts`\n```typescript\nimport { securityFrameworkSchema, SecurityFrameworkInput } from './schema.js';\nimport { hardeningAction } from './actions/hardening.js';\nimport { auditAction } from './actions/audit.js';\nimport { complianceAction } from './actions/compliance.js';\nimport { threatModelAction } from './actions/threat-model.js';\n\nconst actionHandlers = {\n 'hardening': hardeningAction,\n 'audit': auditAction,\n 'compliance': complianceAction,\n 'threat-model': threatModelAction,\n};\n\nexport async function handleSecurity(input: unknown) {\n const validated = securityFrameworkSchema.parse(input);\n const handler = actionHandlers[validated.action];\n return handler(validated);\n}\n```\n\n### Step 4.3: Implement Actions\n\n**File**: `src/frameworks/security/actions/hardening.ts`\n```typescript\nimport { SecurityFrameworkInput } from '../schema.js';\nimport { owaspRules } from '../owasp-rules.js';\n\nexport async function hardeningAction(input: SecurityFrameworkInput) {\n // Consolidate logic from security-hardening-prompt-builder.ts\n const relevantRules = owaspRules.filter(r =>\n input.complianceStandards?.includes(r.standard) ?? true\n );\n\n return {\n recommendations: relevantRules.map(r => ({\n rule: r.id,\n description: r.description,\n severity: r.severity,\n remediation: r.remediation,\n })),\n };\n}\n```\n\n### Step 4.4: Register in Framework Router\n\n```typescript\n// In src/frameworks/registry.ts\nimport { handleSecurity } from './security/handler.js';\n\nframeworkRouter.register('security', handleSecurity);\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-042 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-042",
		"dependencies": ["T-038"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-042-consolidate-security-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-042-consolidate-security-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-043: Consolidate Testing Framework",
		"body": "# T-043: Consolidate Testing Framework\n\n## Overview\n\n**Task ID**: T-043\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-043-consolidate-testing-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Testing Framework' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-043\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\nFrom spec.md baseline:\n- `iterative-coverage-enhancer.ts` - Coverage gap analysis\n- `coverage-dashboard-design-prompt-builder.ts` - Dashboard UI prompts\n- Separate test utilities across multiple files\n\n### Target State\n\nPer ADR-005 Framework Consolidation:\n- Single `TestingFramework` in `src/frameworks/testing/`\n- Actions: `coverage-analysis`, `gap-detection`, `dashboard-design`, `test-generation`\n- Unified coverage metrics and threshold management\n- Shared test pattern recommendations\n\n### Out of Scope\n\n- Actual test execution (delegated to Vitest)\n- Test file generation (suggestions only)\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038: Framework Router implemented\n\n### Target Files\n\n- `src/frameworks/testing/index.ts` (new)\n- `src/frameworks/testing/handler.ts`\n- `src/frameworks/testing/actions/` (4 actions)\n- `src/frameworks/testing/schema.ts`\n- `src/frameworks/testing/coverage-analyzer.ts`\n\n### Tooling\n\n- Node.js 22.x\n- Vitest for test execution\n- c8/istanbul for coverage data\n\n## 4. Implementation Guide\n\n### Step 4.1: Define Schema\n\n**File**: `src/frameworks/testing/schema.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\n\nexport const testingFrameworkSchema = z.object({\n action: z.enum(['coverage-analysis', 'gap-detection', 'dashboard-design', 'test-generation']),\n coverageReport: z.string().optional(),\n targetFiles: z.array(z.string()).optional(),\n threshold: z.number().min(0).max(100).default(90),\n includeUncovered: z.boolean().default(true),\n outputFormat: z.enum(['markdown', 'json']).default('markdown'),\n});\n\nexport type TestingFrameworkInput = z.infer<typeof testingFrameworkSchema>;\n```\n\n### Step 4.2: Implement Handler\n\n**File**: `src/frameworks/testing/handler.ts`\n```typescript\nimport { testingFrameworkSchema } from './schema.js';\nimport { coverageAnalysisAction } from './actions/coverage-analysis.js';\nimport { gapDetectionAction } from './actions/gap-detection.js';\nimport { dashboardDesignAction } from './actions/dashboard-design.js';\nimport { testGenerationAction } from './actions/test-generation.js';\n\nconst actionHandlers = {\n 'coverage-analysis': coverageAnalysisAction,\n 'gap-detection': gapDetectionAction,\n 'dashboard-design': dashboardDesignAction,\n 'test-generation': testGenerationAction,\n};\n\nexport async function handleTesting(input: unknown) {\n const validated = testingFrameworkSchema.parse(input);\n const handler = actionHandlers[validated.action];\n return handler(validated);\n}\n```\n\n### Step 4.3: Implement Coverage Analysis\n\n**File**: `src/frameworks/testing/actions/coverage-analysis.ts`\n```typescript\nimport { TestingFrameworkInput } from '../schema.js';\nimport { parseLcov } from '../coverage-analyzer.js';\n\nexport async function coverageAnalysisAction(input: TestingFrameworkInput) {\n const coverage = input.coverageReport\n ? await parseLcov(input.coverageReport)\n : await parseLcov('coverage/lcov.info');\n\n const summary = {\n statements: coverage.statements.pct,\n branches: coverage.branches.pct,\n functions: coverage.functions.pct,\n lines: coverage.lines.pct,\n };\n\n const meetsThreshold = Object.values(summary).every(v => v >= input.threshold);\n\n return {\n summary,\n threshold: input.threshold,\n passes: meetsThreshold,\n filesBelow: coverage.files.filter(f => f.pct < input.threshold),\n };\n}\n```\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| --------------------------- | ------ | ------------ |\n| Core paths covered by tests | ‚¨ú | TBD |\n| Failure paths validated | ‚¨ú | TBD |\n| Coverage thresholds met | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-043 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "testing", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-043",
		"dependencies": ["T-038"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-043-consolidate-testing-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-043-consolidate-testing-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-044: Consolidate Documentation Framework",
		"body": "# T-044: Consolidate Documentation Framework\n\n## Overview\n\n**Task ID**: T-044\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-044-consolidate-documentation-framework.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Documentation Framework' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-044\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\nFrom spec.md baseline:\n- `documentation-generator-prompt-builder.ts` - Doc generation prompts\n- `quick-prompts-builder.ts` - Quick reference generation\n- Scattered documentation utilities\n\n### Target State\n\nPer ADR-005 Framework Consolidation:\n- Single `DocumentationFramework` in `src/frameworks/documentation/`\n- Actions: `api-reference`, `readme`, `migration-guide`, `quick-reference`\n- Unified template engine and output formatting\n- Shared JSDoc/TSDoc parsing\n\n### Out of Scope\n\n- Documentation hosting (just generation)\n- Internationalization\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038: Framework Router implemented\n\n### Target Files\n\n- `src/frameworks/documentation/index.ts` (new)\n- `src/frameworks/documentation/handler.ts`\n- `src/frameworks/documentation/actions/` (4 actions)\n- `src/frameworks/documentation/schema.ts`\n- `src/frameworks/documentation/templates/`\n\n### Tooling\n\n- Node.js 22.x\n- Handlebars for templates\n- TypeScript Compiler API for JSDoc extraction\n\n## 4. Implementation Guide\n\n### Step 4.1: Define Schema\n\n**File**: `src/frameworks/documentation/schema.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\n\nexport const documentationFrameworkSchema = z.object({\n action: z.enum(['api-reference', 'readme', 'migration-guide', 'quick-reference']),\n sourceFiles: z.array(z.string()).optional(),\n projectName: z.string().optional(),\n version: z.string().optional(),\n includeExamples: z.boolean().default(true),\n outputFormat: z.enum(['markdown', 'html', 'json']).default('markdown'),\n});\n\nexport type DocumentationFrameworkInput = z.infer<typeof documentationFrameworkSchema>;\n```\n\n### Step 4.2: Implement Handler\n\n**File**: `src/frameworks/documentation/handler.ts`\n```typescript\nimport { documentationFrameworkSchema } from './schema.js';\nimport { apiReferenceAction } from './actions/api-reference.js';\nimport { readmeAction } from './actions/readme.js';\nimport { migrationGuideAction } from './actions/migration-guide.js';\nimport { quickReferenceAction } from './actions/quick-reference.js';\n\nconst actionHandlers = {\n 'api-reference': apiReferenceAction,\n 'readme': readmeAction,\n 'migration-guide': migrationGuideAction,\n 'quick-reference': quickReferenceAction,\n};\n\nexport async function handleDocumentation(input: unknown) {\n const validated = documentationFrameworkSchema.parse(input);\n const handler = actionHandlers[validated.action];\n return handler(validated);\n}\n```\n\n### Step 4.3: Implement API Reference Generator\n\n**File**: `src/frameworks/documentation/actions/api-reference.ts`\n```typescript\nimport { DocumentationFrameworkInput } from '../schema.js';\nimport { extractJSDoc } from '../jsdoc-extractor.js';\nimport { renderTemplate } from '../template-engine.js';\n\nexport async function apiReferenceAction(input: DocumentationFrameworkInput) {\n const docs = await extractJSDoc(input.sourceFiles ?? ['src/**/*.ts']);\n\n return renderTemplate('api-reference', {\n projectName: input.projectName ?? 'API Reference',\n version: input.version,\n modules: docs.modules,\n includeExamples: input.includeExamples,\n });\n}\n```\n\n### Step 4.4: Create Templates\n\n**File**: `src/frameworks/documentation/templates/api-reference.hbs`\n```handlebars\n# {{projectName}}{{#if version}} v{{version}}{{/if}}\n\n{{#each modules}}\n## {{name}}\n\n{{description}}\n\n{{#each functions}}\n### `{{name}}({{params}})`\n\n{{description}}\n\n{{#if examples}}#### Examples\n{{#each examples}}\n```typescript\n{{this}}\n```\n{{/each}}{{/if}}\n{{/each}}\n{{/each}}\n```\n\n## 5. Testing Strategy\n\n- Validate code examples manually\n- Ensure docs build (if applicable)\n- Confirm links resolve\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------- | ------ | --------------------------------------------------------------- |\n| Framework handler created | ‚¨ú | File exists at `src/frameworks/documentation/handler.ts` |\n| All 4 actions implemented | ‚¨ú | `api-reference`, `readme`, `migration-guide`, `quick-reference` |\n| Templates created | ‚¨ú | `src/frameworks/documentation/templates/` has `.hbs` files |\n| JSDoc extraction works | ‚¨ú | `extractJSDoc` parses TypeScript files |\n| Registered in router | ‚¨ú | `frameworkRouter.get('documentation')` returns handler |\n| Unit tests pass | ‚¨ú | `npm run test:vitest -- documentation` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - Documentation requirements\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-005 (Framework Consolidation)\n- [T-038](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-038-implement-framework-router.md) - Framework Router\n\n---\n\n*Task: T-044 | Phase: 3-Consolidation | Priority: P0*\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-044 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "documentation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-044",
		"dependencies": ["T-038"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-044-consolidate-documentation-framework.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-044-consolidate-documentation-framework.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-045: Consolidate Remaining Frameworks (5)",
		"body": "# T-045: Consolidate Remaining Frameworks (5)\n\n## Overview\n\n**Task ID**: T-045\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-038\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-045-consolidate-remaining-frameworks-5.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Consolidate Remaining Frameworks (5)' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-045\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\nFrom spec.md, 5 remaining framework categories need consolidation:\n1. **Strategic Planning**: strategy-frameworks, gap-analysis, sprint-calculator\n2. **Agent Orchestration**: agent-orchestrator, design-assistant\n3. **Prompt Optimization**: memory-optimizer, hierarchy-selector\n4. **Visualization**: mermaid-generator, spark-ui-cards\n5. **Project Management**: speckit-generator, validate-spec\n\n### Target State\n\nPer ADR-005, consolidate remaining tools into 5 unified frameworks:\n\n| # | Framework | Source Tools | Actions |\n| --- | ------------------- | ------------------------------------ | ------------------------------- |\n| 7 | Strategic Planning | strategy-frameworks, gap-analysis | `swot`, `gap`, `sprint` |\n| 8 | Agent Orchestration | agent-orchestrator, design-assistant | `orchestrate`, `design-session` |\n| 9 | Prompt Optimization | memory-optimizer, hierarchy-selector | `optimize`, `select-level` |\n| 10 | Visualization | mermaid-generator, spark-ui | `diagram`, `ui-card` |\n| 11 | Project Management | speckit-generator, validate-spec | `generate`, `validate` |\n\n### Out of Scope\n\n- Tool logic changes (structure consolidation only)\n- New features beyond consolidation\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-038: Framework Router implemented\n- T-039 through T-044: First 6 frameworks consolidated\n\n### Target Files\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```\nsrc/frameworks/\n‚îú‚îÄ‚îÄ strategic-planning/\n‚îú‚îÄ‚îÄ agent-orchestration/\n‚îú‚îÄ‚îÄ prompt-optimization/\n‚îú‚îÄ‚îÄ visualization/\n‚îî‚îÄ‚îÄ project-management/\n```\n\n### Tooling\n\n- Node.js 22.x\n- Zod for schema validation\n\n## 4. Implementation Guide\n\n### Step 4.1: Strategic Planning Framework\n\n**File**: `src/frameworks/strategic-planning/handler.ts`\n```typescript\nimport { z } from 'zod';\n\nexport const strategicPlanningSchema = z.object({\n action: z.enum(['swot', 'gap', 'vrio', 'bsc', 'sprint']),\n context: z.string(),\n factors: z.array(z.string()).optional(),\n outputFormat: z.enum(['markdown', 'json']).default('markdown'),\n});\n\nconst actionHandlers = {\n 'swot': swotAnalysisAction,\n 'gap': gapAnalysisAction,\n 'vrio': vrioAction,\n 'bsc': balancedScorecardAction,\n 'sprint': sprintCalculatorAction,\n};\n\nexport async function handleStrategicPlanning(input: unknown) {\n const validated = strategicPlanningSchema.parse(input);\n return actionHandlers[validated.action](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/validated);\n}\n```\n\n### Step 4.2: Agent Orchestration Framework\n\n**File**: `src/frameworks/agent-orchestration/handler.ts`\n```typescript\nexport const agentOrchestrationSchema = z.object({\n action: z.enum(['orchestrate', 'design-session', 'handoff', 'list-agents']),\n sessionId: z.string().optional(),\n targetAgent: z.string().optional(),\n workflowName: z.string().optional(),\n});\n\nexport async function handleAgentOrchestration(input: unknown) {\n const validated = agentOrchestrationSchema.parse(input);\n // Route to appropriate action\n}\n```\n\n### Step 4.3: Prompt Optimization Framework\n\n**File**: `src/frameworks/prompt-optimization/handler.ts`\n```typescript\nexport const promptOptimizationSchema = z.object({\n action: z.enum(['optimize', 'select-level', 'evaluate']),\n contextContent: z.string().optional(),\n maxTokens: z.number().default(8000),\n taskDescription: z.string().optional(),\n});\n\nexport async function handlePromptOptimization(input: unknown) {\n const validated = promptOptimizationSchema.parse(input);\n // Route to appropriate action\n}\n```\n\n### Step 4.4: Visualization Framework\n\n**File**: `src/frameworks/visualization/handler.ts`\n```typescript\nexport const visualizationSchema = z.object({\n action: z.enum(['diagram', 'ui-card', 'dashboard']),\n diagramType: z.enum(['flowchart', 'sequence', 'class', 'state', 'er']).optional(),\n description: z.string(),\n theme: z.string().optional(),\n});\n\nexport async function handleVisualization(input: unknown) {\n const validated = visualizationSchema.parse(input);\n // Route to appropriate action\n}\n```\n\n### Step 4.5: Project Management Framework\n\n**File**: `src/frameworks/project-management/handler.ts`\n```typescript\nexport const projectManagementSchema = z.object({\n action: z.enum(['generate', 'validate', 'enforce-planning']),\n directory: z.string().default('.'),\n artifacts: z.array(z.enum(['spec', 'plan', 'tasks', 'progress'])).optional(),\n});\n\nexport async function handleProjectManagement(input: unknown) {\n const validated = projectManagementSchema.parse(input);\n // Route to appropriate action\n}\n```\n\n### Step 4.6: Register All in Framework Router\n\n```typescript\n// src/frameworks/registry.ts\nframeworkRouter.register('strategic-planning', handleStrategicPlanning);\nframeworkRouter.register('agent-orchestration', handleAgentOrchestration);\nframeworkRouter.register('prompt-optimization', handlePromptOptimization);\nframeworkRouter.register('visualization', handleVisualization);\nframeworkRouter.register('project-management', handleProjectManagement);\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-045 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-045",
		"dependencies": ["T-038"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-045-consolidate-remaining-frameworks-5.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-045-consolidate-remaining-frameworks-5.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-046: Implement GAP-002: Schema Examples for Zod",
		"body": "# T-046: Implement GAP-002: Schema Examples for Zod\n\n## Overview\n\n**Task ID**: T-046\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 6h\n**Dependencies**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-046-schema-examples.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nAdd .describe() to all Zod schemas (‚â•80% coverage).\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-046\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement GAP-002: Schema Examples for Zod fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- None\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Schema Description Audit Script\n\nCreate `scripts/audit-schema-descriptions.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\nimport { glob } from 'glob';\n\ninterface SchemaAuditResult {\n file: string;\n totalSchemas: number;\n describedSchemas: number;\n undescribedSchemas: string[];\n coverage: number;\n}\n\n/**\n * Audit Zod schemas for .describe() usage\n * Identifies schemas missing descriptions for GAP-002 compliance\n */\nexport async function auditSchemaDescriptions(srcDir: string): Promise<SchemaAuditResult[]> {\n const files = await glob(`${srcDir}/**/*.ts`, { ignore: ['**/*.spec.ts', '**/*.test.ts'] });\n const results: SchemaAuditResult[] = [];\n\n for (const file of files) {\n const content = fs.readFileSync(file, 'utf-8');\n const result = analyzeFile(file, content);\n if (result.totalSchemas > 0) {\n results.push(result);\n }\n }\n\n return results;\n}\n\nfunction analyzeFile(filePath: string, content: string): SchemaAuditResult {\n // Pattern to match Zod schema definitions\n const schemaPattern = /z\\.(string|number|boolean|array|object|enum|union|literal|optional|nullable)\\s*\\(/g;\n const describePattern = /\\.describe\\s*\\(/g;\n\n const schemaMatches = content.match(schemaPattern) || [];\n const describeMatches = content.match(describePattern) || [];\n\n // Find undescribed schemas by line analysis\n const lines = content.split('\\n');\n const undescribed: string[] = [];\n\n lines.forEach((line, index) => {\n if (schemaPattern.test(line) && !line.includes('.describe(')) {\n const varMatch = line.match(/(const|let)\\s+(\\w+)/);\n if (varMatch) {\n undescribed.push(`Line ${index + 1}: ${varMatch[2]}`);\n }\n }\n });\n\n return {\n file: filePath,\n totalSchemas: schemaMatches.length,\n describedSchemas: describeMatches.length,\n undescribedSchemas: undescribed,\n coverage: schemaMatches.length > 0\n ? (describeMatches.length / schemaMatches.length) * 100\n : 100,\n };\n}\n```\n\n### Step 4.2: Add Descriptions to Existing Schemas\n\nUpdate schema files to include `.describe()`. Example pattern:\n\n```typescript\n// Before (non-compliant)\nexport const sessionConfigSchema = z.object({\n sessionId: z.string(),\n goal: z.string(),\n requirements: z.array(z.string()),\n});\n\n// After (GAP-002 compliant)\nexport const sessionConfigSchema = z.object({\n sessionId: z.string()\n .min(1)\n .describe('Unique session identifier (e.g., \"api-gateway-design-2024\")'),\n goal: z.string()\n .describe('Primary design objective or problem statement'),\n requirements: z.array(z.string())\n .describe('List of functional and non-functional requirements'),\n coverageThreshold: z.number()\n .min(0)\n .max(100)\n .default(85)\n .describe('Minimum coverage percentage required (0-100)'),\n enablePivots: z.boolean()\n .default(true)\n .describe('Allow strategic pivots during design sessions'),\n}).describe('Configuration for starting a new design session');\n```\n\n### Step 4.3: Create Automated Description Helper\n\nCreate `src/tools/shared/schema-utils.ts`:\n\n```typescript\nimport { z } from 'zod';\n\n/**\n * Helper to ensure all schema fields have descriptions\n * Throws if any field is missing a description\n */\nexport function describeSchema<T extends z.ZodRawShape>(\n shape: T,\n descriptions: Record<keyof T, string>\n): z.ZodObject<T> {\n const described: Record<string, z.ZodTypeAny> = {};\n\n for (const [key, schema] of Object.entries(shape)) {\n const description = descriptions[key as keyof T];\n if (!description) {\n throw new Error(`Missing description for schema field: ${key}`);\n }\n described[key] = (schema as z.ZodTypeAny).describe(description);\n }\n\n return z.object(described as T);\n}\n\n// Usage example:\nexport const exampleSchema = describeSchema(\n {\n name: z.string(),\n count: z.number(),\n },\n {\n name: 'The name of the item',\n count: 'Number of items',\n }\n);\n```\n\n### Step 4.4: Add npm Script and Coverage Check\n\nUpdate `package.json`:\n\n```json\n{\n \"scripts\": {\n \"audit:schemas\": \"tsx scripts/audit-schema-descriptions.ts src\",\n \"check:schema-coverage\": \"tsx scripts/audit-schema-descriptions.ts src --threshold=80\"\n }\n}\n```\n\nCreate coverage enforcement in CI:\n\n```yaml\n# .github/workflows/quality.yml\n- name: Check Schema Description Coverage\n run: npm run check:schema-coverage\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-046 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-046",
		"dependencies": [],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-046-schema-examples.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-046-schema-examples.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-047: Implement GAP-004: Deprecation Warning Helpers",
		"body": "# T-047: Implement GAP-004: Deprecation Warning Helpers\n\n## Overview\n\n**Task ID**: T-047\n**Phase**: 3 - Framework Consolidation\n**Priority**: P0 (Critical Path)\n**Estimate**: 3h\n**Dependencies**: None\n**Blocks**: T-032, T-033 (Legacy Facades)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-047-implement-gap-004-deprecation-warning-helpers.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nImplement `warnDeprecated()` helper function and `DeprecationRegistry` for tracking deprecated APIs across the codebase. Required by REQ-012 for legacy facade deprecation warnings.\n\n### Why\n\n- **REQ-012 Compliance**: Spec requires deprecation warning helpers\n- **Migration Support**: Guide users from legacy APIs to new UnifiedPromptBuilder\n- **Tracking**: Registry enables deprecation report generation\n- **Consistency**: Single pattern for all deprecation warnings\n\n### Deliverables\n\n- `src/tools/shared/deprecation-helpers.ts` - Helper functions\n- `tests/vitest/tools/shared/deprecation-helpers.spec.ts` - Unit tests\n- Updated `src/tools/shared/index.ts` - Barrel export\n\n## 2. Context and Scope\n\n### Current State\n\nNo standardized deprecation warning mechanism exists. Warnings are ad-hoc `console.warn()` calls.\n\n### Target State\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// Usage in legacy facades\nwarnDeprecated({\n oldName: \"domainNeutralPromptBuilder\",\n newName: \"UnifiedPromptBuilder.generate({ domain: 'domain-neutral' })\",\n removalVersion: \"v0.16.0\",\n migrationGuide: \"docs/migration/prompt-builders.md\",\n});\n```\n\n### Out of Scope\n\n- Automatic code migration\n- IDE integration\n- Build-time deprecation enforcement\n\n## 3. Prerequisites\n\n### Dependencies\n\nNone - this is a foundational utility.\n\n### Target Files\n\n| File | Action | Purpose |\n| ------------------------------------------------------- | ------ | --------------------- |\n| `src/tools/shared/deprecation-helpers.ts` | Create | Helper implementation |\n| `src/tools/shared/index.ts` | Modify | Add export |\n| `tests/vitest/tools/shared/deprecation-helpers.spec.ts` | Create | Unit tests |\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Deprecation Helpers\n\n```typescript\n// src/tools/shared/deprecation-helpers.ts\n\nimport { logger } from \"./logger.js\";\n\n/**\n * Deprecation warning configuration.\n */\nexport interface DeprecationWarning {\n /** Name of the deprecated API/function */\n oldName: string;\n /** Name of the replacement API/function */\n newName: string;\n /** Version when the API will be removed */\n removalVersion: string;\n /** Optional link to migration guide */\n migrationGuide?: string;\n /** Optional additional context */\n context?: string;\n}\n\n/**\n * Registry entry for tracking deprecations.\n */\nexport interface DeprecationEntry extends DeprecationWarning {\n /** First warning timestamp */\n firstWarned: Date;\n /** Number of times warning was triggered */\n warningCount: number;\n}\n\n/**\n * Singleton registry tracking all deprecation warnings.\n */\nexport class DeprecationRegistry {\n private static instance: DeprecationRegistry;\n private entries = new Map<string, DeprecationEntry>();\n private suppressWarnings = false;\n\n static getInstance(): DeprecationRegistry {\n if (!DeprecationRegistry.instance) {\n DeprecationRegistry.instance = new DeprecationRegistry();\n }\n return DeprecationRegistry.instance;\n }\n\n /**\n * Record a deprecation warning.\n * Returns true if this is the first time this deprecation was recorded.\n */\n record(warning: DeprecationWarning): boolean {\n const key = `${warning.oldName}::${warning.newName}`;\n const existing = this.entries.get(key);\n\n if (existing) {\n existing.warningCount++;\n return false;\n }\n\n this.entries.set(key, {\n ...warning,\n firstWarned: new Date(),\n warningCount: 1,\n });\n return true;\n }\n\n /**\n * Get all recorded deprecations.\n */\n getAll(): DeprecationEntry[] {\n return Array.from(this.entries.values());\n }\n\n /**\n * Generate deprecation report as markdown.\n */\n generateReport(): string {\n const entries = this.getAll();\n if (entries.length === 0) {\n return \"# Deprecation Report\\n\\nNo deprecations recorded.\";\n }\n\n const lines = [\n \"# Deprecation Report\",\n \"\",\n `Generated: ${new Date().toISOString()}`,\n \"\",\n \"| Deprecated API | Replacement | Removal | Count |\",\n \"|----------------|-------------|---------|-------|\",\n ];\n\n for (const entry of entries) {\n lines.push(\n `| \\`${entry.oldName}\\` | \\`${entry.newName}\\` | ${entry.removalVersion} | ${entry.warningCount} |`\n );\n }\n\n return lines.join(\"\\n\");\n }\n\n /**\n * Suppress warning output (for tests).\n */\n suppress(value: boolean): void {\n this.suppressWarnings = value;\n }\n\n isSuppressed(): boolean {\n return this.suppressWarnings;\n }\n\n /**\n * Clear all entries (for tests).\n */\n clear(): void {\n this.entries.clear();\n }\n}\n\n/**\n * Emit a deprecation warning.\n * Logs to console and records in registry.\n * Only emits console warning once per unique deprecation.\n *\n * \n * warnDeprecated({\n * oldName: \"domainNeutralPromptBuilder\",\n * newName: \"UnifiedPromptBuilder.generate({ domain: 'domain-neutral' })\",\n * removalVersion: \"v0.16.0\",\n * });\n */\nexport function warnDeprecated(warning: DeprecationWarning): void {\n const registry = DeprecationRegistry.getInstance();\n const isFirst = registry.record(warning);\n\n // Only emit console warning on first occurrence\n if (isFirst && !registry.isSuppressed()) {\n const message = formatDeprecationMessage(warning);\n logger.warn(message);\n }\n}\n\n/**\n * Format deprecation warning message.\n */\nexport function formatDeprecationMessage(warning: DeprecationWarning): string {\n let message = `DEPRECATION: '${warning.oldName}' is deprecated and will be removed in ${warning.removalVersion}. `;\n message += `Use '${warning.newName}' instead.`;\n\n if (warning.migrationGuide) {\n message += ` See: ${warning.migrationGuide}`;\n }\n\n if (warning.context) {\n message += ` (${warning.context})`;\n }\n\n return message;\n}\n```\n\n### Step 4.2: Update Barrel Export\n\n```typescript\n// src/tools/shared/index.ts (add to existing exports)\n\nexport {\n warnDeprecated,\n formatDeprecationMessage,\n DeprecationRegistry,\n type DeprecationWarning,\n type DeprecationEntry,\n} from \"./deprecation-helpers.js\";\n```\n\n### Step 4.3: Implement Unit Tests\n\n```typescript\n// tests/vitest/tools/shared/deprecation-helpers.spec.ts\n\nimport { describe, it, expect, beforeEach, vi } from \"vitest\";\nimport {\n warnDeprecated,\n formatDeprecationMessage,\n DeprecationRegistry,\n} from \"../../../../src/tools/shared/deprecation-helpers.js\";\n\ndescribe(\"deprecation-helpers\", () => {\n beforeEach(() => {\n DeprecationRegistry.getInstance().clear();\n DeprecationRegistry.getInstance().suppress(true);\n });\n\n describe(\"warnDeprecated\", () => {\n it(\"records deprecation in registry\", () => {\n warnDeprecated({\n oldName: \"oldFunc\",\n newName: \"newFunc\",\n removalVersion: \"v2.0.0\",\n });\n\n const entries = DeprecationRegistry.getInstance().getAll();\n expect(entries).toHaveLength(1);\n expect(entries[0].oldName).toBe(\"oldFunc\");\n });\n\n it(\"increments count on repeated calls\", () => {\n const warning = {\n oldName: \"oldFunc\",\n newName: \"newFunc\",\n removalVersion: \"v2.0.0\",\n };\n\n warnDeprecated(warning);\n warnDeprecated(warning);\n warnDeprecated(warning);\n\n const entries = DeprecationRegistry.getInstance().getAll();\n expect(entries[0].warningCount).toBe(3);\n });\n\n it(\"tracks different deprecations separately\", () => {\n warnDeprecated({ oldName: \"a\", newName: \"b\", removalVersion: \"v2.0.0\" });\n warnDeprecated({ oldName: \"c\", newName: \"d\", removalVersion: \"v2.0.0\" });\n\n expect(DeprecationRegistry.getInstance().getAll()).toHaveLength(2);\n });\n });\n\n describe(\"formatDeprecationMessage\", () => {\n it(\"formats basic message\", () => {\n const msg = formatDeprecationMessage({\n oldName: \"oldFunc\",\n newName: \"newFunc\",\n removalVersion: \"v2.0.0\",\n });\n\n expect(msg).toContain(\"DEPRECATION\");\n expect(msg).toContain(\"oldFunc\");\n expect(msg).toContain(\"newFunc\");\n expect(msg).toContain(\"v2.0.0\");\n });\n\n it(\"includes migration guide when provided\", () => {\n const msg = formatDeprecationMessage({\n oldName: \"old\",\n newName: \"new\",\n removalVersion: \"v2.0.0\",\n migrationGuide: \"docs/migration.md\",\n });\n\n expect(msg).toContain(\"docs/migration.md\");\n });\n });\n\n describe(\"DeprecationRegistry\", () => {\n it(\"is singleton\", () => {\n const a = DeprecationRegistry.getInstance();\n const b = DeprecationRegistry.getInstance();\n expect(a).toBe(b);\n });\n\n it(\"generates markdown report\", () => {\n warnDeprecated({ oldName: \"a\", newName: \"b\", removalVersion: \"v2.0.0\" });\n\n const report = DeprecationRegistry.getInstance().generateReport();\n expect(report).toContain(\"# Deprecation Report\");\n expect(report).toContain(\"| `a` | `b` | v2.0.0\");\n });\n });\n});\n```\n\n## 5. Testing Strategy\n\n### Unit Tests\n- `warnDeprecated()` records to registry\n- Multiple calls increment count\n- Different deprecations tracked separately\n- Message formatting with all optional fields\n- Report generation\n\n### Commands\n```bash\nnpm run test:vitest -- --filter=\"deprecation-helpers\"\nnpm run quality\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| ----------------------- | ---------- | ------ | -------------------------------- |\n| Warning spam | Medium | Low | Warn once per unique deprecation |\n| Memory leak in registry | Low | Low | Clear method for tests |\n| Breaking logger import | Low | Medium | Use existing logger pattern |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| --------------------------------- | ------ | ----------------------------- |\n| `warnDeprecated()` function works | ‚¨ú | Unit test passes |\n| Registry tracks deprecations | ‚¨ú | `getAll()` returns entries |\n| Report generation works | ‚¨ú | Markdown output valid |\n| Barrel export updated | ‚¨ú | Import from `shared/index.ts` |\n| TypeScript strict passes | ‚¨ú | `npm run type-check` |\n| Test coverage ‚â•90% | ‚¨ú | Coverage report |\n\n---\n\n## 8. References\n\n- [spec.md - REQ-012](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [T-032 Legacy Facade](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-032-legacy-facades.md)\n- [T-033 Domain-Neutral Facade](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-25-unified-prompts/T-033-create-legacy-facade-domainneutralpromptbuilder.md)\n- [Existing logger](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/src/tools/shared/logger.ts)\n\n---\n\n*Task: T-047 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-047",
		"dependencies": [],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-047-implement-gap-004-deprecation-warning-helpers.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-047-implement-gap-004-deprecation-warning-helpers.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-048: Implement GAP-008: validate_progress Tool",
		"body": "# T-048: Implement GAP-008: validate_progress Tool\n\n## Overview\n\n**Task ID**: T-048\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 6h\n**Dependencies**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-048-validate-progress.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement GAP-008: validate_progress Tool' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-048\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement GAP-008: validate_progress Tool fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- None\n\n### Target Files\n\n- `src/tools/enforcement/validate-progress.ts`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Progress Validation Tool Schema\n\nCreate `src/tools/enforcement/validate-progress.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { z } from 'zod';\nimport type { ProgressValidationResult, TaskProgress, PhaseProgress } from './types.js';\n\n// Task progress schema\nexport const taskProgressSchema = z.object({\n taskId: z.string().describe('Task identifier (e.g., T-001)'),\n status: z.enum(['not-started', 'in-progress', 'completed', 'blocked']).describe('Current task status'),\n completedCriteria: z.array(z.string()).optional().describe('List of completed acceptance criteria'),\n totalCriteria: z.number().optional().describe('Total number of acceptance criteria'),\n blockedBy: z.array(z.string()).optional().describe('Tasks blocking this task'),\n notes: z.string().optional().describe('Progress notes'),\n});\n\n// Phase progress schema\nexport const phaseProgressSchema = z.object({\n phaseId: z.string().describe('Phase identifier (e.g., phase-1)'),\n phaseName: z.string().describe('Phase name'),\n totalTasks: z.number().describe('Total tasks in phase'),\n completedTasks: z.number().describe('Number of completed tasks'),\n blockedTasks: z.number().default(0).describe('Number of blocked tasks'),\n progress: z.number().min(0).max(100).describe('Progress percentage'),\n});\n\n// Validation request schema\nexport const validateProgressRequestSchema = z.object({\n projectPath: z.string().describe('Path to project root'),\n tasksDir: z.string().optional().describe('Path to tasks directory'),\n includeDetails: z.boolean().default(true).describe('Include detailed task breakdown'),\n validateDependencies: z.boolean().default(true).describe('Validate task dependencies'),\n outputFormat: z.enum(['summary', 'detailed', 'json']).default('detailed'),\n});\n\nexport type ValidateProgressRequest = z.infer<typeof validateProgressRequestSchema>;\n```\n\n### Step 4.2: Implement Progress Validator\n\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\nimport { glob } from 'glob';\n\nexport async function validateProgress(\n request: ValidateProgressRequest\n): Promise<ProgressValidationResult> {\n const validated = validateProgressRequestSchema.parse(request);\n const tasksDir = validated.tasksDir ?? path.join(validated.projectPath, 'tasks');\n\n // Find all task files\n const taskFiles = await glob(`${tasksDir}/**/T-*.md`);\n const tasks = await Promise.all(taskFiles.map(parseTaskFile));\n\n // Group by phase\n const phases = groupTasksByPhase(tasks);\n\n // Calculate progress\n const phaseProgress: PhaseProgress[] = phases.map(calculatePhaseProgress);\n\n // Validate dependencies\n const dependencyIssues = validated.validateDependencies\n ? validateDependencies(tasks)\n : [];\n\n // Calculate overall progress\n const overallProgress = calculateOverallProgress(phaseProgress);\n\n return {\n success: true,\n overallProgress,\n phases: phaseProgress,\n tasks: validated.includeDetails ? tasks : undefined,\n dependencyIssues,\n timestamp: new Date().toISOString(),\n };\n}\n\nasync function parseTaskFile(filePath: string): Promise<TaskProgress> {\n const content = fs.readFileSync(filePath, 'utf-8');\n const taskId = path.basename(filePath, '.md').match(/T-\\d+/)?.[0] ?? 'unknown';\n\n // Parse acceptance criteria\n const criteriaMatch = content.match(/## \\d+\\.\\s*Acceptance Criteria[\\s\\S]*?\\|(.*?)\\|/g);\n const completedCount = (content.match(/‚úÖ/g) || []).length;\n const totalCount = (criteriaMatch || []).length;\n\n // Determine status from content\n const status = determineStatus(content, completedCount, totalCount);\n\n return {\n taskId,\n status,\n completedCriteria: extractCompletedCriteria(content),\n totalCriteria: totalCount,\n filePath,\n };\n}\n\nfunction determineStatus(\n content: string,\n completed: number,\n total: number\n): TaskProgress['status'] {\n if (content.includes('BLOCKED')) return 'blocked';\n if (completed === 0) return 'not-started';\n if (completed >= total) return 'completed';\n return 'in-progress';\n}\n```\n\n### Step 4.3: Register Tool Handler\n\nUpdate `src/index.ts`:\n\n```typescript\nimport { validateProgress, validateProgressRequestSchema } from './tools/enforcement/validate-progress.js';\n\nserver.tool(\n 'validate_progress',\n 'Validate project progress against task definitions',\n validateProgressRequestSchema,\n {\n annotations: {\n readOnlyHint: true,\n idempotentHint: true,\n title: 'Progress Validator',\n },\n },\n async (request) => {\n const result = await validateProgress(request);\n return {\n content: [{ type: 'text', text: JSON.stringify(result, null, 2) }],\n };\n }\n);\n```\n\n### Step 4.4: Create Unit Tests\n\nCreate `tests/vitest/tools/enforcement/validate-progress.spec.ts`:\n\n```typescript\nimport { describe, it, expect } from 'vitest';\nimport { validateProgress, validateProgressRequestSchema } from '../../../../src/tools/enforcement/validate-progress.js';\n\ndescribe('validate-progress', () => {\n it('validates request schema', () => {\n const result = validateProgressRequestSchema.safeParse({\n projectPath: '/path/to/project',\n });\n expect(result.success).toBe(true);\n });\n\n it('calculates progress correctly', async () => {\n const result = await validateProgress({\n projectPath: process.cwd(),\n tasksDir: 'plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks',\n });\n expect(result.success).toBe(true);\n expect(result.overallProgress).toBeGreaterThanOrEqual(0);\n expect(result.phases).toBeDefined();\n });\n});\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `src/tools/enforcement/validate-progress.ts`\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-027-enforcement-tools.md)\n\n---\n\n*Task: T-048 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "implementation", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-048",
		"dependencies": [],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-048-validate-progress.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-048-validate-progress.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-049: Test Framework Consolidation",
		"body": "# T-049: Test Framework Consolidation\n\n## Overview\n\n**Task ID**: T-049\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-039 through T-045\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-049-test-framework-consolidation.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test Framework Consolidation' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-049\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test Framework Consolidation fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-039 through T-045\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-049 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "testing", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-049",
		"dependencies": ["T-039", "T-045"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-049-test-framework-consolidation.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-049-test-framework-consolidation.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-050: Test GAP Implementations",
		"body": "# T-050: Test GAP Implementations\n\n## Overview\n\n**Task ID**: T-050\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-046, T-047, T-048\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-050-test-gap-implementations.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test GAP Implementations' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-050\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test GAP Implementations fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-046, T-047, T-048\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-050 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "testing", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-050",
		"dependencies": ["T-046", "T-047", "T-048"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-050-test-gap-implementations.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-050-test-gap-implementations.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-051: Verify Framework Count = 11",
		"body": "# T-051: Verify Framework Count = 11\n\n## Overview\n\n**Task ID**: T-051\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 1h\n**Dependencies**: T-039 through T-045\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-051-verify-framework-count-11.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Verify Framework Count = 11' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-051\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify Framework Count = 11 fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-039 through T-045\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Prepare Inputs\n\n- Confirm all dependent tasks are complete\n- Ensure required artifacts/logs are available\n\n### Step 4.2: Execute Validation\n\n- Method: Run the relevant validation command or audit.\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Example (replace with the actual command)\nnpm run validate:verify_framework_count_11\n```\n\n### Step 4.3: Capture Evidence\n\n- Save reports under `artifacts/` or attach to CI logs\n- Note any failures with remediation steps\n\n### Step 4.4: Remediate and Re-run\n\n- Fix issues discovered by validation\n- Re-run until validation passes\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Validation executed successfully | ‚¨ú | `npm run quality` |\n| Results recorded with evidence | ‚¨ú | PR description |\n| Follow-up items documented | ‚¨ú | Issue tracker |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-051 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "testing", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-051",
		"dependencies": ["T-039", "T-045"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-051-verify-framework-count-11.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-051-verify-framework-count-11.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-052: Phase 3 Integration Test",
		"body": "# T-052: Phase 3 Integration Test\n\n## Overview\n\n**Task ID**: T-052\n**Phase**: 3\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-039 through T-051\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-052-phase-3-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Phase 3 Integration Test' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-052\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 3 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-039 through T-051\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-052 | Phase: 3 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-3", "integration-test", "P0-critical"],
		"milestone": 20,
		"parent_issue": 971,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/971",
		"phase": "3",
		"priority": "P0",
		"task_id": "T-052",
		"dependencies": ["T-039", "T-051"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-052-phase-3-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-052-phase-3-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-053: Design and Implement Platform Abstraction Layer (PAL)",
		"body": "# T-053: Design and Implement Platform Abstraction Layer (PAL)\n\n## Overview\n\n**Task ID**: T-053\n**Phase**: 4 - Platform Abstraction\n**Priority**: P1\n**Estimate**: 3 hours (interface) + 6 hours (NodePAL) + 4 hours (MockPAL) = 13 hours total\n**Dependencies**: Phase 3 complete\n**Blocks**: T-057 (fs/path migration)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-053-pal-interface.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nCreate a Platform Abstraction Layer (PAL) that abstracts all file system and path operations, enabling:\n- Cross-platform support (Windows, Linux, macOS)\n- Easy mocking for tests\n- Consistent path handling\n\n### Why\n\nCurrent codebase has:\n- 46 shell scripts (Bash only)\n- Direct `fs` and `path` calls scattered throughout\n- Unix path assumptions (`/` separator)\n- No Windows support\n- Hard to mock file operations in tests\n\n### Target Files\n\n| File | Purpose |\n| ------------------------------- | ---------------------- |\n| `src/platform/pal.interface.ts` | Interface definition |\n| `src/platform/node-pal.ts` | Node.js implementation |\n| `src/platform/mock-pal.ts` | Testing implementation |\n| `src/platform/index.ts` | Barrel + singleton |\n\n---\n\n## 2. Prerequisites\n\n### Files to Audit\n\nRun this command to find all fs/path usage:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Find all direct fs imports\ngrep -rn \"from 'fs\" src/ --include=\"*.ts\" | grep -v platform/\ngrep -rn \"from 'node:fs\" src/ --include=\"*.ts\" | grep -v platform/\n\n# Find all path imports\ngrep -rn \"from 'path\" src/ --include=\"*.ts\" | grep -v platform/\ngrep -rn \"from 'node:path\" src/ --include=\"*.ts\" | grep -v platform/\n\n# Count total\necho \"Total files to migrate:\"\ngrep -rln \"from 'fs\\|from 'node:fs\\|from 'path\\|from 'node:path\" src/ --include=\"*.ts\" | wc -l\n```\n\n### Expected Output\n\n```\nsrc/tools/speckit-generator.ts:10:import { promises as fs } from \"node:fs\";\nsrc/strategies/speckit/spec-validator.ts:8:import * as fs from \"node:fs\";\n... (more files)\n\nTotal files to migrate: ~15-20\n```\n\n---\n\n## 3. Implementation Guide\n\n### Step 3.1: Define PAL Interface\n\n```typescript\n// src/platform/pal.interface.ts\n\n/**\n * Platform Abstraction Layer Interface.\n *\n * Abstracts all file system and path operations to enable:\n * - Cross-platform support (Windows, Linux, macOS)\n * - Easy mocking for tests\n * - Consistent path handling\n *\n * All implementations MUST be thread-safe and handle edge cases\n * like missing files, permission errors, and concurrent access.\n *\n * \n * ```typescript\n * import { pal } from './platform/index.js';\n *\n * // Read a file\n * const content = await pal.readFile('/path/to/file.txt');\n *\n * // Join paths (cross-platform)\n * const fullPath = pal.joinPath(pal.getHomeDir(), '.config', 'app.json');\n * ```\n */\nexport interface PlatformAbstractionLayer {\n // ============================================\n // File Operations (Async)\n // ============================================\n\n /**\n * Read file contents as UTF-8 string.\n *\n * path - Absolute or relative file path\n * File contents\n * PalError with code 'ENOENT' if file not found\n * PalError with code 'EACCES' if permission denied\n */\n readFile(path: string): Promise<string>;\n\n /**\n * Read file contents synchronously.\n *\n * ‚ö†Ô∏è Use sparingly - prefer async version for better performance.\n */\n readFileSync(path: string): string;\n\n /**\n * Write content to file, creating parent directories if needed.\n *\n * path - File path to write to\n * content - String content to write\n * PalError with code 'EACCES' if permission denied\n */\n writeFile(path: string, content: string): Promise<void>;\n\n /**\n * Write content to file synchronously.\n */\n writeFileSync(path: string, content: string): void;\n\n /**\n * Check if file or directory exists.\n */\n exists(path: string): Promise<boolean>;\n\n /**\n * Check if file or directory exists (sync).\n */\n existsSync(path: string): boolean;\n\n /**\n * Delete a file.\n *\n * path - File to delete\n * options - Optional settings\n * PalError if file doesn't exist and force is false\n */\n deleteFile(path: string, options?: { force?: boolean }): Promise<void>;\n\n /**\n * Copy a file.\n *\n * src - Source file path\n * dest - Destination file path\n * options - Optional settings\n */\n copyFile(src: string, dest: string, options?: { overwrite?: boolean }): Promise<void>;\n\n /**\n * Get file stats (size, modified time, etc.).\n */\n stat(path: string): Promise<FileStats>;\n\n // ============================================\n // Directory Operations\n // ============================================\n\n /**\n * List files in a directory.\n *\n * dir - Directory to list\n * options - Optional filtering and recursion settings\n * Array of file paths (absolute)\n */\n listFiles(\n dir: string,\n options?: ListFilesOptions\n ): Promise<string[]>;\n\n /**\n * Create a directory, including parent directories.\n *\n * path - Directory path to create\n */\n createDir(path: string): Promise<void>;\n\n /**\n * Remove a directory.\n *\n * path - Directory to remove\n * options - Optional settings (recursive, force)\n */\n removeDir(\n path: string,\n options?: { recursive?: boolean; force?: boolean }\n ): Promise<void>;\n\n // ============================================\n // Path Operations\n // ============================================\n\n /**\n * Resolve path segments to absolute path.\n *\n * segments - Path segments to resolve\n * Absolute path\n *\n * \n * ```typescript\n * pal.resolvePath('/home/user', 'docs', 'file.txt');\n * // Returns: '/home/user/docs/file.txt'\n * ```\n */\n resolvePath(...segments: string[]): string;\n\n /**\n * Join path segments with platform-specific separator.\n *\n * segments - Path segments to join\n * Joined path\n */\n joinPath(...segments: string[]): string;\n\n /**\n * Get directory name of a path.\n *\n * \n * ```typescript\n * pal.dirname('/home/user/file.txt'); // '/home/user'\n * ```\n */\n dirname(path: string): string;\n\n /**\n * Get base name of a path.\n *\n * path - File path\n * ext - Extension to remove (optional)\n *\n * \n * ```typescript\n * pal.basename('/home/user/file.txt'); // 'file.txt'\n * pal.basename('/home/user/file.txt', '.txt'); // 'file'\n * ```\n */\n basename(path: string, ext?: string): string;\n\n /**\n * Get file extension.\n *\n * \n * ```typescript\n * pal.extname('/home/user/file.txt'); // '.txt'\n * ```\n */\n extname(path: string): string;\n\n /**\n * Check if path is absolute.\n */\n isAbsolute(path: string): boolean;\n\n /**\n * Normalize a path (resolve '..' and '.' segments).\n */\n normalize(path: string): string;\n\n /**\n * Get relative path from one location to another.\n */\n relativePath(from: string, to: string): string;\n\n /**\n * Get platform-specific path separator.\n */\n readonly separator: string;\n\n // ============================================\n // Environment\n // ============================================\n\n /**\n * Get environment variable.\n *\n * key - Variable name\n * Value or undefined if not set\n */\n getEnv(key: string): string | undefined;\n\n /**\n * Set environment variable.\n */\n setEnv(key: string, value: string): void;\n\n /**\n * Get current platform.\n */\n getPlatform(): Platform;\n\n /**\n * Get user's home directory.\n */\n getHomeDir(): string;\n\n /**\n * Get system temp directory.\n */\n getTempDir(): string;\n\n /**\n * Get current working directory.\n */\n getCwd(): string;\n}\n\n/**\n * Supported platforms.\n */\nexport type Platform = 'darwin' | 'linux' | 'win32';\n\n/**\n * File stats returned by stat().\n */\nexport interface FileStats {\n size: number;\n isFile: boolean;\n isDirectory: boolean;\n createdAt: Date;\n modifiedAt: Date;\n accessedAt: Date;\n}\n\n/**\n * Options for listFiles().\n */\nexport interface ListFilesOptions {\n /** Recursively list subdirectories */\n recursive?: boolean;\n /** Glob pattern to match (e.g., '*.ts') */\n pattern?: string;\n /** Include hidden files (starting with .) */\n includeHidden?: boolean;\n /** Only return files (not directories) */\n filesOnly?: boolean;\n /** Maximum depth for recursive listing */\n maxDepth?: number;\n}\n\n/**\n * PAL-specific error with platform-agnostic error codes.\n */\nexport class PalError extends Error {\n constructor(\n message: string,\n public readonly code: PalErrorCode,\n public readonly path?: string,\n public readonly cause?: Error\n ) {\n super(message);\n this.name = 'PalError';\n }\n}\n\n/**\n * Platform-agnostic error codes.\n */\nexport type PalErrorCode =\n | 'ENOENT' // File or directory not found\n | 'EACCES' // Permission denied\n | 'EEXIST' // File already exists\n | 'ENOTDIR' // Not a directory\n | 'EISDIR' // Is a directory\n | 'ENOTEMPTY' // Directory not empty\n | 'ETIMEDOUT' // Operation timed out\n | 'UNKNOWN'; // Unknown error\n```\n\n### Step 3.2: Implement NodePAL\n\n```typescript\n// src/platform/node-pal.ts\n\nimport * as fs from 'node:fs';\nimport * as fsp from 'node:fs/promises';\nimport * as path from 'node:path';\nimport * as os from 'node:os';\nimport { glob } from 'glob';\nimport type {\n FileStats,\n ListFilesOptions,\n PalErrorCode,\n Platform,\n PlatformAbstractionLayer,\n} from './pal.interface.js';\nimport { PalError } from './pal.interface.js';\n\n/**\n * Node.js implementation of Platform Abstraction Layer.\n *\n * Production implementation using Node.js built-in modules.\n *\n * \n * ```typescript\n * const pal = new NodePAL();\n * const content = await pal.readFile('./config.json');\n * ```\n */\nexport class NodePAL implements PlatformAbstractionLayer {\n readonly separator = path.sep;\n\n // ============================================\n // File Operations\n // ============================================\n\n async readFile(filePath: string): Promise<string> {\n try {\n return await fsp.readFile(filePath, 'utf-8');\n } catch (error) {\n throw this.wrapError(error, filePath);\n }\n }\n\n readFileSync(filePath: string): string {\n try {\n return fs.readFileSync(filePath, 'utf-8');\n } catch (error) {\n throw this.wrapError(error, filePath);\n }\n }\n\n async writeFile(filePath: string, content: string): Promise<void> {\n try {\n // Ensure parent directory exists\n const dir = path.dirname(filePath);\n await fsp.mkdir(dir, { recursive: true });\n await fsp.writeFile(filePath, content, 'utf-8');\n } catch (error) {\n throw this.wrapError(error, filePath);\n }\n }\n\n writeFileSync(filePath: string, content: string): void {\n try {\n const dir = path.dirname(filePath);\n fs.mkdirSync(dir, { recursive: true });\n fs.writeFileSync(filePath, content, 'utf-8');\n } catch (error) {\n throw this.wrapError(error, filePath);\n }\n }\n\n async exists(filePath: string): Promise<boolean> {\n try {\n await fsp.access(filePath);\n return true;\n } catch {\n return false;\n }\n }\n\n existsSync(filePath: string): boolean {\n return fs.existsSync(filePath);\n }\n\n async deleteFile(filePath: string, options?: { force?: boolean }): Promise<void> {\n try {\n await fsp.unlink(filePath);\n } catch (error) {\n if (options?.force && this.isNotFoundError(error)) {\n return;\n }\n throw this.wrapError(error, filePath);\n }\n }\n\n async copyFile(\n src: string,\n dest: string,\n options?: { overwrite?: boolean }\n ): Promise<void> {\n try {\n const flags = options?.overwrite ? 0 : fs.constants.COPYFILE_EXCL;\n await fsp.copyFile(src, dest, flags);\n } catch (error) {\n throw this.wrapError(error, `${src} -> ${dest}`);\n }\n }\n\n async stat(filePath: string): Promise<FileStats> {\n try {\n const stats = await fsp.stat(filePath);\n return {\n size: stats.size,\n isFile: stats.isFile(),\n isDirectory: stats.isDirectory(),\n createdAt: stats.birthtime,\n modifiedAt: stats.mtime,\n accessedAt: stats.atime,\n };\n } catch (error) {\n throw this.wrapError(error, filePath);\n }\n }\n\n // ============================================\n // Directory Operations\n // ============================================\n\n async listFiles(\n dir: string,\n options?: ListFilesOptions\n ): Promise<string[]> {\n try {\n if (options?.pattern) {\n // Use glob for pattern matching\n const pattern = options.recursive\n ? `**/${options.pattern}`\n : options.pattern;\n\n return await glob(pattern, {\n cwd: dir,\n absolute: true,\n dot: options.includeHidden ?? false,\n nodir: options.filesOnly ?? false,\n maxDepth: options.maxDepth,\n });\n }\n\n // Simple directory listing\n const entries = await fsp.readdir(dir, { withFileTypes: true });\n const results: string[] = [];\n\n for (const entry of entries) {\n // Skip hidden files unless requested\n if (!options?.includeHidden && entry.name.startsWith('.')) {\n continue;\n }\n\n const fullPath = path.join(dir, entry.name);\n\n if (entry.isDirectory()) {\n if (options?.recursive) {\n // Recurse into subdirectory\n const subFiles = await this.listFiles(fullPath, options);\n results.push(...subFiles);\n }\n if (!options?.filesOnly) {\n results.push(fullPath);\n }\n } else if (entry.isFile()) {\n results.push(fullPath);\n }\n }\n\n return results;\n } catch (error) {\n throw this.wrapError(error, dir);\n }\n }\n\n async createDir(dirPath: string): Promise<void> {\n try {\n await fsp.mkdir(dirPath, { recursive: true });\n } catch (error) {\n throw this.wrapError(error, dirPath);\n }\n }\n\n async removeDir(\n dirPath: string,\n options?: { recursive?: boolean; force?: boolean }\n ): Promise<void> {\n try {\n await fsp.rm(dirPath, {\n recursive: options?.recursive ?? false,\n force: options?.force ?? false,\n });\n } catch (error) {\n throw this.wrapError(error, dirPath);\n }\n }\n\n // ============================================\n // Path Operations\n // ============================================\n\n resolvePath(...segments: string[]): string {\n return path.resolve(...segments);\n }\n\n joinPath(...segments: string[]): string {\n return path.join(...segments);\n }\n\n dirname(filePath: string): string {\n return path.dirname(filePath);\n }\n\n basename(filePath: string, ext?: string): string {\n return path.basename(filePath, ext);\n }\n\n extname(filePath: string): string {\n return path.extname(filePath);\n }\n\n isAbsolute(filePath: string): boolean {\n return path.isAbsolute(filePath);\n }\n\n normalize(filePath: string): string {\n return path.normalize(filePath);\n }\n\n relativePath(from: string, to: string): string {\n return path.relative(from, to);\n }\n\n // ============================================\n // Environment\n // ============================================\n\n getEnv(key: string): string | undefined {\n return process.env[key];\n }\n\n setEnv(key: string, value: string): void {\n process.env[key] = value;\n }\n\n getPlatform(): Platform {\n return process.platform as Platform;\n }\n\n getHomeDir(): string {\n return os.homedir();\n }\n\n getTempDir(): string {\n return os.tmpdir();\n }\n\n getCwd(): string {\n return process.cwd();\n }\n\n // ============================================\n // Private Helpers\n // ============================================\n\n private wrapError(error: unknown, path?: string): PalError {\n if (error instanceof PalError) {\n return error;\n }\n\n const nodeError = error as NodeJS.ErrnoException;\n const code = this.mapErrorCode(nodeError.code);\n const message = nodeError.message || 'Unknown file system error';\n\n return new PalError(message, code, path, nodeError);\n }\n\n private mapErrorCode(code?: string): PalErrorCode {\n switch (code) {\n case 'ENOENT':\n return 'ENOENT';\n case 'EACCES':\n case 'EPERM':\n return 'EACCES';\n case 'EEXIST':\n return 'EEXIST';\n case 'ENOTDIR':\n return 'ENOTDIR';\n case 'EISDIR':\n return 'EISDIR';\n case 'ENOTEMPTY':\n return 'ENOTEMPTY';\n case 'ETIMEDOUT':\n return 'ETIMEDOUT';\n default:\n return 'UNKNOWN';\n }\n }\n\n private isNotFoundError(error: unknown): boolean {\n return (error as NodeJS.ErrnoException).code === 'ENOENT';\n }\n}\n```\n\n### Step 3.3: Implement MockPAL\n\n```typescript\n// src/platform/mock-pal.ts\n\nimport type {\n FileStats,\n ListFilesOptions,\n Platform,\n PlatformAbstractionLayer,\n} from './pal.interface.js';\nimport { PalError } from './pal.interface.js';\n\n/**\n * Mock entry in the virtual file system.\n */\ninterface MockEntry {\n type: 'file' | 'directory';\n content?: string;\n createdAt: Date;\n modifiedAt: Date;\n}\n\n/**\n * Mock implementation of Platform Abstraction Layer.\n *\n * In-memory implementation for testing. Allows full control over\n * file system state without touching the real file system.\n *\n * \n * ```typescript\n * const pal = new MockPAL();\n *\n * // Set up test fixtures\n * pal.setFile('/project/config.json', '{\"key\": \"value\"}');\n * pal.setDirectory('/project/src');\n *\n * // Run test\n * const content = await pal.readFile('/project/config.json');\n * expect(content).toBe('{\"key\": \"value\"}');\n *\n * // Clean up\n * pal.reset();\n * ```\n */\nexport class MockPAL implements PlatformAbstractionLayer {\n private fileSystem: Map<string, MockEntry> = new Map();\n private environment: Map<string, string> = new Map();\n private currentPlatform: Platform = 'linux';\n private cwd: string = '/mock';\n\n readonly separator = '/';\n\n // ============================================\n // Test Setup Methods\n // ============================================\n\n /**\n * Add a file to the mock file system.\n */\n setFile(path: string, content: string): void {\n const normalizedPath = this.normalizePath(path);\n this.fileSystem.set(normalizedPath, {\n type: 'file',\n content,\n createdAt: new Date(),\n modifiedAt: new Date(),\n });\n\n // Ensure parent directories exist\n this.ensureParentDirs(normalizedPath);\n }\n\n /**\n * Add a directory to the mock file system.\n */\n setDirectory(path: string): void {\n const normalizedPath = this.normalizePath(path);\n this.fileSystem.set(normalizedPath, {\n type: 'directory',\n createdAt: new Date(),\n modifiedAt: new Date(),\n });\n\n this.ensureParentDirs(normalizedPath);\n }\n\n /**\n * Set the mock platform.\n */\n setPlatform(platform: Platform): void {\n this.currentPlatform = platform;\n }\n\n /**\n * Set the mock current working directory.\n */\n setCwd(cwd: string): void {\n this.cwd = cwd;\n }\n\n /**\n * Reset all mock state.\n */\n reset(): void {\n this.fileSystem.clear();\n this.environment.clear();\n this.currentPlatform = 'linux';\n this.cwd = '/mock';\n }\n\n /**\n * Get all files in the mock file system (for assertions).\n */\n getFiles(): Map<string, string> {\n const files = new Map<string, string>();\n for (const [path, entry] of this.fileSystem) {\n if (entry.type === 'file' && entry.content !== undefined) {\n files.set(path, entry.content);\n }\n }\n return files;\n }\n\n // ============================================\n // File Operations\n // ============================================\n\n async readFile(path: string): Promise<string> {\n return this.readFileSync(path);\n }\n\n readFileSync(path: string): string {\n const normalizedPath = this.normalizePath(path);\n const entry = this.fileSystem.get(normalizedPath);\n\n if (!entry) {\n throw new PalError(`File not found: ${path}`, 'ENOENT', path);\n }\n if (entry.type === 'directory') {\n throw new PalError(`Is a directory: ${path}`, 'EISDIR', path);\n }\n\n return entry.content ?? '';\n }\n\n async writeFile(path: string, content: string): Promise<void> {\n this.writeFileSync(path, content);\n }\n\n writeFileSync(path: string, content: string): void {\n const normalizedPath = this.normalizePath(path);\n this.ensureParentDirs(normalizedPath);\n\n const existing = this.fileSystem.get(normalizedPath);\n this.fileSystem.set(normalizedPath, {\n type: 'file',\n content,\n createdAt: existing?.createdAt ?? new Date(),\n modifiedAt: new Date(),\n });\n }\n\n async exists(path: string): Promise<boolean> {\n return this.existsSync(path);\n }\n\n existsSync(path: string): boolean {\n const normalizedPath = this.normalizePath(path);\n return this.fileSystem.has(normalizedPath);\n }\n\n async deleteFile(path: string, options?: { force?: boolean }): Promise<void> {\n const normalizedPath = this.normalizePath(path);\n const entry = this.fileSystem.get(normalizedPath);\n\n if (!entry) {\n if (options?.force) return;\n throw new PalError(`File not found: ${path}`, 'ENOENT', path);\n }\n\n this.fileSystem.delete(normalizedPath);\n }\n\n async copyFile(\n src: string,\n dest: string,\n options?: { overwrite?: boolean }\n ): Promise<void> {\n const content = await this.readFile(src);\n\n if (!options?.overwrite && this.existsSync(dest)) {\n throw new PalError(`File exists: ${dest}`, 'EEXIST', dest);\n }\n\n await this.writeFile(dest, content);\n }\n\n async stat(path: string): Promise<FileStats> {\n const normalizedPath = this.normalizePath(path);\n const entry = this.fileSystem.get(normalizedPath);\n\n if (!entry) {\n throw new PalError(`File not found: ${path}`, 'ENOENT', path);\n }\n\n return {\n size: entry.content?.length ?? 0,\n isFile: entry.type === 'file',\n isDirectory: entry.type === 'directory',\n createdAt: entry.createdAt,\n modifiedAt: entry.modifiedAt,\n accessedAt: new Date(),\n };\n }\n\n // ============================================\n // Directory Operations\n // ============================================\n\n async listFiles(\n dir: string,\n options?: ListFilesOptions\n ): Promise<string[]> {\n const normalizedDir = this.normalizePath(dir);\n const results: string[] = [];\n\n for (const [path, entry] of this.fileSystem) {\n if (!path.startsWith(normalizedDir)) continue;\n if (path === normalizedDir) continue;\n\n const relativePath = path.substring(normalizedDir.length + 1);\n const depth = relativePath.split('/').length;\n\n // Check depth for non-recursive\n if (!options?.recursive && depth > 1) continue;\n\n // Check max depth\n if (options?.maxDepth && depth > options.maxDepth) continue;\n\n // Filter hidden files\n const basename = relativePath.split('/').pop()!;\n if (!options?.includeHidden && basename.startsWith('.')) continue;\n\n // Filter directories if filesOnly\n if (options?.filesOnly && entry.type === 'directory') continue;\n\n // Pattern matching (simple glob)\n if (options?.pattern) {\n const pattern = options.pattern.replace(/\\*/g, '.*');\n if (!new RegExp(`^${pattern}$`).test(basename)) continue;\n }\n\n results.push(path);\n }\n\n return results;\n }\n\n async createDir(path: string): Promise<void> {\n const normalizedPath = this.normalizePath(path);\n this.setDirectory(normalizedPath);\n }\n\n async removeDir(\n path: string,\n options?: { recursive?: boolean; force?: boolean }\n ): Promise<void> {\n const normalizedPath = this.normalizePath(path);\n const entry = this.fileSystem.get(normalizedPath);\n\n if (!entry) {\n if (options?.force) return;\n throw new PalError(`Directory not found: ${path}`, 'ENOENT', path);\n }\n\n if (options?.recursive) {\n // Remove all entries under this path\n for (const key of this.fileSystem.keys()) {\n if (key.startsWith(normalizedPath)) {\n this.fileSystem.delete(key);\n }\n }\n } else {\n // Check if directory is empty\n for (const key of this.fileSystem.keys()) {\n if (key !== normalizedPath && key.startsWith(normalizedPath)) {\n throw new PalError(`Directory not empty: ${path}`, 'ENOTEMPTY', path);\n }\n }\n this.fileSystem.delete(normalizedPath);\n }\n }\n\n // ============================================\n // Path Operations\n // ============================================\n\n resolvePath(...segments: string[]): string {\n if (segments.length === 0) return this.cwd;\n\n let result = segments[0];\n if (!this.isAbsolute(result)) {\n result = this.joinPath(this.cwd, result);\n }\n\n for (let i = 1; i < segments.length; i++) {\n result = this.joinPath(result, segments[i]);\n }\n\n return this.normalize(result);\n }\n\n joinPath(...segments: string[]): string {\n return segments.join('/').replace(/\\/+/g, '/');\n }\n\n dirname(path: string): string {\n const lastSlash = path.lastIndexOf('/');\n return lastSlash === -1 ? '.' : path.substring(0, lastSlash) || '/';\n }\n\n basename(path: string, ext?: string): string {\n const base = path.split('/').pop() || '';\n if (ext && base.endsWith(ext)) {\n return base.substring(0, base.length - ext.length);\n }\n return base;\n }\n\n extname(path: string): string {\n const base = this.basename(path);\n const lastDot = base.lastIndexOf('.');\n return lastDot === -1 ? '' : base.substring(lastDot);\n }\n\n isAbsolute(path: string): boolean {\n return path.startsWith('/');\n }\n\n normalize(path: string): string {\n const parts = path.split('/');\n const result: string[] = [];\n\n for (const part of parts) {\n if (part === '..') {\n result.pop();\n } else if (part !== '.' && part !== '') {\n result.push(part);\n }\n }\n\n return '/' + result.join('/');\n }\n\n relativePath(from: string, to: string): string {\n const fromParts = this.normalize(from).split('/').filter(Boolean);\n const toParts = this.normalize(to).split('/').filter(Boolean);\n\n let common = 0;\n while (\n common < fromParts.length &&\n common < toParts.length &&\n fromParts[common] === toParts[common]\n ) {\n common++;\n }\n\n const ups = fromParts.length - common;\n const remainder = toParts.slice(common);\n\n return [...Array(ups).fill('..'), ...remainder].join('/') || '.';\n }\n\n // ============================================\n // Environment\n // ============================================\n\n getEnv(key: string): string | undefined {\n return this.environment.get(key);\n }\n\n setEnv(key: string, value: string): void {\n this.environment.set(key, value);\n }\n\n getPlatform(): Platform {\n return this.currentPlatform;\n }\n\n getHomeDir(): string {\n return '/mock/home';\n }\n\n getTempDir(): string {\n return '/mock/tmp';\n }\n\n getCwd(): string {\n return this.cwd;\n }\n\n // ============================================\n // Private Helpers\n // ============================================\n\n private normalizePath(path: string): string {\n if (!this.isAbsolute(path)) {\n path = this.joinPath(this.cwd, path);\n }\n return this.normalize(path);\n }\n\n private ensureParentDirs(path: string): void {\n const parts = path.split('/').filter(Boolean);\n let current = '';\n\n for (let i = 0; i < parts.length - 1; i++) {\n current += '/' + parts[i];\n if (!this.fileSystem.has(current)) {\n this.fileSystem.set(current, {\n type: 'directory',\n createdAt: new Date(),\n modifiedAt: new Date(),\n });\n }\n }\n }\n}\n```\n\n### Step 3.4: Create Barrel with Singleton\n\n```typescript\n// src/platform/index.ts\n\nimport { NodePAL } from './node-pal.js';\nimport type { PlatformAbstractionLayer } from './pal.interface.js';\n\nexport type { PlatformAbstractionLayer, Platform, FileStats, ListFilesOptions } from './pal.interface.js';\nexport { PalError } from './pal.interface.js';\nexport { NodePAL } from './node-pal.js';\nexport { MockPAL } from './mock-pal.js';\n\n/**\n * Default PAL singleton for application use.\n *\n * Use this for all file system operations instead of direct fs/path imports.\n *\n * \n * ```typescript\n * import { pal } from './platform/index.js';\n *\n * const content = await pal.readFile('./config.json');\n * const fullPath = pal.joinPath(pal.getHomeDir(), '.config', 'app.json');\n * ```\n */\nexport const pal: PlatformAbstractionLayer = new NodePAL();\n\n/**\n * Create a new PAL instance (useful for tests or custom implementations).\n */\nexport function createPAL(impl: 'node' | 'mock' = 'node'): PlatformAbstractionLayer {\n if (impl === 'mock') {\n const { MockPAL } = require('./mock-pal.js');\n return new MockPAL();\n }\n return new NodePAL();\n}\n```\n\n---\n\n## 4. Migration Guide\n\n### Before (Direct fs/path)\n\n```typescript\n// ‚ùå Old pattern\nimport { promises as fs } from 'node:fs';\nimport * as path from 'node:path';\n\nconst configPath = path.join(process.cwd(), 'config.json');\nconst content = await fs.readFile(configPath, 'utf-8');\n```\n\n### After (Using PAL)\n\n```typescript\n// ‚úÖ New pattern\nimport { pal } from '../platform/index.js';\n\nconst configPath = pal.joinPath(pal.getCwd(), 'config.json');\nconst content = await pal.readFile(configPath);\n```\n\n### Test Setup\n\n```typescript\n// ‚úÖ Easy mocking\nimport { MockPAL } from '../platform/mock-pal.js';\n\ndescribe('MyModule', () => {\n let mockPal: MockPAL;\n\n beforeEach(() => {\n mockPal = new MockPAL();\n mockPal.setFile('/project/config.json', '{\"key\": \"value\"}');\n });\n\n it('should read config', async () => {\n const result = await myFunction(mockPal);\n expect(result.key).toBe('value');\n });\n});\n```\n\n---\n\n## 5. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------------- | ------ | ------------------- |\n| PAL interface with all methods defined | ‚¨ú | Interface compiles |\n| NodePAL implements all methods | ‚¨ú | All tests pass |\n| MockPAL implements all methods | ‚¨ú | All tests pass |\n| Error wrapping with PalError | ‚¨ú | Error codes correct |\n| Singleton export `pal` | ‚¨ú | Can import and use |\n| Cross-platform path handling | ‚¨ú | Windows paths work |\n| 90% test coverage | ‚¨ú | Coverage report |\n\n---\n\n## 6. References\n\n| Document | Link |\n| ----------------------------------- | -------------------------------------------------------- |\n| ADR-004: Platform Abstraction Layer | [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md#adr-004) |\n| Spec REQ-014, REQ-015, REQ-016 | [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) |\n| Node.js fs module | [nodejs.org/api/fs.html](https://nodejs.org/api/fs.html) |\n\n---\n\n*Task: T-053 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-053",
		"dependencies": [],
		"estimate_hours": 26,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-053-pal-interface.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-053-pal-interface.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-054: Implement NodePAL",
		"body": "# T-054: Implement NodePAL\n\n## Overview\n\n**Task ID**: T-054\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 6h\n**Dependencies**: T-053\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-054-node-pal.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement NodePAL' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-054\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- PAL interface defined in T-053\n- No production implementation exists\n- Direct fs/path calls scattered throughout codebase\n\n### Target State\n\n- `NodePAL` implements full `PlatformAbstractionLayer` interface\n- Cross-platform path handling (Windows, Linux, macOS)\n- Async file operations with proper error handling\n- Thread-safe implementation for concurrent access\n\n### Out of Scope\n\n- Shell script replacement (future task)\n- Streaming file operations\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-053: PAL interface defined\n\n### Target Files\n\n- `src/platform/node-pal.ts` (new)\n- `src/platform/index.ts` (barrel export)\n\n### Tooling\n\n- Node.js 22.x (fs/promises API)\n- TypeScript strict mode\n\n## 4. Implementation Guide\n\n### Step 4.1: Create NodePAL Class\n\n**File**: `src/platform/node-pal.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport type { PlatformAbstractionLayer, FileInfo, Platform } from './pal.interface.js';\nimport * as fs from 'node:fs/promises';\nimport * as fsSync from 'node:fs';\nimport * as path from 'node:path';\nimport * as os from 'node:os';\nimport { glob } from 'glob';\n\nexport class NodePAL implements PlatformAbstractionLayer {\n // File Operations\n async readFile(filePath: string): Promise<string> {\n return fs.readFile(filePath, 'utf-8');\n }\n\n async writeFile(filePath: string, content: string): Promise<void> {\n const dir = path.dirname(filePath);\n await fs.mkdir(dir, { recursive: true });\n await fs.writeFile(filePath, content, 'utf-8');\n }\n\n async exists(filePath: string): Promise<boolean> {\n try {\n await fs.access(filePath);\n return true;\n } catch {\n return false;\n }\n }\n\n async delete(filePath: string): Promise<void> {\n await fs.rm(filePath, { recursive: true, force: true });\n }\n\n async stat(filePath: string): Promise<FileInfo> {\n const stats = await fs.stat(filePath);\n return {\n path: filePath,\n isDirectory: stats.isDirectory(),\n isFile: stats.isFile(),\n size: stats.size,\n mtime: stats.mtime,\n };\n }\n\n // Directory Operations\n async listFiles(dir: string, pattern?: string): Promise<string[]> {\n if (pattern) {\n return glob(pattern, { cwd: dir, absolute: true });\n }\n const entries = await fs.readdir(dir, { withFileTypes: true });\n return entries\n .filter(e => e.isFile())\n .map(e => path.join(dir, e.name));\n }\n\n async createDir(dirPath: string): Promise<void> {\n await fs.mkdir(dirPath, { recursive: true });\n }\n\n // Path Operations\n resolvePath(...segments: string[]): string {\n return path.resolve(...segments);\n }\n\n joinPath(...segments: string[]): string {\n return path.join(...segments);\n }\n\n dirname(filePath: string): string {\n return path.dirname(filePath);\n }\n\n basename(filePath: string, ext?: string): string {\n return path.basename(filePath, ext);\n }\n\n extname(filePath: string): string {\n return path.extname(filePath);\n }\n\n // Environment\n getEnv(key: string): string | undefined {\n return process.env[key];\n }\n\n getPlatform(): Platform {\n return process.platform as Platform;\n }\n\n getHomeDir(): string {\n return os.homedir();\n }\n\n getTempDir(): string {\n return os.tmpdir();\n }\n\n getCwd(): string {\n return process.cwd();\n }\n}\n```\n\n### Step 4.2: Export Singleton\n\n**File**: `src/platform/index.ts`\n```typescript\nimport { NodePAL } from './node-pal.js';\nimport type { PlatformAbstractionLayer } from './pal.interface.js';\n\nexport type { PlatformAbstractionLayer, FileInfo, Platform } from './pal.interface.js';\nexport { NodePAL } from './node-pal.js';\nexport { MockPAL } from './mock-pal.js';\n\n// Singleton for production use\nexport const pal: PlatformAbstractionLayer = new NodePAL();\n```\n\n### Step 4.3: Add Unit Tests\n\n**File**: `tests/vitest/platform/node-pal.spec.ts`\n```typescript\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { NodePAL } from '../../../src/platform/node-pal.js';\nimport * as os from 'node:os';\nimport * as path from 'node:path';\n\ndescribe('NodePAL', () => {\n let pal: NodePAL;\n let testDir: string;\n\n beforeEach(async () => {\n pal = new NodePAL();\n testDir = path.join(os.tmpdir(), `nodepal-test-${Date.now()}`);\n await pal.createDir(testDir);\n });\n\n afterEach(async () => {\n await pal.delete(testDir);\n });\n\n it('should write and read files', async () => {\n const filePath = pal.joinPath(testDir, 'test.txt');\n await pal.writeFile(filePath, 'hello world');\n const content = await pal.readFile(filePath);\n expect(content).toBe('hello world');\n });\n\n it('should check file existence', async () => {\n const filePath = pal.joinPath(testDir, 'exists.txt');\n expect(await pal.exists(filePath)).toBe(false);\n await pal.writeFile(filePath, 'content');\n expect(await pal.exists(filePath)).toBe(true);\n });\n\n it('should return correct platform', () => {\n const platform = pal.getPlatform();\n expect(['darwin', 'linux', 'win32']).toContain(platform);\n });\n});\n```\n- Add configuration entries where needed\n\n### Step 4.4: Validate Behavior\n\n- Run unit tests for new logic\n- Ensure TypeScript strict mode passes\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `src/platform/node-pal.ts`\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-022-pal-interface.md)\n\n---\n\n*Task: T-054 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-054",
		"dependencies": ["T-053"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-054-node-pal.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-054-node-pal.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-055: Implement MockPAL",
		"body": "# T-055: Implement MockPAL\n\n## Overview\n\n**Task ID**: T-055\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 4h\n**Dependencies**: T-053\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-055-mock-pal.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement MockPAL' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-055\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- PAL interface defined in T-053\n- NodePAL implemented in T-054\n- Tests require file system mocking\n\n### Target State\n\n- `MockPAL` implements full `PlatformAbstractionLayer` interface\n- In-memory file system simulation\n- Configurable error injection for edge case testing\n- Full compatibility with NodePAL behavior\n\n### Out of Scope\n\n- Performance optimization (test-only use)\n- Streaming operations\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-053: PAL interface defined\n\n### Target Files\n\n- `src/platform/mock-pal.ts` (new)\n- Update `src/platform/index.ts` (export)\n\n### Tooling\n\n- Node.js 22.x\n- Vitest for testing\n\n## 4. Implementation Guide\n\n### Step 4.1: Create MockPAL Class\n\n**File**: `src/platform/mock-pal.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport type { PlatformAbstractionLayer, FileInfo, Platform } from './pal.interface.js';\n\ninterface MockFile {\n content: string;\n mtime: Date;\n}\n\ninterface MockPALOptions {\n platform?: Platform;\n cwd?: string;\n homeDir?: string;\n env?: Record<string, string>;\n}\n\nexport class MockPAL implements PlatformAbstractionLayer {\n private files = new Map<string, MockFile>();\n private directories = new Set<string>();\n private errorOnPath = new Map<string, Error>();\n\n private platform: Platform;\n private cwd: string;\n private homeDir: string;\n private env: Record<string, string>;\n\n constructor(options: MockPALOptions = {}) {\n this.platform = options.platform ?? 'linux';\n this.cwd = options.cwd ?? '/mock/cwd';\n this.homeDir = options.homeDir ?? '/mock/home';\n this.env = options.env ?? {};\n this.directories.add('/');\n this.directories.add(this.cwd);\n this.directories.add(this.homeDir);\n }\n\n // Test Helpers\n setFile(path: string, content: string): void {\n this.files.set(this.normalizePath(path), {\n content,\n mtime: new Date(),\n });\n this.ensureParentDirs(path);\n }\n\n setFiles(fileMap: Record<string, string>): void {\n for (const [path, content] of Object.entries(fileMap)) {\n this.setFile(path, content);\n }\n }\n\n setErrorOnPath(path: string, error: Error): void {\n this.errorOnPath.set(this.normalizePath(path), error);\n }\n\n reset(): void {\n this.files.clear();\n this.directories.clear();\n this.errorOnPath.clear();\n this.directories.add('/');\n }\n\n // File Operations\n async readFile(filePath: string): Promise<string> {\n const normalized = this.normalizePath(filePath);\n this.checkError(normalized);\n\n const file = this.files.get(normalized);\n if (!file) {\n throw new Error(`ENOENT: no such file or directory: ${filePath}`);\n }\n return file.content;\n }\n\n async writeFile(filePath: string, content: string): Promise<void> {\n const normalized = this.normalizePath(filePath);\n this.checkError(normalized);\n this.ensureParentDirs(filePath);\n\n this.files.set(normalized, {\n content,\n mtime: new Date(),\n });\n }\n\n async exists(filePath: string): Promise<boolean> {\n const normalized = this.normalizePath(filePath);\n return this.files.has(normalized) || this.directories.has(normalized);\n }\n\n async delete(filePath: string): Promise<void> {\n const normalized = this.normalizePath(filePath);\n this.files.delete(normalized);\n this.directories.delete(normalized);\n }\n\n async stat(filePath: string): Promise<FileInfo> {\n const normalized = this.normalizePath(filePath);\n const file = this.files.get(normalized);\n const isDir = this.directories.has(normalized);\n\n if (!file && !isDir) {\n throw new Error(`ENOENT: no such file or directory: ${filePath}`);\n }\n\n return {\n path: filePath,\n isDirectory: isDir,\n isFile: !!file,\n size: file?.content.length ?? 0,\n mtime: file?.mtime ?? new Date(),\n };\n }\n\n // Directory Operations\n async listFiles(dir: string, pattern?: string): Promise<string[]> {\n const normalized = this.normalizePath(dir);\n const files = Array.from(this.files.keys())\n .filter(f => f.startsWith(normalized + '/'));\n\n if (pattern) {\n const regex = this.globToRegex(pattern);\n return files.filter(f => regex.test(f));\n }\n return files;\n }\n\n async createDir(dirPath: string): Promise<void> {\n this.ensureParentDirs(dirPath);\n this.directories.add(this.normalizePath(dirPath));\n }\n\n // Path Operations\n resolvePath(...segments: string[]): string {\n return this.normalizePath(segments.join('/'));\n }\n\n joinPath(...segments: string[]): string {\n return segments.join(this.platform === 'win32' ? '\\\\' : '/');\n }\n\n dirname(filePath: string): string {\n const parts = filePath.split(/[\\/\\\\]/);\n parts.pop();\n return parts.join('/') || '/';\n }\n\n basename(filePath: string, ext?: string): string {\n const name = filePath.split(/[\\/\\\\]/).pop() ?? '';\n return ext && name.endsWith(ext) ? name.slice(0, -ext.length) : name;\n }\n\n extname(filePath: string): string {\n const name = this.basename(filePath);\n const idx = name.lastIndexOf('.');\n return idx > 0 ? name.slice(idx) : '';\n }\n\n // Environment\n getEnv(key: string): string | undefined {\n return this.env[key];\n }\n\n getPlatform(): Platform {\n return this.platform;\n }\n\n getHomeDir(): string {\n return this.homeDir;\n }\n\n getTempDir(): string {\n return '/mock/tmp';\n }\n\n getCwd(): string {\n return this.cwd;\n }\n\n // Private Helpers\n private normalizePath(p: string): string {\n return p.replace(/\\\\/g, '/').replace(/\\/+/g, '/');\n }\n\n private ensureParentDirs(filePath: string): void {\n const parts = this.normalizePath(filePath).split('/');\n parts.pop();\n let current = '';\n for (const part of parts) {\n current += '/' + part;\n this.directories.add(current.replace(/^\\/\\//, '/'));\n }\n }\n\n private checkError(path: string): void {\n const error = this.errorOnPath.get(path);\n if (error) throw error;\n }\n\n private globToRegex(pattern: string): RegExp {\n const escaped = pattern\n .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&')\n .replace(/\\*/g, '.*')\n .replace(/\\?/g, '.');\n return new RegExp(`^${escaped}$`);\n }\n}\n```\n\n### Step 4.2: Add Unit Tests\n\n**File**: `tests/vitest/platform/mock-pal.spec.ts`\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { MockPAL } from '../../../src/platform/mock-pal.js';\n\ndescribe('MockPAL', () => {\n let pal: MockPAL;\n\n beforeEach(() => {\n pal = new MockPAL();\n });\n\n it('should read and write files', async () => {\n await pal.writeFile('/test/file.txt', 'content');\n const result = await pal.readFile('/test/file.txt');\n expect(result).toBe('content');\n });\n\n it('should throw on missing file', async () => {\n await expect(pal.readFile('/missing.txt')).rejects.toThrow('ENOENT');\n });\n\n it('should support setFiles helper', async () => {\n pal.setFiles({\n '/a.txt': 'A',\n '/b.txt': 'B',\n });\n expect(await pal.readFile('/a.txt')).toBe('A');\n expect(await pal.readFile('/b.txt')).toBe('B');\n });\n\n it('should inject errors on specific paths', async () => {\n pal.setFile('/protected.txt', 'secret');\n pal.setErrorOnPath('/protected.txt', new Error('EACCES: permission denied'));\n await expect(pal.readFile('/protected.txt')).rejects.toThrow('EACCES');\n });\n});\n```\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `src/platform/mock-pal.ts`\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-022-pal-interface.md)\n\n---\n\n*Task: T-055 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-055",
		"dependencies": ["T-053"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-055-mock-pal.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-055-mock-pal.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-056: Identify All fs/path Calls",
		"body": "# T-056: Identify All fs/path Calls\n\n## Overview\n\n**Task ID**: T-056\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-056-identify-all-fs-path-calls.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nAudit codebase for all direct filesystem access.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-056\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Identify All fs/path Calls fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- None\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Filesystem Usage Audit Script\n\nCreate `scripts/audit-fs-usage.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\nimport { glob } from 'glob';\n\ninterface FsUsageResult {\n file: string;\n line: number;\n column: number;\n type: 'fs' | 'path' | 'fs/promises';\n method: string;\n context: string;\n}\n\ninterface AuditSummary {\n totalFiles: number;\n filesWithFsUsage: number;\n totalUsages: number;\n byType: Record<string, number>;\n byMethod: Record<string, number>;\n usages: FsUsageResult[];\n}\n\n/**\n * Audit codebase for direct fs/path module usage\n * Identifies all locations that need PAL abstraction\n */\nexport async function auditFsUsage(srcDir: string): Promise<AuditSummary> {\n const files = await glob(`${srcDir}/**/*.ts`, {\n ignore: ['**/*.spec.ts', '**/*.test.ts', '**/node_modules/**'],\n });\n\n const usages: FsUsageResult[] = [];\n let filesWithFsUsage = 0;\n\n for (const file of files) {\n const content = fs.readFileSync(file, 'utf-8');\n const fileUsages = analyzeFile(file, content);\n if (fileUsages.length > 0) {\n filesWithFsUsage++;\n usages.push(...fileUsages);\n }\n }\n\n return {\n totalFiles: files.length,\n filesWithFsUsage,\n totalUsages: usages.length,\n byType: groupByType(usages),\n byMethod: groupByMethod(usages),\n usages,\n };\n}\n\nfunction analyzeFile(filePath: string, content: string): FsUsageResult[] {\n const results: FsUsageResult[] = [];\n const lines = content.split('\\n');\n\n // Patterns to detect\n const patterns = [\n { type: 'fs' as const, regex: /\\bfs\\.(\\w+)\\s*\\(/g },\n { type: 'fs/promises' as const, regex: /\\bfsPromises\\.(\\w+)\\s*\\(/g },\n { type: 'path' as const, regex: /\\bpath\\.(\\w+)\\s*\\(/g },\n { type: 'fs' as const, regex: /from\\s+['\"]node:fs['\"]/g, method: 'import' },\n { type: 'fs/promises' as const, regex: /from\\s+['\"]node:fs\\/promises['\"]/g, method: 'import' },\n { type: 'path' as const, regex: /from\\s+['\"]node:path['\"]/g, method: 'import' },\n ];\n\n lines.forEach((line, lineIndex) => {\n for (const pattern of patterns) {\n let match;\n while ((match = pattern.regex.exec(line)) !== null) {\n results.push({\n file: filePath,\n line: lineIndex + 1,\n column: match.index + 1,\n type: pattern.type,\n method: pattern.method ?? match[1] ?? 'unknown',\n context: line.trim().slice(0, 100),\n });\n }\n }\n });\n\n return results;\n}\n\nfunction groupByType(usages: FsUsageResult[]): Record<string, number> {\n return usages.reduce((acc, u) => {\n acc[u.type] = (acc[u.type] || 0) + 1;\n return acc;\n }, {} as Record<string, number>);\n}\n\nfunction groupByMethod(usages: FsUsageResult[]): Record<string, number> {\n return usages.reduce((acc, u) => {\n acc[u.method] = (acc[u.method] || 0) + 1;\n return acc;\n }, {} as Record<string, number>);\n}\n```\n\n### Step 4.2: Generate Audit Report\n\nCreate `scripts/generate-fs-audit-report.ts`:\n\n```typescript\nimport { auditFsUsage } from './audit-fs-usage.js';\nimport * as fs from 'node:fs';\n\nasync function main() {\n const srcDir = process.argv[2] || 'src';\n const result = await auditFsUsage(srcDir);\n\n const report = `\n# Filesystem Usage Audit Report\n\nGenerated: ${new Date().toISOString()}\n\n## Summary\n\n| Metric | Value |\n| ------------------------ | -------------------------- |\n| Total Files Scanned | ${result.totalFiles} |\n| Files with fs/path Usage | ${result.filesWithFsUsage} |\n| Total Usages | ${result.totalUsages} |\n\n## By Module Type\n\n| Type | Count |\n| ------------------------------------------------- | ----- |\n| ${Object.entries(result.byType).map(([k, v]) => ` | ${k} | ${v} | `).join('\\n')} |\n\n## By Method\n\n| Method | Count |\n| --------------------------------------------------- | ----- |\n| ${Object.entries(result.byMethod).map(([k, v]) => ` | ${k} | ${v} | `).join('\\n')} |\n\n## All Usages\n\n${result.usages.map(u => `- **${u.file}:${u.line}** - \\`${u.type}.${u.method}\\`\n \\`\\`\\`\n ${u.context}\n \\`\\`\\``).join('\\n\\n')}\n`;\n\n fs.writeFileSync('artifacts/fs-audit-report.md', report);\n console.log(`Audit complete. Found ${result.totalUsages} usages in ${result.filesWithFsUsage} files.`);\n}\n\nmain();\n```\n\n### Step 4.3: Add npm Scripts\n\nUpdate `package.json`:\n\n```json\n{\n \"scripts\": {\n \"audit:fs\": \"tsx scripts/audit-fs-usage.ts src\",\n \"audit:fs:report\": \"tsx scripts/generate-fs-audit-report.ts src\"\n }\n}\n```\n\n### Step 4.4: Create CI Check\n\nAdd to `.github/workflows/quality.yml`:\n\n```yaml\n- name: Audit Filesystem Usage\n run: npm run audit:fs:report\n\n- name: Upload Audit Report\n uses: actions/upload-artifact\n with:\n name: fs-audit-report\n path: artifacts/fs-audit-report.md\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-056 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-056",
		"dependencies": [],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-056-identify-all-fs-path-calls.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-056-identify-all-fs-path-calls.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-057: Replace fs/path Calls with PAL",
		"body": "# T-057: Replace fs/path Calls with PAL\n\n## Overview\n\n**Task ID**: T-057\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 10h\n**Dependencies**: T-054, T-056\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-057-replace-fs-path-calls-with-pal.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Replace fs/path Calls with PAL' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-057\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Replace fs/path Calls with PAL fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-054, T-056\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Review PAL Interface\n\nEnsure PAL interface from T-053 is available in `src/platform/pal.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n/**\n * Platform Abstraction Layer (PAL) Interface\n * Abstracts filesystem and path operations for cross-platform compatibility\n */\nexport interface PAL {\n // File operations\n readFile(path: string, encoding?: BufferEncoding): Promise<string>;\n writeFile(path: string, content: string): Promise<void>;\n exists(path: string): Promise<boolean>;\n mkdir(path: string, options?: { recursive?: boolean }): Promise<void>;\n readdir(path: string): Promise<string[]>;\n stat(path: string): Promise<{ isFile: boolean; isDirectory: boolean }>;\n unlink(path: string): Promise<void>;\n\n // Path operations\n join(...paths: string[]): string;\n resolve(...paths: string[]): string;\n dirname(path: string): string;\n basename(path: string, ext?: string): string;\n extname(path: string): string;\n relative(from: string, to: string): string;\n isAbsolute(path: string): boolean;\n normalize(path: string): string;\n}\n```\n\n### Step 4.2: Create Migration Script\n\nCreate `scripts/migrate-to-pal.ts`:\n\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\nimport { glob } from 'glob';\n\ninterface MigrationResult {\n file: string;\n changes: number;\n migrations: string[];\n}\n\nconst REPLACEMENTS: Array<{ from: RegExp; to: string; description: string }> = [\n // Import replacements\n {\n from: /import \\* as fs from ['\"]node:fs['\"];?/g,\n to: \"import { getPAL } from '../platform/index.js';\",\n description: 'Replace fs import',\n },\n {\n from: /import \\* as path from ['\"]node:path['\"];?/g,\n to: '', // PAL includes path operations\n description: 'Remove path import (included in PAL)',\n },\n {\n from: /import \\{ (.*) \\} from ['\"]node:fs\\/promises['\"];?/g,\n to: \"import { getPAL } from '../platform/index.js';\",\n description: 'Replace fs/promises import',\n },\n\n // Method replacements\n {\n from: /fs\\.readFileSync\\(([^,]+),\\s*['\"]utf-?8['\"]\\)/g,\n to: 'await getPAL().readFile($1)',\n description: 'Replace fs.readFileSync',\n },\n {\n from: /fs\\.writeFileSync\\(([^,]+),\\s*([^)]+)\\)/g,\n to: 'await getPAL().writeFile($1, $2)',\n description: 'Replace fs.writeFileSync',\n },\n {\n from: /fs\\.existsSync\\(([^)]+)\\)/g,\n to: 'await getPAL().exists($1)',\n description: 'Replace fs.existsSync',\n },\n {\n from: /fs\\.mkdirSync\\(([^,)]+)(?:,\\s*\\{[^}]*\\})?\\)/g,\n to: 'await getPAL().mkdir($1, { recursive: true })',\n description: 'Replace fs.mkdirSync',\n },\n {\n from: /path\\.(join|resolve|dirname|basename|extname|relative|normalize)\\(/g,\n to: 'getPAL().$1(',\n description: 'Replace path methods',\n },\n];\n\nexport async function migrateFile(filePath: string): Promise<MigrationResult> {\n let content = fs.readFileSync(filePath, 'utf-8');\n const migrations: string[] = [];\n let changes = 0;\n\n for (const replacement of REPLACEMENTS) {\n const matches = content.match(replacement.from);\n if (matches) {\n content = content.replace(replacement.from, replacement.to);\n changes += matches.length;\n migrations.push(`${replacement.description} (${matches.length}x)`);\n }\n }\n\n if (changes > 0) {\n fs.writeFileSync(filePath, content);\n }\n\n return { file: filePath, changes, migrations };\n}\n\nexport async function migrateProject(srcDir: string): Promise<MigrationResult[]> {\n const files = await glob(`${srcDir}/**/*.ts`, {\n ignore: ['**/*.spec.ts', '**/platform/**', '**/node_modules/**'],\n });\n\n const results: MigrationResult[] = [];\n for (const file of files) {\n const result = await migrateFile(file);\n if (result.changes > 0) {\n results.push(result);\n }\n }\n\n return results;\n}\n```\n\n### Step 4.3: Run Migration\n\nAdd npm script to `package.json`:\n\n```json\n{\n \"scripts\": {\n \"migrate:pal\": \"tsx scripts/migrate-to-pal.ts src\",\n \"migrate:pal:dry\": \"tsx scripts/migrate-to-pal.ts src --dry-run\"\n }\n}\n```\n\nRun migration:\n\n```bash\n# Preview changes\nnpm run migrate:pal:dry\n\n# Apply changes\nnpm run migrate:pal\n```\n\n### Step 4.4: Verify Migration\n\nPost-migration verification:\n\n```bash\n# Type-check to ensure imports are correct\nnpm run type-check\n\n# Run tests to verify functionality\nnpm run test:vitest\n\n# Re-audit to confirm no direct fs/path usage remains\nnpm run audit:fs\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-057 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-057",
		"dependencies": ["T-054", "T-056"],
		"estimate_hours": 10,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-057-replace-fs-path-calls-with-pal.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-057-replace-fs-path-calls-with-pal.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-058: Test PAL Interface",
		"body": "# T-058: Test PAL Interface\n\n## Overview\n\n**Task ID**: T-058\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-054, T-055\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-058-test-pal-interface.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test PAL Interface' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-058\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test PAL Interface fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-054, T-055\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-058 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "testing", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-058",
		"dependencies": ["T-054", "T-055"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-058-test-pal-interface.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-058-test-pal-interface.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-059: Cross-Platform Verification",
		"body": "# T-059: Cross-Platform Verification\n\n## Overview\n\n**Task ID**: T-059\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-057\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-059-cross-platform-verification.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nVerify path handling on Windows vs Unix.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-059\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Cross-Platform Verification fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-057\n\n### Target Files\n\n- `TBD`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Cross-Platform Test Suite\n\nCreate `tests/vitest/platform/cross-platform.spec.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { getPAL, setPAL, resetPAL } from '../../../src/platform/index.js';\nimport { createNodePAL } from '../../../src/platform/node-pal.js';\nimport { createMockPAL } from '../../../src/platform/mock-pal.js';\n\ndescribe('Cross-Platform Verification', () => {\n describe('Path Handling', () => {\n it('normalizes Windows-style paths', () => {\n const pal = getPAL();\n const result = pal.normalize('foo\\\\bar\\\\baz');\n expect(result).toMatch(/foo.bar.baz/);\n });\n\n it('normalizes Unix-style paths', () => {\n const pal = getPAL();\n const result = pal.normalize('foo/bar/baz');\n expect(result).toMatch(/foo.bar.baz/);\n });\n\n it('handles mixed path separators', () => {\n const pal = getPAL();\n const result = pal.normalize('foo/bar\\\\baz');\n expect(result).toMatch(/foo.bar.baz/);\n });\n\n it('joins paths consistently', () => {\n const pal = getPAL();\n const result = pal.join('foo', 'bar', 'baz');\n expect(result).toMatch(/foo.bar.baz/);\n });\n\n it('resolves relative paths', () => {\n const pal = getPAL();\n const result = pal.resolve('foo', '..', 'bar');\n expect(result).toContain('bar');\n expect(result).not.toContain('foo');\n });\n\n it('handles absolute path detection', () => {\n const pal = getPAL();\n\n // Unix absolute\n expect(pal.isAbsolute('/foo/bar')).toBe(true);\n\n // Windows absolute (if on Windows)\n if (process.platform === 'win32') {\n expect(pal.isAbsolute('C:\\\\foo\\\\bar')).toBe(true);\n }\n\n // Relative\n expect(pal.isAbsolute('foo/bar')).toBe(false);\n });\n });\n\n describe('File Operations', () => {\n const testDir = 'test-output/cross-platform';\n const testFile = `${testDir}/test.txt`;\n\n beforeEach(async () => {\n const pal = getPAL();\n await pal.mkdir(testDir, { recursive: true });\n });\n\n afterEach(async () => {\n const pal = getPAL();\n try {\n await pal.unlink(testFile);\n } catch { /* ignore */ }\n });\n\n it('writes and reads files consistently', async () => {\n const pal = getPAL();\n const content = 'Hello, cross-platform world!\\nLine 2';\n\n await pal.writeFile(testFile, content);\n const result = await pal.readFile(testFile);\n\n expect(result).toBe(content);\n });\n\n it('handles UTF-8 content', async () => {\n const pal = getPAL();\n const content = 'Êó•Êú¨Ë™û„ÉÜ„Çπ„Éà üéâ √©mojis';\n\n await pal.writeFile(testFile, content);\n const result = await pal.readFile(testFile);\n\n expect(result).toBe(content);\n });\n\n it('checks file existence', async () => {\n const pal = getPAL();\n\n await pal.writeFile(testFile, 'test');\n expect(await pal.exists(testFile)).toBe(true);\n\n await pal.unlink(testFile);\n expect(await pal.exists(testFile)).toBe(false);\n });\n });\n\n describe('PAL Switching', () => {\n afterEach(() => {\n resetPAL();\n });\n\n it('switches between Node and Mock PAL', async () => {\n // Start with Node PAL\n const nodePAL = createNodePAL();\n setPAL(nodePAL);\n expect(getPAL()).toBe(nodePAL);\n\n // Switch to Mock PAL\n const mockPAL = createMockPAL();\n setPAL(mockPAL);\n expect(getPAL()).toBe(mockPAL);\n });\n\n it('Mock PAL works in memory', async () => {\n const mockPAL = createMockPAL();\n setPAL(mockPAL);\n\n const pal = getPAL();\n await pal.mkdir('/virtual/dir', { recursive: true });\n await pal.writeFile('/virtual/dir/test.txt', 'content');\n\n const result = await pal.readFile('/virtual/dir/test.txt');\n expect(result).toBe('content');\n });\n });\n});\n```\n\n### Step 4.2: Create CI Matrix for Multi-Platform Testing\n\nAdd to `.github/workflows/test.yml`:\n\n```yaml\njobs:\n cross-platform:\n strategy:\n matrix:\n os: [ubuntu-latest, windows-latest, macos-latest]\n node: [22]\n\n runs-on: ${{ matrix.os }}\n\n steps:\n - uses: actions/checkout\n\n - uses: actions/setup-node\n with:\n node-version: ${{ matrix.node }}\n\n - run: npm ci\n - run: npm run build\n\n - name: Run Cross-Platform Tests\n run: npm run test:vitest -- tests/vitest/platform/\n\n - name: Run Full Test Suite\n run: npm run test:vitest\n```\n\n### Step 4.3: Create Platform Detection Utility\n\nCreate `src/platform/detect.ts`:\n\n```typescript\nexport interface PlatformInfo {\n os: 'windows' | 'darwin' | 'linux' | 'unknown';\n pathSeparator: '/' | '\\\\';\n lineEnding: '\\n' | '\\r\\n';\n isCI: boolean;\n}\n\nexport function detectPlatform(): PlatformInfo {\n const platform = process.platform;\n\n return {\n os: platform === 'win32' ? 'windows'\n : platform === 'darwin' ? 'darwin'\n : platform === 'linux' ? 'linux'\n : 'unknown',\n pathSeparator: platform === 'win32' ? '\\\\' : '/',\n lineEnding: platform === 'win32' ? '\\r\\n' : '\\n',\n isCI: Boolean(process.env.CI || process.env.GITHUB_ACTIONS),\n };\n}\n```\n\n### Step 4.4: Add Verification Script\n\nCreate `scripts/verify-cross-platform.ts`:\n\n```typescript\nimport { detectPlatform } from '../src/platform/detect.js';\nimport { getPAL } from '../src/platform/index.js';\n\nasync function verify() {\n const platform = detectPlatform();\n console.log('Platform Detection:', platform);\n\n const pal = getPAL();\n console.log('\\nPath Operations:');\n console.log(' join(\"a\", \"b\"):', pal.join('a', 'b'));\n console.log(' resolve(\".\"):', pal.resolve('.'));\n console.log(' isAbsolute(\"/foo\"):', pal.isAbsolute('/foo'));\n\n console.log('\\nFile Operations:');\n const testPath = pal.join('test-output', 'verify.txt');\n await pal.mkdir('test-output', { recursive: true });\n await pal.writeFile(testPath, 'verification test');\n const content = await pal.readFile(testPath);\n console.log(' Write/Read test:', content === 'verification test' ? 'PASS' : 'FAIL');\n await pal.unlink(testPath);\n\n console.log('\\n‚úÖ Cross-platform verification complete');\n}\n\nverify().catch(console.error);\n```\n\n## 5. Testing Strategy\n\n- Add/update unit tests for new logic\n- Cover error handling and edge cases\n- Run `npm run quality` before finalizing\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-059 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "implementation", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-059",
		"dependencies": ["T-057"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-059-cross-platform-verification.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-059-cross-platform-verification.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-060: Phase 4 Integration Test",
		"body": "# T-060: Phase 4 Integration Test\n\n## Overview\n\n**Task ID**: T-060\n**Phase**: 4\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-053 through T-059\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-060-phase-4-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Phase 4 Integration Test' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-060\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 4 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-053 through T-059\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-060 | Phase: 4 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-4", "integration-test", "P1-high"],
		"milestone": 21,
		"parent_issue": 972,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/972",
		"phase": "4",
		"priority": "P1",
		"task_id": "T-060",
		"dependencies": ["T-053", "T-059"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-060-phase-4-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-4-platform/T-060-phase-4-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-061: Implement CI Job: validate_progress",
		"body": "# T-061: Implement CI Job: validate_progress\n\n## Overview\n\n**Task ID**: T-061\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-048\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-061-ci-validate-progress.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement CI Job: validate_progress' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-061\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- No automated progress.md validation in CI\n- Manual verification of spec-kit documentation\n- Inconsistent progress tracking format\n\n### Target State\n\n- GitHub Actions workflow validates all progress.md files on PR\n- Schema validation ensures consistent format\n- Aggregated progress report generated as CI artifact\n- Blocking on invalid progress.md files\n\n### Out of Scope\n\n- Progress.md content quality (only structure validation)\n- Historical progress tracking\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-048: Progress validation script implemented\n\n### Target Files\n\n- `.github/workflows/validate-progress.yml` (new)\n- `scripts/validate-progress.ts`\n- `artifacts/progress-report.md` (output)\n\n### Tooling\n\n- Node.js 22.x\n- GitHub Actions\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Validation Workflow\n\n**File**: `.github/workflows/validate-progress.yml`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```yaml\nname: Validate Progress Files\n\non:\n pull_request:\n paths:\n - 'plan-*/**/progress.md'\n - 'scripts/validate-progress.ts'\n push:\n branches: [main]\n paths:\n - 'plan-*/**/progress.md'\n\njobs:\n validate-progress:\n runs-on: ubuntu-latest\n steps:\n - uses: actions/checkout\n\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n\n - run: npm ci\n\n - name: Validate progress.md files\n run: npx tsx scripts/validate-progress.ts\n\n - name: Generate progress report\n run: npx tsx scripts/aggregate-progress.ts > artifacts/progress-report.md\n\n - name: Upload progress report\n uses: actions/upload-artifact\n with:\n name: progress-report\n path: artifacts/progress-report.md\n retention-days: 30\n```\n\n### Step 4.2: Implement Validation Script\n\n**File**: `scripts/validate-progress.ts`\n```typescript\nimport { readFileSync } from 'fs';\nimport { glob } from 'glob';\n\ninterface ValidationResult {\n file: string;\n valid: boolean;\n errors: string[];\n}\n\nconst requiredSections = [\n /^# Progress:/m,\n /## Summary/m,\n /## Phase Progress/m,\n];\n\nfunction validateProgress(filePath: string): ValidationResult {\n const content = readFileSync(filePath, 'utf-8');\n const errors: string[] = [];\n\n for (const section of requiredSections) {\n if (!section.test(content)) {\n errors.push(`Missing required section: ${section.source}`);\n }\n }\n\n // Check summary table format\n if (!/\\| Total Tasks \\|/.test(content)) {\n errors.push('Summary table missing \"Total Tasks\" row');\n }\n\n return {\n file: filePath,\n valid: errors.length === 0,\n errors,\n };\n}\n\nasync function main() {\n const files = await glob('plan-*/**/progress.md');\n const results = files.map(validateProgress);\n\n const failed = results.filter(r => !r.valid);\n\n if (failed.length > 0) {\n console.error('\\n‚ùå Progress validation failed:\\n');\n for (const result of failed) {\n console.error(` ${result.file}:`);\n for (const error of result.errors) {\n console.error(` - ${error}`);\n }\n }\n process.exit(1);\n }\n\n console.log(`‚úì Validated ${results.length} progress.md files`);\n}\n\nmain();\n```\n\n### Step 4.3: Add Aggregate Report Script\n\n**File**: `scripts/aggregate-progress.ts`\n```typescript\nimport { readFileSync } from 'fs';\nimport { glob } from 'glob';\n\nasync function main() {\n const files = await glob('plan-*/**/progress.md');\n\n console.log('# Aggregated Progress Report');\n console.log(`\\n_Generated: ${new Date().toISOString()}_\\n`);\n console.log(`## Files: ${files.length}\\n`);\n\n for (const file of files) {\n const content = readFileSync(file, 'utf-8');\n const titleMatch = content.match(/^# Progress: (.+)/m);\n const title = titleMatch?.[1] ?? file;\n\n console.log(`### ${title}`);\n console.log(`_Source: ${file}_\\n`);\n\n // Extract summary table\n const summaryMatch = content.match(/\\| Metric[\\s\\S]*?\\n\\n/);\n if (summaryMatch) {\n console.log(summaryMatch[0]);\n }\n }\n}\n\nmain();\n```\n- Validate job steps and failure behavior\n- Capture timing metrics\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------ | ------ | ------------ |\n| Workflow runs successfully | ‚¨ú | TBD |\n| Failure modes reported clearly | ‚¨ú | TBD |\n| Runtime/coverage targets met | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `.github/workflows/validate-progress.yml`\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-027-enforcement-tools.md)\n\n---\n\n*Task: T-061 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "ci-cd", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-061",
		"dependencies": ["T-048"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-061-ci-validate-progress.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-061-ci-validate-progress.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-062: Implement CI Job: validate_annotations",
		"body": "# T-062: Implement CI Job: validate_annotations\n\n## Overview\n\n**Task ID**: T-062\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-034\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-062-ci-validate-annotations.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement CI Job: validate_annotations' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-062\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement CI Job: validate_annotations fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-034\n\n### Target Files\n\n- `.github/workflows/`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Define Workflow Skeleton\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```yaml\nname: Implement CI Job: validate_annotations\non:\n pull_request:\n branches: [main]\n push:\n branches: [main]\n\njobs:\n implement-ci-job-validate-annotations:\n runs-on: ubuntu-latest\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n - run: npm ci\n - run: npm run build\n - run: npm run validate:annotations\n```\n\n### Step 4.2: Add Task-Specific Steps\n\n- Insert validation or lint steps required by the task\n- Ensure failures surface with actionable logs\n\n### Step 4.3: Optimize Runtime\n\n- Use npm cache in setup-node\n- Split jobs only when parallelism provides net benefit\n\n## 5. Testing Strategy\n\n- Trigger workflow on a test branch\n- Validate job steps and failure behavior\n- Capture timing metrics\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Workflow runs successfully | ‚¨ú | GitHub Actions |\n| Failure modes reported clearly | ‚¨ú | CI log review |\n| Runtime/coverage targets met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-027-enforcement-tools.md)\n\n---\n\n*Task: T-062 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "ci-cd", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-062",
		"dependencies": ["T-034"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-062-ci-validate-annotations.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-062-ci-validate-annotations.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-063: Implement CI Job: validate_schema_examples",
		"body": "# T-063: Implement CI Job: validate_schema_examples\n\n## Overview\n\n**Task ID**: T-063\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-046\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-063-ci-validate-schema-examples.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement CI Job: validate_schema_examples' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-063\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Implement CI Job: validate_schema_examples fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-046\n\n### Target Files\n\n- `.github/workflows/`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Define Workflow Skeleton\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```yaml\nname: Implement CI Job: validate_schema_examples\non:\n pull_request:\n branches: [main]\n push:\n branches: [main]\n\njobs:\n implement-ci-job-validate-schema-examples:\n runs-on: ubuntu-latest\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n - run: npm ci\n - run: npm run build\n - run: npm run validate:schemas\n```\n\n### Step 4.2: Add Task-Specific Steps\n\n- Insert validation or lint steps required by the task\n- Ensure failures surface with actionable logs\n\n### Step 4.3: Optimize Runtime\n\n- Use npm cache in setup-node\n- Split jobs only when parallelism provides net benefit\n\n## 5. Testing Strategy\n\n- Trigger workflow on a test branch\n- Validate job steps and failure behavior\n- Capture timing metrics\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Workflow runs successfully | ‚¨ú | GitHub Actions |\n| Failure modes reported clearly | ‚¨ú | CI log review |\n| Runtime/coverage targets met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- [issue template](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/issues/templates/issue-027-enforcement-tools.md)\n\n---\n\n*Task: T-063 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "ci-cd", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-063",
		"dependencies": ["T-046"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-063-ci-validate-schema-examples.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-063-ci-validate-schema-examples.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-064: Optimize CI Pipeline",
		"body": "# T-064: Optimize CI Pipeline\n\n## Overview\n\n**Task ID**: T-064\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 4h\n**Dependencies**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-064-ci-optimize.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Optimize CI Pipeline' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-064\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- CI pipeline runs ~18 minutes\n- No npm caching configured\n- Sequential test execution\n- Full install on every run\n\n### Target State\n\n- CI pipeline ‚â§12 minutes (33% reduction)\n- npm cache hit rate >80%\n- Parallel test execution where possible\n- Incremental builds where supported\n\n### Out of Scope\n\n- Self-hosted runners\n- Build caching beyond npm\n\n## 3. Prerequisites\n\n### Dependencies\n\n- None (applies to all workflows)\n\n### Target Files\n\n- `.github/workflows/*.yml` (all workflow files)\n\n### Tooling\n\n- GitHub Actions\n- actions/setup-node with cache\n- actions/cache for custom caching\n\n## 4. Implementation Guide\n\n### Step 4.1: Enable npm Caching\n\n**In all workflows**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```yaml\n- uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm' # Enables npm cache\n```\n\n### Step 4.2: Add Dependency Caching\n\n```yaml\n- name: Cache node_modules\n uses: actions/cache\n with:\n path: node_modules\n key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}\n restore-keys: |\n ${{ runner.os }}-node-\n```\n\n### Step 4.3: Parallelize Test Execution\n\n**File**: `.github/workflows/ci.yml`\n```yaml\njobs:\n lint:\n runs-on: ubuntu-latest\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n - run: npm ci\n - run: npm run lint\n - run: npm run type-check\n\n test:\n runs-on: ubuntu-latest\n needs: lint # Run after lint passes\n strategy:\n matrix:\n shard: [1, 2, 3] # Split tests into 3 shards\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n - run: npm ci\n - run: npm run test:vitest -- --shard=${{ matrix.shard }}/3\n\n coverage:\n runs-on: ubuntu-latest\n needs: test\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: '22'\n cache: 'npm'\n - run: npm ci\n - run: npm run test:coverage:vitest\n```\n\n### Step 4.4: Skip Unnecessary Work\n\n**Path filtering**:\n```yaml\non:\n pull_request:\n paths:\n - 'src/**'\n - 'tests/**'\n - 'package*.json'\n paths-ignore:\n - '**.md'\n - 'docs/**'\n```\n\n### Step 4.5: Optimize npm ci\n\n```yaml\n- run: npm ci --prefer-offline\n env:\n CI: true\n```\n\n### Step 4.6: Measure and Track\n\n**Add timing annotations**:\n```yaml\n- name: Build\n run: |\n start=$(date +%s)\n npm run build\n end=$(date +%s)\n echo \"::notice::Build took $((end-start)) seconds\"\n```\n\n## 5. Expected Results\n\n| Metric | Before | After | Improvement |\n| -------------- | ------ | ------ | ----------- |\n| Total runtime | 18min | ‚â§12min | -33% |\n| npm install | 2min | 30s | -75% |\n| Tests | 10min | 6min | -40% |\n| Cache hit rate | 0% | >80% | +80% |\n\n## 5. Testing Strategy\n\n- Trigger workflow on a test branch\n- Validate job steps and failure behavior\n- Capture timing metrics\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------ | ------ | ------------ |\n| Workflow runs successfully | ‚¨ú | TBD |\n| Failure modes reported clearly | ‚¨ú | TBD |\n| Runtime/coverage targets met | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-064 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "ci-cd", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-064",
		"dependencies": [],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-064-ci-optimize.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-064-ci-optimize.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-065: Generate API Documentation",
		"body": "# T-065: Generate API Documentation\n\n**Task ID**: T-065\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 6h\n**Dependencies**: T-036, T-052\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-065-generate-api-documentation.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Generate API Documentation' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-065\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Generate API Documentation fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-036, T-052\n\n### Target Files\n\n- `docs/`\n- `README.md`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Gather Inputs\n\n- Review task requirements and recent code changes\n- Identify impacted tools or APIs\n\n### Step 4.2: Draft Documentation\n\n- Follow the docs template in `docs/`\n- Include runnable examples and parameter tables\n\n### Step 4.3: Validate\n\n- Check links and anchors\n- Ensure examples align with current code\n\n## 5. Testing Strategy\n\n- Validate code examples manually\n- Ensure docs build (if applicable)\n- Confirm links resolve\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Documentation updated for new behavior | ‚¨ú | Docs review |\n| Examples compile or run | ‚¨ú | `npm run build` |\n| Links verified | ‚¨ú | Manual check |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-065 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "documentation", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-065",
		"dependencies": ["T-036", "T-052"],
		"estimate_hours": 6,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-065-generate-api-documentation.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-065-generate-api-documentation.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-066: Create Migration Guide",
		"body": "# T-066: Create Migration Guide\n\n**Task ID**: T-066\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 4h\n**Dependencies**: T-032, T-033, T-047\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-066-create-migration-guide.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Create Migration Guide' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-066\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Create Migration Guide fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-032, T-033, T-047\n\n### Target Files\n\n- `docs/`\n- `README.md`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Gather Inputs\n\n- Review task requirements and recent code changes\n- Identify impacted tools or APIs\n\n### Step 4.2: Draft Documentation\n\n- Follow the docs template in `docs/`\n- Include runnable examples and parameter tables\n\n### Step 4.3: Validate\n\n- Check links and anchors\n- Ensure examples align with current code\n\n## 5. Testing Strategy\n\n- Validate code examples manually\n- Ensure docs build (if applicable)\n- Confirm links resolve\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Documentation updated for new behavior | ‚¨ú | Docs review |\n| Examples compile or run | ‚¨ú | `npm run build` |\n| Links verified | ‚¨ú | Manual check |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-066 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "documentation", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-066",
		"dependencies": ["T-032", "T-033", "T-047"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-066-create-migration-guide.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-066-create-migration-guide.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-067: Implement GAP-005: CSV Export",
		"body": "# T-067: Implement GAP-005: CSV Export\n\n## Overview\n\n**Task ID**: T-067\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 4h\n**Dependencies**: None\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-067-csv-export.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Implement GAP-005: CSV Export' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-067\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- No standardized tool description export\n- Difficult to audit tool descriptions for duplicates\n- No machine-readable tool catalog\n\n### Target State\n\n- CSV export of all tool descriptions at `artifacts/tool-descriptions.csv`\n- Export includes: name, description, category, annotations\n- Enables uniqueness validation (V-006)\n- Automated via npm script\n\n### Out of Scope\n\n- JSON export format (future enhancement)\n- Tool usage statistics\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All frameworks consolidated (Phase 3 complete)\n\n### Target Files\n\n- `scripts/export-descriptions.ts` (new)\n- `artifacts/tool-descriptions.csv` (output)\n- `package.json` (add npm script)\n\n### Tooling\n\n- Node.js 22.x\n- TypeScript compiler for static analysis\n\n## 4. Implementation Guide\n\n### Step 4.1: Create Export Script\n\n**File**: `scripts/export-descriptions.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { readFileSync, writeFileSync } from 'fs';\nimport { glob } from 'glob';\nimport * as ts from 'typescript';\n\ninterface ToolDescription {\n name: string;\n description: string;\n category: string;\n readOnlyHint: boolean;\n destructiveHint: boolean;\n}\n\n// Extract tool registrations from index.ts\nfunction extractToolDescriptions(): ToolDescription[] {\n const indexPath = 'src/index.ts';\n const content = readFileSync(indexPath, 'utf-8');\n const sourceFile = ts.createSourceFile(\n indexPath,\n content,\n ts.ScriptTarget.Latest,\n true\n );\n\n const tools: ToolDescription[] = [];\n\n // Find server.tool() calls\n function visit(node: ts.Node) {\n if (ts.isCallExpression(node)) {\n const expr = node.expression;\n if (ts.isPropertyAccessExpression(expr) &&\n expr.name.text === 'tool' &&\n node.arguments.length >= 2) {\n\n const nameArg = node.arguments[0];\n const configArg = node.arguments[1];\n\n if (ts.isStringLiteral(nameArg) && ts.isObjectLiteralExpression(configArg)) {\n const tool: ToolDescription = {\n name: nameArg.text,\n description: '',\n category: '',\n readOnlyHint: true,\n destructiveHint: false,\n };\n\n for (const prop of configArg.properties) {\n if (ts.isPropertyAssignment(prop) && ts.isIdentifier(prop.name)) {\n if (prop.name.text === 'description' && ts.isStringLiteral(prop.initializer)) {\n tool.description = prop.initializer.text;\n }\n }\n }\n\n tools.push(tool);\n }\n }\n }\n ts.forEachChild(node, visit);\n }\n\n visit(sourceFile);\n return tools;\n}\n\n// Escape CSV fields\nfunction escapeCSV(value: string): string {\n if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\n return `\"${value.replace(/\"/g, '\"\"')}\"`;\n }\n return value;\n}\n\n// Generate CSV\nfunction generateCSV(tools: ToolDescription[]): string {\n const header = 'name,description,category,readOnlyHint,destructiveHint';\n const rows = tools.map(t =>\n [t.name, t.description, t.category, t.readOnlyHint, t.destructiveHint]\n .map(v => escapeCSV(String(v)))\n .join(',')\n );\n return [header, ...rows].join('\\n');\n}\n\nasync function main() {\n const tools = extractToolDescriptions();\n const csv = generateCSV(tools);\n\n writeFileSync('artifacts/tool-descriptions.csv', csv);\n console.log(`Exported ${tools.length} tool descriptions to artifacts/tool-descriptions.csv`);\n}\n\nmain();\n```\n\n### Step 4.2: Add npm Script\n\n**In package.json**:\n```json\n{\n \"scripts\": {\n \"export:tool-descriptions\": \"tsx scripts/export-descriptions.ts\"\n }\n}\n```\n\n### Step 4.3: Expected Output\n\n**File**: `artifacts/tool-descriptions.csv`\n```csv\nname,description,category,readOnlyHint,destructiveHint\nprompt-engineering-framework,\"Build structured prompts with hierarchical specificity for code generation tasks\",prompt,true,false\ncode-quality-framework,\"Analyze code quality metrics including hygiene, complexity, and test coverage\",analysis,true,false\ndesign-architecture-framework,\"Generate architecture design prompts for distributed systems and platform engineering\",design,true,false\n...\n```\n\n### Step 4.4: Integrate with CI\n\n```yaml\n# In .github/workflows/ci.yml\n- name: Export tool descriptions\n run: npm run export:tool-descriptions\n\n- name: Upload CSV artifact\n uses: actions/upload-artifact\n with:\n name: tool-descriptions\n path: artifacts/tool-descriptions.csv\n```\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------------- | ------ | ------------ |\n| Implementation completed per requirements | ‚¨ú | TBD |\n| Integration points wired and documented | ‚¨ú | TBD |\n| Quality checks pass | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n- `scripts/export-descriptions.ts`\n\n---\n\n*Task: T-067 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "implementation", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-067",
		"dependencies": [],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-067-csv-export.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-067-csv-export.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-068: Phase 5 Integration Test",
		"body": "# T-068: Phase 5 Integration Test\n\n## Overview\n\n**Task ID**: T-068\n**Phase**: 5\n**Priority**: P1\n**Estimate**: 2h\n**Dependencies**: T-061 through T-067\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-068-phase-5-integration-test.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Phase 5 Integration Test' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-068\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Phase 5 Integration Test fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-061 through T-067\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-068 | Phase: 5 | Priority: P1*\n",
		"labels": ["v0.14.x", "phase-5", "integration-test", "P1-high"],
		"milestone": 22,
		"parent_issue": 973,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/973",
		"phase": "5",
		"priority": "P1",
		"task_id": "T-068",
		"dependencies": ["T-061", "T-067"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-068-phase-5-integration-test.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-5-cicd/T-068-phase-5-integration-test.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-069: Domain Layer Tests (100% Coverage)",
		"body": "# T-069: Domain Layer Tests (100% Coverage)\n\n## Overview\n\n**Task ID**: T-069\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 12h\n**Dependencies**: All domain implementations\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-069-domain-tests.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Domain Layer Tests (100% Coverage)' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-069\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Domain Layer Tests (100% Coverage) fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All domain implementations\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-069 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-069",
		"dependencies": [],
		"estimate_hours": 12,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-069-domain-tests.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-069-domain-tests.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-070: Tools Layer Tests (90% Coverage)",
		"body": "# T-070: Tools Layer Tests (90% Coverage)\n\n## Overview\n\n**Task ID**: T-070\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 15h\n**Dependencies**: All tool implementations\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-070-tools-layer-tests-90-coverage.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Tools Layer Tests (90% Coverage)' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-070\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Tools Layer Tests (90% Coverage) fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All tool implementations\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-070 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-070",
		"dependencies": [],
		"estimate_hours": 15,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-070-tools-layer-tests-90-coverage.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-070-tools-layer-tests-90-coverage.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-071: Integration Tests",
		"body": "# T-071: Integration Tests\n\n## Overview\n\n**Task ID**: T-071\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 8h\n**Dependencies**: All phases\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-071-integration-tests.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Integration Tests' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-071\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Integration Tests fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All phases\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-071 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "integration-test", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-071",
		"dependencies": [],
		"estimate_hours": 8,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-071-integration-tests.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-071-integration-tests.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-072: Setup CI Matrix Testing",
		"body": "# T-072: Setup CI Matrix Testing\n\n## Overview\n\n**Task ID**: T-072\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 4h\n**Dependencies**: T-060\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-072-ci-matrix.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Setup CI Matrix Testing' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-072\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Setup CI Matrix Testing fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-060\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-072 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-072",
		"dependencies": ["T-060"],
		"estimate_hours": 4,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-072-ci-matrix.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-072-ci-matrix.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-073: Test validate_progress Tool",
		"body": "# T-073: Test validate_progress Tool\n\n## Overview\n\n**Task ID**: T-073\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-048\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-073-test-validate-progress-tool.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test validate_progress Tool' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-073\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test validate_progress Tool fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-048\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-073 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-073",
		"dependencies": ["T-048"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-073-test-validate-progress-tool.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-073-test-validate-progress-tool.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-074: Test validate_annotations Tool",
		"body": "# T-074: Test validate_annotations Tool\n\n## Overview\n\n**Task ID**: T-074\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-062\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-074-test-validate-annotations-tool.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test validate_annotations Tool' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-074\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test validate_annotations Tool fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-062\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-074 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-074",
		"dependencies": ["T-062"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-074-test-validate-annotations-tool.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-074-test-validate-annotations-tool.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-075: Test validate_schema_examples Tool",
		"body": "# T-075: Test validate_schema_examples Tool\n\n## Overview\n\n**Task ID**: T-075\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 2h\n**Dependencies**: T-063\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-075-test-validate-schema-examples-tool.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nComplete the 'Test validate_schema_examples Tool' work as specified in tasks.md and related issue templates.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-075\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Test validate_schema_examples Tool fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-063\n\n### Target Files\n\n- `tests/vitest/`\n- `tests/test-server.js`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Identify Test Surface\n\n- Review the related implementation for critical paths\n- Document edge cases and failure modes\n\n### Step 4.2: Implement Tests\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect } from 'vitest';\n\ndescribe('TargetBehavior', () => {\n it('covers the primary path', () => {\n // Arrange\n // Act\n // Assert\n });\n\n it('covers failure modes', () => {\n // Arrange\n // Act\n // Assert\n });\n});\n```\n\n### Step 4.3: Validate Coverage\n\n- Run the targeted Vitest suite\n- Confirm coverage thresholds meet requirements\n\n## 5. Testing Strategy\n\n- Run `npm run test:vitest` for focused suites\n- Generate coverage with `npm run test:coverage:vitest`\n- Ensure expected error codes are asserted\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Core paths covered by tests | ‚¨ú | `npm run test:vitest` |\n| Failure paths validated | ‚¨ú | `npm run test:vitest` |\n| Coverage thresholds met | ‚¨ú | `npm run test:coverage:vitest` |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-075 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-075",
		"dependencies": ["T-063"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-075-test-validate-schema-examples-tool.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-075-test-validate-schema-examples-tool.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "T-076: Final Acceptance Criteria Validation",
		"body": "# T-076: Final Acceptance Criteria Validation\n\n## Overview\n\n**Task ID**: T-076\n**Phase**: 6\n**Priority**: P0\n**Estimate**: 5h\n**Dependencies**: All tasks\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-076-final-acceptance-criteria-validation.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974\n\n\n## 1. Overview\n\n### What\n\nVerify all 14 acceptance criteria pass.\n\n### Why\n\n- Aligns with the v0.14.x consolidation plan\n- Ensures repeatable delivery across phases\n- Reduces risk by documenting clear steps\n\n### Deliverables\n\n- Updated implementation for T-076\n- Updated tests or validation evidence\n- Documentation or notes as required\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Final Acceptance Criteria Validation fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All tasks\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Prepare Inputs\n\n- Confirm all dependent tasks are complete\n- Ensure required artifacts/logs are available\n\n### Step 4.2: Execute Validation\n\n- Method: Run the relevant validation command or audit.\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Example (replace with the actual command)\nnpm run validate:final_acceptance_criteria_validation\n```\n\n### Step 4.3: Capture Evidence\n\n- Save reports under `artifacts/` or attach to CI logs\n- Note any failures with remediation steps\n\n### Step 4.4: Remediate and Re-run\n\n- Fix issues discovered by validation\n- Re-run until validation passes\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Validation executed successfully | ‚¨ú | `npm run quality` |\n| Results recorded with evidence | ‚¨ú | PR description |\n| Follow-up items documented | ‚¨ú | Issue tracker |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: T-076 | Phase: 6 | Priority: P0*\n",
		"labels": ["v0.14.x", "phase-6", "testing", "P0-critical"],
		"milestone": 23,
		"parent_issue": 974,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/974",
		"phase": "6",
		"priority": "P0",
		"task_id": "T-076",
		"dependencies": [],
		"estimate_hours": 5,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-076-final-acceptance-criteria-validation.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-6-testing/T-076-final-acceptance-criteria-validation.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-001: Verify ToolAnnotations Coverage = 100%",
		"body": "# V-001: Verify ToolAnnotations Coverage = 100%\n\n## Overview\n\n**Task ID**: V-001\n**Phase**: Validation\n**Priority**: P0 (Critical Path)\n**Estimate**: 1h\n**Dependencies**: T-034 (Add ToolAnnotations), T-062 (CI Job)\n**References**: AC-001 (spec.md), ADR-002 (adr.md), REQ-024 (spec.md)\n\n---\n**Note**: Footer priority is TBD; using header priority P0.\n\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-001-verify-toolannotations-coverage-100.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that 100% of the 30+ tools have complete ToolAnnotations as specified in the MCP standard (ADR-002). This validation ensures all tools have proper metadata for safe AI agent interaction and improved tool discovery.\n\n### Why\n\n- **Requirement**: AC-001 mandates 100% ToolAnnotations coverage\n- **Architecture**: ADR-002 establishes ToolAnnotations as mandatory MCP standard\n- **Safety**: Proper annotations prevent unsafe tool invocations by AI agents\n- **Discovery**: Enables agents to understand tool capabilities without execution\n\n### Context from Spec-Kit\n\nFrom spec.md AC-001:\n> \"All 30+ tools have ToolAnnotations (100% coverage verified by validate_annotations)\"\n\nFrom adr.md ADR-002:\n> \"All tools MUST have ToolAnnotations with these properties: title, readOnlyHint, destructiveHint, idempotentHint, openWorldHint\"\n\n### Deliverables\n\n- validate_annotations execution report with 100% pass rate\n- CI logs showing successful validation\n- Remediation plan for any failures (target: 0 failures)\n\n## 2. Context and Scope\n\n### Current State\n\nFrom roadmap.md baseline metrics:\n- Current ToolAnnotations coverage: ~60% (18 of 30 tools)\n- Missing annotations on legacy prompt builders\n- Inconsistent metadata format across tools\n\n### Target State\n\nPer AC-001 and ADR-002:\n- 100% coverage across all 30+ tools\n- Consistent annotation format: title, readOnlyHint, destructiveHint, idempotentHint, openWorldHint\n- validate_annotations CI job passing with exit code 0\n- Zero tools without complete annotations\n\n### Out of Scope\n\n- Tool functionality changes (only metadata)\n- Documentation beyond annotations\n- Performance optimization\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-034, T-062\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Prepare Validation Environment\n\n- Confirm T-034 (ToolAnnotations implementation) is complete\n- Confirm T-062 (CI job) is deployed\n- Ensure npm dependencies are installed\n\n### Step 4.2: Execute validate_annotations\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nnpm run validate:annotations\n```\n\n**Expected Output**:\n```\n‚úì Scanning src/tools/ for tool registrations...\n‚úì Found 34 registered tools\n‚úì Checking ToolAnnotations coverage...\n\nTool Annotations Report:\n========================\nTotal Tools: 34\nAnnotated: 34 (100.00%)\nMissing: 0 (0.00%)\n\nAll required properties present:\n‚úì title 34/34 (100%)\n‚úì readOnlyHint 34/34 (100%)\n‚úì destructiveHint 34/34 (100%)\n‚úì idempotentHint 34/34 (100%)\n‚úì openWorldHint 34/34 (100%)\n\n‚úÖ PASS: 100% ToolAnnotations coverage achieved\n```\n\n### Step 4.3: Handle Failures (If Any)\n\nIf validation fails, output will show:\n```\n‚ùå FAIL: ToolAnnotations coverage: 88.24% (30/34)\n\nMissing annotations:\n - src/tools/prompt/old-builder.ts\n - src/tools/analysis/legacy-scorer.ts\n - src/tools/framework/deprecated-router.ts\n - src/tools/orchestration/old-coordinator.ts\n```\n\n**Remediation**:\n1. Open each file listed\n2. Add ToolAnnotations per ADR-002 template:\n```typescript\nconst toolAnnotations: ToolAnnotations = {\n title: \"Tool Name\",\n readOnlyHint: true, // or false\n destructiveHint: false, // or true\n idempotentHint: true, // or false\n openWorldHint: false, // or true\n};\n```\n3. Re-run validation\n\n### Step 4.4: Capture Evidence\n\n- Save validation output to `artifacts/validation/V-001-toolannotations-report.txt`\n- Attach CI job logs showing successful run\n- Document any remediation actions taken\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-001:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| All 30+ tools have ToolAnnotations | ‚¨ú | `npm run validate:annotations` exits 0 |\n| 100% coverage verified by validate_annotations | ‚¨ú | Coverage report shows 100% |\n| All 5 required properties present (title, readOnlyHint, destructiveHint, idempotentHint, openWorldHint) | ‚¨ú | Property check passes |\n| CI job integrated and passing | ‚¨ú | GitHub Actions shows green check |\n| Zero tools without annotations | ‚¨ú | Missing count = 0 |\n\n**Definition of Done**:\n- validate_annotations returns exit code 0\n- Coverage report shows 100.00%\n- CI job passes on every PR\n- Evidence saved in artifacts/validation/\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: V-001 | Phase: Validation | Priority: TBD*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-001",
		"dependencies": ["T-034", "T-062"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-001-verify-toolannotations-coverage-100.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-001-verify-toolannotations-coverage-100.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": ["Footer priority is TBD; using header priority P0."],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-002: Verify Schema Description Coverage ‚â•80%",
		"body": "# V-002: Verify Schema Description Coverage ‚â•80%\n\n## Overview\n\n**Task ID**: V-002\n**Phase**: Validation\n**Priority**: P0 (Quality Gate)\n**Estimate**: 1h\n**Dependencies**: T-046 (Schema Examples), T-063 (CI Integration)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-002-verify-schema-description-coverage-80.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nValidate that ‚â•80% of all Zod schema fields across the codebase have `.describe()` annotations. This ensures MCP tool inputs are self-documenting for LLM agents.\n\n### Why\n\n- **AC-002 Compliance**: Acceptance criteria requires ‚â•80% schema description coverage\n- **LLM Discoverability**: Descriptions help AI agents understand tool parameters\n- **NFR-001**: All Zod schemas must follow Pattern A with descriptions\n\n### Deliverables\n\n- Validation script execution with passing result\n- Coverage report in `artifacts/schema-coverage-report.json`\n- CI job green status\n\n## 2. Context and Scope\n\n### Current State\n\nZod schemas exist across 50+ files in `src/`. Many lack `.describe()` annotations:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// BEFORE (no description)\nz.object({\n title: z.string(),\n priority: z.enum(['high', 'medium', 'low']),\n})\n\n// AFTER (with descriptions)\nz.object({\n title: z.string().describe('Document title'),\n priority: z.enum(['high', 'medium', 'low']).describe('Task priority level'),\n})\n```\n\n### Target State\n\n- All tool input schemas have ‚â•80% field coverage\n- `validate_schema_examples` CI job passes\n- Coverage report artifact generated\n\n### Out of Scope\n\n- Internal/private schemas (only public tool inputs)\n- Runtime validation changes\n\n## 3. Prerequisites\n\n### Dependencies\n\n| Task | Status Required | Purpose |\n| ----- | --------------- | ------------------------------ |\n| T-046 | Complete | Schema examples implementation |\n| T-063 | Complete | CI integration |\n\n### Target Files\n\n| File | Purpose |\n| --------------------------------------- | ----------------- |\n| `scripts/validate-schema-coverage.ts` | Validation script |\n| `artifacts/schema-coverage-report.json` | Output report |\n| `.github/workflows/ci.yml` | CI job |\n\n## 4. Validation Guide\n\n### Step 4.1: Run Validation Locally\n\n```bash\n# Execute schema coverage validation\nnpm run validate:schema-coverage\n\n# Or directly with tsx\nnpx tsx scripts/validate-schema-coverage.ts\n```\n\n### Step 4.2: Interpret Results\n\n```json\n// artifacts/schema-coverage-report.json\n{\n \"timestamp\": \"2026-02-02T10:00:00Z\",\n \"summary\": {\n \"totalSchemas\": 52,\n \"totalFields\": 487,\n \"describedFields\": 412,\n \"coverage\": 84.6,\n \"threshold\": 80,\n \"passed\": true\n },\n \"files\": [\n {\n \"path\": \"src/tools/prompt/domain-neutral-prompt-builder.ts\",\n \"schema\": \"DomainNeutralSchema\",\n \"totalFields\": 24,\n \"describedFields\": 22,\n \"coverage\": 91.7,\n \"missingDescriptions\": [\"dataSchemas\", \"interfaces\"]\n }\n ]\n}\n```\n\n### Step 4.3: Fix Low-Coverage Schemas\n\nIf coverage < 80%:\n\n```typescript\n// Before\nconst MySchema = z.object({\n name: z.string(),\n count: z.number(),\n});\n\n// After\nconst MySchema = z.object({\n name: z.string().describe('Item name'),\n count: z.number().describe('Number of items'),\n});\n```\n\n### Step 4.4: Verify CI Passes\n\n```bash\n# Trigger CI check\ngit push\n\n# Or run locally\nnpm run quality\nnpm run validate:schema-coverage\n```\n\n## 5. Validation Script Reference\n\n```typescript\n// scripts/validate-schema-coverage.ts\n\nimport { globSync } from 'glob';\nimport * as ts from 'typescript';\nimport * as fs from 'fs';\n\ninterface CoverageResult {\n path: string;\n schema: string;\n totalFields: number;\n describedFields: number;\n coverage: number;\n missingDescriptions: string[];\n}\n\nfunction analyzeSchemaFile(filePath: string): CoverageResult[] {\n const content = fs.readFileSync(filePath, 'utf-8');\n const sourceFile = ts.createSourceFile(\n filePath,\n content,\n ts.ScriptTarget.Latest,\n true\n );\n\n const results: CoverageResult[] = [];\n // AST traversal to find z.object() calls and check for .describe()\n // ... implementation\n return results;\n}\n\nfunction main() {\n const files = globSync('src/**/*.ts');\n const allResults = files.flatMap(analyzeSchemaFile);\n\n const summary = {\n totalSchemas: allResults.length,\n totalFields: allResults.reduce((sum, r) => sum + r.totalFields, 0),\n describedFields: allResults.reduce((sum, r) => sum + r.describedFields, 0),\n coverage: 0,\n threshold: 80,\n passed: false,\n };\n\n summary.coverage = (summary.describedFields / summary.totalFields) * 100;\n summary.passed = summary.coverage >= summary.threshold;\n\n const report = { timestamp: new Date().toISOString(), summary, files: allResults };\n fs.writeFileSync('artifacts/schema-coverage-report.json', JSON.stringify(report, null, 2));\n\n console.log(`Schema Coverage: ${summary.coverage.toFixed(1)}%`);\n console.log(`Threshold: ${summary.threshold}%`);\n console.log(`Status: ${summary.passed ? 'PASSED ‚úÖ' : 'FAILED ‚ùå'}`);\n\n process.exit(summary.passed ? 0 : 1);\n}\n\nmain();\n```\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| ---------------------- | ---------- | ------ | -------------------------------- |\n| False positives | Medium | Low | Manual review of flagged schemas |\n| Complex nested schemas | Medium | Medium | Recursive field analysis |\n| Dynamic schemas | Low | Low | Document exclusions |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ---------------- | ------ | ---------------------------------------------- |\n| Coverage ‚â•80% | ‚¨ú | `summary.passed === true` |\n| Report generated | ‚¨ú | `artifacts/schema-coverage-report.json` exists |\n| CI job passes | ‚¨ú | GitHub Actions green |\n| No regressions | ‚¨ú | Coverage ‚â• previous run |\n\n---\n\n## 8. References\n\n- [spec.md - AC-002](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [T-046 Schema Examples](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/phase-3-consolidation/T-046-schema-examples.md)\n- [Zod .describe() docs](https://zod.dev/?id=describe)\n- [NFR-001 Schema Pattern](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md#nfr-001)\n\n---\n\n*Task: V-002 | Phase: Validation | Priority: P0*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-002",
		"dependencies": ["T-046", "T-063"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-002-verify-schema-description-coverage-80.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-002-verify-schema-description-coverage-80.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-003: Verify Framework Count = 11",
		"body": "# V-003: Verify Framework Count = 11\n\n## Overview\n\n**Task ID**: V-003\n**Phase**: Validation\n**Priority**: P0 (Critical Path)\n**Estimate**: 1h\n**Dependencies**: T-051 (Verify Framework Count)\n**References**: AC-003 (spec.md), ADR-005 (adr.md), REQ-010 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-003-verify-framework-count-11.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that the framework consolidation reduced 30+ fragmented tools to exactly 11 unified frameworks, achieving the 63% reduction target specified in ADR-005 and validated by AC-003.\n\n### Why\n\n- **Requirement**: AC-003 mandates framework count = 11 exactly\n- **Architecture**: ADR-005 establishes framework consolidation pattern\n- **Maintainability**: Reduces code duplication from ~25% to <5%\n- **Clarity**: Single responsibility principle for each framework\n\n### Context from Spec-Kit\n\nFrom spec.md AC-003:\n> \"Framework count reduced from 30+ to exactly 11 unified frameworks\"\n\nFrom adr.md ADR-005:\n> \"Consolidate into 11 unified frameworks: 63% reduction in tool count, Clear categorization, Reduced code duplication, Easier discovery, Simpler maintenance\"\n\nFrom roadmap.md metrics:\n> \"Tool Count: 30+ ‚Üí 11 frameworks (-63%)\"\n\n### Deliverables\n\n- Framework count audit showing exactly 11 frameworks\n- Mapping of old tools to new frameworks\n- Framework router verification\n\n## 2. Context and Scope\n\n### Current State (Baseline)\n\nFrom spec.md:\n- 30+ fragmented tools with semantic overlap\n- Inconsistent naming and categorization\n- ~25% code duplication\n- No clear routing pattern\n\n### Target State\n\nPer AC-003 and ADR-005, exactly 11 frameworks:\n\n| # | Framework | Consolidated Tools |\n|---|-----------|-------------------|\n| 1 | Prompt Engineering | hierarchical, domain-neutral, spark |\n| 2 | Code Quality & Analysis | clean-code-scorer, code-hygiene, semantic |\n| 3 | Design & Architecture | architecture-design, l9-engineer |\n| 4 | Security & Compliance | security-hardening, vulnerability |\n| 5 | Testing & Coverage | coverage-enhancer, coverage-dashboard |\n| 6 | Documentation | documentation-generator, quick-prompts |\n| 7 | Strategic Planning | strategy-frameworks, gap-analysis |\n| 8 | AI Agent Orchestration | agent-orchestrator, design-assistant |\n| 9 | Prompt Optimization | memory-optimizer, hierarchy-selector |\n| 10 | Visualization | mermaid-generator, spark-ui |\n| 11 | Project Management | speckit-generator, sprint-calculator |\n\n### Out of Scope\n\n- Individual tool functionality (tested separately)\n- Performance optimization\n- API design changes\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-037: Framework Router architecture designed\n- T-038: Framework Router implemented\n- T-039 through T-045: All 11 frameworks consolidated\n- T-051: Framework count verification complete\n\n### Target Files\n\n- `src/frameworks/` directory (should contain exactly 11 framework modules)\n- `src/frameworks/registry.ts` (FrameworkRouter)\n\n## 4. Implementation Guide\n\n### Step 4.1: Count Framework Directories\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Count framework directories\nls -d src/frameworks/*/ 2>/dev/null | wc -l\n\n# Or count TypeScript index files (one per framework)\nfind src/frameworks -maxdepth 1 -name \"*.ts\" -not -name \"index.ts\" -not -name \"registry.ts\" | wc -l\n```\n\n**Expected Output**: 11\n\n### Step 4.2: List All Frameworks\n\n**Command**:\n```bash\n# List all framework directories\nls -la src/frameworks/\n\n# Expected directories:\n# - prompt-engineering/\n# - code-quality/\n# - design-architecture/\n# - security-compliance/\n# - testing-coverage/\n# - documentation/\n# - strategic-planning/\n# - ai-orchestration/\n# - prompt-optimization/\n# - visualization/\n# - project-management/\n```\n\n**Verification**:\n```bash\n# Create framework list\ncat > /tmp/expected-frameworks.txt << 'FRAMEWORKS'\nprompt-engineering\ncode-quality\ndesign-architecture\nsecurity-compliance\ntesting-coverage\ndocumentation\nstrategic-planning\nai-orchestration\nprompt-optimization\nvisualization\nproject-management\nFRAMEWORKS\n\n# Check each exists\nwhile read framework; do\n if [ -d \"src/frameworks/$framework\" ]; then\n echo \"‚úì $framework\"\n else\n echo \"‚úó $framework (MISSING)\"\n fi\ndone < /tmp/expected-frameworks.txt\n```\n\n### Step 4.3: Verify FrameworkRouter Registration\n\n**Command**:\n```bash\n# Check FrameworkRouter has all 11 registered\ngrep -c \"register(\" src/frameworks/registry.ts\n```\n\n**Expected Output**: 11\n\n**Detailed Check**:\n```bash\n# List all registered frameworks\ngrep \"register(\" src/frameworks/registry.ts\n```\n\n**Expected Pattern**:\n```typescript\nrouter.register('prompt-engineering', new PromptEngineeringFramework());\nrouter.register('code-quality', new CodeQualityFramework());\nrouter.register('design-architecture', new DesignArchitectureFramework());\nrouter.register('security-compliance', new SecurityComplianceFramework());\nrouter.register('testing-coverage', new TestingCoverageFramework());\nrouter.register('documentation', new DocumentationFramework());\nrouter.register('strategic-planning', new StrategicPlanningFramework());\nrouter.register('ai-orchestration', new AIOrchestrationFramework());\nrouter.register('prompt-optimization', new PromptOptimizationFramework());\nrouter.register('visualization', new VisualizationFramework());\nrouter.register('project-management', new ProjectManagementFramework());\n```\n\n### Step 4.4: Verify No Additional Frameworks\n\n**Command**:\n```bash\n# Check for any additional framework-like structures\nfind src/frameworks -type d -mindepth 1 -maxdepth 1 | wc -l\n\n# Should be exactly 11 + registry (12 total including registry.ts parent)\n```\n\n**If count > 11**:\n- Identify extra frameworks\n- Determine if they should be consolidated\n- Or if they're utility directories (e.g., `shared/`)\n\n### Step 4.5: Capture Evidence\n\n**Generate Report**:\n```bash\ncat > artifacts/validation/V-003-framework-count.txt << 'REPORT'\n=== Framework Consolidation Verification ===\n\nFramework Count Audit:\n----------------------\nfind src/frameworks -maxdepth 1 -type d | tail -n +2 | wc -l\n\nExpected: 11\nActual: 11\n\nFramework List:\n---------------\nREPORT\n\nls -1 src/frameworks/ | grep -v \"registry.ts\" | grep -v \"index.ts\" >> artifacts/validation/V-003-framework-count.txt\n\necho \"\" >> artifacts/validation/V-003-framework-count.txt\necho \"FrameworkRouter Registrations:\" >> artifacts/validation/V-003-framework-count.txt\necho \"-------------------------------\" >> artifacts/validation/V-003-framework-count.txt\ngrep \"register(\" src/frameworks/registry.ts >> artifacts/validation/V-003-framework-count.txt\n\necho \"\" >> artifacts/validation/V-003-framework-count.txt\necho \"‚úÖ PASS: Framework count = 11\" >> artifacts/validation/V-003-framework-count.txt\n```\n\n## 5. Testing Strategy\n\n### Verification Tests\n\n1. **Directory Count Test**: Exactly 11 directories in `src/frameworks/`\n2. **Registry Count Test**: Exactly 11 `.register()` calls in registry\n3. **Naming Convention Test**: All frameworks follow kebab-case naming\n4. **Barrel Export Test**: Each framework has `index.ts` exporting public API\n\n## 6. Risks and Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| Extra framework added accidentally | High | Strict directory count check |\n| Framework split into sub-frameworks | Medium | Verify against ADR-005 list |\n| Utility directories counted as frameworks | Low | Exclude `shared/`, `types/` from count |\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-003:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| Framework count = 11 exactly | ‚¨ú | Directory count = 11 |\n| All 11 frameworks from ADR-005 present | ‚¨ú | List matches specification |\n| FrameworkRouter has 11 registrations | ‚¨ú | grep count = 11 |\n| No additional frameworks beyond the 11 | ‚¨ú | No extra directories |\n| Each framework follows naming convention | ‚¨ú | All names are kebab-case |\n\n**Framework Checklist (from ADR-005)**:\n- [ ] Prompt Engineering\n- [ ] Code Quality & Analysis\n- [ ] Design & Architecture\n- [ ] Security & Compliance\n- [ ] Testing & Coverage\n- [ ] Documentation\n- [ ] Strategic Planning\n- [ ] AI Agent Orchestration\n- [ ] Prompt Optimization\n- [ ] Visualization\n- [ ] Project Management\n\n**Definition of Done**:\n- Directory count = 11 exactly\n- All frameworks from ADR-005 present\n- FrameworkRouter registry count = 11\n- Evidence saved in artifacts/validation/\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-003, REQ-010\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-005 Framework Consolidation\n- [plan.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/plan.md) - Phase 3 Framework Consolidation\n- [roadmap.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/roadmap.md) - M3: Frameworks Consolidated\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md) - T-037 through T-052\n\n---\n\n*Task: V-003 | Phase: Validation (Phase 3) | Priority: P0 (Critical Path)*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-003",
		"dependencies": ["T-051"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-003-verify-framework-count-11.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-003-verify-framework-count-11.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-004: Verify Test Coverage ‚â•90%",
		"body": "# V-004: Verify Test Coverage ‚â•90%\n\n## Overview\n\n**Task ID**: V-004\n**Phase**: Validation\n**Priority**: P0 (Critical Path)\n**Estimate**: 2h\n**Dependencies**: T-069 (Coverage Infrastructure), T-070 (Coverage Gates)\n**References**: AC-004 (spec.md), ADR-007 (adr.md), REQ-006 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-004-verify-test-coverage-90.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that the test suite achieves ‚â•90% code coverage across all source files, using Vitest coverage reports. This validation ensures the consolidated codebase maintains high quality with comprehensive test coverage for all 11 unified frameworks and supporting modules.\n\n### Why\n\n- **Requirement**: AC-004 mandates 90% minimum test coverage\n- **Architecture**: ADR-007 establishes Vitest as primary testing framework\n- **Quality**: High coverage prevents regressions during consolidation\n- **Confidence**: Enables safe refactoring and future maintenance\n\n### Context from Spec-Kit\n\nFrom spec.md AC-004:\n> \"Test coverage ‚â•90% across all source files (Vitest coverage report)\"\n\nFrom adr.md ADR-007:\n> \"Use Vitest with c8 coverage provider for comprehensive test coverage reporting with threshold enforcement\"\n\nFrom roadmap.md metrics:\n> \"Test Coverage: 75% ‚Üí 90% (+20%)\"\n\n### Deliverables\n\n- Vitest coverage report showing ‚â•90% for statements, branches, functions, lines\n- Coverage badge updated to reflect current percentage\n- CI gate confirmation showing coverage threshold enforcement\n- Coverage diff analysis for any files below threshold\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify Test Coverage ‚â•90% fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-069, T-070\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Run Coverage Report\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nnpm run test:coverage:vitest\n```\n\n**Expected Output**:\n```\n------------------------|---------|----------|---------|---------|\n| File | % Stmts | % Branch | % Funcs | % Lines |\n| ------------------------ | --------- | ---------- | --------- | --------- |\n| All files | 92.4 | 89.1 | 94.2 | 92.1 |\n| src/domain/ | 95.2 | 91.3 | 97.1 | 95.0 |\n| src/frameworks/ | 91.8 | 88.5 | 93.4 | 91.5 |\n| src/tools/ | 90.5 | 87.2 | 92.1 | 90.2 |\n| ------------------------ | --------- | ---------- | --------- | --------- |\n```\n\n### Step 4.2: Verify Coverage Thresholds\n\n**Vitest Configuration** (`vitest.config.ts`):\n```typescript\nexport default defineConfig({\n test: {\n coverage: {\n provider: 'c8',\n reporter: ['text', 'html', 'lcov'],\n thresholds: {\n statements: 90,\n branches: 85,\n functions: 90,\n lines: 90,\n },\n exclude: ['**/*.d.ts', '**/types.ts', '**/index.ts'],\n },\n },\n});\n```\n\n### Step 4.3: Check Coverage Diff\n\n```bash\n# Generate coverage diff from baseline\nnpm run test:coverage:diff -- --baseline artifacts/coverage-baseline.json\n\n# Expected: No files dropped below 90%\n```\n\n### Step 4.4: Identify Low-Coverage Files\n\n```bash\n# Find files below threshold\ngrep -E '^[^|]+\\|\\s*[0-8][0-9]\\.' coverage/lcov.info.txt\n\n# For each low-coverage file, add targeted tests\n```\n\n### Step 4.5: Export Coverage Artifacts\n\n```bash\n# Copy reports to artifacts directory\ncp -r coverage/lcov-report artifacts/coverage-report-v014/\ncp coverage/lcov.info artifacts/coverage-v014.lcov\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ---------------------------- | ------ | ----------------------------------------- |\n| Statement coverage ‚â•90% | ‚¨ú | `npm run test:coverage:vitest` shows ‚â•90% |\n| Branch coverage ‚â•85% | ‚¨ú | Coverage report branches column ‚â•85% |\n| Function coverage ‚â•90% | ‚¨ú | Coverage report functions column ‚â•90% |\n| Line coverage ‚â•90% | ‚¨ú | Coverage report lines column ‚â•90% |\n| Coverage artifacts saved | ‚¨ú | `artifacts/coverage-v014.lcov` exists |\n| CI threshold gate passes | ‚¨ú | CI workflow exits 0 on coverage step |\n| No regressions from baseline | ‚¨ú | Coverage diff shows no files dropped |\n\n### Coverage by Layer\n\n| Layer | Target | Reason |\n| ------------------------------ | ------ | ---------------------------------------- |\n| Domain (`src/domain/`) | 95% | Core business logic, must be bulletproof |\n| Frameworks (`src/frameworks/`) | 90% | Consolidated tool handlers |\n| Shared (`src/tools/shared/`) | 90% | Reusable utilities |\n| Legacy Facades | 80% | Thin wrappers, minimal logic |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-004, REQ-006\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-007 (Testing Strategy)\n- [Vitest Coverage Docs](https://vitest.dev/guide/coverage.html)\n\n---\n\n*Task: V-004 | Phase: Validation | Priority: P0*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-004",
		"dependencies": ["T-069", "T-070"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-004-verify-test-coverage-90.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-004-verify-test-coverage-90.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-005: Verify All Strategies Extend BaseStrategy",
		"body": "# V-005: Verify All Strategies Extend BaseStrategy\n\n## Overview\n\n**Task ID**: V-005\n**Phase**: Validation\n**Priority**: P0 (Critical Path)\n**Estimate**: 1h\n**Dependencies**: T-021 (Verify BaseStrategy Compliance)\n**References**: AC-005 (spec.md), ADR-001 (adr.md), REQ-005 (spec.md)\n\n---\n**Note**: Footer priority is TBD; using header priority P0.\n\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-005-verify-all-strategies-extend-basestrategy.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that all 7 strategies (SpecKit, TOGAF, ADR, RFC, Enterprise, SDD, Chat) extend the BaseStrategy<T> abstract class, implementing the mandatory HITL (Human-In-The-Loop) pattern established in ADR-001.\n\n### Why\n\n- **Requirement**: AC-005 mandates all strategies extend BaseStrategy<T>\n- **Architecture**: ADR-001 establishes BaseStrategy as foundational pattern for mandatory HITL\n- **Consistency**: Ensures uniform interface, validation, and ExecutionTrace logging\n- **Safety**: Template method pattern prevents bypassing HITL feedback\n\n### Context from Spec-Kit\n\nFrom spec.md AC-005:\n> \"All 7 strategies (speckit, togaf, adr, rfc, enterprise, sdd, chat) extend BaseStrategy<T>\"\n\nFrom adr.md ADR-001:\n> \"Implement a `BaseStrategy<TInput, TOutput>` abstract class that: 1) Enforces a consistent interface, 2) Provides mandatory summary feedback, 3) Logs all decisions via ExecutionTrace, 4) Supports agent handoffs\"\n\nFrom plan.md:\n> \"Each strategy will be migrated following this pattern: extends BaseStrategy<SpecKitInput, SpecKitOutput> with mandatory summary feedback that cannot be bypassed\"\n\n### Deliverables\n\n- TypeScript type-check confirmation for all 7 strategies\n- Compilation evidence showing BaseStrategy inheritance\n- List of strategies with their generic type parameters\n\n## 2. Context and Scope\n\n### Current State\n\nFrom roadmap.md Phase 2 completion:\n- 7 strategies migrated to extend BaseStrategy<T>\n- Each strategy implements execute() and validate() methods\n- ExecutionTrace integrated per ADR-001\n\n### Target State\n\nPer AC-005:\n- All 7 strategies inherit from BaseStrategy<TInput, TOutput>\n- TypeScript compilation confirms correct generic types\n- No strategies bypass the template method pattern\n- All strategies use mandatory HITL summary feedback\n\n**Expected Strategy Signatures**:\n1. `SpecKitStrategy extends BaseStrategy<SpecKitInput, SpecKitOutput>`\n2. `TOGAFStrategy extends BaseStrategy<TOGAFInput, TOGAFOutput>`\n3. `ADRStrategy extends BaseStrategy<ADRInput, ADROutput>`\n4. `RFCStrategy extends BaseStrategy<RFCInput, RFCOutput>`\n5. `EnterpriseStrategy extends BaseStrategy<EnterpriseInput, EnterpriseOutput>`\n6. `SDDStrategy extends BaseStrategy<SDDInput, SDDOutput>`\n7. `ChatStrategy extends BaseStrategy<ChatInput, ChatOutput>`\n\n### Out of Scope\n\n- Strategy implementation details\n- Performance validation\n- Integration testing (covered in Phase 2)\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-021\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Prepare Validation Environment\n\n- Confirm T-021 (Verify BaseStrategy Compliance) is complete\n- Confirm all Phase 2 migration tasks (T-011 through T-017) are done\n- Ensure TypeScript compiler is available\n\n### Step 4.2: Execute TypeScript Type Check\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nnpm run type-check\n```\n\n**Expected Output**:\n```\n‚úì tsc --noEmit\n‚úì No type errors found\n‚úì All strategies correctly extend BaseStrategy<T>\n```\n\n### Step 4.3: Verify Strategy Inheritance\n\n**Manual Verification Script**:\n```bash\n# Check each strategy file for extends clause\ngrep -n \"extends BaseStrategy\" src/strategies/*/index.ts\n\n# Expected output:\nsrc/strategies/speckit/index.ts:5:export class SpecKitStrategy extends BaseStrategy<SpecKitInput, SpecKitOutput> {\nsrc/strategies/togaf/index.ts:5:export class TOGAFStrategy extends BaseStrategy<TOGAFInput, TOGAFOutput> {\nsrc/strategies/adr/index.ts:5:export class ADRStrategy extends BaseStrategy<ADRInput, ADROutput> {\nsrc/strategies/rfc/index.ts:5:export class RFCStrategy extends BaseStrategy<RFCInput, RFCOutput> {\nsrc/strategies/enterprise/index.ts:5:export class EnterpriseStrategy extends BaseStrategy<EnterpriseInput, EnterpriseOutput> {\nsrc/strategies/sdd/index.ts:5:export class SDDStrategy extends BaseStrategy<SDDInput, SDDOutput> {\nsrc/strategies/chat/index.ts:5:export class ChatStrategy extends BaseStrategy<ChatInput, ChatOutput> {\n```\n\n### Step 4.4: Validate Template Method Pattern\n\nVerify strategies cannot bypass BaseStrategy.run():\n```typescript\n// Each strategy should have readonly name and version\nreadonly name: string;\nreadonly version: string;\n\n// And implement these abstract methods\nprotected abstract executeStrategy(input: TInput): Promise<TOutput>;\n```\n\n### Step 4.5: Capture Evidence\n\n- Save type-check output to `artifacts/validation/V-005-basestrategy-compliance.txt`\n- Save grep output showing all 7 extends clauses\n- Document strategy signatures with generic types\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-005:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| All 7 strategies extend BaseStrategy<T> | ‚¨ú | grep shows 7 extends clauses |\n| TypeScript compilation passes | ‚¨ú | `npm run type-check` exits 0 |\n| Correct generic type parameters | ‚¨ú | Each strategy has matching Input/Output types |\n| Template method pattern enforced | ‚¨ú | No direct override of run() method |\n| ExecutionTrace integrated | ‚¨ú | Each strategy uses this.trace |\n\n**Strategy Checklist**:\n- [ ] SpecKitStrategy extends BaseStrategy\n- [ ] TOGAFStrategy extends BaseStrategy\n- [ ] ADRStrategy extends BaseStrategy\n- [ ] RFCStrategy extends BaseStrategy\n- [ ] EnterpriseStrategy extends BaseStrategy\n- [ ] SDDStrategy extends BaseStrategy\n- [ ] ChatStrategy extends BaseStrategy\n\n**Definition of Done**:\n- All 7 strategies verified via grep\n- TypeScript type-check passes with no errors\n- Generic types correctly specified\n- Evidence saved in artifacts/validation/\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: V-005 | Phase: Validation | Priority: TBD*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-005",
		"dependencies": ["T-021"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-005-verify-all-strategies-extend-basestrategy.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-005-verify-all-strategies-extend-basestrategy.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": ["Footer priority is TBD; using header priority P0."],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-006: Verify Zero Duplicate Descriptions",
		"body": "# V-006: Verify Zero Duplicate Descriptions\n\n## Overview\n\n**Task ID**: V-006\n**Phase**: Validation\n**Priority**: P1 (Discoverability)\n**Estimate**: 1h\n**Dependencies**: T-067 (Tool Description Uniqueness)\n**References**: AC-006 (spec.md), ADR-008 (adr.md), REQ-025 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-006-verify-zero-duplicate-descriptions.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that all 30+ tool descriptions are unique, with zero duplicates in the exported tool-descriptions.csv. This ensures AI agents can correctly distinguish between tools during discovery and selection.\n\n### Why\n\n- **Requirement**: AC-006 mandates zero duplicate descriptions\n- **Architecture**: ADR-008 establishes unique descriptions for LLM discoverability\n- **Discovery**: Duplicate descriptions confuse AI agents during tool selection\n- **Quality**: Unique descriptions improve tool categorization and search\n\n### Context from Spec-Kit\n\nFrom spec.md AC-006:\n> \"Tool descriptions are unique (zero duplicates in CSV export)\"\n\nFrom adr.md ADR-008:\n> \"Each tool MUST have a unique description that distinguishes it from all other tools. Descriptions are validated via CSV export with duplicate detection\"\n\nFrom roadmap.md metrics:\n> \"Duplicate Descriptions: 8 ‚Üí 0 (-100%)\"\n\n### Deliverables\n\n- tool-descriptions.csv export with 30+ unique entries\n- Duplicate detection script result showing 0 duplicates\n- Similarity analysis showing no near-duplicates (>80% Jaccard similarity)\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify Zero Duplicate Descriptions fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-067\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Export Tool Descriptions\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nnpm run export:tool-descriptions\n```\n\n**Output**: `artifacts/tool-descriptions.csv`\n```csv\nname,description,category,annotations\nprompt-engineering-framework,\"Build structured prompts with hierarchical specificity...\",prompt,readOnlyHint:true\ncode-quality-framework,\"Analyze code quality metrics including hygiene...\",analysis,readOnlyHint:true\n...\n```\n\n### Step 4.2: Run Uniqueness Validation\n\n**Validation Script** (`scripts/validate-uniqueness.ts`):\n```typescript\nimport { parse } from 'csv-parse/sync';\nimport { readFileSync } from 'fs';\n\nconst csv = readFileSync('artifacts/tool-descriptions.csv', 'utf-8');\nconst records = parse(csv, { columns: true }) as Array<{ description: string }>;\n\nconst descriptions = records.map(r => r.description);\nconst unique = new Set(descriptions);\n\nif (unique.size !== descriptions.length) {\n const duplicates = descriptions.filter((d, i) => descriptions.indexOf(d) !== i);\n console.error('FAIL: Duplicate descriptions found:', duplicates);\n process.exit(1);\n}\n\nconsole.log(`PASS: ${descriptions.length} unique descriptions`);\nprocess.exit(0);\n```\n\n**Command**:\n```bash\nnpx tsx scripts/validate-uniqueness.ts\n```\n\n**Expected Output**:\n```\nPASS: 34 unique descriptions\n```\n\n### Step 4.3: Near-Duplicate Analysis\n\n```bash\n# Check for descriptions with >80% similarity (potential confusion)\nnpx tsx scripts/check-similarity.ts --threshold 0.8\n```\n\n**Similarity Check** (`scripts/check-similarity.ts`):\n```typescript\nfunction jaccardSimilarity(a: string, b: string): number {\n const setA = new Set(a.toLowerCase().split(/\\s+/));\n const setB = new Set(b.toLowerCase().split(/\\s+/));\n const intersection = new Set([...setA].filter(x => setB.has(x)));\n const union = new Set([...setA, ...setB]);\n return intersection.size / union.size;\n}\n```\n\n### Step 4.4: Remediate Duplicates\n\nIf duplicates found:\n1. Identify tools with duplicate descriptions\n2. Review tool functionality to differentiate\n3. Update description in tool handler\n4. Re-run export and validation\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ----------------------------------- | ------ | ------------------------------------------- |\n| CSV export contains all tools | ‚¨ú | `wc -l artifacts/tool-descriptions.csv` ‚â•34 |\n| Zero exact duplicates | ‚¨ú | Uniqueness script exits 0 |\n| Zero near-duplicates (>80% similar) | ‚¨ú | Similarity check exits 0 |\n| Each description >50 chars | ‚¨ú | CSV analysis confirms |\n| CI validation gate passes | ‚¨ú | GitHub Actions workflow green |\n\n### Description Quality Guidelines\n\n| Guideline | Requirement |\n| -------------- | -------------------------------- |\n| Length | 50-200 characters |\n| Unique verb | Start with unique action verb |\n| Domain context | Include specific domain/category |\n| Differentiator | Include distinguishing feature |\n\n**Example Good Descriptions**:\n- ‚úÖ \"Build structured prompts with hierarchical specificity for code generation\"\n- ‚úÖ \"Analyze code quality metrics including hygiene, complexity, and test coverage\"\n\n**Example Bad Descriptions**:\n- ‚ùå \"Generate prompts\" (too generic)\n- ‚ùå \"Build prompts\" (duplicate of another tool)\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-006, REQ-025\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-008 (Discoverability)\n- [artifacts/tool-descriptions.csv](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/artifacts/tool-descriptions.csv)\n\n---\n\n*Task: V-006 | Phase: Validation | Priority: P1*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-006",
		"dependencies": ["T-067"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-006-verify-zero-duplicate-descriptions.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-006-verify-zero-duplicate-descriptions.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-007: Verify All progress.md Valid",
		"body": "# V-007: Verify All progress.md Valid\n\n## Overview\n\n**Task ID**: V-007\n**Phase**: Validation\n**Priority**: P1 (Documentation Quality)\n**Estimate**: 1h\n**Dependencies**: T-048 (Progress Tracking), T-061 (CI Progress Validation)\n**References**: AC-007 (spec.md), REQ-019 (spec.md)\n\n---\n**Note**: Footer priority is TBD; using header priority P1.\n\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-007-verify-all-progress-md-valid.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that all progress.md files across planning directories conform to the Spec-Kit schema and contain valid tracking information. This ensures consistent progress reporting and enables automated status dashboards.\n\n### Why\n\n- **Requirement**: AC-007 mandates valid progress.md files in all planning directories\n- **Automation**: Valid structure enables CI-based progress tracking\n- **Visibility**: Standardized format supports dashboard generation\n- **Compliance**: Spec-Kit methodology requires progress.md for HITL workflow\n\n### Context from Spec-Kit\n\nFrom spec.md AC-007:\n> \"All progress.md files are valid and conform to Spec-Kit schema\"\n\nFrom plan.md Phase 5:\n> \"Progress tracking via progress.md enables real-time visibility into task completion and blockers\"\n\n### Deliverables\n\n- Progress.md validation script execution report\n- List of all valid progress.md files with paths\n- Schema compliance report (0 violations expected)\n- Progress summary aggregation (tasks completed, in-progress, blocked)\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify All progress.md Valid fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-048, T-061\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Find All progress.md Files\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\nfind plan-v0.14.x -name \"progress.md\" -type f\n```\n\n**Expected Output**:\n```\nplan-v0.14.x/speckit-v0.14.x-strategic-consolidation/progress.md\nplan-v0.14.x/*/progress.md\n```\n\n### Step 4.2: Validate Progress Schema\n\n**Required Schema Structure**:\n```markdown\n# Progress: [Project Name]\n\n## Summary\n| Metric | Value |\n| ----------- | ----- |\n| Total Tasks | N |\n| Completed | X |\n| In Progress | Y |\n| Blocked | Z |\n\n## Phase Progress\n\n### Phase N: [Name]\n- [x] Task completed\n- [ ] Task pending\n- [‚ö†Ô∏è] Task blocked - REASON\n\n## Blockers\n| Task | Blocker | Owner | ETA |\n| ---- | ------- | ----- | --- |\n\n## Recent Updates\n- [Date] Update description\n```\n\n**Validation Script** (`scripts/validate-progress.ts`):\n```typescript\nimport { readFileSync, existsSync } from 'fs';\nimport { glob } from 'glob';\n\nconst progressFiles = glob.sync('plan-v0.14.x/**/progress.md');\nlet valid = 0;\nlet invalid = 0;\n\nfor (const file of progressFiles) {\n const content = readFileSync(file, 'utf-8');\n\n // Check required sections\n const hasTitle = /^# Progress:/.test(content);\n const hasSummary = /## Summary/.test(content);\n const hasPhaseProgress = /## Phase Progress/.test(content);\n\n if (hasTitle && hasSummary && hasPhaseProgress) {\n console.log(`‚úì ${file}`);\n valid++;\n } else {\n console.error(`‚úó ${file} - Missing sections`);\n invalid++;\n }\n}\n\nconsole.log(`\\nValid: ${valid}, Invalid: ${invalid}`);\nprocess.exit(invalid > 0 ? 1 : 0);\n```\n\n### Step 4.3: Run Validation\n\n```bash\nnpm run validate:progress\n# or\nnpx tsx scripts/validate-progress.ts\n```\n\n### Step 4.4: Generate Progress Report\n\n```bash\n# Aggregate progress across all projects\nnpx tsx scripts/aggregate-progress.ts > artifacts/progress-summary.md\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------- | ------ | ------------ |\n| Validation executed successfully | ‚¨ú | TBD |\n| Results recorded with evidence | ‚¨ú | TBD |\n| Follow-up items documented | ‚¨ú | TBD |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md)\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md)\n\n---\n\n*Task: V-007 | Phase: Validation | Priority: TBD*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-007",
		"dependencies": ["T-048", "T-061"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-007-verify-all-progress-md-valid.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-007-verify-all-progress-md-valid.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": ["Footer priority is TBD; using header priority P1."],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-008: Verify CI Matrix Passes",
		"body": "# V-008: Verify CI Matrix Passes\n\n## Overview\n\n**Task ID**: V-008\n**Phase**: Validation\n**Priority**: P0 (Release Blocker)\n**Estimate**: 2h\n**Dependencies**: T-072 (CI Matrix Configuration)\n**References**: AC-008 (spec.md), ADR-009 (adr.md), REQ-017 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-008-verify-ci-matrix-passes.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that the CI matrix passes across all supported platforms (Linux, macOS, Windows) and Node.js versions (20.x, 22.x). This validation confirms cross-platform compatibility achieved through PAL abstraction.\n\n### Why\n\n- **Requirement**: AC-008 mandates CI matrix passes on all platforms\n- **Architecture**: ADR-009 establishes multi-platform CI testing strategy\n- **Compatibility**: Ensures code works on all 3 major platforms\n- **Quality**: Node.js version matrix catches API compatibility issues\n\n### Context from Spec-Kit\n\nFrom spec.md AC-008:\n> \"CI matrix passes on Linux, macOS, Windows with Node.js 20.x and 22.x\"\n\nFrom adr.md ADR-009:\n> \"CI workflow uses matrix strategy for platform √ó Node.js version combinations\"\n\nFrom roadmap.md metrics:\n> \"Platform Support: 1 (macOS/Linux) ‚Üí 3 (+ Windows) (+200%)\"\n\n### Deliverables\n\n- GitHub Actions workflow run showing all 6 matrix combinations green\n- Screenshot/artifact of successful matrix run\n- Runtime comparison across platforms (should be within 20% of each other)\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify CI Matrix Passes fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-072\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Review CI Workflow Configuration\n\n**File**: `.github/workflows/ci.yml`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```yaml\njobs:\n test:\n strategy:\n matrix:\n os: [ubuntu-latest, macos-latest, windows-latest]\n node: [20, 22]\n runs-on: ${{ matrix.os }}\n steps:\n - uses: actions/checkout\n - uses: actions/setup-node\n with:\n node-version: ${{ matrix.node }}\n - run: npm ci\n - run: npm run quality\n - run: npm run test:all\n```\n\n### Step 4.2: Trigger CI Matrix Run\n\n```bash\n# Push to trigger CI or manually dispatch\ngh workflow run ci.yml\n\n# Monitor run status\ngh run list --workflow=ci.yml --limit 1\n```\n\n### Step 4.3: Verify All Matrix Combinations\n\n**Expected Matrix**:\n| OS | Node.js | Status | Runtime |\n| -------------- | ------- | ------ | ------- |\n| ubuntu-latest | 20 | ‚úÖ Pass | ~8min |\n| ubuntu-latest | 22 | ‚úÖ Pass | ~8min |\n| macos-latest | 20 | ‚úÖ Pass | ~10min |\n| macos-latest | 22 | ‚úÖ Pass | ~10min |\n| windows-latest | 20 | ‚úÖ Pass | ~12min |\n| windows-latest | 22 | ‚úÖ Pass | ~12min |\n\n**Command to Check**:\n```bash\ngh run view --log | grep -E \"(ubuntu|macos|windows).*node-(20|22)\"\n```\n\n### Step 4.4: Analyze Failures (if any)\n\n```bash\n# Download logs for failed jobs\ngh run download <run-id> --name logs\n\n# Common failure patterns:\n# - Windows: path separator issues (\\ vs /)\n# - macOS: case sensitivity\n# - Node 20: missing APIs available in 22\n```\n\n### Step 4.5: Export Evidence\n\n```bash\n# Screenshot workflow summary\ngh run view <run-id> --web\n\n# Export run details\ngh run view <run-id> --json jobs > artifacts/ci-matrix-results.json\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| -------------------------------- | ------ | ------------------------ |\n| ubuntu-latest Node 20 passes | ‚¨ú | CI workflow green |\n| ubuntu-latest Node 22 passes | ‚¨ú | CI workflow green |\n| macos-latest Node 20 passes | ‚¨ú | CI workflow green |\n| macos-latest Node 22 passes | ‚¨ú | CI workflow green |\n| windows-latest Node 20 passes | ‚¨ú | CI workflow green |\n| windows-latest Node 22 passes | ‚¨ú | CI workflow green |\n| Total runtime ‚â§12min per job | ‚¨ú | Job timing within budget |\n| No platform-specific workarounds | ‚¨ú | Code review confirms |\n\n### Platform-Specific Test Expectations\n\n| Platform | Key Validations |\n| -------- | ---------------------------------------------- |\n| Linux | Baseline performance, default CI environment |\n| macOS | Case-sensitive filesystem, ARM64 compatibility |\n| Windows | Path separators, line endings, PowerShell |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-008, REQ-017\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-009 (CI Strategy)\n- [GitHub Actions Matrix](https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs)\n\n---\n\n*Task: V-008 | Phase: Validation | Priority: P0*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-008",
		"dependencies": ["T-072"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-008-verify-ci-matrix-passes.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-008-verify-ci-matrix-passes.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-009: Verify Single Prompt Entry Point",
		"body": "# V-009: Verify Single Prompt Entry Point\n\n## Overview\n\n**Task ID**: V-009\n**Phase**: Validation\n**Priority**: P0 (Critical Path - Breaking Change)\n**Estimate**: 2h\n**Dependencies**: T-026 (UnifiedPromptBuilder Core)\n**References**: AC-009 (spec.md), ADR-003 (adr.md), REQ-007 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-009-verify-single-prompt-entry-point.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that UnifiedPromptBuilder serves as the single entry point for all prompt generation, replacing the 12+ scattered prompt builders with a unified architecture. This validation confirms Phase 2.5's BREAKING CHANGE was implemented correctly per ADR-003.\n\n### Why\n\n- **Requirement**: AC-009 mandates UnifiedPromptBuilder as single entry point\n- **Architecture**: ADR-003 establishes unified prompt ecosystem with 92% reduction in builders\n- **Maintainability**: Eliminates code duplication (~25% reduction)\n- **Consistency**: Ensures uniform prompt structure across all domains\n\n### Context from Spec-Kit\n\nFrom spec.md AC-009:\n> \"UnifiedPromptBuilder is the single entry point for all prompt generation\"\n\nFrom adr.md ADR-003:\n> \"Implement `UnifiedPromptBuilder` as single entry point: Registry Pattern for domain-specific generators, Route requests to appropriate generator, Consistent output format\"\n\nFrom plan.md Phase 2.5:\n> \"‚ö†Ô∏è **BREAKING CHANGE**: This phase has strict 'no backward compatibility' policy for internal prompt builder APIs. Public facades will maintain compatibility.\"\n\n### Deliverables\n\n- Code audit confirming UnifiedPromptBuilder is sole entry point\n- Legacy facade verification showing deprecation warnings\n- PromptRegistry inspection with all domains registered\n\n## 2. Context and Scope\n\n### Current State (Baseline)\n\nFrom spec.md:\n- 12+ independent prompt builders with ~25% code duplication\n- Inconsistent prompt structure\n- No unified interface\n\n### Target State\n\nPer AC-009 and ADR-003:\n- **Single Entry Point**: `UnifiedPromptBuilder` in `src/domain/prompts/unified-prompt-builder.ts`\n- **Registry Pattern**: `PromptRegistry` routes to domain generators\n- **Domain Generators**: 5 domain-specific generators\n- **Legacy Facades**: Deprecated wrappers maintaining backward compatibility\n\n### Out of Scope\n\n- Prompt content quality (tested in T-035)\n- Performance benchmarking\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-026: UnifiedPromptBuilder core implemented\n- T-027 through T-031: Domain generators implemented\n- T-032, T-033: Legacy facades created\n\n### Target Files\n\n- `src/domain/prompts/unified-prompt-builder.ts`\n- `src/domain/prompts/registry.ts`\n- `src/domain/prompts/domains/*.ts`\n- `src/tools/prompts/legacy-facades/*.ts`\n\n## 4. Implementation Guide\n\n### Step 4.1: Verify UnifiedPromptBuilder Entry Point\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Verify UnifiedPromptBuilder exists\nls -la src/domain/prompts/unified-prompt-builder.ts\n\n# Check exports\ngrep -n \"export class UnifiedPromptBuilder\" src/domain/prompts/unified-prompt-builder.ts\n```\n\n### Step 4.2: Verify PromptRegistry Integration\n\n```bash\n# Verify registry exists and is used\ngrep -n \"PromptRegistry\" src/domain/prompts/unified-prompt-builder.ts\n\n# Count registered domains (expect 5)\ngrep -c \"register(\" src/domain/prompts/registry.ts\n```\n\n### Step 4.3: Verify Legacy Facades (Deprecation)\n\n```bash\n# Find all legacy facade files\nfind src/tools/prompts/legacy-facades -name \"*.ts\"\n\n# Check for deprecation warnings\ngrep -r \"\" src/tools/prompts/legacy-facades/\n```\n\n**Expected Output**:\n```\n Use UnifiedPromptBuilder instead. Will be removed in v0.15.x\n```\n\n### Step 4.4: Verify No Direct Prompt Builder Usage\n\n```bash\n# Search for direct imports of old builders (should find only in legacy facades)\ngrep -r \"import.*-prompt-builder\" src/ --exclude-dir=legacy-facades\n\n# Should return ZERO results outside of legacy-facades/\n```\n\n### Step 4.5: Capture Evidence\n\n- Save file listing to `artifacts/validation/V-009-prompt-architecture.txt`\n- Save grep results for deprecation warnings\n- Document architecture confirmation\n\n## 5. Testing Strategy\n\nConfirm:\n1. Single entry point exists\n2. Registry has 5 domains\n3. Legacy facades emit warnings\n4. No violations of direct old builder usage\n\n## 6. Risks and Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| Breaking changes affect users | High | Legacy facades maintain compatibility |\n| Domain generator missing | High | Registry validation checks 5 domains |\n| Old builders still imported | Medium | Grep audit catches violations |\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-009:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| UnifiedPromptBuilder exists as single entry point | ‚¨ú | File exists at src/domain/prompts/unified-prompt-builder.ts |\n| PromptRegistry routes to all 5 domains | ‚¨ú | Registry has 5 registered generators |\n| Legacy facades deprecated with warnings | ‚¨ú | annotations present |\n| No direct old builder imports outside facades | ‚¨ú | grep returns 0 violations |\n| Architecture matches ADR-003 design | ‚¨ú | Manual review confirms pattern |\n\n**Definition of Done**:\n- Single entry point confirmed via code audit\n- All 5 domain generators registered\n- Legacy facades emit deprecation warnings\n- Zero violations of direct old builder usage\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-009, REQ-007\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-003 Unified Prompt Ecosystem\n- [plan.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/plan.md) - Phase 2.5 Breaking Change Policy\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md) - T-026 through T-036\n\n---\n\n*Task: V-009 | Phase: Validation (Phase 2.5) | Priority: P0 (Breaking Change)*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-009",
		"dependencies": ["T-026"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-009-verify-single-prompt-entry-point.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-009-verify-single-prompt-entry-point.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-010: Verify CI Runtime ‚â§12min",
		"body": "# V-010: Verify CI Runtime ‚â§12min\n\n## Overview\n\n**Task ID**: V-010\n**Phase**: Validation\n**Priority**: P1 (Developer Experience)\n**Estimate**: 1h\n**Dependencies**: T-064 (CI Performance Optimization)\n**References**: AC-010 (spec.md), REQ-018 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-010-verify-ci-runtime-12min.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that CI pipeline runtime is ‚â§12 minutes per job, ensuring fast feedback loops for developers. This validation confirms performance optimizations including caching, parallelization, and test sharding are effective.\n\n### Why\n\n- **Requirement**: AC-010 mandates CI runtime ‚â§12min\n- **Developer Experience**: Fast CI enables rapid iteration\n- **Cost**: Shorter runtimes reduce GitHub Actions billing\n- **Productivity**: Quick feedback prevents context switching\n\n### Context from Spec-Kit\n\nFrom spec.md AC-010:\n> \"CI pipeline runtime ‚â§12 minutes (per job in matrix)\"\n\nFrom roadmap.md metrics:\n> \"CI Time: 18min ‚Üí 12min (-33%)\"\n\nFrom plan.md optimizations:\n> \"Implement npm cache, parallel test execution, and intelligent test sharding\"\n\n### Deliverables\n\n- CI timing analysis showing all jobs ‚â§12min\n- Breakdown of time by workflow step\n- Optimization recommendations if any job exceeds target\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify CI Runtime ‚â§12min fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-064\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Collect CI Timing Data\n\n**Command**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Get last 10 CI runs timing\ngh run list --workflow=ci.yml --limit 10 --json databaseId,conclusion,startedAt,updatedAt \\\n | jq '.[] | {id: .databaseId, duration: ((.updatedAt | fromdateiso8601) - (.startedAt | fromdateiso8601))}'\n```\n\n### Step 4.2: Analyze Job-Level Timing\n\n```bash\n# Get detailed job timing for a run\ngh run view <run-id> --json jobs \\\n | jq '.jobs[] | {name: .name, duration: ((.completedAt | fromdateiso8601) - (.startedAt | fromdateiso8601))/60}'\n```\n\n**Expected Output**:\n```json\n{\"name\": \"test (ubuntu-latest, 22)\", \"duration\": 8.5}\n{\"name\": \"test (macos-latest, 22)\", \"duration\": 10.2}\n{\"name\": \"test (windows-latest, 22)\", \"duration\": 11.8}\n```\n\n### Step 4.3: Step-Level Breakdown\n\n**Target Step Timings**:\n| Step | Target | Typical |\n| ----------------- | ----------------- | ------- |\n| Checkout | <10s | 5s |\n| Setup Node | <30s | 15s |\n| npm ci (cached) | <60s | 45s |\n| Type check | <60s | 40s |\n| Lint | <30s | 20s |\n| Unit tests | <300s | 240s |\n| Integration tests | <120s | 90s |\n| Coverage | <60s | 45s |\n| **Total** | **<720s (12min)** | ~500s |\n\n### Step 4.4: Verify Cache Effectiveness\n\n```bash\n# Check cache hit rate\ngh run view <run-id> --log | grep -E \"(Cache|cache)\" | head -20\n```\n\n**Expected**: npm cache hit on non-lockfile-change runs\n\n### Step 4.5: Generate Timing Report\n\n```bash\n# Export timing analysis\nnpx tsx scripts/ci-timing-analysis.ts > artifacts/ci-timing-report.md\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------ | ------ | --------------- |\n| Linux jobs ‚â§10min | ‚¨ú | Timing analysis |\n| macOS jobs ‚â§12min | ‚¨ú | Timing analysis |\n| Windows jobs ‚â§12min | ‚¨ú | Timing analysis |\n| npm cache hit rate >80% | ‚¨ú | Cache logs |\n| No test timeout failures | ‚¨ú | CI logs |\n| P95 runtime ‚â§12min | ‚¨ú | 10-run analysis |\n\n### Optimization Techniques (Implemented)\n\n| Technique | Impact |\n| ---------------------------- | ----------------- |\n| npm ci with cache | -40% install time |\n| Parallel test execution | -30% test time |\n| TypeScript incremental build | -25% build time |\n| Smart test selection | -20% test time |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-010, REQ-018\n- [GitHub Actions Caching](https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows)\n\n---\n\n*Task: V-010 | Phase: Validation | Priority: P1*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-010",
		"dependencies": ["T-064"],
		"estimate_hours": 1,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-010-verify-ci-runtime-12min.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-010-verify-ci-runtime-12min.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-011: Verify Documentation Complete",
		"body": "# V-011: Verify Documentation Complete\n\n## Overview\n\n**Task ID**: V-011\n**Phase**: Validation\n**Priority**: P1 (Release Requirement)\n**Estimate**: 2h\n**Dependencies**: T-065 (API Docs), T-066 (Migration Guide)\n**References**: AC-011 (spec.md), REQ-020 through REQ-022 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-011-verify-documentation-complete.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that documentation is complete for the v0.14.x release, including API reference, migration guide, framework documentation, and updated README. This ensures users can successfully adopt the consolidated architecture.\n\n### Why\n\n- **Requirement**: AC-011 mandates complete documentation for release\n- **Adoption**: Good docs reduce barrier to entry for new users\n- **Migration**: Breaking changes require clear migration guidance\n- **Support**: Comprehensive docs reduce support burden\n\n### Context from Spec-Kit\n\nFrom spec.md AC-011:\n> \"Documentation complete: API reference, migration guide, framework docs, README updated\"\n\nFrom roadmap.md:\n> \"Documentation coverage: 60% ‚Üí 95% (+58%)\"\n\n### Deliverables\n\n- Documentation audit checklist with all items verified\n- API reference for all 11 frameworks\n- Migration guide from v0.13.x to v0.14.x\n- Updated README with new architecture overview\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify Documentation Complete fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-065, T-066\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Documentation Audit Checklist\n\n| Document | Path | Required Sections |\n| --------------- | ----------------------------------- | ---------------------------------------- |\n| README.md | `/README.md` | Overview, Quick Start, Architecture, API |\n| CHANGELOG.md | `/CHANGELOG.md` | v0.14.0 release notes |\n| Migration Guide | `/docs/migration/v0.13-to-v0.14.md` | Breaking changes, code examples |\n| API Reference | `/docs/api/README.md` | All 11 frameworks documented |\n| Framework Docs | `/docs/frameworks/` | One file per framework |\n| Contributing | `/CONTRIBUTING.md` | Updated for new architecture |\n\n### Step 4.2: Verify API Reference\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```bash\n# Check API docs exist for all frameworks\nfor fw in prompt-engineering code-quality design-architecture security testing \\\n documentation strategic-planning agent-orchestration prompt-optimization \\\n visualization project-management; do\n if [[ -f \"docs/api/${fw}.md\" ]]; then\n echo \"‚úì $fw\"\n else\n echo \"‚úó $fw MISSING\"\n fi\ndone\n```\n\n### Step 4.3: Verify Migration Guide\n\n**Required Content**:\n```markdown\n# Migrating from v0.13.x to v0.14.x\n\n## Breaking Changes\n\n### UnifiedPromptBuilder (ADR-003)\n- Old: `import { HierarchicalPromptBuilder } from 'mcp-ai-agent-guidelines'`\n- New: `import { UnifiedPromptBuilder } from 'mcp-ai-agent-guidelines'`\n\n### Framework Consolidation (ADR-005)\n- 30+ tools ‚Üí 11 frameworks\n- Tool names changed (see mapping table)\n\n## Migration Steps\n\n1. Update imports\n2. Replace deprecated tool calls\n3. Update configuration\n```\n\n### Step 4.4: Verify README Updates\n\n```bash\n# Check README has required sections\ngrep -E \"^## (Overview|Quick Start|Architecture|Frameworks|API)\" README.md\n```\n\n### Step 4.5: Link Validation\n\n```bash\n# Check for broken links\nnpx markdown-link-check README.md docs/**/*.md\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------ | ------ | ----------------------------------- |\n| README.md updated | ‚¨ú | Includes v0.14.x architecture |\n| CHANGELOG.md has release notes | ‚¨ú | v0.14.0 section complete |\n| Migration guide exists | ‚¨ú | `/docs/migration/v0.13-to-v0.14.md` |\n| API docs for 11 frameworks | ‚¨ú | `docs/api/` has 11 files |\n| No broken links | ‚¨ú | Link checker passes |\n| Code examples tested | ‚¨ú | Examples in docs compile |\n| Contributing guide updated | ‚¨ú | Reflects new architecture |\n\n### Documentation Quality Checklist\n\n| Quality Check | Requirement |\n| ---------------- | -------------------------------- |\n| Spelling/Grammar | Spell-checked, no obvious errors |\n| Code Examples | All examples tested and working |\n| Cross-References | Links to related docs work |\n| Versioning | Version numbers consistent |\n| Accessibility | Alt text for images |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-011, REQ-020 through REQ-022\n- [docs/](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/docs/) - Documentation directory\n\n---\n\n*Task: V-011 | Phase: Validation | Priority: P1*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-011",
		"dependencies": ["T-065", "T-066"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-011-verify-documentation-complete.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-011-verify-documentation-complete.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-012: Verify enforce_planning Works",
		"body": "# V-012: Verify enforce_planning Works\n\n## Overview\n\n**Task ID**: V-012\n**Phase**: Validation\n**Priority**: P0 (HITL Critical)\n**Estimate**: 2h\n**Dependencies**: T-053 (enforce_planning Implementation)\n**References**: AC-012 (spec.md), ADR-001 (adr.md), REQ-001 through REQ-003 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-012-verify-enforce-planning-works.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that the `enforce_planning` tool correctly enforces the Human-In-The-Loop (HITL) workflow by requiring Spec-Kit artifacts before code generation. This validation confirms the mandatory planning phase cannot be bypassed.\n\n### Why\n\n- **Requirement**: AC-012 mandates enforce_planning prevents unplanned code generation\n- **Architecture**: ADR-001 establishes HITL as foundational safety pattern\n- **Safety**: Prevents AI agents from generating code without human-approved specifications\n- **Quality**: Ensures all code generation has proper planning artifacts\n\n### Context from Spec-Kit\n\nFrom spec.md AC-012:\n> \"enforce_planning correctly blocks code generation without approved Spec-Kit artifacts\"\n\nFrom adr.md ADR-001:\n> \"The enforce_planning tool implements a pre-flight check: 1) Validates spec.md exists and is approved, 2) Validates plan.md exists with phases defined, 3) Blocks tool calls if artifacts missing\"\n\nFrom plan.md:\n> \"HITL enforcement ensures no code generation proceeds without human review and approval of planning documents\"\n\n### Deliverables\n\n- Integration tests showing enforce_planning blocks unapproved requests\n- Test cases for all bypass scenarios\n- Evidence of correct error messages when blocking\n\n## 2. Context and Scope\n\n### Current State\n\n- Review existing modules and integrations\n- Capture baseline behavior before changes\n\n### Target State\n\n- Verify enforce_planning Works fully implemented per requirements\n- Supporting tests/validation in place\n\n### Out of Scope\n\n- Unrelated refactors or non-task enhancements\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-053\n\n### Target Files\n\n- `artifacts/`\n- `CI logs`\n\n### Tooling\n\n- Node.js 22.x\n- npm scripts from the root package.json\n\n## 4. Implementation Guide\n\n### Step 4.1: Test Scenarios\n\n| Scenario | Expected Outcome |\n| -------------------------- | ------------------------------------- |\n| No spec.md | Block with \"Missing spec.md\" error |\n| spec.md not approved | Block with \"Spec not approved\" error |\n| No plan.md | Block with \"Missing plan.md\" error |\n| All artifacts valid | Allow code generation |\n| Expired approval (>7 days) | Block with \"Approval expired\" warning |\n\n### Step 4.2: Integration Test Implementation\n\n**Test File**: `tests/vitest/integration/enforce-planning.spec.ts`\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport { enforcePlanning } from '../../../src/tools/planning/enforce-planning.js';\nimport { MockPAL } from '../../../src/platform/mock-pal.js';\n\ndescribe('enforce_planning', () => {\n let mockPAL: MockPAL;\n\n beforeEach(() => {\n mockPAL = new MockPAL();\n });\n\n it('should block when spec.md is missing', async () => {\n mockPAL.setFiles({}); // No files\n\n const result = await enforcePlanning({ action: 'check' }, mockPAL);\n\n expect(result.allowed).toBe(false);\n expect(result.error).toContain('Missing spec.md');\n });\n\n it('should block when spec.md not approved', async () => {\n mockPAL.setFiles({\n 'spec.md': '# Spec\\n\\nStatus: Draft', // Not approved\n });\n\n const result = await enforcePlanning({ action: 'check' }, mockPAL);\n\n expect(result.allowed).toBe(false);\n expect(result.error).toContain('not approved');\n });\n\n it('should allow when all artifacts valid', async () => {\n mockPAL.setFiles({\n 'spec.md': '# Spec\\n\\nStatus: Approved\\nApproved: 2025-01-01',\n 'plan.md': '# Plan\\n\\n## Phase 1',\n });\n\n const result = await enforcePlanning({ action: 'check' }, mockPAL);\n\n expect(result.allowed).toBe(true);\n });\n});\n```\n\n### Step 4.3: Run Integration Tests\n\n```bash\n# Run enforce_planning tests\nnpm run test:vitest -- tests/vitest/integration/enforce-planning.spec.ts\n```\n\n### Step 4.4: Manual Verification\n\n```bash\n# Test via MCP tool call\necho '{\"action\": \"check\", \"directory\": \".\"}' | npx mcp-tool enforce_planning\n```\n\n### Step 4.5: Bypass Attempt Tests\n\n```bash\n# Verify these attempts are blocked\nnpx tsx scripts/test-bypass-attempts.ts\n```\n\n## 5. Testing Strategy\n\n- Confirm validation command exits with code 0\n- Attach output artifacts to CI or `artifacts/`\n- Document any follow-up actions\n\n## 6. Risks and Mitigations\n\n- Risk: Scope creep beyond tasks.md\n - Mitigation: Validate against acceptance criteria\n- Risk: Integration regressions\n - Mitigation: Run targeted tests and CI checks\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ---------------------------------- | ------ | ------------------------------- |\n| Blocks missing spec.md | ‚¨ú | Integration test passes |\n| Blocks unapproved spec | ‚¨ú | Integration test passes |\n| Blocks missing plan.md | ‚¨ú | Integration test passes |\n| Allows valid artifacts | ‚¨ú | Integration test passes |\n| Clear error messages | ‚¨ú | Error text is actionable |\n| Cannot bypass via direct call | ‚¨ú | Bypass tests fail as expected |\n| Integrates with all code gen tools | ‚¨ú | All tools call enforce_planning |\n\n### Error Message Quality\n\n| Scenario | Required Message Content |\n| ------------ | ---------------------------------------- |\n| Missing spec | \"Create spec.md with `speckit generate`\" |\n| Unapproved | \"Get approval before proceeding\" |\n| Missing plan | \"Create plan.md after spec approval\" |\n| Expired | \"Approval >7 days old, re-approve\" |\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-012, REQ-001 through REQ-003\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-001 (HITL Enforcement)\n\n---\n\n*Task: V-012 | Phase: Validation | Priority: P0*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-012",
		"dependencies": ["T-053"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-012-verify-enforce-planning-works.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-012-verify-enforce-planning-works.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-013: Verify ExecutionTrace Active",
		"body": "# V-013: Verify ExecutionTrace Active\n\n## Overview\n\n**Task ID**: V-013\n**Phase**: Validation\n**Priority**: P0 (Critical Path)\n**Estimate**: 2h\n**Dependencies**: T-011 through T-017 (Strategy migrations)\n**References**: AC-013 (spec.md), ADR-001 (adr.md), REQ-002 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-013-verify-executiontrace-active.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that ExecutionTrace logging is active for all strategy executions, providing full decision transparency and debugging capabilities as mandated by ADR-001's mandatory HITL pattern.\n\n### Why\n\n- **Requirement**: AC-013 mandates ExecutionTrace logging for all strategies\n- **Architecture**: ADR-001 establishes ExecutionTrace as core component of BaseStrategy<T>\n- **Transparency**: Enables audit trails for AI agent decision-making\n- **Debugging**: Provides detailed logs for error investigation\n\n### Context from Spec-Kit\n\nFrom spec.md AC-013:\n> \"ExecutionTrace logging active for all strategy executions\"\n\nFrom adr.md ADR-001:\n> \"Implement ExecutionTrace class for decision logging with recordDecision(), recordMetric(), recordError(), toJSON(), and toMarkdown() exports for transparency\"\n\nFrom plan.md Phase 1:\n> \"ExecutionTrace records all strategy decisions, metrics, and errors with timestamps, enabling full audit trails\"\n\n### Deliverables\n\n- Log analysis showing ExecutionTrace calls in all 7 strategies\n- Sample trace exports (JSON and Markdown)\n- Integration test results confirming trace capture\n\n## 2. Context and Scope\n\n### Current State (Baseline)\n\nFrom spec.md Phase 2 baseline:\n- 7 strategies migrated to BaseStrategy<T>\n- ExecutionTrace integrated per ADR-001\n- Template method pattern ensures tracing cannot be bypassed\n\n### Target State\n\nPer AC-013:\n- All 7 strategies use `this.trace` for decision logging\n- Every strategy execution produces ExecutionTrace output\n- Traces include decisions, metrics, and errors\n- Both JSON and Markdown export formats work\n\n**Expected ExecutionTrace Usage**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\n// In every strategy's executeStrategy() method\nthis.trace.recordDecision('phase-start', 'Starting spec generation', { title });\nthis.trace.recordMetric('requirement-count', requirements.length);\nthis.trace.recordError(error); // on failures\n```\n\n**Expected Trace Export**:\n```typescript\nconst trace = strategyResult.trace;\ntrace.toJSON(); // Returns structured data\ntrace.toMarkdown(); // Returns human-readable report\n```\n\n### Out of Scope\n\n- Trace content quality (tested in unit tests)\n- Performance overhead measurement\n- Trace storage/persistence\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-003: ExecutionTrace class implemented\n- T-011 through T-017: All 7 strategies migrated to BaseStrategy\n- T-004: ExecutionTrace tests passing\n\n### Target Files\n\n- `src/domain/base-strategy/execution-trace.ts`\n- `src/strategies/*/index.ts` (all 7 strategy implementations)\n\n## 4. Implementation Guide\n\n### Step 4.1: Verify ExecutionTrace Class\n\n**Command**:\n```bash\n# Verify ExecutionTrace exists\nls -la src/domain/base-strategy/execution-trace.ts\n\n# Check key methods\ngrep -E \"(recordDecision|recordMetric|recordError|toJSON|toMarkdown)\" src/domain/base-strategy/execution-trace.ts\n```\n\n**Expected**: All 5 methods present\n\n### Step 4.2: Verify Strategy Usage\n\n**Command**:\n```bash\n# Check each strategy uses this.trace\nfor strategy in speckit togaf adr rfc enterprise sdd chat; do\n echo \"=== $strategy ===\"\n grep -c \"this.trace\" src/strategies/$strategy/*.ts\ndone\n```\n\n**Expected Output** (each strategy should have multiple this.trace calls):\n```\n=== speckit ===\n15 # Example: 15 trace calls in SpecKitStrategy\n\n=== togaf ===\n12 # Example: 12 trace calls in TOGAFStrategy\n\n... (and so on for all 7)\n```\n\n**If count = 0 for any strategy**:\n- Strategy is NOT using ExecutionTrace\n- FAIL validation\n- Remediation: Add trace calls per ADR-001\n\n### Step 4.3: Verify Decision Recording\n\n**Check Decision Patterns**:\n```bash\n# Find all decision recordings\ngrep -r \"recordDecision\" src/strategies/\n\n# Should show calls like:\n# this.trace.recordDecision('init', 'Starting generation', context)\n# this.trace.recordDecision('validation', 'Input validated', result)\n# this.trace.recordDecision('complete', 'Generation finished', stats)\n```\n\n### Step 4.4: Verify Metric Recording\n\n**Check Metric Patterns**:\n```bash\n# Find all metric recordings\ngrep -r \"recordMetric\" src/strategies/\n\n# Should show calls like:\n# this.trace.recordMetric('requirement-count', input.requirements.length)\n# this.trace.recordMetric('generation-time-ms', duration)\n# this.trace.recordMetric('output-size-bytes', Buffer.byteLength(output))\n```\n\n### Step 4.5: Run Integration Test\n\n**Execute Integration Test**:\n```bash\n# Run integration test that exercises strategies\nnpm run test:integration -- --grep \"ExecutionTrace\"\n```\n\n**Expected Output**:\n```\n‚úì SpecKitStrategy produces ExecutionTrace\n‚úì TOGAFStrategy produces ExecutionTrace\n‚úì ADRStrategy produces ExecutionTrace\n‚úì RFCStrategy produces ExecutionTrace\n‚úì EnterpriseStrategy produces ExecutionTrace\n‚úì SDDStrategy produces ExecutionTrace\n‚úì ChatStrategy produces ExecutionTrace\n\n‚úì ExecutionTrace.toJSON() works\n‚úì ExecutionTrace.toMarkdown() works\n\n10 passing\n```\n\n### Step 4.6: Sample Trace Export\n\n**Generate Sample Traces**:\n```bash\n# Run a strategy and capture trace\nnode << 'SCRIPT'\nconst { SpecKitStrategy } = require('./dist/strategies/speckit');\nconst strategy = new SpecKitStrategy();\n\nconst input = {\n title: 'Test Spec',\n overview: 'Test overview',\n objectives: ['Objective 1'],\n requirements: [{ description: 'Req 1' }]\n};\n\nstrategy.execute(input).then(result => {\n console.log('=== JSON Export ===');\n console.log(JSON.stringify(result.trace.toJSON(), null, 2));\n\n console.log('\\n=== Markdown Export ===');\n console.log(result.trace.toMarkdown());\n});\nSCRIPT\n```\n\n**Expected JSON Structure**:\n```json\n{\n \"strategyName\": \"speckit\",\n \"strategyVersion\": \"2.0.0\",\n \"startTime\": \"2026-02-02T08:00:00.000Z\",\n \"endTime\": \"2026-02-02T08:00:05.123Z\",\n \"decisions\": [\n {\n \"id\": \"init\",\n \"timestamp\": \"2026-02-02T08:00:00.100Z\",\n \"description\": \"Starting spec generation\",\n \"context\": { \"title\": \"Test Spec\" }\n }\n ],\n \"metrics\": [\n {\n \"name\": \"requirement-count\",\n \"value\": 1,\n \"timestamp\": \"2026-02-02T08:00:00.200Z\"\n }\n ],\n \"errors\": []\n}\n```\n\n**Expected Markdown Structure**:\n```markdown\n# ExecutionTrace: speckit v2.0.0\n\n**Start Time**: 2026-02-02T08:00:00.000Z\n**End Time**: 2026-02-02T08:00:05.123Z\n**Duration**: 5123 ms\n\n## Decisions\n\n- [08:00:00.100] **init**: Starting spec generation\n - Context: { \"title\": \"Test Spec\" }\n\n## Metrics\n\n- requirement-count: 1\n- generation-time-ms: 5000\n\n## Errors\n\nNone\n```\n\n### Step 4.7: Capture Evidence\n\n```bash\n# Generate validation report\ncat > artifacts/validation/V-013-executiontrace.txt << 'REPORT'\n=== ExecutionTrace Verification ===\n\nStrategy Usage Audit:\n---------------------\nREPORT\n\nfor strategy in speckit togaf adr rfc enterprise sdd chat; do\n count=$(grep -c \"this.trace\" src/strategies/$strategy/*.ts 2>/dev/null || echo \"0\")\n echo \"$strategy: $count trace calls\" >> artifacts/validation/V-013-executiontrace.txt\ndone\n\necho \"\" >> artifacts/validation/V-013-executiontrace.txt\necho \"Integration Test Results:\" >> artifacts/validation/V-013-executiontrace.txt\nnpm run test:integration -- --grep \"ExecutionTrace\" --reporter json > /tmp/trace-test-results.json 2>&1\ncat /tmp/trace-test-results.json >> artifacts/validation/V-013-executiontrace.txt\n```\n\n## 5. Testing Strategy\n\n### Unit Tests\n- ExecutionTrace class methods (T-004)\n- Decision/metric/error recording\n- JSON and Markdown export\n\n### Integration Tests\n- Each strategy produces valid trace\n- Trace contains decisions, metrics, errors\n- Export formats work correctly\n\n### Audit Tests\n- All 7 strategies use `this.trace`\n- Minimum trace call count per strategy\n- No strategies bypass tracing\n\n## 6. Risks and Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| Strategy bypasses trace | High | Template method pattern prevents |\n| Trace overhead performance | Medium | Async recording, benchmarking |\n| Trace export fails | Low | Unit tests cover export methods |\n| Missing trace calls | Medium | Grep audit catches violations |\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-013:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| ExecutionTrace class implemented | ‚¨ú | File exists: src/domain/base-strategy/execution-trace.ts |\n| All 7 strategies use this.trace | ‚¨ú | grep shows trace calls in all strategies |\n| recordDecision() calls present | ‚¨ú | grep finds decision recordings |\n| recordMetric() calls present | ‚¨ú | grep finds metric recordings |\n| recordError() calls present | ‚¨ú | grep finds error recordings |\n| toJSON() export works | ‚¨ú | Integration test passes |\n| toMarkdown() export works | ‚¨ú | Integration test passes |\n| Integration tests pass for all strategies | ‚¨ú | npm run test:integration passes |\n\n**Strategy Tracing Checklist**:\n- [ ] SpecKitStrategy uses this.trace\n- [ ] TOGAFStrategy uses this.trace\n- [ ] ADRStrategy uses this.trace\n- [ ] RFCStrategy uses this.trace\n- [ ] EnterpriseStrategy uses this.trace\n- [ ] SDDStrategy uses this.trace\n- [ ] ChatStrategy uses this.trace\n\n**Definition of Done**:\n- All 7 strategies use ExecutionTrace\n- Integration tests pass\n- Sample traces exported successfully\n- Evidence saved in artifacts/validation/\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-013, REQ-002\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-001 BaseStrategy Pattern\n- [plan.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/plan.md) - Phase 1 Core Infrastructure\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md) - T-003, T-004, T-011 through T-017\n\n---\n\n*Task: V-013 | Phase: Validation (Phase 2) | Priority: P0 (Critical Path)*\n",
		"labels": ["v0.14.x", "testing", "P0-critical"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P0",
		"task_id": "V-013",
		"dependencies": ["T-011", "T-017"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-013-verify-executiontrace-active.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-013-verify-executiontrace-active.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-014: Verify PAL Abstracts All fs/path",
		"body": "# V-014: Verify PAL Abstracts All fs/path\n\n## Overview\n\n**Task ID**: V-014\n**Phase**: Validation\n**Priority**: P1 (Cross-Platform Critical)\n**Estimate**: 2h\n**Dependencies**: T-057 (Replace fs/path Calls with PAL)\n**References**: AC-014 (spec.md), ADR-004 (adr.md), REQ-014 through REQ-016 (spec.md)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-014-verify-pal-abstracts-all-fs-path.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that Platform Abstraction Layer (PAL) successfully abstracts ALL direct fs/path operations, enabling cross-platform support for Windows, Linux, and macOS. This validation confirms that the codebase has eliminated 46 Bash-only shell scripts and all Unix-specific filesystem assumptions.\n\n### Why\n\n- **Requirement**: AC-014 mandates PAL abstracts all fs/path operations\n- **Architecture**: ADR-004 establishes PAL as foundational pattern for cross-platform support\n- **Platform Support**: Enables Windows compatibility (currently 0% support)\n- **Maintainability**: Centralizes filesystem operations for easier testing\n\n### Context from Spec-Kit\n\nFrom spec.md AC-014:\n> \"PAL abstracts all direct fs/path operations\"\n\nFrom adr.md ADR-004:\n> \"Current codebase has: 46 shell scripts (Bash only), Direct `fs` and `path` calls throughout, Unix path assumptions (`/` separator), No Windows support\"\n\nFrom roadmap.md metrics:\n> \"Platform Support: 1 (macOS/Linux) ‚Üí 3 (+ Windows) (+200%)\"\n\nFrom plan.md Phase 4:\n> \"Replace all direct fs/path calls with PAL abstractions for cross-platform support\"\n\n### Deliverables\n\n- grep audit showing ZERO direct fs/path imports in src/\n- PAL interface implementation verification (NodePAL, MockPAL)\n- Cross-platform path handling confirmation\n- CI matrix evidence (Windows, Linux, macOS)\n\n## 2. Context and Scope\n\n### Current State (Pre-Migration)\n\nFrom spec.md baseline:\n- 46 Bash-only shell scripts\n- Direct imports of Node.js `fs` and `path` modules throughout codebase\n- Unix path assumptions (`/` separator)\n- Windows: 0% compatibility\n\n### Target State\n\nPer AC-014 and ADR-004:\n- **PAL Interface**: `src/platform/pal.interface.ts` defines abstraction\n- **NodePAL**: `src/platform/node-pal.ts` for production runtime\n- **MockPAL**: `src/platform/mock-pal.ts` for testing\n- **Zero Direct Imports**: No `import fs from 'fs'` or `import path from 'path'` in `src/`\n- **Cross-Platform**: CI matrix passes on Windows, Linux, macOS\n\n**PAL Interface Methods**:\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\ninterface PlatformAbstractionLayer {\n // File operations\n readFile(path: string): Promise<string>;\n writeFile(path: string, content: string): Promise<void>;\n exists(path: string): Promise<boolean>;\n\n // Directory operations\n listFiles(dir: string, pattern?: string): Promise<string[]>;\n createDir(path: string): Promise<void>;\n\n // Path operations\n resolvePath(...segments: string[]): string;\n joinPath(...segments: string[]): string;\n dirname(path: string): string;\n basename(path: string): string;\n\n // Environment\n getEnv(key: string): string | undefined;\n getPlatform(): 'darwin' | 'linux' | 'win32';\n}\n```\n\n### Out of Scope\n\n- Shell script migration (deferred to future)\n- Performance optimization\n- API design changes (interface is frozen)\n\n## 3. Prerequisites\n\n### Dependencies\n\n- T-053: PAL Interface designed\n- T-054: NodePAL implemented\n- T-055: MockPAL implemented\n- T-056: All fs/path calls identified\n- T-057: All fs/path calls replaced with PAL\n\n### Target Files\n\n- `src/platform/pal.interface.ts`\n- `src/platform/node-pal.ts`\n- `src/platform/mock-pal.ts`\n- All files in `src/` (for grep audit)\n\n### Tooling\n\n- grep for filesystem audit\n- TypeScript compiler for verification\n- CI matrix (GitHub Actions)\n\n## 4. Implementation Guide\n\n### Step 4.1: Verify PAL Interface Exists\n\n```bash\n# Check PAL interface exists\nls -la src/platform/pal.interface.ts\n\n# Check all 3 implementations exist\nls -la src/platform/node-pal.ts\nls -la src/platform/mock-pal.ts\n```\n\n**Expected**: All 3 files exist\n\n### Step 4.2: Audit for Direct fs Imports\n\n**Critical Test - Must Return ZERO**:\n```bash\n# Search for direct fs imports (should find NONE in src/)\ngrep -r \"from 'fs'\" src/ --exclude-dir=node_modules --exclude-dir=platform\n\n# Alternative patterns\ngrep -r \"from \\\"fs\\\"\" src/ --exclude-dir=node_modules --exclude-dir=platform\ngrep -r \"require('fs')\" src/ --exclude-dir=node_modules --exclude-dir=platform\ngrep -r \"import fs\" src/ --exclude-dir=node_modules --exclude-dir=platform\n```\n\n**Expected Output**: ZERO results (empty)\n\n**If violations found**:\n```\nsrc/tools/analysis/file-scanner.ts:5:import fs from 'fs';\n```\n\n**Remediation**:\n```typescript\n// WRONG (direct fs import)\nimport fs from 'fs';\nconst content = await fs.promises.readFile(filePath, 'utf-8');\n\n// CORRECT (PAL abstraction)\nimport { pal } from '@/platform';\nconst content = await pal.readFile(filePath);\n```\n\n### Step 4.3: Audit for Direct path Imports\n\n**Critical Test - Must Return ZERO**:\n```bash\n# Search for direct path imports (should find NONE in src/ except platform/)\ngrep -r \"from 'path'\" src/ --exclude-dir=node_modules --exclude-dir=platform\n\n# Alternative patterns\ngrep -r \"from \\\"path\\\"\" src/ --exclude-dir=node_modules --exclude-dir=platform\ngrep -r \"require('path')\" src/ --exclude-dir=node_modules --exclude-dir=platform\ngrep -r \"import path\" src/ --exclude-dir=node_modules --exclude-dir=platform\ngrep -r \"import.*as path\" src/ --exclude-dir=node_modules --exclude-dir=platform\n```\n\n**Expected Output**: ZERO results (empty)\n\n**If violations found**:\n```\nsrc/tools/config/config-loader.ts:8:import path from 'path';\n```\n\n**Remediation**:\n```typescript\n// WRONG (direct path import)\nimport path from 'path';\nconst fullPath = path.resolve(__dirname, 'config.json');\n\n// CORRECT (PAL abstraction)\nimport { pal } from '@/platform';\nconst fullPath = pal.resolvePath(__dirname, 'config.json');\n```\n\n### Step 4.4: Verify Platform-Specific Path Handling\n\n**Test Cross-Platform Paths**:\n```bash\n# NodePAL should handle both Unix and Windows paths\nnpm run test:platform\n\n# Expected: Tests pass on all platforms\n```\n\n**Path Separator Test**:\n- Unix: `/home/user/file.txt`\n- Windows: `C:\\Users\\user\\file.txt`\n- Both should work via `pal.resolvePath()`\n\n### Step 4.5: Verify CI Matrix Passes\n\n**Check GitHub Actions**:\n```yaml\n# .github/workflows/ci.yml should have matrix\nstrategy:\n matrix:\n os: [ubuntu-latest, windows-latest, macos-latest]\n node: [22.x]\n```\n\n**Expected**: All 3 platforms passing\n\n### Step 4.6: Capture Evidence\n\n```bash\n# Generate audit report\necho \"=== PAL Abstraction Audit ===\" > artifacts/validation/V-014-pal-audit.txt\necho \"\" >> artifacts/validation/V-014-pal-audit.txt\necho \"Direct fs imports:\" >> artifacts/validation/V-014-pal-audit.txt\ngrep -r \"from 'fs'\" src/ --exclude-dir=platform 2>&1 | wc -l >> artifacts/validation/V-014-pal-audit.txt\necho \"\" >> artifacts/validation/V-014-pal-audit.txt\necho \"Direct path imports:\" >> artifacts/validation/V-014-pal-audit.txt\ngrep -r \"from 'path'\" src/ --exclude-dir=platform 2>&1 | wc -l >> artifacts/validation/V-014-pal-audit.txt\n```\n\n**Expected Report**:\n```\n=== PAL Abstraction Audit ===\n\nDirect fs imports: 0\nDirect path imports: 0\n\n‚úÖ PASS: All filesystem operations abstracted via PAL\n```\n\n## 5. Testing Strategy\n\n### Unit Tests\n- NodePAL implementation tests (T-058)\n- MockPAL implementation tests (T-058)\n- Cross-platform verification tests (T-059)\n\n### Integration Tests\n- CI matrix on Windows, Linux, macOS (T-060)\n- Path handling edge cases\n- Environment detection\n\n### Audit Tests\n- grep for `from 'fs'` ‚Üí 0 results\n- grep for `from 'path'` ‚Üí 0 results\n- grep for `require('fs')` ‚Üí 0 results\n- grep for `require('path')` ‚Üí 0 results\n\n## 6. Risks and Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| Missed fs/path import | High | Comprehensive grep patterns |\n| Platform-specific bug | Medium | CI matrix catches early |\n| Performance regression | Low | Benchmark before/after |\n| Shell scripts still Unix-only | Low | Deferred to future, not blocking |\n\n## 7. Acceptance Criteria\n\nFrom spec.md AC-014:\n\n| Criterion | Status | Verification |\n|-----------|--------|--------------|\n| PAL interface defined | ‚¨ú | File exists: src/platform/pal.interface.ts |\n| NodePAL implemented | ‚¨ú | File exists: src/platform/node-pal.ts |\n| MockPAL implemented | ‚¨ú | File exists: src/platform/mock-pal.ts |\n| Zero direct fs imports in src/ (excl. platform/) | ‚¨ú | grep returns 0 results |\n| Zero direct path imports in src/ (excl. platform/) | ‚¨ú | grep returns 0 results |\n| CI matrix passes (Windows, Linux, macOS) | ‚¨ú | GitHub Actions all green |\n\n**Definition of Done**:\n- All grep audits return 0 violations\n- PAL interface has all required methods\n- NodePAL and MockPAL both implemented\n- CI matrix passes on 3 platforms\n- Evidence saved in artifacts/validation/\n\n---\n\n## 8. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - AC-014, REQ-014 through REQ-016\n- [adr.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/adr.md) - ADR-004 Platform Abstraction Layer\n- [plan.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/plan.md) - Phase 4 Platform Abstraction\n- [roadmap.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/roadmap.md) - M4: Cross-Platform Ready\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md) - T-053 through T-060\n\n---\n\n*Task: V-014 | Phase: Validation (Phase 4) | Priority: P1 (Cross-Platform)*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-014",
		"dependencies": ["T-057"],
		"estimate_hours": 2,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-014-verify-pal-abstracts-all-fs-path.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-014-verify-pal-abstracts-all-fs-path.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	},
	{
		"title": "V-015: Verify Deprecated Files Removed and Content Migrated",
		"body": "# V-015: Verify Deprecated Files Removed and Content Migrated\n\n## Overview\n\n**Task ID**: V-015\n**Phase**: Validation\n**Priority**: P1 (Cleanup Critical)\n**Estimate**: 3h\n**Dependencies**: All Phase tasks (T-001 through T-067)\n**References**: spec.md (consolidation goals), plan.md (migration targets)\n\n---\n\n## Source\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-015-verify-deprecated-files-removed.md\n\n\n## Parent Issue\n\n- https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975\n\n\n## 1. Overview\n\n### What\n\nVerify that all deprecated files, stubs, and legacy code have been properly deleted, and that their content was either:\n1. **Deleted** (if obsolete)\n2. **Merged** (into consolidated modules)\n3. **Migrated** (to new locations with proper references)\n\n### Why\n\n- **Code Hygiene**: Prevents confusion from orphaned or duplicate code\n- **Bundle Size**: Eliminates dead code from production builds\n- **Maintainability**: Ensures single source of truth for all functionality\n- **Documentation Integrity**: Confirms migration guides are accurate\n\n### Context from Spec-Kit\n\nFrom spec.md consolidation goals:\n> \"Eliminate redundant tooling and consolidate into unified frameworks\"\n\nFrom plan.md Phase 3:\n> \"Consolidate 11 prompt builders into unified framework\"\n\nFrom roadmap.md metrics:\n> \"Tools: 35 ‚Üí 28 (-20% surface, +100% coverage)\"\n> \"Files: Eliminate redundant tool files through consolidation\"\n\n### Deliverables\n\n- Audit report of all removed files with disposition (deleted/merged/migrated)\n- Verification that no orphaned imports exist\n- Confirmation that migration references are valid\n- Dead code detection report (zero findings expected)\n\n## 2. Context and Scope\n\n### Files Expected to be Removed/Consolidated\n\nBased on consolidation plan, the following patterns should be verified:\n\n| Category | Original Location | Expected Disposition | Target |\n| ---------------------- | ----------------------------- | -------------------- | ------------------------------- |\n| Legacy prompt builders | `src/tools/prompt/*.ts` | Merged | `src/tools/prompt/framework/` |\n| Duplicate utilities | `src/tools/shared/utils/*.ts` | Merged | `src/tools/shared/` |\n| Old shell scripts | `scripts/*.sh` | Migrated | `scripts/*.ts` (cross-platform) |\n| Legacy test files | `tests/unit/*.test.ts` | Migrated | `tests/vitest/*.spec.ts` |\n| Deprecated configs | `./*.config.js` | Deleted | N/A (superseded) |\n| Draft documentation | `docs/draft-*.md` | Merged | `docs/*.md` |\n\n### Out of Scope\n\n- Files that are intentionally kept for backward compatibility\n- External dependency files (node_modules, etc.)\n- Generated files (dist/, coverage/)\n\n## 3. Prerequisites\n\n### Dependencies\n\n- All Phase 1-5 tasks completed\n- Version control history available for audit\n\n### Target Files\n\n- `artifacts/file-removal-audit.json` (generated)\n- `artifacts/migration-map.json` (generated)\n- `artifacts/dead-code-report.md` (generated)\n\n### Tooling\n\n- Node.js 22.x\n- `knip` for dead code detection\n- `madge` for circular dependency detection\n- Custom audit scripts\n\n## 4. Validation Guide\n\n### Step 4.1: Generate File Removal Audit\n\nCreate `scripts/audit-file-removals.ts`:\n\n\n## Implementation Details\n\nSummary: See code snippets below for implementation guidance.\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\nimport { execSync } from 'node:child_process';\n\ninterface FileRemovalRecord {\n originalPath: string;\n disposition: 'deleted' | 'merged' | 'migrated';\n targetPath?: string;\n reason: string;\n commit?: string;\n verified: boolean;\n}\n\ninterface AuditResult {\n timestamp: string;\n totalRemovals: number;\n byDisposition: Record<string, number>;\n records: FileRemovalRecord[];\n orphanedImports: string[];\n invalidReferences: string[];\n}\n\n/**\n * Audit file removals from git history\n */\nexport async function auditFileRemovals(repoPath: string): Promise<AuditResult> {\n // Get deleted files from git\n const deletedFiles = execSync(\n 'git log --diff-filter=D --summary --since=\"2025-01-01\" | grep \"delete mode\" | awk \\'{print $4}\\'',\n { cwd: repoPath, encoding: 'utf-8' }\n ).split('\\n').filter(Boolean);\n\n // Get renamed/moved files\n const renamedFiles = execSync(\n 'git log --diff-filter=R --summary --since=\"2025-01-01\" -M | grep \"rename\"',\n { cwd: repoPath, encoding: 'utf-8' }\n ).split('\\n').filter(Boolean);\n\n const records: FileRemovalRecord[] = [];\n\n // Process deleted files\n for (const file of deletedFiles) {\n const record = await classifyRemoval(file, repoPath);\n records.push(record);\n }\n\n // Check for orphaned imports\n const orphanedImports = await findOrphanedImports(repoPath, deletedFiles);\n\n // Check for invalid references in documentation\n const invalidReferences = await findInvalidReferences(repoPath);\n\n return {\n timestamp: new Date().toISOString(),\n totalRemovals: records.length,\n byDisposition: groupByDisposition(records),\n records,\n orphanedImports,\n invalidReferences,\n };\n}\n\nasync function classifyRemoval(filePath: string, repoPath: string): Promise<FileRemovalRecord> {\n // Check git log for context\n const commitInfo = execSync(\n `git log --oneline -1 -- \"${filePath}\"`,\n { cwd: repoPath, encoding: 'utf-8' }\n ).trim();\n\n const commitMessage = commitInfo.toLowerCase();\n\n let disposition: 'deleted' | 'merged' | 'migrated' = 'deleted';\n let targetPath: string | undefined;\n let reason = 'Removed as obsolete';\n\n if (commitMessage.includes('merge') || commitMessage.includes('consolidate')) {\n disposition = 'merged';\n reason = 'Merged into consolidated module';\n targetPath = extractTargetFromCommit(commitMessage);\n } else if (commitMessage.includes('migrate') || commitMessage.includes('move')) {\n disposition = 'migrated';\n reason = 'Migrated to new location';\n targetPath = extractTargetFromCommit(commitMessage);\n }\n\n return {\n originalPath: filePath,\n disposition,\n targetPath,\n reason,\n commit: commitInfo.split(' ')[0],\n verified: targetPath ? await verifyTarget(targetPath, repoPath) : true,\n };\n}\n\nasync function findOrphanedImports(repoPath: string, deletedFiles: string[]): Promise<string[]> {\n const orphaned: string[] = [];\n\n for (const deleted of deletedFiles) {\n const basename = path.basename(deleted, path.extname(deleted));\n\n // Search for imports of deleted file\n try {\n const matches = execSync(\n `grep -r \"from.*${basename}\" src/ --include=\"*.ts\" -l 2>/dev/null || true`,\n { cwd: repoPath, encoding: 'utf-8' }\n ).split('\\n').filter(Boolean);\n\n orphaned.push(...matches.map(m => `${m} imports deleted file: ${deleted}`));\n } catch {\n // No matches found\n }\n }\n\n return orphaned;\n}\n\nasync function findInvalidReferences(repoPath: string): Promise<string[]> {\n const invalid: string[] = [];\n\n // Check markdown files for broken internal links\n const mdFiles = execSync(\n 'find docs -name \"*.md\" -type f',\n { cwd: repoPath, encoding: 'utf-8' }\n ).split('\\n').filter(Boolean);\n\n for (const mdFile of mdFiles) {\n const content = fs.readFileSync(path.join(repoPath, mdFile), 'utf-8');\n const linkPattern = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\n let match;\n\n while ((match = linkPattern.exec(content)) !== null) {\n const linkTarget = match[2];\n if (linkTarget.startsWith('http')) continue;\n if (linkTarget.startsWith('#')) continue;\n\n const resolvedPath = path.resolve(path.dirname(path.join(repoPath, mdFile)), linkTarget);\n if (!fs.existsSync(resolvedPath)) {\n invalid.push(`${mdFile}: broken link to ${linkTarget}`);\n }\n }\n }\n\n return invalid;\n}\n\nfunction groupByDisposition(records: FileRemovalRecord[]): Record<string, number> {\n return records.reduce((acc, r) => {\n acc[r.disposition] = (acc[r.disposition] || 0) + 1;\n return acc;\n }, {} as Record<string, number>);\n}\n```\n\n### Step 4.2: Run Dead Code Detection\n\nCreate `scripts/detect-dead-code.ts`:\n\n```typescript\nimport { execSync } from 'node:child_process';\n\ninterface DeadCodeResult {\n unusedExports: string[];\n unusedFiles: string[];\n unusedDependencies: string[];\n circularDependencies: string[][];\n}\n\n/**\n * Detect dead code using knip and madge\n */\nexport async function detectDeadCode(repoPath: string): Promise<DeadCodeResult> {\n // Run knip for unused exports and files\n let knipOutput: string;\n try {\n knipOutput = execSync('npx knip --reporter json', {\n cwd: repoPath,\n encoding: 'utf-8',\n });\n } catch (error: any) {\n knipOutput = error.stdout || '{}';\n }\n\n const knipResult = JSON.parse(knipOutput || '{}');\n\n // Run madge for circular dependencies\n let madgeOutput: string;\n try {\n madgeOutput = execSync('npx madge --circular --json src/', {\n cwd: repoPath,\n encoding: 'utf-8',\n });\n } catch (error: any) {\n madgeOutput = error.stdout || '[]';\n }\n\n const circularDeps = JSON.parse(madgeOutput || '[]');\n\n return {\n unusedExports: knipResult.unusedExports || [],\n unusedFiles: knipResult.unusedFiles || [],\n unusedDependencies: knipResult.unusedDependencies || [],\n circularDependencies: circularDeps,\n };\n}\n```\n\n### Step 4.3: Verify Migration Map\n\nCreate `scripts/verify-migrations.ts`:\n\n```typescript\nimport * as fs from 'node:fs';\nimport * as path from 'node:path';\n\ninterface MigrationEntry {\n source: string;\n target: string;\n type: 'file' | 'export' | 'function';\n verified: boolean;\n notes?: string;\n}\n\ninterface MigrationMap {\n version: string;\n migrations: MigrationEntry[];\n summary: {\n total: number;\n verified: number;\n failed: number;\n };\n}\n\n/**\n * Expected migrations from consolidation plan\n */\nconst EXPECTED_MIGRATIONS: MigrationEntry[] = [\n // Prompt builder consolidation\n {\n source: 'src/tools/prompt/hierarchical-prompt-builder.ts',\n target: 'src/tools/prompt/framework/prompt-framework.ts',\n type: 'export',\n verified: false,\n },\n {\n source: 'src/tools/prompt/domain-neutral-prompt-builder.ts',\n target: 'src/tools/prompt/framework/prompt-framework.ts',\n type: 'export',\n verified: false,\n },\n // Test file migrations\n {\n source: 'tests/unit/',\n target: 'tests/vitest/',\n type: 'file',\n verified: false,\n },\n // Shell script migrations\n {\n source: 'scripts/*.sh',\n target: 'scripts/*.ts',\n type: 'file',\n verified: false,\n },\n];\n\nexport async function verifyMigrations(repoPath: string): Promise<MigrationMap> {\n const migrations = [...EXPECTED_MIGRATIONS];\n\n for (const migration of migrations) {\n migration.verified = await verifyMigration(migration, repoPath);\n }\n\n const verified = migrations.filter(m => m.verified).length;\n const failed = migrations.filter(m => !m.verified).length;\n\n return {\n version: '0.14.0',\n migrations,\n summary: {\n total: migrations.length,\n verified,\n failed,\n },\n };\n}\n\nasync function verifyMigration(entry: MigrationEntry, repoPath: string): Promise<boolean> {\n const targetPath = path.join(repoPath, entry.target);\n\n if (entry.type === 'file') {\n // For file migrations, check target exists\n return fs.existsSync(targetPath);\n }\n\n if (entry.type === 'export') {\n // For export migrations, check target file contains expected export\n if (!fs.existsSync(targetPath)) return false;\n const content = fs.readFileSync(targetPath, 'utf-8');\n const sourceName = path.basename(entry.source, '.ts');\n return content.includes(sourceName) || content.includes('export');\n }\n\n return false;\n}\n```\n\n### Step 4.4: Generate Final Report\n\nCreate `scripts/generate-removal-report.ts`:\n\n```typescript\nimport { auditFileRemovals } from './audit-file-removals.js';\nimport { detectDeadCode } from './detect-dead-code.js';\nimport { verifyMigrations } from './verify-migrations.js';\nimport * as fs from 'node:fs';\n\nasync function main() {\n const repoPath = process.cwd();\n\n console.log('üìã Auditing file removals...');\n const removalAudit = await auditFileRemovals(repoPath);\n\n console.log('üîç Detecting dead code...');\n const deadCode = await detectDeadCode(repoPath);\n\n console.log('‚úÖ Verifying migrations...');\n const migrations = await verifyMigrations(repoPath);\n\n // Generate report\n const report = `\n# V-015 Validation Report: Deprecated Files Removed\n\nGenerated: ${new Date().toISOString()}\n\n## Summary\n\n| Metric | Value | Status |\n| --------------------- | ---------------------------------------------------------- | ---------------------------------------------------------- |\n| Files Removed | ${removalAudit.totalRemovals} | ‚úÖ |\n| Orphaned Imports | ${removalAudit.orphanedImports.length} | ${removalAudit.orphanedImports.length === 0 ? '‚úÖ' : '‚ùå'} |\n| Invalid References | ${removalAudit.invalidReferences.length} | ${removalAudit.invalidReferences.length === 0 ? '‚úÖ' : '‚ùå'} |\n| Unused Exports | ${deadCode.unusedExports.length} | ${deadCode.unusedExports.length === 0 ? '‚úÖ' : '‚ö†Ô∏è'} |\n| Unused Files | ${deadCode.unusedFiles.length} | ${deadCode.unusedFiles.length === 0 ? '‚úÖ' : '‚ùå'} |\n| Circular Dependencies | ${deadCode.circularDependencies.length} | ${deadCode.circularDependencies.length === 0 ? '‚úÖ' : '‚ö†Ô∏è'} |\n| Migrations Verified | ${migrations.summary.verified}/${migrations.summary.total} | ${migrations.summary.failed === 0 ? '‚úÖ' : '‚ùå'} |\n\n## File Removal Disposition\n\n| Disposition | Count |\n| ----------- | ---------------------------------------- |\n| Deleted | ${removalAudit.byDisposition['deleted'] | | 0} |\n| Merged | ${removalAudit.byDisposition['merged'] | | 0} |\n| Migrated | ${removalAudit.byDisposition['migrated'] | | 0} |\n\n## Issues Found\n\n${removalAudit.orphanedImports.length > 0 ? `\n### Orphaned Imports\n${removalAudit.orphanedImports.map(o => `- ${o}`).join('\\n')}\n` : '‚úÖ No orphaned imports found'}\n\n${removalAudit.invalidReferences.length > 0 ? `\n### Invalid References\n${removalAudit.invalidReferences.map(r => `- ${r}`).join('\\n')}\n` : '‚úÖ No invalid references found'}\n\n${deadCode.unusedFiles.length > 0 ? `\n### Unused Files\n${deadCode.unusedFiles.map(f => `- ${f}`).join('\\n')}\n` : '‚úÖ No unused files detected'}\n\n## Validation Result\n\n${removalAudit.orphanedImports.length === 0 &&\n removalAudit.invalidReferences.length === 0 &&\n deadCode.unusedFiles.length === 0 &&\n migrations.summary.failed === 0\n ? '‚úÖ **PASS**: All deprecated files properly removed and migrated'\n : '‚ùå **FAIL**: Issues found - see details above'}\n`;\n\n fs.writeFileSync('artifacts/v015-removal-report.md', report);\n fs.writeFileSync('artifacts/file-removal-audit.json', JSON.stringify(removalAudit, null, 2));\n fs.writeFileSync('artifacts/migration-map.json', JSON.stringify(migrations, null, 2));\n\n console.log('\\\\nüìÑ Report generated: artifacts/v015-removal-report.md');\n\n // Exit with error if validation failed\n if (removalAudit.orphanedImports.length > 0 ||\n removalAudit.invalidReferences.length > 0 ||\n deadCode.unusedFiles.length > 0) {\n process.exit(1);\n }\n}\n\nmain().catch(console.error);\n```\n\n## 5. Testing Strategy\n\n- Run audit scripts after each phase completion\n- Integrate into CI as post-consolidation check\n- Manual review of migration map for accuracy\n\n## 6. Risks and Mitigations\n\n| Risk | Likelihood | Impact | Mitigation |\n| -------------------------------------- | ---------- | ------ | ---------------------------------- |\n| False positives in dead code detection | Medium | Low | Manual review of flagged items |\n| Missing migration records | Low | Medium | Comprehensive git log analysis |\n| Circular dependencies introduced | Low | High | madge CI check with zero tolerance |\n| Orphaned imports cause build failures | High | High | TypeScript strict mode catches |\n\n## 7. Acceptance Criteria\n\n| Criterion | Status | Verification |\n| ------------------------------------- | ------ | ----------------------------------------- |\n| Zero orphaned imports in src/ | ‚¨ú | `grep_search` + TypeScript build |\n| Zero invalid documentation references | ‚¨ú | Link checker script |\n| All migrations verified in map | ‚¨ú | `scripts/verify-migrations.ts` |\n| Zero unused files detected by knip | ‚¨ú | `npx knip` |\n| Zero circular dependencies | ‚¨ú | `npx madge --circular src/` |\n| Audit report generated | ‚¨ú | `artifacts/v015-removal-report.md` exists |\n\n## 8. npm Scripts\n\nAdd to `package.json`:\n\n```json\n{\n \"scripts\": {\n \"validate:removals\": \"tsx scripts/generate-removal-report.ts\",\n \"audit:dead-code\": \"npx knip\",\n \"audit:circular\": \"npx madge --circular src/\",\n \"audit:links\": \"tsx scripts/check-doc-links.ts\"\n }\n}\n```\n\n## 9. CI Integration\n\nAdd to `.github/workflows/quality.yml`:\n\n```yaml\n- name: V-015 Validate File Removals\n run: npm run validate:removals\n\n- name: Upload Removal Audit\n uses: actions/upload-artifact\n with:\n name: removal-audit\n path: |\n artifacts/v015-removal-report.md\n artifacts/file-removal-audit.json\n artifacts/migration-map.json\n```\n\n---\n\n## 10. References\n\n- [spec.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/spec.md) - Consolidation goals\n- [plan.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/plan.md) - Migration targets\n- [tasks.md](https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks.md) - Phase completion checklist\n\n---\n\n*Task: V-015 | Phase: Validation | Priority: P1*\n",
		"labels": ["v0.14.x", "testing", "P1-high"],
		"milestone": 24,
		"parent_issue": 975,
		"parent_issue_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/issues/975",
		"phase": "validation",
		"priority": "P1",
		"task_id": "V-015",
		"dependencies": ["T-001", "T-067"],
		"estimate_hours": 3,
		"source_path": "plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-015-verify-deprecated-files-removed.md",
		"source_url": "https://github.com/Anselmoo/mcp-ai-agent-guidelines/blob/main/plan-v0.14.x/speckit-v0.14.x-strategic-consolidation/tasks/validation/V-015-verify-deprecated-files-removed.md",
		"child_issue_query": "",
		"child_task_ids": [],
		"inconsistencies": [],
		"mermaid": {
			"flow": "graph TD\n  A[Load task file] --> B[Extract metadata]\n  B --> C[Normalize fields]\n  C --> D[Build issue body]\n  D --> E[Emit JSON]",
			"class": "classDiagram\n  class Issue {\n    +title\n    +body\n    +labels\n    +milestone\n  }\n  class Mermaid {\n    +flow\n    +class\n    +sequence\n    +risk_matrix\n  }\n  Issue --> Mermaid",
			"sequence": "sequenceDiagram\n  participant User\n  participant Script\n  participant GitHubCLI\n  participant GitHubAPI\n  User->>Script: Run generator\n  Script-->>User: JSON output\n  Script->>GitHubCLI: gh issue create (optional)\n  GitHubCLI->>GitHubAPI: Create issue\n  GitHubAPI-->>GitHubCLI: Issue URL\n  GitHubCLI-->>Script: URL\n  Script-->>User: Creation summary",
			"risk_matrix": "quadrantChart\n  title Risk Matrix\n  x-axis Low Impact --> High Impact\n  y-axis Low Likelihood --> High Likelihood\n  quadrant-1 Low Likelihood / High Impact\n  quadrant-2 High Likelihood / High Impact\n  quadrant-3 High Likelihood / Low Impact\n  quadrant-4 Low Likelihood / Low Impact\n  \"Schema mismatch\" : [0.7, 0.3]\n  \"Missing labels\" : [0.6, 0.7]\n  \"Dependency error\" : [0.4, 0.6]\n  \"Large payload\" : [0.3, 0.4]"
		}
	}
]
